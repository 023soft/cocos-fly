!function(t,i,s){function n(s,r){var e=i[s];if(!e){var c=t[s];if(!c){var o="function"==typeof require&&require;if(!r&&o)return o(s,!0);if(h)return h(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var a={};e=i[s]={exports:a},c[0](function(t){return n(c[1][t]||t)},e,a)}return e.exports}for(var h="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r])}({1:[function(t,i,s){function n(){cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),e&&e()}function h(){window.removeEventListener("load",h,!1),n()}cc._LogInfos=cc._LogInfos||{},window.CocosEngine=cc.ENGINE_VERSION="1.6.1",cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys");var r=!1,e=null;cc._engineLoaded=!1,cc.initEngine=function(t,i){if(r){var s=e;e=function(){s&&s(),i&&i()}}else e=i,!cc.game.config&&t?cc.game.config=t:cc.game.config||cc.game._loadConfig(),function(t){var i=cc.game.CONFIG_KEY,s=parseInt(t[i.renderMode])||0;(isNaN(s)||s>2||s<0)&&(t[i.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===s?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===s&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===s&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}(t=cc.game.config),document.body?n():window.addEventListener("load",h,!1),r=!0}},{"./cocos2d/core/platform/CCSys":181,"./cocos2d/core/utils":222}],2:[function(t,i,s){function n(t,i){return function(s){"use strict";if(1!==arguments.length){var n="";2===arguments.length?n="Arguments: "+arguments[1]:arguments.length>2&&(n="Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")),t(i+" "+s+", please go to "+r+"#"+s+" to see details. "+n)}else t(i+" "+s+", please go to "+r+"#"+s+" to see details.")}}cc._logToWebPage=function(t){if(cc._canvas){var i=cc._logList,s=document;if(!i){var n=s.createElement("Div"),h=n.style;n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),h.zIndex="99999",h.position="absolute",h.top="0",h.left="0";var r=(i=cc._logList=s.createElement("textarea")).style;i.setAttribute("rows","20"),i.setAttribute("cols","30"),i.setAttribute("disabled",!0),n.appendChild(i),r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderRightWidth="0px",r.borderLeftWidth="0px",r.borderTopWidth="0px",r.borderTopStyle="none",r.borderRightStyle="none",r.borderLeftStyle="none",r.padding="0px",r.margin=0}i.value=i.value+t+"\r\n",i.scrollTop=i.scrollHeight}};var h=t("./cocos2d/core/platform/CCEnum");cc.DebugMode=h({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}),cc.log||console.log,cc._initDebugSetting=function(t){if(cc.log=cc.logID=cc.warn=cc.warnID=cc.error=cc.errorID=cc._throw=cc.assert=cc.assertID=function(){},t!==cc.DebugMode.NONE){var i;t>cc.DebugMode.ERROR?(i=cc._logToWebPage.bind(cc),cc.error=function(){i("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,s){"use strict";!t&&s&&(s=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),i("ASSERT: "+s))},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){i(cc.js.formatStr.apply(null,arguments))})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,i){if(!t)throw i&&(i=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(i)}),t!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)}),cc.warnID=n(cc.warn,"Warning"),cc.errorID=n(cc.error,"Error"),cc.logID=n(cc.log,"Log");var s=n(function(){for(var t=[!1],i=0;i<arguments.length;++i)t.push(arguments[i]);cc.assert.apply(null,t)},"Assert");cc.assertID=function(t){"use strict";t||s.apply(null,cc.js.shiftArguments.apply(null,arguments))}}},cc._throw=function(t){var i=t.stack;i?cc.error(i):cc.error(t)};var r="https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md"},{"./cocos2d/core/platform/CCEnum":174}],3:[function(t,i,s){},{}],4:[function(t,i,s){cc.Action=cc._Class.extend({ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.logID(1006)},update:function(t){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,i){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,i)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,i){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=i,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,i){return new cc.Speed(t,i)},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,i){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(i?this.initWithTarget(t,i):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,i=this._worldRect,s=new cc.Rect(i.x,i.y,i.width,i.height);return t.initWithTarget(this._followedNode,s),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,i){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");i=i||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=i,this._boundarySet=!cc._rectEqualToZero(i),this._boundaryFullyCovered=!1;var s=cc.director.getWinSize();return this._fullScreenSize=cc.p(s.width,s.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(i.x+i.width-this._fullScreenSize.x),this.rightBoundary=-i.x,this.topBoundary=-i.y,this.bottomBoundary=-(i.y+i.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(t){var i=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),s=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),n=cc.pSub(i,s),h=this.target.parent.convertToNodeSpaceAR(cc.pAdd(n,this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(h.x,this.leftBoundary,this.rightBoundary),cc.clampf(h.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(h.x,h.y)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,i){return new cc.Follow(t,i)}},{}],5:[function(t,i,s){function n(t){for(var i=[],s=t.length-1;s>=0;s--)i.push(cc.p(t[s].x,t[s].y));return i}function h(t){for(var i=[],s=0;s<t.length;s++)i.push(cc.p(t[s].x,t[s].y));return i}cc.cardinalSplineAt=function(t,i,s,n,h,r){var e=r*r,c=e*r,o=(1-h)/2,u=o*(2*e-c-r),a=o*(-c+e)+(2*c-3*e+1),f=o*(c-2*e+r)+(-2*c+3*e),l=o*(c-e),v=t.x*u+i.x*a+s.x*f+n.x*l,d=t.y*u+i.y*a+s.y*f+n.y*l;return cc.p(v,d)},cc.getControlPointAt=function(t,i){return t[Math.min(t.length-1,Math.max(i,0))]},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==s&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){if(!i||0===i.length)throw new Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(i),this._tension=s,!0)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,h(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var i,s,n=this._points;if(1===t)i=n.length-1,s=1;else{var h=this._deltaT;s=(t-h*(i=0|t/h))/h}var r=cc.cardinalSplineAt(cc.getControlPointAt(n,i-1),cc.getControlPointAt(n,i-0),cc.getControlPointAt(n,i+1),cc.getControlPointAt(n,i+2),this._tension,s);if(cc.macro.ENABLE_STACKABLE_ACTIONS){var e,c;if(e=this.target.getPositionX()-this._previousPosition.x,c=this.target.getPositionY()-this._previousPosition.y,0!==e||0!==c){var o=this._accumulatedDiff;e=o.x+e,c=o.y+c,o.x=e,o.y=c,r.x+=e,r.y+=c}}this.updatePosition(r)},reverse:function(){var t=n(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,i,s){return new cc.CardinalSplineTo(t,i,s)},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,i,s){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==s&&this.initWithDuration(t,i,s)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,i=this._points.slice(),s=i[0],h=1;h<i.length;++h)t=i[h],i[h]=cc.pSub(t,s),s=t;var r=n(i);for(s=r[r.length-1],r.pop(),s.x=-s.x,s.y=-s.y,r.unshift(s),h=1;h<r.length;++h)(t=r[h]).x=-t.x,t.y=-t.y,t.x+=s.x,t.y+=s.y,r[h]=t,s=t;return cc.cardinalSplineBy(this._duration,r,this._tension)},updatePosition:function(t){var i=this._startPosition,s=t.x+i.x,n=t.y+i.y;this._previousPosition.x=s,this._previousPosition.y=n,this.target.setPosition(s,n)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,h(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,i,s){return new cc.CardinalSplineBy(t,i,s)},cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,i){i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,i,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,h(this._points)),t}}),cc.catmullRomTo=function(t,i){return new cc.CatmullRomTo(t,i)},cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,i){cc.CardinalSplineBy.prototype.ctor.call(this),i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,i,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,h(this._points)),t}}),cc.catmullRomBy=function(t,i){return new cc.CatmullRomBy(t,i)}},{}],6:[function(t,i,s){cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0)},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,i){cc.ActionEase.prototype.ctor.call(this),void 0!==i&&this.initWithAction(t,i)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,i){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=i,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,i){return new cc.EaseRateAction(t,i)},cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){(t*=2)<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:1-Math.pow(2,-10*t))},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialOutObj={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t=(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,i){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,i)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,i){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==i?.3:i,!0},reverse:function(){return cc.logID(1009),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var i=0;if(0===t||1===t)i=t;else{var s=this._period/4;t-=1,i=-Math.pow(2,10*t)*Math.sin((t-s)*Math.PI*2/this._period)}this._inner.update(i)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var i=0;if(0===t||1===t)i=t;else{var s=this._period/4;i=Math.pow(2,-10*t)*Math.sin((t-s)*Math.PI*2/this._period)+1}this._inner.update(i)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var i=0,s=this._period;if(0===t||1===t)i=t;else{t*=2,s||(s=this._period=.3*1.5);var n=s/4;i=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/s):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/s)*.5+1}this._inner.update(i)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var i=0,s=this._period;if(0===t||1===t)i=t;else{t*=2,s||(s=this._period=.3*1.5);var n=s/4;i=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/s):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/s)*.5+1}return i},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var i=1-this.bounceTime(1-t);this._inner.update(i)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var i=this.bounceTime(t);this._inner.update(i)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var i=0;t<.5?(t*=2,i=.5*(1-this.bounceTime(1-t))):i=.5*this.bounceTime(2*t-1)+.5,this._inner.update(i)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc._easeBounceInOutObj={easing:function(t){var i;return t<.5?(t*=2,i=.5*(1-cc._bounceTime(1-t))):i=.5*cc._bounceTime(2*t-1)+.5,i},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:t*t*(2.70158*t-1.70158),this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackInObj={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){t-=1,this._inner.update(t*t*(2.70158*t+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackOutObj={easing:function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){(t*=2)<1?this._inner.update(t*t*(3.5949095*t-2.5949095)/2):(t-=2,this._inner.update(t*t*(3.5949095*t+2.5949095)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc._easeBackInOutObj={easing:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,i,s,n,h){return Math.pow(1-h,3)*t+3*h*Math.pow(1-h,2)*i+3*Math.pow(h,2)*(1-h)*s+Math.pow(h,3)*n},update:function(t){var i=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(i)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,i,s,n){this._p0=t||0,this._p1=i||0,this._p2=s||0,this._p3=n||0}}),cc.easeBezierAction=function(t,i,s,n){return{easing:function(h){return cc.EaseBezierAction.prototype._updateTime(t,i,s,n,h)},reverse:function(){return cc.easeBezierAction(n,s,i,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-((t-=1)*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return(t-=1)*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return(t-=1)*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut}},{}],7:[function(t,i,s){cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){for(var i=this.target.getComponentsInChildren(cc._SGComponent),s=0;s<i.length;++s)i[s].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(t){for(var i=this.target.getComponentsInChildren(cc._SGComponent),s=0;s<i.length;++s)i[s].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){for(var i=this.target.getComponentsInChildren(cc._SGComponent),s=0;s<i.length;++s){var n=i[s];n.enabled=!n.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this._(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},_:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,i){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(i=t.y,t=t.x),this.initWithPosition(t,i))},initWithPosition:function(t,i){return this._x=t,this._y=i,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,i){return new cc.Place(t,i)},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,i,s){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,i,s)},initWithFunction:function(t,i,s){return t&&(this._function=t),i&&(this._selectorTarget=i),void 0!==s&&(this._data=s),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,i,s){return new cc.CallFunc(t,i,s)}},{}],8:[function(t,i,s){cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var i=0;i<this._easeList.length;i++)t._easeList.push(this._easeList[i].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var i=0;i<arguments.length;i++)this._easeList.push(arguments[i]);return this},_computeEaseTime:function(t){var i=this._easeList;if(!i||0===i.length)return t;for(var s=0,n=i.length;s<n;s++)t=i[s].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var i=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);i=1>i?i:1,this.update(i>0?i:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(t){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(t){return t<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var i=t instanceof Array?t:arguments;if(1!==i.length){var s=i.length-1;if(s>=0&&null==i[s]&&cc.logID(1015),s>=0){for(var n,h=i[0],r=1;r<s;r++)i[r]&&(n=h,h=cc.Sequence._actionOneTwo(n,i[r]));this.initWithTwoActions(h,i[s])}}else cc.errorID(1019)},initWithTwoActions:function(t,i){if(!t||!i)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var s=t._duration+i._duration;return this.initWithDuration(s),this._actions[0]=t,this._actions[1]=i,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var i,s,n=0,h=this._split,r=this._actions,e=this._last;(t=this._computeEaseTime(t))<h?(i=0!==h?t/h:1,0===n&&1===e&&(r[1].update(0),r[1].stop())):(n=1,i=1===h?1:(t-h)/(1-h),-1===e&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),e||(r[0].update(1),r[0].stop())),s=r[n],e===n&&s.isDone()||(e!==n&&s.startWithTarget(this.target),i*=s._timesForRepeat,s.update(i>1?i%1:i),this._last=n)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var i=t instanceof Array?t:arguments;if(1===i.length)return cc.errorID(1019),null;var s=i.length-1;s>=0&&null==i[s]&&cc.logID(1015);var n=null;if(s>=0){n=i[0];for(var h=1;h<=s;h++)i[h]&&(n=cc.Sequence._actionOneTwo(n,i[h]))}return n},cc.Sequence._actionOneTwo=function(t,i){var s=new cc.Sequence;return s.initWithTwoActions(t,i),s},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithAction(t,i)},initWithAction:function(t,i){var s=t._duration*i;return!!this.initWithDuration(s)&&(this._times=i,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var i=this._innerAction,s=this._duration,n=this._times,h=this._nextDt;if(t>=h){for(;t>h&&this._total<n;)i.update(1),this._total++,i.stop(),i.startWithTarget(this.target),h+=i._duration/s,this._nextDt=h;t>=1&&this._total<n&&(i.update(1),this._total++),this._actionInstant||(this._total===n?i.stop():i.update(t-(h-i._duration/s)))}else i.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,i){return new cc.Repeat(t,i)},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var i=this._innerAction;i.step(t),i.isDone()&&(i.startWithTarget(this.target),i.step(i.getElapsed()-i._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var i=t instanceof Array?t:arguments;if(1!==i.length){var s=i.length-1;if(s>=0&&null==i[s]&&cc.logID(1015),s>=0){for(var n,h=i[0],r=1;r<s;r++)i[r]&&(n=h,h=cc.Spawn._actionOneTwo(n,i[r]));this.initWithTwoActions(h,i[s])}}else cc.errorID(1020)},initWithTwoActions:function(t,i){if(!t||!i)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var s=!1,n=t._duration,h=i._duration;return this.initWithDuration(Math.max(n,h))&&(this._one=t,this._two=i,n>h?this._two=cc.Sequence._actionOneTwo(i,cc.delayTime(n-h)):n<h&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(h-n))),s=!0),s},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var i=t instanceof Array?t:arguments;if(1===i.length)return cc.errorID(1020),null;i.length>0&&null==i[i.length-1]&&cc.logID(1015);for(var s=i[0],n=1;n<i.length;n++)null!=i[n]&&(s=cc.Spawn._actionOneTwo(s,i[n]));return s},cc.Spawn._actionOneTwo=function(t,i){var s=new cc.Spawn;return s.initWithTwoActions(t,i),s},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=i||0,this._dstAngleY=void 0!==s?s:this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var i=t.rotationX%360,s=this._dstAngleX-i;s>180&&(s-=360),s<-180&&(s+=360),this._startAngleX=i,this._diffAngleX=s,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;n>180&&(n-=360),n<-180&&(n+=360),this._diffAngleY=n},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,i,s){return new cc.RotateTo(t,i,s)},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=i||0,this._angleY=void 0!==s?s:this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,i,s){return new cc.RotateBy(t,i,s)},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==i.x&&(s=i.y,i=i.x),this._positionDelta.x=i,this._positionDelta.y=s,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var i=t.getPositionX(),s=t.getPositionY();this._previousPosition.x=i,this._previousPosition.y=s,this._startPosition.x=i,this._startPosition.y=s},update:function(t){if(t=this._computeEaseTime(t),this.target){var i=this._positionDelta.x*t,s=this._positionDelta.y*t,n=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var h=this.target.getPositionX(),r=this.target.getPositionY(),e=this._previousPosition;n.x=n.x+h-e.x,n.y=n.y+r-e.y,i+=n.x,s+=n.y,e.x=i,e.y=s,this.target.setPosition(i,s)}else this.target.setPosition(n.x+i,n.y+s)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,i,s){return new cc.MoveBy(t,i,s)},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,i,s){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,i,s)&&(void 0!==i.x&&(s=i.y,i=i.x),this._endPosition.x=i,this._endPosition.y=s,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,i,s){return new cc.MoveTo(t,i,s)},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),void 0!==s&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=i,this._endSkewY=s,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,i,s){return new cc.SkewTo(t,i,s)},cc.SkewBy=cc.SkewTo.extend({ctor:function(t,i,s){cc.SkewTo.prototype.ctor.call(this),void 0!==s&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,i,s)&&(this._skewX=i,this._skewY=s,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,i,s){return new cc.SkewBy(t,i,s)},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,i,s,n,h){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,i,s,n,h)},initWithDuration:function(t,i,s,n,h){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===h&&(h=n,n=s,s=i.y,i=i.x),this._delta.x=i,this._delta.y=s,this._height=n,this._jumps=h,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var i=t.getPositionX(),s=t.getPositionY();this._previousPosition.x=i,this._previousPosition.y=s,this._startPosition.x=i,this._startPosition.y=s},update:function(t){if(t=this._computeEaseTime(t),this.target){var i=t*this._jumps%1,s=4*this._height*i*(1-i);s+=this._delta.y*t;var n=this._delta.x*t,h=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),e=this.target.getPositionY(),c=this._previousPosition;h.x=h.x+r-c.x,h.y=h.y+e-c.y,n+=h.x,s+=h.y,c.x=n,c.y=s,this.target.setPosition(n,s)}else this.target.setPosition(h.x+n,h.y+s)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,i,s,n,h){return new cc.JumpBy(t,i,s,n,h)},cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,i,s,n,h){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,i,s,n,h)},initWithDuration:function(t,i,s,n,h){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,i,s,n,h)&&(void 0===h&&(s=i.y,i=i.x),this._endPosition.x=i,this._endPosition.y=s,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,i,s,n,h){return new cc.JumpTo(t,i,s,n,h)},cc.bezierAt=function(t,i,s,n,h){return Math.pow(1-h,3)*t+3*h*Math.pow(1-h,2)*i+3*Math.pow(h,2)*(1-h)*s+Math.pow(h,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,i){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=i,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var i=[],s=0;s<this._config.length;s++){var n=this._config[s];i.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,i),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var i=t.getPositionX(),s=t.getPositionY();this._previousPosition.x=i,this._previousPosition.y=s,this._startPosition.x=i,this._startPosition.y=s},update:function(t){if(t=this._computeEaseTime(t),this.target){var i=this._config,s=i[0].x,n=i[1].x,h=i[2].x,r=i[0].y,e=i[1].y,c=i[2].y,o=cc.bezierAt(0,s,n,h,t),u=cc.bezierAt(0,r,e,c,t),a=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var f=this.target.getPositionX(),l=this.target.getPositionY(),v=this._previousPosition;a.x=a.x+f-v.x,a.y=a.y+l-v.y,o+=a.x,u+=a.y,v.x=o,v.y=u,this.target.setPosition(o,u)}else this.target.setPosition(a.x+o,a.y+u)}},reverse:function(){var t=this._config,i=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],s=new cc.BezierBy(this._duration,i);return this._cloneDecoration(s),this._reverseEaseList(s),s}}),cc.bezierBy=function(t,i){return new cc.BezierBy(t,i)},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,i){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=i,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var i=this._startPosition,s=this._toConfig,n=this._config;n[0]=cc.pSub(s[0],i),n[1]=cc.pSub(s[1],i),n[2]=cc.pSub(s[2],i)}}),cc.bezierTo=function(t,i){return new cc.BezierTo(t,i)},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,i,s){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,i,s)},initWithDuration:function(t,i,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=i,this._endScaleY=null!=s?s:i,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,i,s){return new cc.ScaleTo(t,i,s)},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,i,s){return new cc.ScaleBy(t,i,s)},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=i,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var i=1/this._times,s=t%i;this.target.opacity=s>i/2?255:0}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,i){return new cc.Blink(t,i)},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,i)},initWithDuration:function(t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=i,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var i=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=i+(this._toOpacity-i)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,i){return new cc.FadeTo(t,i)},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,i,s,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),i instanceof cc.Color&&(n=i.b,s=i.g,i=i.r),void 0!==n&&this.initWithDuration(t,i,s,n)},initWithDuration:function(t,i,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(i,s,n),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var i=this._to;return t.initWithDuration(this._duration,i.r,i.g,i.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var i=this._from,s=this._to;i&&this.target.setColor(cc.color(i.r+(s.r-i.r)*t,i.g+(s.g-i.g)*t,i.b+(s.b-i.b)*t))}}),cc.tintTo=function(t,i,s,n){return new cc.TintTo(t,i,s,n)},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,i,s,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,i,s,n)},initWithDuration:function(t,i,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=i,this._deltaG=s,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var i=t.color;this._fromR=i.r,this._fromG=i.g,this._fromB=i.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,i,s,n){return new cc.TintBy(t,i,s,n)},cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var i=t.getDuration();if(this.initWithDuration(i*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var s=this._splitTimes;s.length=0;var n=0,h=i/t.getTotalDelayUnits(),r=t.getFrames();cc.js.array.verifyType(r,cc.AnimationFrame);for(var e=0;e<r.length;e++){var c=n*h/i;n+=r[e].getDelayUnits(),s.push(c)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.getSpriteFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){(t=this._computeEaseTime(t))<1&&((0|(t*=this._animation.getLoops()))>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1);for(var i=this._animation.getFrames(),s=i.length,n=this._splitTimes,h=this._nextFrame;h<s&&n[h]<=t;h++)_currFrameIndex=h,this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame()),this._nextFrame=h+1},reverse:function(){var t=this._animation,i=t.getFrames(),s=[];if(cc.js.array.verifyType(i,cc.AnimationFrame),i.length>0)for(var n=i.length-1;n>=0;n--){var h=i[n];if(!h)break;s.push(h.clone())}var r=new cc.SpriteFrameAnimation(s,t.getDelayPerUnit(),t.getLoops());r.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var e=new cc.Animate(r);return this._cloneDecoration(e),this._reverseEaseList(e),e},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,i){cc.ActionInterval.prototype.ctor.call(this),i&&this.initWithTarget(t,i)},initWithTarget:function(t,i){return!!this.initWithDuration(i._duration)&&(this._forcedTarget=t,this._action=i,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,i){return new cc.TargetedAction(t,i)}},{}],9:[function(t,i,s){cc.ActionManager=cc._Class.extend({_elementPool:[],_searchElementByTarget:function(t,i){for(var s=0;s<t.length;s++)if(i===t[s].target)return t[s];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null},_getElement:function(t,i){var s=this._elementPool.pop();return s||(s=new function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}),s.target=t,s.paused=!!i,s},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,i,s){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!i)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[i.__instanceId];n?n.actions||(n.actions=[]):(n=this._getElement(i,s),this._hashTargets[i.__instanceId]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(i)},removeAllActions:function(){for(var t=this._arrayTargets,i=0;i<t.length;i++){var s=t[i];s&&this.removeAllActionsFromTarget(s.target,!0)}},removeAllActionsFromTarget:function(t,i){if(null!=t){var s=this._hashTargets[t.__instanceId];s&&(s.actions.length=0,this._deleteHashElement(s))}},removeAction:function(t){if(null!=t){var i=t.getOriginalTarget(),s=this._hashTargets[i.__instanceId];if(s){for(var n=0;n<s.actions.length;n++)if(s.actions[n]===t){s.actions.splice(n,1),s.actionIndex>=n&&s.actionIndex--;break}}else cc.logID(1001)}},removeActionByTag:function(t,i){t===cc.Action.TAG_INVALID&&cc.logID(1002),cc.assertID(i,1003);var s=this._hashTargets[i.__instanceId];if(s)for(var n=s.actions.length,h=0;h<n;++h){var r=s.actions[h];if(r&&r.getTag()===t&&r.getOriginalTarget()===i){this._removeActionAtIndex(h,s);break}}},getActionByTag:function(t,i){t===cc.Action.TAG_INVALID&&cc.logID(1004);var s=this._hashTargets[i.__instanceId];if(s){if(null!=s.actions)for(var n=0;n<s.actions.length;++n){var h=s.actions[n];if(h&&h.getTag()===t)return h}cc.logID(1005,t)}return null},getNumberOfRunningActionsInTarget:function(t){var i=this._hashTargets[t.__instanceId];return i&&i.actions?i.actions.length:0},pauseTarget:function(t){var i=this._hashTargets[t.__instanceId];i&&(i.paused=!0)},resumeTarget:function(t){var i=this._hashTargets[t.__instanceId];i&&(i.paused=!1)},pauseAllRunningActions:function(){for(var t=[],i=this._arrayTargets,s=0;s<i.length;s++){var n=i[s];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.resumeTarget(t[i])},pauseTargets:function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.pauseTarget(t[i])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,i){i.actions[t],i.actions.splice(t,1),i.actionIndex>=t&&i.actionIndex--,0===i.actions.length&&this._deleteHashElement(i)},_deleteHashElement:function(t){var i=!1;if(t&&!t.lock&&this._hashTargets[t.target.__instanceId]){delete this._hashTargets[t.target.__instanceId];for(var s=this._arrayTargets,n=0,h=s.length;n<h;n++)if(s[n]===t){s.splice(n,1);break}this._putElement(t),i=!0}return i},update:function(t){for(var i,s=this._arrayTargets,n=0;n<s.length;n++){if(this._currentTarget=s[n],!(i=this._currentTarget).paused&&i.actions){for(i.lock=!0,i.actionIndex=0;i.actionIndex<i.actions.length;i.actionIndex++)if(i.currentAction=i.actions[i.actionIndex],i.currentAction){if(i.currentAction.step(t*(i.currentAction._speedMethod?i.currentAction._speed:1)),i.currentAction&&i.currentAction.isDone()){i.currentAction.stop();var h=i.currentAction;i.currentAction=null,this.removeAction(h)}i.currentAction=null}i.lock=!1}0===i.actions.length&&this._deleteHashElement(i)&&n--}}})},{}],10:[function(t,i,s){t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom")},{"./CCAction":4,"./CCActionCatmullRom":5,"./CCActionEase":6,"./CCActionInstant":7,"./CCActionInterval":8,"./CCActionManager":9}],11:[function(t,i,s){function n(t,i){e.call(this,t),this.animation=i}function h(t,i){function s(t){if(!Array.isArray(t))return!1;for(var i=0,s=t.length;i<s;i++){var n=t[i];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function n(t,n,h){var e,a=t instanceof cc.Node&&"position"===n,f=[];(e=a?new o:new c).target=t;var l,v=n.indexOf(".");-1!==v?t[l=n.slice(0,v)]:l=n,e.prop=l,e.subProps=function(t){var i=n.split(".");return i.shift(),i.length>0?i:null}();for(var d=0,p=h.length;d<p;d++){var g=h[d],m=g.frame/i.duration;if(e.ratios.push(m),a){var w=g.motionPath;w&&!s(w)&&(cc.errorID(3904,t.name,n,d),w=null),f.push(w)}var _=g.value;e.values.push(_);var C=g.curve;if(C){if("string"==typeof C){e.types.push(C);continue}if(Array.isArray(C)){C[0]===C[1]&&C[2]===C[3]?e.types.push(c.Linear):e.types.push(c.Bezier(C));continue}}e.types.push(c.Linear)}return a&&u(f,e,r.duration,r.sample),e}function h(t,i){var s=i.props,h=i.comps;if(s)for(var r in s)f=n(t,r,a=s[r]),e.push(f);if(h)for(var c in h){var o=t.getComponent(c);if(o){var u=h[c];for(var r in u){var a=u[r],f=n(o,r,a);e.push(f)}}}}var r=i.clip,e=i.curves;e.length=0,i.duration=r.duration,i.speed=r.speed,i.wrapMode=r.wrapMode,i.frameRate=r.sample,(i.wrapMode&l.Loop)===l.Loop?i.repeatCount=1/0:i.repeatCount=1;var d=r.curveData,p=d.paths;h(t,d);for(var g in p){var m=cc.find(g,t);m&&h(m,p[g])}var w=r.events;if(w)for(var _,C=0,b=w.length;C<b;C++){_||((_=new a).target=t,e.push(_));var y,T=w[C],S=T.frame/i.duration,A=v(_.ratios,S);A>=0?y=_.events[A]:(y=new f,_.ratios.push(S),_.events.push(y)),y.add(T.func,T.params)}}var r=cc.js,e=t("./animators").Animator,c=t("./animation-curves").DynamicAnimCurve,o=t("./animation-curves").SampledAnimCurve,u=t("./motion-path-helper").sampleMotionPaths,a=t("./animation-curves").EventAnimCurve,f=t("./animation-curves").EventInfo,l=t("./types").WrapModeMask,v=t("../core/utils/binary-search").binarySearchEpsilon;r.extend(n,e);var d=n.prototype;d.playState=function(t,i){t.clip&&(t.curveLoaded||h(this.target,t),this.addAnimation(t),t.animator=this,t.play(),"number"==typeof i&&t.setTime(i),this.play())},d.addAnimation=function(t){e.prototype.addAnimation.call(this,t);for(var i=this.animation._listeners,s=0,n=i.length;s<n;s++){var h=i[s];t.on(h[0],h[1],h[2],h[3])}},d.removeAnimation=function(t){e.prototype.removeAnimation.call(this,t),t.animator=null},d.sample=function(){var t=this._anims,i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].sample()},d.stopState=function(t){t&&t.stop()},d.pauseState=function(t){t&&t.pause()},d.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},d.setStateTime=function(t,i){if(void 0!==i)t&&(t.setTime(i),t.sample());else{i=t;var s=this._anims,n=s.array;for(s.i=0;s.i<n.length;++s.i){var h=n[s.i];h.setTime(i),h.sample()}}},d.onStop=function(){var t=this._anims,i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].stop();e.prototype.onStop.call(this)},d.onPause=function(){for(var t=this._anims.array,i=0;i<t.length;++i){var s=t[i];s.pause(),s.animator=null}e.prototype.onPause.call(this)},d.onResume=function(){for(var t=this._anims.array,i=0;i<t.length;++i){var s=t[i];s.animator=this,s.resume()}e.prototype.onResume.call(this)},d._reloadClip=function(t){h(this.target,t)},i.exports=n},{"../core/utils/binary-search":219,"./animation-curves":13,"./animators":16,"./motion-path-helper":20,"./types":22}],12:[function(t,i,s){var n=cc.T({name:"cc.AnimationClip",S:cc.Asset,O:{_duration:{default:0,type:"Float"},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:cc.WrapMode.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,i){if(!Array.isArray(t))return cc.errorID(3905),null;var s=new n;s.sample=i||s.sample,s._duration=t.length/s.sample;for(var h=[],r=1/s.sample,e=0,c=t.length;e<c;e++)h[e]={frame:e*r,value:t[e]};return s.curveData={comps:{"cc.Sprite":{spriteFrame:h}}},s}}});cc.AnimationClip=i.exports=n},{}],13:[function(t,i,s){function n(t,i){if("string"==typeof i){var s=cc.Easing[i];s?t=s(t):cc.errorID(3906,i)}else Array.isArray(i)&&(t=h(i,t));return t}var h=t("./bezier").bezierByTime,r=t("../core/utils/binary-search").binarySearchEpsilon,e=t("./types").WrapModeMask,c=t("./types").WrappedInfo,o=cc.T({name:"cc.AnimCurve",sample:function(t,i,s){},onTimeChangedManually:function(){}}),u=cc.T({name:"cc.DynamicAnimCurve",S:o,O:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_calcValue:function(t,i){var s=this.values,n=s[t-1],h=s[t];return"number"==typeof n?n+(h-n)*i:n&&n.lerp?n.lerp(h,i):n},_applyValue:function(t,i,s){t[i]=s},_findFrameIndex:r,sample:function(t,i,s){var h=this.values,r=this.ratios,e=r.length;if(0!==e){var c,o=this._findFrameIndex(r,i);if(o<0)if((o=~o)<=0)c=h[0];else if(o>=e)c=h[e-1];else{var u=r[o-1],a=(i-u)/(r[o]-u);a=n(a,this.types[o-1]),c=this._calcValue(o,a)}else c=h[o];var f=this.subProps;if(f){for(var l=this.target[this.prop],v=l,d=0;d<f.length-1;d++){var p=f[d];if(!v)return;v=v[p]}var g=f[f.length-1];if(!v)return;this._applyValue(v,g,c),c=l}this._applyValue(this.target,this.prop,c)}}});u.Linear=null,u.Bezier=function(t){return t};var a=cc.T({name:"cc.SampledAnimCurve",S:u,_findFrameIndex:function(t,i){var s=t.length-1;if(0===s)return 0;var n=t[0];if(i<n)return 0;var h=t[s];if(i>h)return s;var r=(i=(i-n)/(h-n))/(1/s),e=0|r;return r-e<1e-6?e:~(e+1)}}),f=function(){this.events=[]};f.prototype.add=function(t,i){this.events.push({func:t||"",params:i||[]})};var l=cc.T({name:"cc.EventAnimCurve",S:o,O:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new c}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&(t-=1),0|t},sample:function(t,i,s){var n=this.ratios.length,h=s.getWrappedInfo(s.time,this._wrappedInfo),o=h.direction,u=r(this.ratios,h.ratio);if(u<0&&(u=~u-1,o<0&&(u+=1)),this._ignoreIndex!==u&&(this._ignoreIndex=NaN),h.frameIndex=u,!this._lastWrappedInfo)return this._fireEvent(u),void(this._lastWrappedInfo=new c(h));var a=s.wrapMode,f=this._wrapIterations(h.iterations),l=this._lastWrappedInfo,v=this._wrapIterations(l.iterations),d=l.frameIndex,p=l.direction,g=-1!==v&&f!==v;if(d===u&&g&&1===n)this._fireEvent(0);else if(d!==u||g){o=p;do{if(d!==u){if(-1===o&&0===d&&u>0?((a&e.PingPong)===e.PingPong?o*=-1:d=n,v++):1===o&&d===n-1&&u<n-1&&((a&e.PingPong)===e.PingPong?o*=-1:d=-1,v++),d===u)break;if(v>f)break}d+=o,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[d])}while(d!==u&&d>-1&&d<n)}this._lastWrappedInfo.set(h)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var i=this.events[t].events;if(this.target.isValid)for(var s=this.target._components,n=0;n<i.length;n++)for(var h=i[n],r=h.func,e=0;e<s.length;e++){var c=s[e],o=c[r];o&&o.apply(c,h.params)}}},onTimeChangedManually:function(t,i){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var s=i.getWrappedInfo(t,this._wrappedInfo),n=s.direction,h=r(this.ratios,s.ratio);h<0&&(h=~h-1,n<0&&(h+=1),this._ignoreIndex=h)}});i.exports={AnimCurve:o,DynamicAnimCurve:u,SampledAnimCurve:a,EventAnimCurve:l,EventInfo:f,computeRatioByType:n}},{"../core/utils/binary-search":219,"./bezier":17,"./types":22}],14:[function(t,s,n){var h=cc.js,r=cc.T({ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._animators=new h.array.MutableForwardIterator([]),this._delayEvents=[]},update:function(t){var s=this._animators,n=s.array;for(s.i=0;s.i<n.length;++s.i){var h=n[s.i];h._isPlaying&&!h._isPaused&&h.update(t)}var r=this._delayEvents;for(i=0,l=r.length;i<l;i++){var e=r[i];e.target[e.func].apply(e.target,e.args)}r.length=0},destruct:function(){},addAnimator:function(t){-1===this._animators.array.indexOf(t)&&this._animators.push(t)},removeAnimator:function(t){var i=this._animators.array.indexOf(t);i>=0?this._animators.fastRemoveAt(i):cc.errorID(3907)},pushDelayEvent:function(t,i,s){this._delayEvents.push({target:t,func:i,args:s})}});cc.AnimationManager=s.exports=r},{}],15:[function(t,i,s){function n(t,i){r.call(this,null,null,{duration:t.length}),this._emit=this.emit,this.emit=function(){for(var t=new Array(arguments.length),i=0,s=t.length;i<s;i++)t[i]=arguments[i];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)},this._clip=t,this._name=i||t.name}var h=cc.js,r=t("./types").AnimationNode;h.extend(n,r);var e=n.prototype;h.get(e,"clip",function(){return this._clip}),h.get(e,"name",function(){return this._name}),h.obsolete(e,"AnimationState.length","duration"),h.getset(e,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0}),e.onPlay=function(){this.setTime(0),r.prototype.onPlay.call(this)},e.onStop=function(){r.prototype.onStop.call(this),this.animator&&this.animator.removeAnimation(this)},e.setTime=function(t){this.time=t||0;var i=this;this.curves.forEach(function(s){s.onTimeChangedManually(t,i)})},cc.AnimationState=i.exports=n},{"./types":22}],16:[function(t,i,s){function n(t){this.target=t,this._anims=new e.array.MutableForwardIterator([])}function h(t){n.call(this,t)}function r(t,i,s,n,h){var r=function(t,i,s){for(var n,h=0;h<t.length;h++)if((n=t[h]).target===i&&n.prop===s)return n;return null}(t,i,s);r||(r=new u,t.push(r),r.target=i,r.prop=s),r.values.push(n),r.ratios.push(h)}var e=cc.js,c=t("./playable"),o=t("./types").AnimationNode,u=t("./animation-curves").DynamicAnimCurve;e.extend(n,c);var a=n.prototype;a.update=function(t){var i=this._anims,s=i.array,n=0,h=s.length;for(i.i=0;i.i<s.length;++i.i){var r=s[i.i];r._isPlaying&&!r._isPaused&&(r.update(t),r._isPlaying||n++)}var e=n>=h;(0===s.length||e)&&this.stop()},a.stopStatesExcept=function(t){var i=this._anims,s=i.array;for(i.i=0;i.i<s.length;++i.i){var n=s[i.i];n!==t&&this.stopState(n)}},a.on=function(t,i,s,n){for(var h=this._anims.array,r=0;r<h.length;++r)h[r].on(t,i,s,n)},a.onPlay=function(){cc.director.getAnimationManager().addAnimator(this)},a.onStop=function(){this._isPaused||cc.director.getAnimationManager().removeAnimator(this)},a.onResume=function(){cc.director.getAnimationManager().addAnimator(this)},a.onPause=function(){cc.director.getAnimationManager().removeAnimator(this)},a.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},a.removeAnimation=function(t){var i=this._anims.array.indexOf(t);i>=0?this._anims.fastRemoveAt(i):cc.errorID(3908)},e.extend(h,n);var f=h.prototype;f.animate=function(t,i){if(!t)return cc.errorID(3909),null;!function(t){for(var i=0,s=0,n=t.length,h=0;h<n;h++){var r=t[h],e=r.ratio;if(0===h&&"number"!=typeof e?r.computedRatio=e=0:h===n-1&&"number"!=typeof e&&(r.computedRatio=e=1),"number"==typeof e){if(i+1<h)for(var c=(e-s)/(h-i),o=i+1;o<h;o++)s+=c,t[o].computedRatio=s;i=h,s=e}}}(t);var s=this._doAnimate(t,i);return this.play(),s},f._doAnimate=function(t,i){var s=new o(this,null,i);s.play();for(var n=s.curves,h=-1,e=0;e<t.length;e++){var c=t[e],u=c.ratio;if("number"!=typeof u&&(u=c.computedRatio),u<0)cc.errorID(3910);else if(u<h)cc.errorID(3911);else{h=u;for(var a in c){var f=c[a];if("props"===a)for(var l in f)r(n,this.target,l,f[l],u);else if("comps"===a)for(var v in f){var d=this.target.getComponent(v),p=f[v];for(var l in p)r(n,d,l,p[l],u)}}}}return this._anims.push(s),s},i.exports={Animator:n,EntityAnimator:h}},{"./animation-curves":13,"./playable":21,"./types":22}],17:[function(t,i,s){function n(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}var h=Math.cos,r=Math.acos,e=Math.max,c=2*Math.PI,o=Math.sqrt;i.exports={bezier:function(t,i,s,n,h){var r=1-h;return t*r*r*r+3*i*r*r*h+3*s*r*h*h+n*h*h*h},bezierByTime:function(t,i){var s=function(t,i){var s,u,a,f,l,v=i-0,d=i-t[0],p=3*v,g=3*d,m=3*(i-t[2]),w=1/(-v+g-m+(i-1)),_=(p-6*d+m)*w,C=_*(1/3),b=(-p+g)*w,y=1/3*(3*b-_*_),T=y*(1/3),S=(2*_*_*_-9*_*b+v*w*27)/27,A=S/2,M=A*A+T*T*T;if(M<0){var x=1/3*-y,E=o(x*x*x),O=-S/(2*E),P=r(O<-1?-1:O>1?1:O),R=2*n(E);return a=R*h(P*(1/3))-C,f=R*h((P+c)*(1/3))-C,l=R*h((P+2*c)*(1/3))-C,0<=a&&a<=1?0<=f&&f<=1?0<=l&&l<=1?e(a,f,l):e(a,f):0<=l&&l<=1?e(a,l):a:0<=f&&f<=1?0<=l&&l<=1?e(f,l):f:l}if(0===M)return s=A<0?n(-A):-n(A),a=2*s-C,f=-s-C,0<=a&&a<=1?0<=f&&f<=1?e(a,f):a:f;var I=o(M);return s=n(-A+I),u=n(A+I),a=s-u-C}(t,i),u=1-s;return 0*u*u*u+3*t[1]*s*u*u+3*t[3]*s*s*u+1*s*s*s}}},{}],18:[function(t,i,s){function n(t,i){return function(s){return s<.5?i(2*s)/2:t(2*s-1)/2+.5}}var h={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*Math.asin(1/s)/(2*Math.PI),-s*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},elasticOut:function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*Math.asin(1/s)/(2*Math.PI),s*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*Math.asin(1/s)/(2*Math.PI),(t*=2)<1?s*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4)*-.5:s*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};h.quadOutIn=n(h.quadIn,h.quadOut),h.cubicOutIn=n(h.cubicIn,h.cubicOut),h.quartOutIn=n(h.quartIn,h.quartOut),h.quintOutIn=n(h.quintIn,h.quintOut),h.sineOutIn=n(h.sineIn,h.sineOut),h.expoOutIn=n(h.expoIn,h.expoOut),h.circOutIn=n(h.circIn,h.circOut),h.backOutIn=n(h.backIn,h.backOut),h.backOutIn=n(h.backIn,h.backOut),h.bounceIn=function(t){return 1-h.bounceOut(1-t)},h.bounceInOut=function(t){return t<.5?.5*h.bounceIn(2*t):.5*h.bounceOut(2*t-1)+.5},h.bounceOutIn=n(h.bounceIn,h.bounceOut),cc.Easing=i.exports=h},{}],19:[function(t,i,s){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animators"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":11,"./animation-clip":12,"./animation-curves":13,"./animation-manager":14,"./animation-state":15,"./animators":16,"./bezier":17,"./easing":18,"./motion-path-helper":20,"./types":22}],20:[function(t,i,s){function n(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function h(){this.start=u(),this.end=u(),this.startCtrlPoint=u(),this.endCtrlPoint=u()}var r=t("./animation-curves").DynamicAnimCurve,e=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,o=t("../core/utils/binary-search").binarySearchEpsilon,u=cc.v2;n.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t,i=1;i<this.points.length;i++){var s=this.points[i-1],n=this.points[i];(t=new h).start=s.pos,t.startCtrlPoint=s.out,t.end=n.pos,t.endCtrlPoint=n.in,this.beziers.push(t),this.length+=t.getLength()}var r=0;for(i=0;i<this.beziers.length;i++)t=this.beziers[i],this.ratios[i]=t.getLength()/this.length,this.progresses[i]=r+=this.ratios[i];return this.beziers},h.prototype.getPointAt=function(t){var i=this.getUtoTmapping(t);return this.getPoint(i)},h.prototype.getPoint=function(t){var i=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),s=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new u(i,s)},h.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},h.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var i,s,n=[],h=this.getPoint(0),r=0;for(n.push(0),s=1;s<=t;s++)i=this.getPoint(s/t),r+=cc.pDistance(i,h),n.push(r),h=i;return this.cacheArcLengths=n,n},h.prototype.getUtoTmapping=function(t,i){var s,n=this.getLengths(),h=0,r=n.length;s=i||t*n[r-1];for(var e,c=0,o=r-1;c<=o;)if(h=Math.floor(c+(o-c)/2),(e=n[h]-s)<0)c=h+1;else{if(!(e>0)){o=h;break}o=h-1}if(h=o,n[h]===s)return a=h/(r-1);var u=n[h],a=(h+(s-u)/(n[h+1]-u))/(r-1);return a},i.exports={sampleMotionPaths:function(t,i,s,h){function c(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:u(t[2],t[3]),pos:u(t[0],t[1]),out:u(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function a(t,i,s){d.push(t),p.push(i),g.push(s)}var f=i.values;if(0!==t.length&&0!==f.length)if(1!==(f=f.map(function(t){return u(t[0],t[1])})).length){for(var l=i.types,v=i.ratios,d=i.values=[],p=i.types=[],g=i.ratios=[],m=0,w=r.Linear,_=0,C=t.length;_<C-1;_++){var b,y=t[_],T=v[_],S=v[_+1]-T,A=f[_],M=f[_+1],x=l[_],E=[],O=m/S,P=1/(S*s*h);if(y&&y.length>0){var R=[];R.push(c(A));for(var I=0,L=y.length;I<L;I++){var D=c(y[I]);R.push(D)}R.push(c(M));var F=new n(R);F.computeBeziers();for(var N=F.progresses;1-O>1e-6;){var k,B,G,z;if((b=e(b=O,x))<0)z=(0-b)*(B=F.beziers[0]).getLength(),G=B.start.sub(B.endCtrlPoint).normalize(),k=B.start.add(G.mul(z));else if(b>1)z=(b-1)*(B=F.beziers[F.beziers.length-1]).getLength(),G=B.end.sub(B.startCtrlPoint).normalize(),k=B.end.add(G.mul(z));else{var j=o(N,b);j<0&&(j=~j),b-=j>0?N[j-1]:0,b/=F.ratios[j],k=F.beziers[j].getPointAt(b)}E.push(k),O+=P}}else for(;1-O>1e-6;)b=e(b=O,x),E.push(A.lerp(M,b)),O+=P;for(w="constant"===x?x:r.Linear,I=0,L=E.length;I<L;I++){var V=T+m+P*I*S;a(E[I],w,V)}m=Math.abs(O-1)>1e-6?(O-1)*S:0}v[v.length-1]!==g[g.length-1]&&a(f[f.length-1],w,v[v.length-1])}else i.values=f},Curve:n,Bezier:h}},{"../core/utils/binary-search":219,"./animation-curves":13,"./bezier":17}],21:[function(t,i,s){function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var h=cc.js,r=n.prototype;h.get(r,"isPlaying",function(){return this._isPlaying},!0),h.get(r,"isPaused",function(){return this._isPaused},!0);var e=function(){};r.onPlay=e,r.onPause=e,r.onResume=e,r.onStop=e,r.onError=e,r.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},r.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},r.pause=function(){this._isPlaying&&(this._isPaused=!0,this.onPause())},r.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},r.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},i.exports=n},{}],22:[function(t,i,s){function n(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}function h(){c.call(this)}function r(t,i,s){if(h.call(this),this._firstFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new n,this._lastWrappedInfo=null,this.animator=t,this.curves=i||[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=u.Normal,s){this.delay=s.delay||this.delay;var r=s.duration;void 0!==r&&(this.duration=r);var e=s.speed;void 0!==e&&(this.speed=e);var c=s.wrapMode;if(void 0!==c){var a="number"==typeof c;this.wrapMode=a?c:u[c]}var f=s.repeatCount;void 0!==f?this.repeatCount=f:this.wrapMode&o.Loop&&(this.repeatCount=1/0)}this.time=0}var e=cc.js,c=t("./playable"),o={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},u=cc.Enum({Default:0,Normal:1,Reverse:o.Reverse,Loop:o.Loop,LoopReverse:o.Loop|o.Reverse,PingPong:o.PingPong,PingPongReverse:o.PingPong|o.Reverse});cc.WrapMode=u,n.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.extend(h,c),h.prototype.update=function(t){},e.extend(r,h);var a=r.prototype;a.update=function(t){if(!(this._delayTime>0&&(this._delayTime-=t,this._delayTime>0))){this._firstFramePlayed?this.time+=t*this.speed:this._firstFramePlayed=!0;var i=this.sample();this._lastWrappedInfo||(this._lastWrappedInfo=new n(i));var s=(0|i.iterations)>(0|this._lastWrappedInfo.iterations);this.repeatCount>1&&s&&((this.wrapMode&o.Reverse)===o.Reverse?this._lastWrappedInfo.direction<0&&this.emit("lastframe",this):this._lastWrappedInfo.direction>0&&this.emit("lastframe",this)),i.stopped&&(this.stop(),this.emit("finished",this)),this._lastWrappedInfo.set(i)}},a._needRevers=function(t){var i=this.wrapMode,s=!1;return(i&o.PingPong)===o.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(s=!s)),(i&o.Reverse)===o.Reverse&&(s=!s),s},a.getWrappedInfo=function(t,i){i=i||new n;var s=!1,h=this.duration,r=0,e=this.wrapMode,c=Math.abs(t/h);c>this.repeatCount&&(c=this.repeatCount);var u=!1;e&o.ShouldWrap&&(u=this._needRevers(c));var a=u?-1:1;if(this.speed<0&&(a*=-1),c>=this.repeatCount){s=!0;var f=this.repeatCount-(0|this.repeatCount);0===f&&(f=1),t=f*h*(t>0?1:-1)}if(t>h){var l=t%h;t=0===l?h:l}else t<0&&0!=(t%=h)&&(t+=h);return e&o.ShouldWrap&&u&&(t=h-t),r=t/h,i.ratio=r,i.time=t,i.direction=a,i.stopped=s,i.iterations=c,i},a.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),i=this.curves,s=0,n=i.length;s<n;s++)i[s].sample(t.time,t.ratio,this);return t},a.onStop=function(){this.emit("stop",this)},a.onPlay=function(){this._delayTime=this._delay,this.emit("play",this)},a.onPause=function(){this.emit("pause",this)},a.onResume=function(){this.emit("resume",this)},e.getset(a,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&o.Loop?this.repeatCount=1/0:this.repeatCount=1}),e.getset(a,"delay",function(){return this._delay},function(t){this._delayTime=this._delay=t}),cc.js.mixin(a,cc.EventTarget.prototype),cc.AnimationNode=r,i.exports={WrapModeMask:o,WrapMode:u,AnimationNode:r,WrappedInfo:n}},{"./playable":21}],23:[function(t,i,s){var n=t("../core/event/event-target"),h=!1,r=[],e=function(t){n.call(this),this._src=t,this._audioType=e.Type.UNKNOWN,this._element=null,this._eventList={},this._state=e.State.INITIALZING,this._loaded=!1,this._onended=function(){this.emit("ended")}.bind(this)};cc.js.extend(e,n),e.Type={DOM:"AUDIO",WEBAUDIO:"WEBAUDIO",NATIVE:"NATIVE",UNKNOWN:"UNKNOWN"},e.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2},function(t){t.preload=function(){var t=this._src,i=this;if(!t)return this._src="",this._audioType=e.Type.UNKNOWN,this._element=null,this._state=e.State.INITIALZING,void(this._loaded=!1);var s=cc.loader.getItem(t);if(s||(s=cc.loader.getItem(t+"?useDom=1")),!s)return cc.loader.load(t,function(s){if(!s){var n=cc.loader.getItem(t);i.mount(n.element||n.buffer),i.emit("load")}});s.complete&&(i.mount(s.element||s.buffer),i.emit("load"))},t._bindEnded=function(t){t=t||this._onended,this._audioType===e.Type.DOM?this._element.addEventListener("ended",t):this._element.onended=t},t._unbindEnded=function(){this._audioType===e.Type.DOM?this._element.removeEventListener("ended",this._onended):this._element.onended=null},t.mount=function(t){t instanceof HTMLElement?(this._element=document.createElement("audio"),this._element.src=t.src,this._audioType=e.Type.DOM):(this._element=new c(t,this),this._audioType=e.Type.WEBAUDIO),this._state=e.State.INITIALZING,this._loaded=!0},t.play=function(){this._element&&(this._bindEnded(),this._element.play(),this.emit("play"),this._state=e.State.PLAYING,this._audioType===e.Type.DOM&&this._element.paused&&r.push({instance:this,offset:0,audio:this._element}),h||(h=!0,cc.game.canvas.addEventListener("touchstart",function(){for(var t;t=r.pop();)t.audio.play(t.offset)})))},t.pause=function(){this._element&&(this._unbindEnded(),this._element.pause(),this.emit("pause"),this._state=e.State.PAUSED)},t.resume=function(){this._element&&0!==this._element.currentTime&&(this._bindEnded(),this._element.play(),this.emit("resume"),this._state=e.State.PLAYING)},t.stop=function(){if(this._element){try{this._element.currentTime=0}catch(t){}this._element.pause();for(var t=0;t<r;t++)if(r[t].instance===this){r.splice(t,1);break}this._unbindEnded(),this.emit("stop"),this._state=e.State.PAUSED}},t.setLoop=function(t){this._element&&(this._element.loop=t)},t.getLoop=function(){return this._element&&this._element.loop},t.setVolume=function(t){this._element&&(this._element.volume=t)},t.getVolume=function(){return this._element?this._element.volume:1},t.setCurrentTime=function(t){if(this._element){this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=t}catch(n){var i=this._element;if(i.addEventListener){var s=function(){i.removeEventListener("loadedmetadata",s),i.currentTime=t};i.addEventListener("loadedmetadata",s)}}}},t.getCurrentTime=function(){return this._element?this._element.currentTime:0},t.getDuration=function(){return this._element?this._element.duration:0},t.getState=function(){var t=this._element;return e.State.PLAYING===this._state&&t.paused&&(this._state=e.State.PAUSED),this._state},t.__defineGetter__("src",function(){return this._src}),t.__defineSetter__("src",function(t){return this._src=t}),t.__defineGetter__("paused",function(){return!this._element||this._element.paused})}(e.prototype);var c=function(t,i){this._audio=i,this._context=cc.sys.__audioSupport.context,this._buffer=t,this._volume=this._context.createGain(),this._volume.gain.value=1,this._volume.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};!function(t){t.play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var i=this._context.createBufferSource();i.buffer=this._buffer,i.connect(this._volume),i.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var s,n=this._buffer.duration,h=t;if(this._loop?i.start?i.start(0,h):i.notoGrainOn?i.noteGrainOn(0,h):i.noteOn(0,h):(s=n-t,i.start?i.start(0,h,s):i.notoGrainOn?i.noteGrainOn(0,h,s):i.noteOn(0,h,s)),this._currentSource=i,i.onended=this._endCallback,0===this._context.currentTime){var e=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){0===e._context.currentTime&&r.push({instance:e._audio,offset:t,audio:e})},10)}},t.pause=function(){if(clearTimeout(this._currextTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},t.__defineGetter__("paused",function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)}),t.__defineGetter__("loop",function(){return this._loop}),t.__defineSetter__("loop",function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t}),t.__defineGetter__("volume",function(){return this._volume.gain.value}),t.__defineSetter__("volume",function(t){return this._volume.gain.value=t,cc.sys.os===cc.sys.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play()),t}),t.__defineGetter__("currentTime",function(){return this.paused?this.playedLength:(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,this.playedLength)}),t.__defineSetter__("currentTime",function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t}),t.__defineGetter__("duration",function(){return this._buffer.duration})}(c.prototype),i.exports=cc.Audio=e},{"../core/event/event-target":111}],24:[function(t,i,s){var n=t("./CCAudio"),h=0,r={},e={},c=function(t){return r[t]},o={AudioState:n.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:r,play:function(t,i,s){var c=function(t){var i=h++,s=e[t];s||(s=e[t]=[]);var c;if(o._maxAudioInstance<=s.length){var u=s.shift();r[u].stop()}var a=function(){var t=this.instanceId;delete r[t];var i=s.indexOf(t);cc.js.array.fastRemoveAt(s,i)};return(c=new n(t)).on("ended",a),c.on("stop",a),r[i]=c,c.instanceId=i,s.push(i),c}(t),u=function(){c.setLoop(i||!1),("number"!=typeof s||isNaN(s))&&(s=1),c.setVolume(s),c.play()};return c.__callback=u,c.on("load",u),c.preload(),c.instanceId},setLoop:function(t,i){var s=c(t);s&&s.setLoop&&s.setLoop(i)},isLoop:function(t){var i=c(t);return!(!i||!i.isLoop)&&i.isLoop()},setVolume:function(t,i){var s=c(t);s&&(s._loaded||s.once("load",function(){s.setVolume&&s.setVolume(i)}),s.setVolume&&s.setVolume(i))},getVolume:function(t){var i=c(t);return i&&i.getVolume?i.getVolume():1},setCurrentTime:function(t,i){var s=c(t);return!!s&&(s._loaded?(s.setCurrentTime&&s.setCurrentTime(i),!0):(s.once("load",function(){s.setCurrentTime&&s.setCurrentTime(i)}),!0))},getCurrentTime:function(t){var i=c(t);return i&&i.getCurrentTime?i.getCurrentTime():0},getDuration:function(t){var i=c(t);return i&&i.getDuration?i.getDuration():0},getState:function(t){var i=c(t);return i&&i.getState?i.getState():this.AudioState.ERROR},setFinishCallback:function(t,i){var s=c(t);s&&(s.off("ended"),s.on("ended",i))},pause:function(t){var i=c(t);return!(!i||!i.pause||(i.pause(),0))},_pauseIDCache:[],pauseAll:function(){for(var t in r){var i=r[t];i.getState()===n.State.PLAYING&&(this._pauseIDCache.push(t),i.pause())}},resume:function(t){var i=c(t);if(!i||!i.resume)return!1;0===i.getCurrentTime()?i.play():i.resume()},resumeAll:function(){for(;this._pauseIDCache.length>0;){var t=this._pauseIDCache.pop(),i=c(t);i&&i.resume&&i.resume()}},stop:function(t){var i=c(t);return!(!i||!i.stop||(i.off("load",i.__callback),i.stop(),0))},stopAll:function(){for(var t in r){var i=r[t];i&&i.stop&&(i.stop(),i.off("load",i.__callback))}},setMaxAudioInstance:function(t){return this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var i=e[t];if(i)for(;i.length>0;){var s=i.pop(),n=r[s];n&&(n.stop(),delete r[s])}},uncacheAll:function(){this.stopAll(),r={},e={}},getProfile:function(t){},preload:function(t,i){cc.loader.load(t,function(t){t||i()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){this._breakCache=[];for(var t in r){var i=r[t];i.getState()===n.State.PLAYING&&(this._breakCache.push(t),i.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var t=this._breakCache.pop(),i=c(t);i&&i.resume&&i.resume()}this._breakCache=null}}};i.exports=cc.audioEngine=o;var u=t("./deprecated");u.removed(o),u.deprecated(o)},{"./CCAudio":23,"./deprecated":25}],25:[function(t,i,s){var n=cc.js;s.removed=function(t){function i(){cc.errorID(1403)}n.getset(t,"willPlayMusic",i,i)},s.deprecated=function(t){var i=-1,s=1,h=1,r=1,e=1,c=[];n.get(t,"playMusic",function(){return function(n,e){return t.stop(i),i=t.play(n,e,r),s=n,h=e,i}}),n.get(t,"stopMusic",function(){return function(){return t.stop(i),i}}),n.get(t,"pauseMusic",function(){return function(){return t.pause(i),i}}),n.get(t,"resumeMusic",function(){return function(){return t.resume(i),i}}),n.get(t,"rewindMusic",function(){return function(){return t.setCurrentTime(i,0),i}}),n.get(t,"getMusicVolume",function(){return function(){return r}}),n.get(t,"setMusicVolume",function(){return function(s){return r=s,t.setVolume(i,r),r}}),n.get(t,"isMusicPlaying",function(){return function(){return t.getState(i)===t.AudioState.PLAYING}}),n.get(t,"playEffect",function(){return function(i,s,n){return t.play(i,s||!1,void 0===n?e:n)}}),n.get(t,"setEffectsVolume",function(s){return function(s){e=s;var n=t._id2audio;for(var h in n)h!==i&&t.setVolume(h,s)}}),n.get(t,"getEffectsVolume",function(){return function(){return e}}),n.get(t,"pauseEffect",function(){return function(i){return t.pause(i)}}),n.get(t,"pauseAllEffects",function(){return function(){c.length=0;var s=t._id2audio;for(var n in s)if(n!==i){var h=s[n];h.getState()===t.AudioState.PLAYING&&(c.push(n),h.pause())}}}),n.get(t,"resumeEffect",function(){return function(i){t.resume(i)}}),n.get(t,"resumeAllEffects",function(){return function(){for(var i=t._id2audio;c.length>0;){var s=i[c.pop()];s&&s.resume&&s.resume()}}}),n.get(t,"stopEffect",function(){return function(i){return t.stop(i)}}),n.get(t,"stopAllEffects",function(){return function(){var s=t._id2audio;for(var n in s)if(n!==i){var h=s[n];h.getState()===t.AudioState.PLAYING&&h.stop()}}}),n.get(t,"unloadEffect",function(){return function(i){return t.stop(i)}}),n.get(t,"end",function(){return function(){return t.stopAll()}})}},{}],26:[function(t,i,s){cc.ClippingNode=_ccsg.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,t&&(this._originStencilProgram=t.getShaderProgram()),this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnter)},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExit),_ccsg.Node.prototype.onExit.call(this)},visit:function(t){this._renderCmd.clippingVisit(t&&t._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&this.sortAllChildren();for(var t,i=this._children,s=0,n=i.length;s<n;s++)(t=i[s])&&t._visible&&t.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(t){1===t&&t!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil(),this._alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&(t&&(this._originStencilProgram=t.getShaderProgram()),this._renderCmd.setStencil(t))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),cc.ClippingNode.stencilBits=-1;var n=cc.ClippingNode.prototype;cc.defineGetterSetter(n,"stencil",n.getStencil,n.setStencil),cc.defineGetterSetter(n,"alphaThreshold",n.getAlphaThreshold,n.setAlphaThreshold)},{}],27:[function(t,i,s){cc.ClippingNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._rendererClipCmd=new cc.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var n=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.ClippingNode.CanvasRenderCmd,n.resetProgramByStencil=function(){},n.initStencilBits=function(){},n.setStencil=function(t){null!=t&&(this._node._stencil=t,t instanceof cc.DrawNode||cc.errorID(6300))},n._restoreCmdCallback=function(t){(t||cc._renderContext).restore()},n._drawStencilCommand=function(t,i,s){var n=t||cc._renderContext,h=n.getContext();n.save(),h.beginPath(),n.setTransform(this._worldTransform,i,s);for(var r=this._node._stencil._buffer,e=0;e<r.length;++e){var c=r[e].verts;if(!(c.length<3)){h.moveTo(c[0].x,-c[0].y);for(var o=1;o<c.length;++o)h.lineTo(c[o].x,-c[o].y)}}h.clip()},n.clippingVisit=function(t){var i=this._node;if(t=t||this.getParentRenderCmd(),this._propagateFlagsDown(t),i._visible){t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),i._stencil&&cc.renderer.pushRenderCommand(this._rendererClipCmd);var s,n=i._children,h=n.length;if(h>0)for(i.sortAllChildren(),s=0;s<h;s++)n[s].visit(i);i._stencil&&cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}}},{}],28:[function(t,i,s){function n(t,i){t.shaderProgram=i;var s=t.children;if(s)for(var h=0;h<s.length;h++)n(s[h],i)}var h={stencilEnabled:!1,depthWriteMask:!0};cc.ClippingNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._previousState=null,this._state={stencilEnabled:!0,stencilWriteMask:0,depthWriteMask:!1,stencilFunc:0,stencilRef:0,stencilValueMask:0}};var r=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);r.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,r.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.ClippingNode.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.ClippingNode.stencilBits<=0&&cc.logID(6301),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},r.transform=function(t,i){var s=this._node;this.originTransform(t,i),s._stencil&&(s._stencil._renderCmd.transform(this,!0),s._stencil._dirtyFlag&=~_ccsg.Node._dirtyFlags.transformDirty)},r.clippingVisit=function(t){var i=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),cc.ClippingNode.stencilBits<1)i._visitChildren();else if(i._stencil&&i._stencil.visible){if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.ClippingNode.stencilBits)return cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.logID(6302,cc.ClippingNode.stencilBits),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),void i._visitChildren();cc.renderer.pushRenderCommand(this._beforeVisitCmd),i._stencil.visit(i),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var s=i._children;if(s&&s.length>0){var n=s.length;i.sortAllChildren();for(var h=0;h<n;h++)s[h].visit(i)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0}else i.inverted&&i._visitChildren()},r.setStencil=function(t){var i=this._node;i._stencil&&(i._stencil._parent=null),i._stencil=t,i._stencil&&(i._stencil._parent=i)},r._drawFullScreenQuadClearStencil=function(){var t=cc.math.projection_matrix_stack;t.push(),t.top.identity();var i=cc.math.modelview_matrix_stack;i.push(),i.top.identity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),t.pop(),i.pop()},r.resetProgramByStencil=function(){var t=this._node;if(t._stencil){var i=t._originStencilProgram;n(t._stencil,i)}},r._onBeforeVisit=function(t){var i=t||cc._renderContext,s=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var r=1<<cc.ClippingNode.WebGLRenderCmd._layer,e=r|r-1;if(this._previousState=h,i.enable(i.STENCIL_TEST),i.stencilMask(r),i.depthMask(!1),i.stencilFunc(i.NEVER,r,r),i.stencilOp(this._node.inverted?i.REPLACE:i.ZERO,i.KEEP,i.KEEP),this._drawFullScreenQuadClearStencil(),i.stencilFunc(i.NEVER,r,r),i.stencilOp(this._node.inverted?i.ZERO:i.REPLACE,i.KEEP,i.KEEP),s.alphaThreshold<1){var c=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);cc.gl.useProgram(c.getProgram()),c.setUniformLocationWith1f(cc.macro.UNIFORM_ALPHA_TEST_VALUE_S,s.alphaThreshold),c.setUniformLocationWithMatrix4fv(cc.macro.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),n(s._stencil,c)}this._state.stencilWriteMask=r,this._state.stencilRef=this._state.stencilValueMask=e,this._state.stencilFunc=i.NEVER,h=this._state},r._onAfterDrawStencil=function(t){var i=t||cc._renderContext;i.depthMask(this._previousState.depthWriteMask),i.stencilFunc(i.EQUAL,this._state.stencilRef,this._state.stencilValueMask),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this._state.stencilFunc=i.EQUAL},r._onAfterVisit=function(t){var i=t||cc._renderContext,s=this._previousState;s.stencilEnabled?(i.stencilFunc(s.stencilFunc,s.stencilRef,s.stencilValueMask),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.stencilMask(s.stencilWriteMask)):i.disable(i.STENCIL_TEST),h=this._previousState,this._previousState=null,cc.ClippingNode.WebGLRenderCmd._layer--}},{}],29:[function(t,i,s){cc.Codec={name:"Jacob__Codec"},cc.Codec.Base64=t("./base64"),cc.Codec.GZip=t("./gzip"),cc.Codec.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.Codec.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);try{return cc.Codec.GZip.gunzip.call(cc.Codec.GZip,t)}catch(i){return t.slice(7)}},cc.Codec.unzipBase64AsArray=function(t,i){i=i||1;var s,n,h,r=this.unzipBase64(t),e=[];for(s=0,h=r.length/i;s<h;s++)for(e[s]=0,n=i-1;n>=0;--n)e[s]+=r.charCodeAt(s*i+n)<<8*n;return e},cc.Codec.unzipAsArray=function(t,i){i=i||1;var s,n,h,r=this.unzip(t),e=[];for(s=0,h=r.length/i;s<h;s++)for(e[s]=0,n=i-1;n>=0;--n)e[s]+=r.charCodeAt(s*i+n)<<8*n;return e}},{"./base64":30,"./gzip":31}],30:[function(t,i,s){var n=t("../core/utils/misc").BASE64_VALUES,h={name:"Jacob__Codec__Base64"};h.decode=function(t){var i,s,h,r,e,c,o=[],u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)i=n[t.charCodeAt(u++)]<<2|(r=n[t.charCodeAt(u++)])>>4,s=(15&r)<<4|(e=n[t.charCodeAt(u++)])>>2,h=(3&e)<<6|(c=n[t.charCodeAt(u++)]),o.push(String.fromCharCode(i)),64!==e&&o.push(String.fromCharCode(s)),64!==c&&o.push(String.fromCharCode(h));return o=o.join("")},h.decodeAsArray=function(t,i){var s,n,h,r=this.decode(t),e=[];for(s=0,h=r.length/i;s<h;s++)for(e[s]=0,n=i-1;n>=0;--n)e[s]+=r.charCodeAt(s*i+n)<<8*n;return e},i.exports=h},{"../core/utils/misc":223}],31:[function(t,i,s){var n=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(n.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};n.gunzip=function(t){return t.constructor===Array||(t.constructor,String),new n(t).gunzip()[0][0]},n.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},n.LITERALS=288,n.NAMEMAX=256,n.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],n.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],n.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],n.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],n.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],n.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},n.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},n.prototype.byteAlign=function(){this.bb=1},n.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},n.prototype.readBits=function(t){for(var i=0,s=t;s--;)i=i<<1|this.readBit();return t&&(i=n.bitReverse[i]>>8-t),i},n.prototype.flushBuffer=function(){this.bIdx=0},n.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},n.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},n.prototype.Rec=function(){var t,i=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)i.b0=t;else if(i.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)i.b1=t,i.jump=null;else if(i.b1=32768,i.jump=this.Places[this.treepos],i.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},n.prototype.CreateTree=function(t,i,s,n){var h;for(this.Places=t,this.treepos=0,this.flens=s,this.fmax=i,h=0;h<17;h++)this.fpos[h]=0;return this.len=0,this.Rec()?-1:0},n.prototype.DecodeValue=function(t){for(var i,s,n=0,h=t[n];;)if(this.readBit()){if(!(32768&h.b1))return h.b1;for(h=h.jump,i=t.length,s=0;s<i;s++)if(t[s]===h){n=s;break}}else{if(!(32768&h.b0))return h.b0;h=t[++n]}return-1},n.prototype.DeflateLoop=function(){var t,i,s;do{if(t=this.readBit(),0===(i=this.readBits(2))){var h,r;for(this.byteAlign(),h=this.readByte(),h|=this.readByte()<<8,r=this.readByte(),65535&(h^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");h--;)g=this.readByte(),this.addBuffer(g)}else if(1===i)for(;;)if((e=n.bitReverse[this.readBits(7)]>>1)>23?(e=e<<1|this.readBit())>199?e=(e-=128)<<1|this.readBit():(e-=48)>143&&(e+=136):e+=256,e<256)this.addBuffer(e);else{if(256===e)break;for(e-=257,d=this.readBits(n.cplext[e])+n.cplens[e],e=n.bitReverse[this.readBits(5)]>>3,n.cpdext[e]>8?(p=this.readBits(8),p|=this.readBits(n.cpdext[e]-8)<<8):p=this.readBits(n.cpdext[e]),p+=n.cpdist[e],e=0;e<d;e++)g=this.buf32k[this.bIdx-p&32767],this.addBuffer(g)}else if(2===i){var e,c,o,u,a,f=new Array(320);for(o=257+this.readBits(5),u=1+this.readBits(5),a=4+this.readBits(4),e=0;e<19;e++)f[e]=0;for(e=0;e<a;e++)f[n.border[e]]=this.readBits(3);for(d=this.distanceTree.length,s=0;s<d;s++)this.distanceTree[s]=new n.HufNode;if(this.CreateTree(this.distanceTree,19,f,0))return this.flushBuffer(),1;for(c=o+u,s=0;s<c;)if((e=this.DecodeValue(this.distanceTree))<16)f[s++]=e;else if(16===e){var l;if(e=3+this.readBits(2),s+e>c)return this.flushBuffer(),1;for(l=s?f[s-1]:0;e--;)f[s++]=l}else{if(e=17===e?3+this.readBits(3):11+this.readBits(7),s+e>c)return this.flushBuffer(),1;for(;e--;)f[s++]=0}for(d=this.literalTree.length,s=0;s<d;s++)this.literalTree[s]=new n.HufNode;if(this.CreateTree(this.literalTree,o,f,0))return this.flushBuffer(),1;for(d=this.literalTree.length,s=0;s<d;s++)this.distanceTree[s]=new n.HufNode;var v=new Array;for(s=o;s<f.length;s++)v[s-o]=f[s];if(this.CreateTree(this.distanceTree,u,v,0))return this.flushBuffer(),1;for(;;)if((e=this.DecodeValue(this.literalTree))>=256){var d,p;if(0==(e-=256))break;for(e--,d=this.readBits(n.cplext[e])+n.cplens[e],e=this.DecodeValue(this.distanceTree),n.cpdext[e]>8?(p=this.readBits(8),p|=this.readBits(n.cpdext[e]-8)<<8):p=this.readBits(n.cpdext[e]),p+=n.cpdist[e];d--;){var g=this.buf32k[this.bIdx-p&32767];this.addBuffer(g)}}else this.addBuffer(e)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},n.prototype.unzipFile=function(t){var i;for(this.gunzip(),i=0;i<this.unzipped.length;i++)if(this.unzipped[i][1]===t)return this.unzipped[i][0]},n.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var i=this.readByte();i|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var s=this.readByte();s|=this.readByte()<<8;var h=this.readByte();for(h|=this.readByte()<<8,e=0,this.nameBuf=[];s--;){var r=this.readByte();"/"===r|":"===r?e=0:e<n.NAMEMAX-1&&(this.nameBuf[e++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var e=0;e<h;)r=this.readByte(),e++;8===i&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},n.prototype.skipdir=function(){var t,i,s,h,r=[];if(8&this.gpflags&&(r[0]=this.readByte(),r[1]=this.readByte(),r[2]=this.readByte(),r[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,i=this.readByte(),i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24),this.modeZIP&&this.nextFile(),r[0]=this.readByte(),8!==r[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(r[0]=this.readByte(),r[2]=this.readByte(),this.len=r[0]+256*r[1],s=0;s<this.len;s++)this.readByte();if(8&this.gpflags)for(s=0,this.nameBuf=[];h=this.readByte();)"7"!==h&&":"!==h||(s=0),s<n.NAMEMAX-1&&(this.nameBuf[s++]=h);if(16&this.gpflags)for(;h=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),i=this.readByte(),i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24,this.modeZIP&&this.nextFile()},i.exports=n},{}],32:[function(t,i,s){(function(){"use strict";function t(t){throw t}function i(t,i){var s=t.split("."),n=_;!(s[0]in n)&&n.execScript&&n.execScript("var "+s[0]);for(var h;s.length&&(h=s.shift());)s.length||i===m?n=n[h]?n[h]:n[h]={}:n[h]=i}function s(t){if("string"==typeof t){var i,s,n=t.split("");for(i=0,s=n.length;i<s;i++)n[i]=(255&n[i].charCodeAt(0))>>>0;t=n}for(var h,r=1,e=0,c=t.length,o=0;0<c;){c-=h=1024<c?1024:c;do{e+=r+=t[o++]}while(--h);r%=65521,e%=65521}return(e<<16|r)>>>0}function n(i,s){this.index="number"==typeof s?s:0,this.i=0,this.buffer=i instanceof(C?Uint8Array:Array)?i:new(C?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function h(t){this.buffer=new(C?Uint16Array:Array)(2*t),this.length=0}function r(t){var i,s,n,h,r,e,c,o,u,a=t.length,f=0,l=Number.POSITIVE_INFINITY;for(o=0;o<a;++o)t[o]>f&&(f=t[o]),t[o]<l&&(l=t[o]);for(i=1<<f,s=new(C?Uint32Array:Array)(i),n=1,h=0,r=2;n<=f;){for(o=0;o<a;++o)if(t[o]===n){for(e=0,c=h,u=0;u<n;++u)e=e<<1|1&c,c>>=1;for(u=e;u<i;u+=r)s[u]=n<<16|o;++h}++n,h<<=1,r<<=1}return[s,f,l]}function e(t,i){this.h=E,this.w=0,this.input=t,this.b=0,i&&(i.lazy&&(this.w=i.lazy),"number"==typeof i.compressionType&&(this.h=i.compressionType),i.outputBuffer&&(this.a=C&&i.outputBuffer instanceof Array?new Uint8Array(i.outputBuffer):i.outputBuffer),"number"==typeof i.outputIndex&&(this.b=i.outputIndex)),this.a||(this.a=new(C?Uint8Array:Array)(32768))}function c(t,i){this.length=t,this.G=i}function o(i,s){function n(i,s){var n,h=i.G,r=[],e=0;n=D[i.length],r[e++]=65535&n,r[e++]=n>>16&255,r[e++]=n>>24;var c;switch(w){case 1===h:c=[0,h-1,0];break;case 2===h:c=[1,h-2,0];break;case 3===h:c=[2,h-3,0];break;case 4===h:c=[3,h-4,0];break;case 6>=h:c=[4,h-5,1];break;case 8>=h:c=[5,h-7,1];break;case 12>=h:c=[6,h-9,2];break;case 16>=h:c=[7,h-13,2];break;case 24>=h:c=[8,h-17,3];break;case 32>=h:c=[9,h-25,3];break;case 48>=h:c=[10,h-33,4];break;case 64>=h:c=[11,h-49,4];break;case 96>=h:c=[12,h-65,5];break;case 128>=h:c=[13,h-97,5];break;case 192>=h:c=[14,h-129,6];break;case 256>=h:c=[15,h-193,6];break;case 384>=h:c=[16,h-257,7];break;case 512>=h:c=[17,h-385,7];break;case 768>=h:c=[18,h-513,8];break;case 1024>=h:c=[19,h-769,8];break;case 1536>=h:c=[20,h-1025,9];break;case 2048>=h:c=[21,h-1537,9];break;case 3072>=h:c=[22,h-2049,10];break;case 4096>=h:c=[23,h-3073,10];break;case 6144>=h:c=[24,h-4097,11];break;case 8192>=h:c=[25,h-6145,11];break;case 12288>=h:c=[26,h-8193,12];break;case 16384>=h:c=[27,h-12289,12];break;case 24576>=h:c=[28,h-16385,13];break;case 32768>=h:c=[29,h-24577,13];break;default:t("invalid distance")}n=c,r[e++]=n[0],r[e++]=n[1],r[e++]=n[2];var o,u;for(o=0,u=r.length;o<u;++o)p[g++]=r[o];b[r[0]]++,y[r[3]]++,_=i.length+s-1,l=null}var h,r,e,o,u,a,f,l,v,d={},p=C?new Uint16Array(2*s.length):[],g=0,_=0,b=new(C?Uint32Array:Array)(286),y=new(C?Uint32Array:Array)(30),T=i.w;if(!C){for(e=0;285>=e;)b[e++]=0;for(e=0;29>=e;)y[e++]=0}for(b[256]=1,h=0,r=s.length;h<r;++h){for(e=u=0,o=3;e<o&&h+e!==r;++e)u=u<<8|s[h+e];if(d[u]===m&&(d[u]=[]),a=d[u],!(0<_--)){for(;0<a.length&&32768<h-a[0];)a.shift();if(h+3>=r){for(l&&n(l,-1),e=0,o=r-h;e<o;++e)v=s[h+e],p[g++]=v,++b[v];break}if(0<a.length){var S=m,A=m,M=0,x=m,E=m,O=m,P=m,R=s.length;E=0,P=a.length;t:for(;E<P;E++){if(S=a[P-E-1],x=3,3<M){for(O=M;3<O;O--)if(s[S+O-1]!==s[h+O-1])continue t;x=M}for(;258>x&&h+x<R&&s[S+x]===s[h+x];)++x;if(x>M&&(A=S,M=x),258===x)break}f=new c(M,h-A),l?l.length<f.length?(v=s[h-1],p[g++]=v,++b[v],n(f,0)):n(l,-1):f.length<T?l=f:n(f,0)}else l?n(l,-1):(v=s[h],p[g++]=v,++b[v])}a.push(h)}return p[g++]=256,b[256]++,i.L=b,i.K=y,C?p.subarray(0,g):p}function u(t,i){function s(t){var i=T[t][S[t]];i===m?(s(t+1),s(t+1)):--b[i],++S[t]}var n,r,e,c,o,u=t.length,a=new h(572),f=new(C?Uint8Array:Array)(u);if(!C)for(c=0;c<u;c++)f[c]=0;for(c=0;c<u;++c)0<t[c]&&a.push(c,t[c]);if(n=Array(a.length/2),r=new(C?Uint32Array:Array)(a.length/2),1===n.length)return f[a.pop().index]=1,f;for(c=0,o=a.length/2;c<o;++c)n[c]=a.pop(),r[c]=n[c].value;var l,v,d,p,g,m=r.length,w=new(C?Uint16Array:Array)(i),_=new(C?Uint8Array:Array)(i),b=new(C?Uint8Array:Array)(m),y=Array(i),T=Array(i),S=Array(i),A=(1<<i)-m,M=1<<i-1;for(w[i-1]=m,v=0;v<i;++v)A<M?_[v]=0:(_[v]=1,A-=M),A<<=1,w[i-2-v]=(w[i-1-v]/2|0)+m;for(w[0]=_[0],y[0]=Array(w[0]),T[0]=Array(w[0]),v=1;v<i;++v)w[v]>2*w[v-1]+_[v]&&(w[v]=2*w[v-1]+_[v]),y[v]=Array(w[v]),T[v]=Array(w[v]);for(l=0;l<m;++l)b[l]=i;for(d=0;d<w[i-1];++d)y[i-1][d]=r[d],T[i-1][d]=d;for(l=0;l<i;++l)S[l]=0;for(1===_[i-1]&&(--b[0],++S[i-1]),v=i-2;0<=v;--v){for(p=l=0,g=S[v+1],d=0;d<w[v];d++)(p=y[v+1][g]+y[v+1][g+1])>r[l]?(y[v][d]=p,T[v][d]=m,g+=2):(y[v][d]=r[l],T[v][d]=l,++l);S[v]=0,1===_[v]&&s(v)}for(e=b,c=0,o=n.length;c<o;++c)f[n[c].index]=e[c];return f}function a(i){var s,n,h,r,e=new(C?Uint16Array:Array)(i.length),c=[],o=[],u=0;for(s=0,n=i.length;s<n;s++)c[i[s]]=1+(0|c[i[s]]);for(s=1,n=16;s<=n;s++)o[s]=u,(u+=0|c[s])>1<<s&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),s=0,n=i.length;s<n;s++)for(u=o[i[s]],o[i[s]]+=1,h=e[s]=0,r=i[s];h<r;h++)e[s]=e[s]<<1|1&u,u>>>=1;return e}function f(t,i){this.input=t,this.a=new(C?Uint8Array:Array)(32768),this.h=F.j;var s,n={};!i&&(i={})||"number"!=typeof i.compressionType||(this.h=i.compressionType);for(s in i)n[s]=i[s];n.outputBuffer=this.a,this.z=new e(this.input,n)}function l(i,s){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=C?new Uint8Array(i):i,this.s=!1,this.m=k,this.B=!1,!s&&(s={})||(s.index&&(this.c=s.index),s.bufferSize&&(this.l=s.bufferSize),s.bufferType&&(this.m=s.bufferType),s.resize&&(this.B=s.resize)),this.m){case N:this.b=32768,this.a=new(C?Uint8Array:Array)(32768+this.l+258);break;case k:this.b=0,this.a=new(C?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function v(i,s){for(var n,h=i.g,r=i.e,e=i.input,c=i.c;r<s;)(n=e[c++])===m&&t(Error("input buffer is broken")),h|=n<<r,r+=8;return n=h&(1<<s)-1,i.g=h>>>s,i.e=r-s,i.c=c,n}function d(i,s){for(var n,h,r,e=i.g,c=i.e,o=i.input,u=i.c,a=s[0],f=s[1];c<f;)(n=o[u++])===m&&t(Error("input buffer is broken")),e|=n<<c,c+=8;return h=a[e&(1<<f)-1],r=h>>>16,i.g=e>>r,i.e=c-r,i.c=u,65535&h}function p(t){function i(t,i,s){var n,h,r,e;for(e=0;e<t;)switch(n=d(this,i)){case 16:for(r=3+v(this,2);r--;)s[e++]=h;break;case 17:for(r=3+v(this,3);r--;)s[e++]=0;h=0;break;case 18:for(r=11+v(this,7);r--;)s[e++]=0;h=0;break;default:h=s[e++]=n}return s}var s,n,h,e,c=v(t,5)+257,o=v(t,5)+1,u=v(t,4)+4,a=new(C?Uint8Array:Array)(V.length);for(e=0;e<u;++e)a[V[e]]=v(t,3);s=r(a),n=new(C?Uint8Array:Array)(c),h=new(C?Uint8Array:Array)(o),t.o(r(i.call(t,c,s,n)),r(i.call(t,o,s,h)))}function g(i,s){var n,h;switch(this.input=i,this.c=0,!s&&(s={})||(s.index&&(this.c=s.index),s.verify&&(this.M=s.verify)),n=i[this.c++],h=i[this.c++],15&n){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((n<<8)+h)%31&&t(Error("invalid fcheck flag:"+((n<<8)+h)%31)),32&h&&t(Error("fdict flag is not supported")),this.A=new l(i,{index:this.c,bufferSize:s.bufferSize,bufferType:s.bufferType,resize:s.resize})}var m=void 0,w=!0,_=this,C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;n.prototype.f=function(){var t,i=this.buffer,s=i.length,n=new(C?Uint8Array:Array)(s<<1);if(C)n.set(i);else for(t=0;t<s;++t)n[t]=i[t];return this.buffer=n},n.prototype.d=function(t,i,s){var n,h=this.buffer,r=this.index,e=this.i,c=h[r];if(s&&1<i&&(t=8<i?(M[255&t]<<24|M[t>>>8&255]<<16|M[t>>>16&255]<<8|M[t>>>24&255])>>32-i:M[t]>>8-i),8>i+e)c=c<<i|t,e+=i;else for(n=0;n<i;++n)c=c<<1|t>>i-n-1&1,8==++e&&(e=0,h[r++]=M[c],c=0,r===h.length&&(h=this.f()));h[r]=c,this.buffer=h,this.i=e,this.index=r},n.prototype.finish=function(){var t,i=this.buffer,s=this.index;return 0<this.i&&(i[s]<<=8-this.i,i[s]=M[i[s]],s++),C?t=i.subarray(0,s):(i.length=s,t=i),t};var b,y=new(C?Uint8Array:Array)(256);for(b=0;256>b;++b){for(var T=A=b,S=7,A=A>>>1;A;A>>>=1)T<<=1,T|=1&A,--S;y[b]=(T<<S&255)>>>0}var M=y;C&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),h.prototype.getParent=function(t){return 2*((t-2)/4|0)},h.prototype.push=function(t,i){var s,n,h,r=this.buffer;for(s=this.length,r[this.length++]=i,r[this.length++]=t;0<s&&(n=this.getParent(s),r[s]>r[n]);)h=r[s],r[s]=r[n],r[n]=h,h=r[s+1],r[s+1]=r[n+1],r[n+1]=h,s=n;return this.length},h.prototype.pop=function(){var t,i,s,n,h,r=this.buffer;for(i=r[0],t=r[1],this.length-=2,r[0]=r[this.length],r[1]=r[this.length+1],h=0;!((n=2*h+2)>=this.length)&&(n+2<this.length&&r[n+2]>r[n]&&(n+=2),r[n]>r[h]);)s=r[h],r[h]=r[n],r[n]=s,s=r[h+1],r[h+1]=r[n+1],r[n+1]=s,h=n;return{index:t,value:i,length:this.length}};var x,E=2,O={NONE:0,r:1,j:E,N:3},P=[];for(x=0;288>x;x++)switch(w){case 143>=x:P.push([x+48,8]);break;case 255>=x:P.push([x-144+400,9]);break;case 279>=x:P.push([x-256+0,7]);break;case 287>=x:P.push([x-280+192,8]);break;default:t("invalid literal: "+x)}e.prototype.n=function(){var i,s,h,r,e=this.input;switch(this.h){case 0:for(h=0,r=e.length;h<r;){var c=s=C?e.subarray(h,h+65535):e.slice(h,h+65535),f=(h+=s.length)===r,l=m,v=m,d=m,p=m,g=m,_=this.a,b=this.b;if(C){for(_=new Uint8Array(this.a.buffer);_.length<=b+c.length+5;)_=new Uint8Array(_.length<<1);_.set(this.a)}if(l=f?1:0,_[b++]=0|l,v=c.length,d=65536+~v&65535,_[b++]=255&v,_[b++]=v>>>8&255,_[b++]=255&d,_[b++]=d>>>8&255,C)_.set(c,b),b+=c.length,_=_.subarray(0,b);else{for(p=0,g=c.length;p<g;++p)_[b++]=c[p];_.length=b}this.b=b,this.a=_}break;case 1:var y=new n(new Uint8Array(this.a.buffer),this.b);y.d(1,1,w),y.d(1,2,w);var T,S,A,M=o(this,e);for(T=0,S=M.length;T<S;T++)if(A=M[T],n.prototype.d.apply(y,P[A]),256<A)y.d(M[++T],M[++T],w),y.d(M[++T],5),y.d(M[++T],M[++T],w);else if(256===A)break;this.a=y.finish(),this.b=this.a.length;break;case E:var x,O,R,I,L,D,F,N,k,B,G,z,j,V,U,W=new n(new Uint8Array(this.a),this.b),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=Array(19);for(x=E,W.d(1,1,w),W.d(x,2,w),O=o(this,e),F=a(D=u(this.L,15)),k=a(N=u(this.K,7)),R=286;257<R&&0===D[R-1];R--);for(I=30;1<I&&0===N[I-1];I--);var J,Y,q,Z,Q,K,$=R,tt=I,it=new(C?Uint32Array:Array)($+tt),st=new(C?Uint32Array:Array)(316),nt=new(C?Uint8Array:Array)(19);for(J=Y=0;J<$;J++)it[Y++]=D[J];for(J=0;J<tt;J++)it[Y++]=N[J];if(!C)for(J=0,Z=nt.length;J<Z;++J)nt[J]=0;for(J=Q=0,Z=it.length;J<Z;J+=Y){for(Y=1;J+Y<Z&&it[J+Y]===it[J];++Y);if(q=Y,0===it[J])if(3>q)for(;0<q--;)st[Q++]=0,nt[0]++;else for(;0<q;)(K=138>q?q:138)>q-3&&K<q&&(K=q-3),10>=K?(st[Q++]=17,st[Q++]=K-3,nt[17]++):(st[Q++]=18,st[Q++]=K-11,nt[18]++),q-=K;else if(st[Q++]=it[J],nt[it[J]]++,3>--q)for(;0<q--;)st[Q++]=it[J],nt[it[J]]++;else for(;0<q;)(K=6>q?q:6)>q-3&&K<q&&(K=q-3),st[Q++]=16,st[Q++]=K-3,nt[16]++,q-=K}for(i=C?st.subarray(0,Q):st.slice(0,Q),B=u(nt,7),V=0;19>V;V++)X[V]=B[H[V]];for(L=19;4<L&&0===X[L-1];L--);for(G=a(B),W.d(R-257,5,w),W.d(I-1,5,w),W.d(L-4,4,w),V=0;V<L;V++)W.d(X[V],3,w);for(V=0,U=i.length;V<U;V++)if(z=i[V],W.d(G[z],B[z],w),16<=z){switch(V++,z){case 16:j=2;break;case 17:j=3;break;case 18:j=7;break;default:t("invalid code: "+z)}W.d(i[V],j,w)}var ht,rt,et,ct,ot,ut,at,ft,lt=[F,D],vt=[k,N];for(ot=lt[0],ut=lt[1],at=vt[0],ft=vt[1],ht=0,rt=O.length;ht<rt;++ht)if(et=O[ht],W.d(ot[et],ut[et],w),256<et)W.d(O[++ht],O[++ht],w),ct=O[++ht],W.d(at[ct],ft[ct],w),W.d(O[++ht],O[++ht],w);else if(256===et)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var R,I,L=[];for(R=3;258>=R;R++)I=function(){var i=R;switch(w){case 3===i:return[257,i-3,0];case 4===i:return[258,i-4,0];case 5===i:return[259,i-5,0];case 6===i:return[260,i-6,0];case 7===i:return[261,i-7,0];case 8===i:return[262,i-8,0];case 9===i:return[263,i-9,0];case 10===i:return[264,i-10,0];case 12>=i:return[265,i-11,1];case 14>=i:return[266,i-13,1];case 16>=i:return[267,i-15,1];case 18>=i:return[268,i-17,1];case 22>=i:return[269,i-19,2];case 26>=i:return[270,i-23,2];case 30>=i:return[271,i-27,2];case 34>=i:return[272,i-31,2];case 42>=i:return[273,i-35,3];case 50>=i:return[274,i-43,3];case 58>=i:return[275,i-51,3];case 66>=i:return[276,i-59,3];case 82>=i:return[277,i-67,4];case 98>=i:return[278,i-83,4];case 114>=i:return[279,i-99,4];case 130>=i:return[280,i-115,4];case 162>=i:return[281,i-131,5];case 194>=i:return[282,i-163,5];case 226>=i:return[283,i-195,5];case 257>=i:return[284,i-227,5];case 258===i:return[285,i-258,0];default:t("invalid length: "+i)}}(),L[R]=I[2]<<24|I[1]<<16|I[0];var D=C?new Uint32Array(L):L,F=O;f.prototype.n=function(){var i,n,h,r,e,c,o,u=0;switch(o=this.a,i=ut){case ut:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(h=n<<4|i,o[u++]=h,i){case ut:switch(this.h){case F.NONE:e=0;break;case F.r:e=1;break;case F.j:e=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return r=e<<6|0,o[u++]=r|31-(256*h+r)%31,c=s(this.input),this.z.b=u,o=this.z.n(),u=o.length,C&&((o=new Uint8Array(o.buffer)).length<=u+4&&(this.a=new Uint8Array(o.length+4),this.a.set(o),o=this.a),o=o.subarray(0,u+4)),o[u++]=c>>24&255,o[u++]=c>>16&255,o[u++]=c>>8&255,o[u++]=255&c,o},i("Zlib.Deflate",f),i("Zlib.Deflate.compress",function(t,i){return new f(t,i).n()}),i("Zlib.Deflate.CompressionType",F),i("Zlib.Deflate.CompressionType.NONE",F.NONE),i("Zlib.Deflate.CompressionType.FIXED",F.r),i("Zlib.Deflate.CompressionType.DYNAMIC",F.j);var N=0,k=1,B={D:N,C:k};l.prototype.p=function(){for(;!this.s;){var i=v(this,3);switch(1&i&&(this.s=w),i>>>=1){case 0:var s=this.input,n=this.c,h=this.a,r=this.b,e=m,c=m,o=m,u=h.length,a=m;switch(this.e=this.g=0,(e=s[n++])===m&&t(Error("invalid uncompressed block header: LEN (first byte)")),c=e,(e=s[n++])===m&&t(Error("invalid uncompressed block header: LEN (second byte)")),c|=e<<8,(e=s[n++])===m&&t(Error("invalid uncompressed block header: NLEN (first byte)")),o=e,(e=s[n++])===m&&t(Error("invalid uncompressed block header: NLEN (second byte)")),o|=e<<8,c===~o&&t(Error("invalid uncompressed block header: length verify")),n+c>s.length&&t(Error("input buffer is broken")),this.m){case N:for(;r+c>h.length;){if(a=u-r,c-=a,C)h.set(s.subarray(n,n+a),r),r+=a,n+=a;else for(;a--;)h[r++]=s[n++];this.b=r,h=this.f(),r=this.b}break;case k:for(;r+c>h.length;)h=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(C)h.set(s.subarray(n,n+c),r),r+=c,n+=c;else for(;c--;)h[r++]=s[n++];this.c=n,this.b=r,this.a=h;break;case 1:this.o(tt,st);break;case 2:p(this);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var G,z,j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=C?new Uint16Array(j):j,U=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],W=C?new Uint16Array(U):U,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],X=C?new Uint8Array(H):H,J=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Y=C?new Uint16Array(J):J,q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Z=C?new Uint8Array(q):q,Q=new(C?Uint8Array:Array)(288);for(G=0,z=Q.length;G<z;++G)Q[G]=143>=G?8:255>=G?9:279>=G?7:8;var K,$,tt=r(Q),it=new(C?Uint8Array:Array)(30);for(K=0,$=it.length;K<$;++K)it[K]=5;var st=r(it);l.prototype.o=function(t,i){var s=this.a,n=this.b;this.u=t;for(var h,r,e,c,o=s.length-258;256!==(h=d(this,t));)if(256>h)n>=o&&(this.b=n,s=this.f(),n=this.b),s[n++]=h;else for(c=W[r=h-257],0<X[r]&&(c+=v(this,X[r])),h=d(this,i),e=Y[h],0<Z[h]&&(e+=v(this,Z[h])),n>=o&&(this.b=n,s=this.f(),n=this.b);c--;)s[n]=s[n++-e];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},l.prototype.I=function(t,i){var s=this.a,n=this.b;this.u=t;for(var h,r,e,c,o=s.length;256!==(h=d(this,t));)if(256>h)n>=o&&(s=this.f(),o=s.length),s[n++]=h;else for(c=W[r=h-257],0<X[r]&&(c+=v(this,X[r])),h=d(this,i),e=Y[h],0<Z[h]&&(e+=v(this,Z[h])),n+c>o&&(s=this.f(),o=s.length);c--;)s[n]=s[n++-e];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},l.prototype.f=function(){var t,i,s=new(C?Uint8Array:Array)(this.b-32768),n=this.b-32768,h=this.a;if(C)s.set(h.subarray(32768,s.length));else for(t=0,i=s.length;t<i;++t)s[t]=h[t+32768];if(this.k.push(s),this.q+=s.length,C)h.set(h.subarray(n,n+32768));else for(t=0;32768>t;++t)h[t]=h[n+t];return this.b=32768,h},l.prototype.J=function(t){var i,s,n,h,r=this.input.length/this.c+1|0,e=this.input,c=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),2>r?(s=(e.length-this.c)/this.u[2],h=s/2*258|0,n=h<c.length?c.length+h:c.length<<1):n=c.length*r,C?(i=new Uint8Array(n)).set(c):i=c,this.a=i},l.prototype.t=function(){var t,i,s,n,h,r=0,e=this.a,c=this.k,o=new(C?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return C?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(i=0,s=c.length;i<s;++i)for(n=0,h=(t=c[i]).length;n<h;++n)o[r++]=t[n];for(i=32768,s=this.b;i<s;++i)o[r++]=e[i];return this.k=[],this.buffer=o},l.prototype.H=function(){var t,i=this.b;return C?this.B?(t=new Uint8Array(i)).set(this.a.subarray(0,i)):t=this.a.subarray(0,i):(this.a.length>i&&(this.a.length=i),t=this.a),this.buffer=t},g.prototype.p=function(){var i,n=this.input;return i=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==s(i)&&t(Error("invalid adler-32 checksum")),i},i("Zlib.Inflate",g),i("Zlib.Inflate.BufferType",B),B.ADAPTIVE=B.C,B.BLOCK=B.D,i("Zlib.Inflate.prototype.decompress",g.prototype.p),C&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),C&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),C&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),C&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);var nt,ht,rt=new(C?Uint8Array:Array)(288);for(nt=0,ht=rt.length;nt<ht;++nt)rt[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;r(rt);var et,ct,ot=new(C?Uint8Array:Array)(30);for(et=0,ct=ot.length;et<ct;++et)ot[et]=5;r(ot);var ut=8}).call(window);var n=window.Zlib;n.Deflate=n.Deflate,n.Deflate.compress=n.Deflate.compress,n.Inflate=n.Inflate,n.Inflate.BufferType=n.Inflate.BufferType,n.Inflate.prototype.decompress=n.Inflate.prototype.decompress,i.exports=n},{}],33:[function(t,i,s){cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,i){this._inited||this._init();var s=this._valueDict;return s[t]?s[t]:i},setValue:function(t,i){this._valueDict[t]=i},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,i=this._valueDict;i["gl.vendor"]=t.getParameter(t.VENDOR),i["gl.renderer"]=t.getParameter(t.RENDERER),i["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var s=t.getSupportedExtensions(),n=0;n<s.length;n++)this._GlExtensions+=s[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),i["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),i["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),i["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,i["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),i["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),i["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),i["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);cc.assertID(i,1101,t);var s=i.data;if(s)for(var n in s)this._valueDict[n]=s[n];else cc.logID(1100,t)}}},{}],34:[function(t,i,s){var n=t("./event/event-target"),h=t("./platform/_CCClass"),r=t("./load-pipeline/auto-release-utils"),e=t("./component-scheduler"),c=t("./node-activator"),o=t("./event/event-listeners");cc.g_NumberOfDraws=0,cc.Director=h.extend({ctor:function(){var t=this;n.call(t),t._landscape=!1,t._nextDeltaTimeZero=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._sendCleanupToScene=!1,t._animationInterval=0,t._oldAnimationInterval=0,t._projection=0,t._projectionDelegate=null,t._contentScaleFactor=1,t._winSizeInPoints=null,t._openGLView=null,t._scenesStack=null,t._nextScene=null,t._loadingScene="",t._runningScene=null,t._scene=null,t._totalFrames=0,t._lastUpdate=Date.now(),t._deltaTime=0,t._dirtyRegion=null,t._scheduler=null,t._compScheduler=null,t._nodeActivator=null,t._actionManager=null,cc.game.on(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},_:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new e,this._nodeActivator=new c,cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc._widgetManager&&cc._widgetManager._(this)},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>1&&(this._deltaTime=1/60)),this._lastUpdate=t},convertToGL:function(t){var i=cc.game.container,s=cc.view,n=i.getBoundingClientRect(),h=n.left+window.pageXOffset-i.clientLeft,r=n.top+window.pageYOffset-i.clientTop,e=s._devicePixelRatio*(t.x-h),c=s._devicePixelRatio*(r+n.height-t.y);return s._isRotated?{x:s._viewPortRect.width-c,y:e}:{x:e,y:c}},convertToUI:function(t){var i=cc.game.container,s=cc.view,n=i.getBoundingClientRect(),h=n.left+window.pageXOffset-i.clientLeft,r=n.top+window.pageYOffset-i.clientTop,e={x:0,y:0};return s._isRotated?(e.x=h+t.y/s._devicePixelRatio,e.y=r+n.height-(s._viewPortRect.width-t.x)/s._devicePixelRatio):(e.x=h+t.x*s._devicePixelRatio,e.y=r+n.height-t.y*s._devicePixelRatio),e},_visitScene:function(){if(this._runningScene){var t=cc.renderer;t.childrenOrderDirty?(t.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()}},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assertID(this._runningScene,1204),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.textureCache._clear(),cc.loader.releaseAll()},purgeDirector:function(){this.getScheduler().unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),this._runningScene.performRecursive(_ccsg.Node.performType.onExit),this._runningScene.performRecursive(_ccsg.Node.performType.cleanup),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData()},reset:function(){this.purgeDirector(),cc.eventManager&&cc.eventManager.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(t){cc.assertID(t,1205),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,i,s){t instanceof cc.Scene&&t._load();for(var n=cc.game,h=Object.keys(n._persistRootNodes).map(function(t){return n._persistRootNodes[t]}),e=0;e<h.length;e++){var c=h[e];n._ignoreRemovePersistNode=c,c.parent=null,n._ignoreRemovePersistNode=null}var o=this._scene,u=o&&o.autoReleaseAssets&&o.dependAssets;r.autoRelease(u,t.dependAssets,h),cc.isValid(o)&&o.destroy(),this._scene=null,cc.Object._deferredDestroy(),i&&i(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var a=t;if(t instanceof cc.Scene){this._scene=t,a=t._sgNode;for(var f=0;f<h.length;f++){var l=h[f],v=t.getChildByUuid(l.uuid);if(v){var d=v.getSiblingIndex();v._destroyImmediate(),t.insertChild(l,d)}else l.parent=t}t._activate()}if(this._runningScene){var p=this._scenesStack.length;this._scenesStack[Math.max(p-1,0)]=a,this._sendCleanupToScene=!0,this._nextScene=a}else this.pushScene(a),this.startAnimation();this._nextScene&&this.setNextScene(),s&&s(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,i,s){cc.assertID(t,1205),t instanceof cc.Scene&&t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,i,s)})},_getSceneUuid:function(t){var i=cc.game._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var s=0;s<i.length;s++){var n=i[s];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<i.length)return i[t];cc.errorID(1206,t)}else cc.errorID(1207,t);return null},loadScene:function(t,i,s){if(this._loadingScene)return cc.errorID(1208,t,this._loadingScene),!1;var n=this._getSceneUuid(t);if(n){var h=n.uuid;return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(h,i,s),!0}return cc.errorID(1209,t),!1},preloadScene:function(t,i){var s=this._getSceneUuid(t);if(s)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),cc.loader.load({uuid:s.uuid,type:"uuid"},function(s,n){s&&cc.errorID(1210,t,s.message),i&&i(s,n)});else{var n='Can not preload the scene "'+t+'" because it is not in the build settings.';i(new Error(n)),cc.error("preloadScene: "+n)}},_loadSceneByUuid:function(t,i,s,n){console.time("LoadScene "+t),cc.AssetLibrary.loadAsset(t,function(n,h){console.timeEnd("LoadScene "+t);var r=cc.director;if(r._loadingScene="",n)n="Failed to load scene: "+n,cc.error(n);else{if(h instanceof cc.SceneAsset){var e=h.scene;return e._id=h._uuid,e._name=h._name,void r.runSceneImmediate(e,s,i)}n="The asset "+t+" is not a scene",cc.error(n)}i&&i(n)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,i=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,i=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!i){var s=this._runningScene;s&&(s.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),s.performRecursive(_ccsg.Node.performType.onExit)),this._sendCleanupToScene&&s&&s.performRecursive(_ccsg.Node.performType.cleanup)}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.performRecursive(_ccsg.Node.performType.onEnter),this._runningScene.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config[cc.game.CONFIG_KEY.showFPS]=!!t)},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assertID(this._runningScene,1203);var i=this._scenesStack,s=i.length;if(0!==s){if(!(t>s)){for(;s>t;){var n=i.pop();n.running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),n.performRecursive(_ccsg.Node.performType.cleanup),s--}this._nextScene=i[i.length-1],this._sendCleanupToScene=!0}}else this.end()},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getDeltaTime:function(){return this._deltaTime}}),cc.js.addon(cc.Director.prototype,n.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.emit(cc.Director.EVENT_BEFORE_VISIT),this._visitScene(),this.emit(cc.Director.EVENT_AFTER_VISIT),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),cc.eventManager.frameUpdateListeners())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())},__fastOn:function(t,i,s){var n=this._bubblingListeners;n||(n=this._bubblingListeners=new o),n.add(t,i,s)},__fastOff:function(t,i,s){var n=this._bubblingListeners;n&&n.remove(t,i,s)}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector._()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D},{"./component-scheduler":69,"./event/event-listeners":110,"./event/event-target":111,"./load-pipeline/auto-release-utils":132,"./node-activator":144,"./platform/_CCClass":184}],35:[function(t,i,s){t("./CCDirector"),t("./CCGame"),cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":34,"./CCGame":39}],36:[function(t,i,s){t("./CCDirector"),t("./CCGame"),t("../kazmath");var n=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,i=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var s,n=t._children;for(s=0;s<n.length;s++)i(n[s])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=cc.director._scenesStack,s=0;s<t.length;s++)i(t[s])}),t.setProjection=function(t){var i=this._winSizeInPoints;this.setViewport();var s=this._openGLView,h=s._viewPortRect.x/s._scaleX,r=s._viewPortRect.y/s._scaleY;switch(t){case cc.Director.PROJECTION_2D:n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity();var e=n.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024);n.glMultMatrix(e),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var c=this.getZEye(),o=new n.Matrix4,u=new n.Matrix4;n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity(),o=n.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*c),n.glMultMatrix(o);var a=new n.Vec3(-h+i.width/2,-r+i.height/2,c),f=new n.Vec3(-h+i.width/2,-r+i.height/2,0),l=new n.Vec3(0,1,0);u.lookAt(a,f,l),n.glMultMatrix(u),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.logID(1201)}this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){var i=cc.renderer._clearColor;i.r=t.r/255,i.g=t.g/255,i.b=t.b/255,i.a=t.a/255},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.configuration.gatherGPUInfo(),this.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var i=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,i.width,i.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":244,"./CCDirector":34,"./CCGame":39}],37:[function(t,i,s){cc.DrawingPrimitiveCanvas=cc._Class.extend({_cacheArray:[],ctor:function(t){this._renderContext=t},drawPoint:function(t,i){i||(i=1);var s=cc.view.getScaleX(),n=cc.view.getScaleY(),h=cc.p(t.x*s,t.y*n),r=this._renderContext.getContext();r.beginPath(),r.arc(h.x,-h.y,i*s,0,2*Math.PI,!1),r.closePath(),r.fill()},drawPoints:function(t,i,s){if(null!=t){s||(s=1);var n=this._renderContext.getContext(),h=cc.view.getScaleX(),r=cc.view.getScaleY();n.beginPath();for(var e=0,c=t.length;e<c;e++)n.arc(t[e].x*h,-t[e].y*r,s*h,0,2*Math.PI,!1);n.closePath(),n.fill()}},drawLine:function(t,i){var s=this._renderContext.getContext(),n=cc.view.getScaleX(),h=cc.view.getScaleY();s.beginPath(),s.moveTo(t.x*n,-t.y*h),s.lineTo(i.x*n,-i.y*h),s.closePath(),s.stroke()},drawRect:function(t,i){this.drawLine(cc.p(t.x,t.y),cc.p(i.x,t.y)),this.drawLine(cc.p(i.x,t.y),cc.p(i.x,i.y)),this.drawLine(cc.p(i.x,i.y),cc.p(t.x,i.y)),this.drawLine(cc.p(t.x,i.y),cc.p(t.x,t.y))},drawSolidRect:function(t,i,s){var n=[t,cc.p(i.x,t.y),i,cc.p(t.x,i.y)];this.drawSolidPoly(n,4,s)},drawPoly:function(t,i,s,n){if(n=n||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var h=t[0],r=this._renderContext.getContext(),e=cc.view.getScaleX(),c=cc.view.getScaleY();r.beginPath(),r.moveTo(h.x*e,-h.y*c);for(var o=1,u=t.length;o<u;o++)r.lineTo(t[o].x*e,-t[o].y*c);s&&r.closePath(),n?r.fill():r.stroke()}},drawSolidPoly:function(t,i,s){this.setDrawColor(s.r,s.g,s.b,s.a),this.drawPoly(t,i,!0,!0)},drawCircle:function(t,i,s,n,h){h=h||!1;var r=this._renderContext.getContext(),e=cc.view.getScaleX(),c=cc.view.getScaleY();r.beginPath();var o=s-2*Math.PI;r.arc(0|t.x*e,0|-t.y*c,i*e,-s,-o,!1),h&&r.lineTo(0|t.x*e,0|-t.y*c),r.stroke()},drawQuadBezier:function(t,i,s,n){var h=this._cacheArray;h.length=0;for(var r=0,e=0;e<n;e++){var c=Math.pow(1-r,2)*t.x+2*(1-r)*r*i.x+r*r*s.x,o=Math.pow(1-r,2)*t.y+2*(1-r)*r*i.y+r*r*s.y;h.push(cc.p(c,o)),r+=1/n}h.push(cc.p(s.x,s.y)),this.drawPoly(h,n+1,!1,!1)},drawCubicBezier:function(t,i,s,n,h){var r=this._cacheArray;r.length=0;for(var e=0,c=0;c<h;c++){var o=Math.pow(1-e,3)*t.x+3*Math.pow(1-e,2)*e*i.x+3*(1-e)*e*e*s.x+e*e*e*n.x,u=Math.pow(1-e,3)*t.y+3*Math.pow(1-e,2)*e*i.y+3*(1-e)*e*e*s.y+e*e*e*n.y;r.push(cc.p(o,u)),e+=1/h}r.push(cc.p(n.x,n.y)),this.drawPoly(r,h+1,!1,!1)},drawCatmullRom:function(t,i){this.drawCardinalSpline(t,.5,i)},drawCardinalSpline:function(t,i,s){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var h,r,e=1/t.length,c=0;c<s+1;c++){var o=c/s;1===o?(h=t.length-1,r=1):r=(o-e*(h=0|o/e))/e;var u=cc.cardinalSplineAt(cc.getControlPointAt(t,h-1),cc.getControlPointAt(t,h-0),cc.getControlPointAt(t,h+1),cc.getControlPointAt(t,h+2),i,r);n.push(u)}this.drawPoly(n,s+1,!1,!1)},drawImage:function(t,i,s,n,h){var r=arguments.length,e=this._renderContext.getContext();switch(r){case 2:var c=t.height;e.drawImage(t,i.x,-(i.y+c));break;case 3:e.drawImage(t,i.x,-(i.y+s.height),s.width,s.height);break;case 5:e.drawImage(t,i.x,i.y,s.width,s.height,n.x,-(n.y+h.height),h.width,h.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,i,s){var n=t||this._renderContext,h=n.getContext();i*=cc.view.getScaleX();var r="rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b);n.setFillStyle(r+",1)");var e=i/10;h.beginPath(),h.moveTo(-i,i),h.lineTo(0,e),h.lineTo(i,i),h.lineTo(e,0),h.lineTo(i,-i),h.lineTo(0,-e),h.lineTo(-i,-i),h.lineTo(-e,0),h.lineTo(-i,i),h.closePath(),h.fill();var c=h.createRadialGradient(0,0,e,0,0,i);c.addColorStop(0,r+", 1)"),c.addColorStop(.3,r+", 0.8)"),c.addColorStop(1,r+", 0.0)"),n.setFillStyle(c),h.beginPath();var o=cc.macro.PI2;h.arc(0,0,i-e,0,o,!1),h.closePath(),h.fill()},drawColorBall:function(t,i,s){var n=t||this._renderContext,h=n.getContext();i*=cc.view.getScaleX();var r="rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b),e=i/10,c=h.createRadialGradient(0,0,e,0,0,i);c.addColorStop(0,r+", 1)"),c.addColorStop(.3,r+", 0.8)"),c.addColorStop(.6,r+", 0.4)"),c.addColorStop(1,r+", 0.0)"),n.setFillStyle(c),h.beginPath();var o=cc.macro.PI2;h.arc(0,0,i,0,o,!1),h.closePath(),h.fill()},fillText:function(t,i,s){this._renderContext.getContext().fillText(t,i,-s)},setDrawColor:function(t,i,s,n){this._renderContext.setFillStyle("rgba("+t+","+i+","+s+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+i+","+s+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}})},{}],38:[function(t,i,s){var n=cc.macro;cc.DrawingPrimitiveWebGL=cc._Class.extend({_initialized:!1,_shader:null,_colorLocation:"u_color",_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(null==t&&(t=cc._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(n.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var s=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,new Float32Array([t.x,t.y]),i.STATIC_DRAW),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,1),i.deleteBuffer(s),cc.incrementGLDraws(1)},drawPoints:function(t,i){if(t&&0!==t.length){this.lazy_init();var s=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),s.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var h=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,h),s.bufferData(s.ARRAY_BUFFER,this._pointsToTypeArray(t),s.STATIC_DRAW),s.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,0),s.drawArrays(s.POINTS,0,t.length),s.deleteBuffer(h),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var i=new Float32Array(2*t.length),s=0;s<t.length;s++)i[2*s]=t[s].x,i[2*s+1]=t[s].y;return i},drawLine:function(t,i){this.lazy_init();var s=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),s.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,h),s.bufferData(s.ARRAY_BUFFER,this._pointsToTypeArray([t,i]),s.STATIC_DRAW),s.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,0),s.drawArrays(s.LINES,0,2),s.deleteBuffer(h),cc.incrementGLDraws(1)},drawRect:function(t,i){this.drawLine(cc.p(t.x,t.y),cc.p(i.x,t.y)),this.drawLine(cc.p(i.x,t.y),cc.p(i.x,i.y)),this.drawLine(cc.p(i.x,i.y),cc.p(t.x,i.y)),this.drawLine(cc.p(t.x,i.y),cc.p(t.x,t.y))},drawSolidRect:function(t,i,s){var n=[t,cc.p(i.x,t.y),i,cc.p(t.x,i.y)];this.drawSolidPoly(n,4,s)},drawPoly:function(t,i,s){this.lazy_init();var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,r),h.bufferData(h.ARRAY_BUFFER,this._pointsToTypeArray(t),h.STATIC_DRAW),h.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),s?h.drawArrays(h.LINE_LOOP,0,t.length):h.drawArrays(h.LINE_STRIP,0,t.length),h.deleteBuffer(r),cc.incrementGLDraws(1)},drawSolidPoly:function(t,i,s){this.lazy_init(),s&&this.setDrawColor(s.r,s.g,s.b,s.a);var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,r),h.bufferData(h.ARRAY_BUFFER,this._pointsToTypeArray(t),h.STATIC_DRAW),h.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.TRIANGLE_FAN,0,t.length),h.deleteBuffer(r),cc.incrementGLDraws(1)},drawCircle:function(t,i,s,h,r){this.lazy_init();var e=1;r&&e++;var c=2*Math.PI/h,o=new Float32Array(2*(h+2));if(o){for(var u=0;u<=h;u++){var a=u*c,f=i*Math.cos(a+s)+t.x,l=i*Math.sin(a+s)+t.y;o[2*u]=f,o[2*u+1]=l}o[2*(h+1)]=t.x,o[2*(h+1)+1]=t.y;var v=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),v.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,d),v.bufferData(v.ARRAY_BUFFER,o,v.STATIC_DRAW),v.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,v.FLOAT,!1,0,0),v.drawArrays(v.LINE_STRIP,0,h+e),v.deleteBuffer(d),cc.incrementGLDraws(1)}},drawQuadBezier:function(t,i,s,h){this.lazy_init();for(var r=new Float32Array(2*(h+1)),e=0,c=0;c<h;c++)r[2*c]=Math.pow(1-e,2)*t.x+2*(1-e)*e*i.x+e*e*s.x,r[2*c+1]=Math.pow(1-e,2)*t.y+2*(1-e)*e*i.y+e*e*s.y,e+=1/h;r[2*h]=s.x,r[2*h+1]=s.y;var o=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),o.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var u=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,r,o.STATIC_DRAW),o.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,o.FLOAT,!1,0,0),o.drawArrays(o.LINE_STRIP,0,h+1),o.deleteBuffer(u),cc.incrementGLDraws(1)},drawCubicBezier:function(t,i,s,h,r){this.lazy_init();for(var e=new Float32Array(2*(r+1)),c=0,o=0;o<r;o++)e[2*o]=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*i.x+3*(1-c)*c*c*s.x+c*c*c*h.x,e[2*o+1]=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*i.y+3*(1-c)*c*c*s.y+c*c*c*h.y,c+=1/r;e[2*r]=h.x,e[2*r+1]=h.y;var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),u.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var a=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,e,u.STATIC_DRAW),u.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,r+1),u.deleteBuffer(a),cc.incrementGLDraws(1)},drawCatmullRom:function(t,i){this.drawCardinalSpline(t,.5,i)},drawCardinalSpline:function(t,i,s){this.lazy_init();for(var h,r,e=new Float32Array(2*(s+1)),c=1/t.length,o=0;o<s+1;o++){var u=o/s;1===u?(h=t.length-1,r=1):r=(u-c*(h=0|u/c))/c;var a=cc.cardinalSplineAt(cc.getControlPointAt(t,h-1),cc.getControlPointAt(t,h),cc.getControlPointAt(t,h+1),cc.getControlPointAt(t,h+2),i,r);e[2*o]=a.x,e[2*o+1]=a.y}var f=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),f.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,l),f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW),f.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,f.FLOAT,!1,0,0),f.drawArrays(f.LINE_STRIP,0,s+1),f.deleteBuffer(l),cc.incrementGLDraws(1)},setDrawColor:function(t,i,s,n){this._colorArray[0]=t/255,this._colorArray[1]=i/255,this._colorArray[2]=s/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}})},{}],39:[function(t,i,s){var n,h=t("./event/event-target");n=t("./platform/CCView"),t("../audio/CCAudioEngine");var r={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",debugMode:"debugMode",exposeClassName:"exposeClassName",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,setFrameRate:function(t){this.config[this.CONFIG_KEY.frameRate]=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.director.purgeDirector(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),r.onStart()})},end:function(){close()},prepare:function(t){var i=this,s=i.config,h=i.CONFIG_KEY;if(this._configLoaded){if(this._prepared)t&&t();else if(!this._prepareCalled)if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(s[h.width],s[h.height]),cc.view=n?n._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var r=s[h.jsList];r&&r.length>0?cc.loader.load(r,function(s){if(s)throw new Error(JSON.stringify(s));i._prepared=!0,t&&t(),i.emit(i.EVENT_GAME_INITED)}):(t&&t(),i.emit(i.EVENT_GAME_INITED))}else cc.initEngine(this.config,function(){i.prepare(t)})}else this._loadConfig(function(){i.prepare(t)})},run:function(t,i){"function"==typeof t?r.onStart=t:(t&&(r.config=t),"function"==typeof i&&(r.onStart=i)),this.prepare(r.onStart&&r.onStart.bind(r))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var i=t.uuid;if(!this._persistRootNodes[i]){var s=cc.director._scene;if(cc.isValid(s)){if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==s)return void cc.warnID(3802)}else t.parent=s;this._persistRootNodes[i]=t,t._persistNode=!0}}}else cc.warnID(3800)},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var i=t.uuid||"";t===this._persistRootNodes[i]&&(delete this._persistRootNodes[i],t._persistNode=!1)}},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=new Date;var t=r.config[r.CONFIG_KEY.frameRate];this._frameTime=1e3/t,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var i=(new Date).getTime(),s=Math.max(0,r._frameTime-(i-r._lastTime)),n=window.setTimeout(function(){t()},s);return r._lastTime=i+s,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,i=this,s=i.config,n=i.CONFIG_KEY,h=cc.director,r=!0,e=s[n.frameRate];h.setDisplayStats(s[n.showFPS]),t=function(){if(!i._paused){if(30===e&&(r=!r))return void(i._intervalId=window.requestAnimFrame(t));h.mainLoop(),i._intervalId=window.requestAnimFrame(t)}},i._intervalId=window.requestAnimFrame(t),i._paused=!1},_loadConfig:function(t){if(this.config)return this._initConfig(this.config),void(t&&t());if(document.ccConfig)return this._initConfig(document.ccConfig),void(t&&t());var i=this;cc.loader.load("project.json",function(s,n){s&&cc.logID(3818),i._initConfig(n||{}),t&&t()})},_initConfig:function(t){var i=this.CONFIG_KEY;"number"!=typeof t[i.debugMode]&&(t[i.debugMode]=0),t[i.exposeClassName]=!!t[i.exposeClassName],"number"!=typeof t[i.frameRate]&&(t[i.frameRate]=60),"number"!=typeof t[i.renderMode]&&(t[i.renderMode]=0),"boolean"!=typeof t[i.registerSystemEvent]&&(t[i.registerSystemEvent]=!0),t[i.showFPS]=!(i.showFPS in t&&!t[i.showFPS]),this._sceneInfos=t[i.scenes]||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],cc._initDebugSetting(t[i.debugMode]),this.config=t,this._configLoaded=!0},_initRenderer:function(t,i){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var s,n,h=this.config[r.CONFIG_KEY.id],e=window,c=cc.$(h)||cc.$("#"+h);"CANVAS"===c.tagName?(t=t||c.width,i=i||c.height,this.canvas=cc._canvas=s=c,this.container=cc.container=n=document.createElement("DIV"),s.parentNode&&s.parentNode.insertBefore(n,s)):("DIV"!==c.tagName&&cc.warnID(3819),t=t||c.clientWidth,i=i||c.clientHeight,this.canvas=cc._canvas=s=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),c.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(s),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,s.addClass("gameCanvas"),s.setAttribute("width",t||480),s.setAttribute("height",i||320),s.setAttribute("tabindex",99),cc._renderType===r.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(s,{stencil:!0,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS,antialias:cc.sys.isMobile})),this._renderContext?(cc.renderer=cc.rendererWebGL,e.gl=this._renderContext,cc.renderer._(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=e.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=e.gl.getExtension("OES_element_index_uint")):(cc._renderType=r.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,cc.renderer._(),this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(s.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=n,r.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,i=window;this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?t="hidden":void 0!==document.mozHidden?t="mozHidden":void 0!==document.msHidden?t="msHidden":void 0!==document.webkitHidden&&(t="webkitHidden");var s=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],n=function(){r.emit(r.EVENT_HIDE,r)},h=function(){r.emit(r.EVENT_SHOW,r)};if(t)for(var e=0;e<s.length;e++)document.addEventListener(s[e],function(i){var s=document[t];(s=s||i.hidden)?n():h()},!1);else i.addEventListener("blur",n,!1),i.addEventListener("focus",h,!1);navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=function(){h()}),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",n,!1),i.addEventListener("pageshow",h,!1)),this.on(r.EVENT_HIDE,function(){r.pause()}),this.on(r.EVENT_SHOW,function(){r.resume()})}};h.call(r),cc.js.addon(r,h.prototype),cc.game=i.exports=r},{"../audio/CCAudioEngine":24,"./event/event-target":111,"./platform/CCView":182}],40:[function(t,i,s){"use strict";function n(t){var i=cc.Mask;if(i)for(var s=0,n=t;n&&cc.Node.isNode(n);n=n._parent,++s)if(n.getComponent(i))return{index:s,node:n};return null}var h=t("./utils/prefab-helper"),r=t("./utils/scene-graph-helper"),e=cc.Object.Flags.Destroying,c=t("./utils/misc"),o=(t("./event/event"),!!cc.ActionManager),u=function(){},a=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),f=[a.TOUCH_START,a.TOUCH_MOVE,a.TOUCH_END,a.TOUCH_CANCEL],l=[a.MOUSE_DOWN,a.MOUSE_ENTER,a.MOUSE_MOVE,a.MOUSE_LEAVE,a.MOUSE_UP,a.MOUSE_WHEEL],v=null,d=function(t,i){var s=t.getLocation(),n=this.owner;return!!n._hitTest(s,this)&&(i.type=a.TOUCH_START,i.touch=t,i.bubbles=!0,n.dispatchEvent(i),!0)},p=function(t,i){var s=this.owner;i.type=a.TOUCH_MOVE,i.touch=t,i.bubbles=!0,s.dispatchEvent(i)},g=function(t,i){var s=t.getLocation(),n=this.owner;n._hitTest(s,this)?i.type=a.TOUCH_END:i.type=a.TOUCH_CANCEL,i.touch=t,i.bubbles=!0,n.dispatchEvent(i)},m=function(t){var i=t.getLocation(),s=this.owner;s._hitTest(i,this)&&(t.stopPropagation(),t.type=a.MOUSE_DOWN,s.dispatchEvent(t))},w=function(t){var i=t.getLocation(),s=this.owner;s._hitTest(i,this)?(t.stopPropagation(),this._previousIn||(v&&(t.type=a.MOUSE_LEAVE,v.dispatchEvent(t),v._mouseListener._previousIn=!1),v=this.owner,t.type=a.MOUSE_ENTER,s.dispatchEvent(t),this._previousIn=!0),t.type=a.MOUSE_MOVE,s.dispatchEvent(t)):this._previousIn&&(t.type=a.MOUSE_LEAVE,s.dispatchEvent(t),this._previousIn=!1,v=null)},_=function(t){var i=t.getLocation(),s=this.owner;s._hitTest(i,this)&&(t.stopPropagation(),t.type=a.MOUSE_UP,s.dispatchEvent(t))},C=function(t){var i=t.getLocation(),s=this.owner;s._hitTest(i,this)&&(t.type=a.MOUSE_WHEEL,s.dispatchEvent(t))},b=cc.T({name:"cc.Node",S:t("./utils/base-node"),O:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_opacityModifyRGB:!1,groupIndex:{default:0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),this.emit("group-changed")}},x:{get:function(){return this._position.x},set:function(t){var i=this._position;if(t!==i.x){i.x=t,this._sgNode.setPositionX(t);var s=this._capturingListeners&&this._capturingListeners._callbackTable["position-changed"],n=this._bubblingListeners&&this._bubblingListeners._callbackTable["position-changed"];(s&&s.length>0||n&&n.length>0)&&this.emit("position-changed")}}},y:{get:function(){return this._position.y},set:function(t){var i=this._position;if(t!==i.y){i.y=t,this._sgNode.setPositionY(t);var s=this._capturingListeners&&this._capturingListeners._callbackTable["position-changed"],n=this._bubblingListeners&&this._bubblingListeners._callbackTable["position-changed"];(s&&s.length>0||n&&n.length>0)&&this.emit("position-changed")}}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},set:function(t){this._rotationX===t&&this._rotationY===t||(this._rotationX=this._rotationY=t,this._sgNode.rotation=t,this.emit("rotation-changed"))}},rotationX:{get:function(){return this._rotationX},set:function(t){this._rotationX!==t&&(this._rotationX=t,this._sgNode.rotationX=t,this.emit("rotation-changed"))}},rotationY:{get:function(){return this._rotationY},set:function(t){this._rotationY!==t&&(this._rotationY=t,this._sgNode.rotationY=t,this.emit("rotation-changed"))}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._sgNode.scaleX=t,this.emit("scale-changed"))}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._sgNode.scaleY=t,this.emit("scale-changed"))}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t&&(this._opacity=t,this._sgNode.setOpacity(t),!this._cascadeOpacityEnabled)){var i=this._sizeProvider;i instanceof _ccsg.Node&&i!==this._sgNode&&i.setOpacity(t)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t){this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t;var i=t?255:this._opacity,s=this._sizeProvider;s instanceof _ccsg.Node&&s.setOpacity(i)}}},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.fromColor(t),this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var i=this._anchorPoint;if(i.x!==t){i.x=t;var s=this._sizeProvider;s instanceof _ccsg.Node&&s.setAnchorPoint(i),this.emit("anchor-changed")}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var i=this._anchorPoint;if(i.y!==t){i.y=t;var s=this._sizeProvider;s instanceof _ccsg.Node&&s.setAnchorPoint(i),this.emit("anchor-changed")}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){var i=this._sizeProvider;i&&i.setContentSize(t,i._getHeight()),this._contentSize.width=t,this.emit("size-changed")}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){var i=this._sizeProvider;i&&i.setContentSize(i._getWidth(),t),this._contentSize.height=t,this.emit("size-changed")}}},zIndex:{get:function(){return this._localZOrder},set:function(t){this._localZOrder!==t&&(this._localZOrder=t,this._sgNode.zIndex=t,this._parent&&function(t){t._parent._delaySort(),cc.eventManager._setDirtyForNode(t)}(this))}}},ctor:function(t){var i=this._sgNode=new _ccsg.Node;cc.game._isCloning||(i.cascadeOpacity=!0),this._sizeProvider=null,this._reorderChildDirty=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},statics:{isNode:function(t){return t instanceof b&&(t.constructor===b||!(t instanceof cc.Scene))}},_onSetParent:function(t){var i=this._sgNode;i.parent&&i.parent.removeChild(i,!1),t&&(t._sgNode.addChild(i),t._delaySort())},_onSiblingIndexChanged:function(t){for(var i,s=this._parent,n=s._children,h=0,r=n.length;h<r;h++)(i=n[h]._sgNode)._arrivalOrder=h,cc.eventManager._setDirtyForNode(i);cc.renderer.childrenOrderDirty=!0,s._sgNode._reorderChildDirty=!0,s._delaySort()},_onPreDestroy:function(){var t=this._onPreDestroyBase();o&&cc.director.getActionManager().removeAllActionsFromTarget(this),v===this&&(v=null),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this),cc.eventManager.removeListeners(this),t||this._removeSgNode()},_onPostActivated:function(t){var i=o?cc.director.getActionManager():null;if(t)if(i&&i.resumeTarget(this),cc.eventManager.resumeTarget(this),this._touchListener){var s=this._touchListener.mask=n(this);this._mouseListener&&(this._mouseListener.mask=s)}else this._mouseListener&&(this._mouseListener.mask=n(this));else i&&i.pauseTarget(this),cc.eventManager.pauseTarget(this)},_onHierarchyChanged:function(t){this._onHierarchyChangedBase(t),cc._widgetManager._nodesOrderDirty=!0},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&h.syncWithPrefab(this),this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(o&&cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this));for(var i=this._children,s=0,n=i.length;s<n;s++)i[s]._onBatchCreated()},on:function(t,i,s,h){var r=!1;return-1!==f.indexOf(t)?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:n(this),onTouchBegan:d,onTouchMoved:p,onTouchEnded:g}),cc.eventManager.addListener(this._touchListener,this),r=!0):-1!==l.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:n(this),onMouseDown:m,onMouseMove:w,onMouseUp:_,onMouseScroll:C}),cc.eventManager.addListener(this._mouseListener,this),r=!0)),r&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||cc.eventManager.pauseTarget(this)},this,0,0,0,!1),this._EventTargetOn(t,i,s,h)},off:function(t,i,s,n){this._EventTargetOff(t,i,s,n),-1!==f.indexOf(t)?this._checkTouchListeners():-1!==l.indexOf(t)&&this._checkMouseListeners()},targetOff:function(t){this._EventTargetTargetOff(t),this._checkTouchListeners(),this._checkMouseListeners()},pauseSystemEvents:function(t){cc.eventManager.pauseTarget(this,t)},resumeSystemEvents:function(t){cc.eventManager.resumeTarget(this,t)},_checkTouchListeners:function(){if(!(this._objFlags&e)&&this._touchListener){var t=0;if(this._bubblingListeners)for(;t<f.length;++t)if(this._bubblingListeners.has(f[t]))return;if(this._capturingListeners)for(;t<f.length;++t)if(this._capturingListeners.has(f[t]))return;cc.eventManager.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&e)&&this._mouseListener){var t=0;if(this._bubblingListeners)for(;t<l.length;++t)if(this._bubblingListeners.has(l[t]))return;if(this._capturingListeners)for(;t<l.length;++t)if(this._capturingListeners.has(l[t]))return;v===this&&(v=null),cc.eventManager.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,i){var s,n=this.width,h=this.height,r=cc.rect(0,0,n,h);s=cc.Camera&&cc.Camera.main?cc.Camera.main.getNodeToCameraTransform(this):this.getNodeToWorldTransform(),cc._rectApplyAffineTransformIn(r,s);var e=t.x-r.x,c=r.x+r.width-t.x,o=t.y-r.y,u=r.y+r.height-t.y;if(e>=0&&c>=0&&u>=0&&o>=0){if(i&&i.mask){for(var a=i.mask,f=this,l=0;f&&l<a.index;++l,f=f.parent);if(f===a.node){var v=f.getComponent(cc.Mask);return!v||!v.enabledInHierarchy||v._hitTest(t)}return i.mask=null,!0}return!0}return!1},_getCapturingTargets:function(t,i){for(var s=this.parent;s;)s.hasEventListener(t,!0)&&i.push(s),s=s.parent},_getBubblingTargets:function(t,i){for(var s=this.parent;s;)s.hasEventListener(t)&&i.push(s),s=s.parent},isRunning:function(){return this._activeInHierarchy},runAction:o?function(t){if(this.active)return cc.assertID(t,1618),cc.macro.ENABLE_GC_FOR_NATIVE_OBJECTS||this._retainAction(t),cc.director.getActionManager().addAction(t,this,!1),t}:u,pauseAllActions:o?function(){cc.director.getActionManager().pauseTarget(this)}:u,resumeAllActions:o?function(){cc.director.getActionManager().resumeTarget(this)}:u,stopAllActions:o?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:u,stopAction:o?function(t){cc.director.getActionManager().removeAction(t)}:u,stopActionByTag:o?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:u,getActionByTag:o?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:o?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},_retainAction:function(t){},_releaseAllActions:function(){},setTag:function(t){this._tag=t,this._sgNode.tag=t},getPosition:function(){return new cc.Vec2(this._position)},setPosition:function(t,i){var s;void 0===i?(s=t.x,i=t.y):s=t;var n=this._position;if(n.x!==s||n.y!==i){n.x=s,n.y=i,this._sgNode.setPosition(s,i);var h=this._capturingListeners&&this._capturingListeners._callbackTable["position-changed"],r=this._bubblingListeners&&this._bubblingListeners._callbackTable["position-changed"];(h&&h.length>0||r&&r.length>0)&&this.emit("position-changed")}},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,i){"object"==typeof t?(i=t.y,t=t.x):i=i||0===i?i:t,this._scaleX===t&&this._scaleY===i||(this._scaleX=t,this._scaleY=i,this._sgNode.setScale(t,i),this.emit("scale-changed"))},getContentSize:function(t){if(this._sizeProvider&&!t){var i=this._sizeProvider.getContentSize();return this._contentSize=i,cc.size(i)}return cc.size(this._contentSize)},setContentSize:function(t,i){var s=this._contentSize;if(void 0===i){if(t.width===s.width&&t.height===s.height)return;s.width=t.width,s.height=t.height}else{if(t===s.width&&i===s.height)return;s.width=t,s.height=i}this._sizeProvider&&this._sizeProvider.setContentSize(s),this.emit("size-changed")},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t);var i=this._sizeProvider;i instanceof _ccsg.Node&&i!==this._sgNode&&i.setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,i){var s=this._anchorPoint;if(void 0===i){if(t.x===s.x&&t.y===s.y)return;s.x=t.x,s.y=t.y}else{if(t===s.x&&i===s.y)return;s.x=t,s.y=i}var n=this._sizeProvider;n instanceof _ccsg.Node&&n.setAnchorPoint(s),this.emit("anchor-changed")},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},getNodeToParentTransformAR:function(){var t=this.getContentSize(),i=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var s=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,h=cc.affineTransformMake(1,0,0,1,s,n);i=cc.affineTransformConcatIn(h,i)}return i},getBoundingBox:function(){var t=this.getContentSize(),i=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(i,this.getNodeToParentTransform())},getBoundingBoxToWorld:function(){var t;return this.parent&&(t=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var i=this.getContentSize(),s=i.width,n=i.height,h=cc.rect(-this._anchorPoint.x*s,-this._anchorPoint.y*n,s,n),r=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(h,r),!this._children)return h;for(var e=this._children,c=0;c<e.length;c++){var o=e[c];if(o&&o.active){var u=o._getBoundingBoxTo(r);u&&(h=cc.rectUnion(h,u))}}return h},getNodeToParentTransform:function(){var t=this.getContentSize(),i=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var s=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,h=cc.affineTransformMake(1,0,0,1,s,n);i=cc.affineTransformConcatIn(h,i)}return i},getNodeToWorldTransform:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var i=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var s=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,h=cc.affineTransformMake(1,0,0,1,s,n);i=cc.affineTransformConcatIn(h,i)}return i},getNodeToWorldTransformAR:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var i=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var s=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,h=cc.affineTransformMake(1,0,0,1,s,n);i=cc.affineTransformConcatIn(h,i)}return i},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},_isSgTransformArToMe:function(t){var i=this._sgNode.getContentSize();return 0===i.width&&0===i.height&&(0!==t.width||0!==t.height)||!!this._sgNode.isIgnoreAnchorPointForPosition()},convertToNodeSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var i=this._sgNode.convertToNodeSpace(t);return cc.pAdd(i,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var i=t.x-this._anchorPoint.x*this._contentSize.width,s=t.y-this._anchorPoint.y*this._contentSize.height;return cc.v2(this._sgNode.convertToWorldSpace(cc.v2(i,s)))},convertToNodeSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(t)):this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(t)):cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},setNodeDirty:function(){this._sgNode.setNodeDirty()},addChild:function(t,i,s){i=void 0===i?t._localZOrder:i;var n,h=!1;void 0===s?(s=void 0,n=t._name):cc.js.isString(s)?(n=s,s=void 0):cc.js.isNumber(s)&&(h=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,t.zIndex=i,h?t.setTag(s):t.setName(n)},cleanup:function(){o&&cc.director.getActionManager().removeAllActionsFromTarget(this),cc.eventManager.removeListeners(this);var t,i,s=this._children.length;for(t=0;t<s;++t)(i=this._children[t])&&i.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;if(t.length>1){var i,s,n,h=t.length;for(i=1;i<h;i++){for(n=t[i],s=i-1;s>=0;){if(n._localZOrder<t[s]._localZOrder)t[s+1]=t[s];else{if(!(n._localZOrder===t[s]._localZOrder&&n._sgNode._arrivalOrder<t[s]._sgNode._arrivalOrder))break;t[s+1]=t[s]}s--}t[s+1]=n}this.emit("child-reorder")}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_updateDummySgNode:function(){var t=this._sgNode;t.setPosition(this._position),t.setRotationX(this._rotationX),t.setRotationY(this._rotationY),t.setScale(this._scaleX,this._scaleY),t.setSkewX(this._skewX),t.setSkewY(this._skewY);var i=t._arrivalOrder;t.setLocalZOrder(this._localZOrder),t._arrivalOrder=i,t.setGlobalZOrder(this._globalZOrder),t.setOpacity(this._opacity),t.setOpacityModifyRGB(this._opacityModifyRGB),t.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),t.setTag(this._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color);var i=o?cc.director.getActionManager():null;this._activeInHierarchy?(i&&i.resumeTarget(this),cc.eventManager.resumeTarget(this)):(i&&i.pauseTarget(this),cc.eventManager.pauseTarget(this))},_removeSgNode:r.removeSgNode,onRestore:!1});c.propertyDefine(b,["parent","tag","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"]}),b.EventType=a,cc.Node=i.exports=b},{"./event/event":112,"./utils/base-node":218,"./utils/misc":223,"./utils/prefab-helper":225,"./utils/scene-graph-helper":226}],41:[function(t,i,s){cc.Scene=cc.T({name:"cc.Scene",S:t("./CCNode"),O:{autoReleaseAssets:void 0},ctor:function(){(this._sgNode=new _ccsg.Scene).setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),i.exports=cc.Scene},{"./CCNode":40}],42:[function(t,i,s){function n(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var h=function(t,i,s,n,h,r,e){this.prev=t,this.next=i,this.callback=s,this.target=n,this.priority=h,this.paused=r,this.markedForDeletion=e,this.isUpdate=!s},r=[];h.get=function(t,i,s,n,e,c,o){var u=r.pop();return u?(u.prev=t,u.next=i,u.callback=s,u.target=n,u.priority=e,u.paused=c,u.markedForDeletion=o,u.isUpdate=!s):u=new h(t,i,s,n,e,c,o),u},h.put=function(t){r.length<20&&(t.prev=t.next=t.callback=t.target=null,r.push(t))};var e=function(t,i,s,n){this.list=t,this.entry=i,this.target=s,this.callback=n},c=[];e.get=function(t,i,s,n){var h=c.pop();return h?(h.list=t,h.entry=i,h.target=s,h.callback=n):h=new e(t,i,s,n),h},e.put=function(t){c.length<20&&(t.list=t.entry=t.target=t.callback=null,c.push(t))};var o=function(t,i,s,n,h,r){this.timers=t,this.target=i,this.timerIndex=s,this.currentTimer=n,this.currentTimerSalvaged=h,this.paused=r},u=[];o.get=function(t,i,s,n,h,r){var e=u.pop();return e?(e.timers=t,e.target=i,e.timerIndex=s,e.currentTimer=n,e.currentTimerSalvaged=h,e.paused=r):e=new o(t,i,s,n,h,r),e},o.put=function(t){u.length<20&&(t.timers=t.target=t.currentTimer=null,u.push(t))};var a=n.prototype;a.initWithCallback=function(t,i,s,n,h,r){return this._scheduler=t,this._target=s,this._callback=i,this._elapsed=-1,this._interval=n,this._delay=r,this._useDelay=this._delay>0,this._repeat=h,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},a.getInterval=function(){return this._interval},a.setInterval=function(t){this._interval=t},a.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},a.getCallback=function(){return this._callback},a.trigger=function(){this._target&&this._callback&&this._callback.call(this._target,this._elapsed)},a.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var f=[];n.get=function(){return f.pop()||new n},n.put=function(t){f.length<20&&(t._scheduler=t._target=t._callback=null,f.push(t))};var l=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_removeHashElement:function(t){delete this._hashForTimers[l(t.target)];for(var i=this._arrayForTimers,s=0,n=i.length;s<n;s++)if(i[s]===t){i.splice(s,1);break}o.put(t)},_removeUpdateFromHash:function(t){var i=l(t.target),s=this._hashForUpdates[i];if(s){for(var n=s.list,r=s.entry,c=0,o=n.length;c<o;c++)if(n[c]===r){n.splice(c,1);break}delete this._hashForUpdates[i],h.put(r),e.put(s)}},_priorityIn:function(t,i,s){for(var n=0;n<t.length;n++)if(s<t[n].priority)return void t.splice(n,0,i);t.push(i)},_appendIn:function(t,i){t.push(i)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var i,s,n,h;for(i=0,n=(s=this._updatesNegList).length;i<n;i++)(h=s[i]).paused||h.markedForDeletion||(h.isUpdate?h.target.update(t):h.callback.call(h.target,t));for(i=0,n=(s=this._updates0List).length;i<n;i++)(h=s[i]).paused||h.markedForDeletion||(h.isUpdate?h.target.update(t):h.callback.call(h.target,t));for(i=0,n=(s=this._updatesPosList).length;i<n;i++)(h=s[i]).paused||h.markedForDeletion||(h.isUpdate?h.target.update(t):h.callback.call(h.target,t));var r,e=this._arrayForTimers;for(i=0;i<e.length;i++){if(r=e[i],this._currentTarget=r,this._currentTargetSalvaged=!1,!r.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;++r.timerIndex)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(t),r.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--i)}for(i=0,s=this._updatesNegList;i<s.length;)(h=s[i]).markedForDeletion?this._removeUpdateFromHash(h):i++;for(i=0,s=this._updates0List;i<s.length;)(h=s[i]).markedForDeletion?this._removeUpdateFromHash(h):i++;for(i=0,s=this._updatesPosList;i<s.length;)(h=s[i]).markedForDeletion?this._removeUpdateFromHash(h):i++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,i,s,n,h,r){this.schedule(i,t,s,n,h,r)},schedule:function(t,i,s,h,r,e){"use strict";if("function"!=typeof t){var c=t;t=i,i=c}4!==arguments.length&&5!==arguments.length||(e=!!h,h=cc.macro.REPEAT_FOREVER,r=0),cc.assertID(i,1502);var u=l(i);cc.assertID(u,1510);var a=this._hashForTimers[u];a?a.paused!==e&&cc.warnID(1511):(a=o.get(null,i,0,null,null,e),this._arrayForTimers.push(a),this._hashForTimers[u]=a);var f,v;if(null==a.timers)a.timers=[];else for(v=0;v<a.timers.length;++v)if((f=a.timers[v])&&t===f._callback)return cc.logID(1507,f.getInterval(),s),void(f._interval=s);(f=n.get()).initWithCallback(this,t,i,s,h,r),a.timers.push(f)},scheduleUpdate:function(t,i,s,n){var r=l(t);cc.assertID(r,1510);var c=this._hashForUpdates[r];if(c&&c.entry){if(c.entry.priority===i)return c.entry.markedForDeletion=!1,void(c.entry.paused=s);if(this._updateHashLocked)return cc.logID(1506),c.entry.markedForDeletion=!1,void(c.entry.paused=s);this.unscheduleUpdate(t)}var o,u=h.get(null,null,n,t,i,s,!1);0===i?(o=this._updates0List,this._appendIn(o,u)):(o=i<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,u,i)),this._hashForUpdates[r]=e.get(o,u,t,null)},unschedule:function(t,i){if(i&&t){var s=l(i);cc.assertID(s,1510);var h=this._hashForTimers[s];if(h)for(var r=h.timers,e=0,c=r.length;e<c;e++){var o=r[e];if(t===o._callback)return o!==h.currentTimer||h.currentTimerSalvaged||(h.currentTimerSalvaged=!0),r.splice(e,1),n.put(o),h.timerIndex>=e&&h.timerIndex--,void(0===r.length&&(this._currentTarget===h?this._currentTargetSalvaged=!0:this._removeHashElement(h)))}}},unscheduleUpdate:function(t){if(t){var i=l(t);cc.assertID(i,1510);var s=this._hashForUpdates[i];s&&(this._updateHashLocked?s.entry.markedForDeletion=!0:this._removeUpdateFromHash(s.entry))}},unscheduleAllForTarget:function(t){if(t){var i=l(t);cc.assertID(i,1510);var s=this._hashForTimers[i];if(s){var h=s.timers;h.indexOf(s.currentTimer)>-1&&!s.currentTimerSalvaged&&(s.currentTimerSalvaged=!0);for(var r=0,e=h.length;r<e;r++)n.put(h[r]);h.length=0,this._currentTarget===s?this._currentTargetSalvaged=!0:this._removeHashElement(s)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var i,s,n=this._arrayForTimers;for(i=n.length-1;i>=0;i--)s=n[i],this.unscheduleAllForTarget(s.target);var h,r=0;if(t<0)for(i=0;i<this._updatesNegList.length;)r=this._updatesNegList.length,(h=this._updatesNegList[i])&&h.priority>=t&&this.unscheduleUpdate(h.target),r==this._updatesNegList.length&&i++;if(t<=0)for(i=0;i<this._updates0List.length;)r=this._updates0List.length,(h=this._updates0List[i])&&this.unscheduleUpdate(h.target),r==this._updates0List.length&&i++;for(i=0;i<this._updatesPosList.length;)r=this._updatesPosList.length,(h=this._updatesPosList[i])&&h.priority>=t&&this.unscheduleUpdate(h.target),r==this._updatesPosList.length&&i++},isScheduled:function(t,i){cc.assertID(t,1508),cc.assertID(i,1509);var s=l(i);cc.assertID(s,1510);var n=this._hashForTimers[s];if(!n)return!1;if(null==n.timers)return!1;for(var h=n.timers,r=0;r<h.length;++r)if(t===h[r]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var i,s,n,h=[],r=this._arrayForTimers;for(s=0,n=r.length;s<n;s++)(i=r[s])&&(i.paused=!0,h.push(i.target));var e;if(t<0)for(s=0;s<this._updatesNegList.length;s++)(e=this._updatesNegList[s])&&e.priority>=t&&(e.paused=!0,h.push(e.target));if(t<=0)for(s=0;s<this._updates0List.length;s++)(e=this._updates0List[s])&&(e.paused=!0,h.push(e.target));for(s=0;s<this._updatesPosList.length;s++)(e=this._updatesPosList[s])&&e.priority>=t&&(e.paused=!0,h.push(e.target));return h},resumeTargets:function(t){if(t)for(var i=0;i<t.length;i++)this.resumeTarget(t[i])},pauseTarget:function(t){cc.assertID(t,1503);var i=l(t);cc.assertID(i,1510);var s=this._hashForTimers[i];s&&(s.paused=!0);var n=this._hashForUpdates[i];n&&(n.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var i=l(t);cc.assertID(i,1510);var s=this._hashForTimers[i];s&&(s.paused=!1);var n=this._hashForUpdates[i];n&&(n.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var i=l(t);cc.assertID(i,1510);var s=this._hashForTimers[i];if(s)return s.paused;var n=this._hashForUpdates[i];return!!n&&n.entry.paused},scheduleUpdateForTarget:function(t,i,s){this.scheduleUpdate(t,i,s)},unscheduleCallbackForTarget:function(t,i){this.unschedule(i,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],43:[function(t,i,s){var n=t("./CCRawAsset");cc.Asset=cc.T({name:"cc.Asset",S:n,O:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/"+this._rawFiles[0];cc.errorID(6400)}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/";return this._rawFiles.map(function(i){return t+i})}cc.errorID(6401)}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=t.length>0?t:null},_preloadRawFiles:null}),i.exports=cc.Asset},{"./CCRawAsset":49}],44:[function(t,i,s){var n=cc.T({name:"cc.AudioClip",S:cc.RawAsset});cc.AudioClip=n,i.exports=n},{}],45:[function(t,i,s){var n=cc.T({name:"cc.BitmapFont",S:cc.Font,O:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.P},fontSize:{default:-1},_fntConfig:null}});cc.BitmapFont=n,i.exports=n},{}],46:[function(t,i,s){var n=cc.T({name:"cc.Font",S:cc.Asset});cc.Font=n,i.exports=n},{}],47:[function(t,i,s){var n=cc.T({name:"cc.LabelAtlas",S:cc.BitmapFont});cc.LabelAtlas=n,i.exports=n},{}],48:[function(t,i,s){var n=cc.T({name:"cc.Prefab",S:cc.Asset,O:{data:null,asyncLoadAssets:void 0,_createFunction:{default:null,serializable:!1}},createNode:!1,compileCreateFunction:function(){var i=t("../platform/instantiate-jit");this._createFunction=i.compile(this.data)},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){var t=this._doInstantiate();return this.data._instantiate(t),t}});cc.V=i.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":190}],49:[function(t,i,s){var n=t("../platform/CCObject");cc.RawAsset=cc.T({name:"cc.RawAsset",S:n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}),i.exports=cc.RawAsset},{"../platform/CCObject":178}],50:[function(t,i,s){var n=cc.T({name:"cc.SceneAsset",S:cc.Asset,O:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,i.exports=n},{}],51:[function(t,i,s){var n=cc.T({name:"cc.Script",S:cc.Asset});cc._Script=n;var h=cc.T({name:"cc.JavaScript",S:n});cc._JavaScript=h;var r=cc.T({name:"cc.CoffeeScript",S:n});cc._CoffeeScript=r;var e=cc.T({name:"cc.TypeScript",S:n});cc._TypeScript=e},{}],52:[function(t,i,s){var n=cc.T({name:"cc.SpriteAtlas",S:cc.Asset,O:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var i=this._spriteFrames[t[0]];return i?i.getTexture():null}return null},getSpriteFrame:function(t){return this._spriteFrames[t]},getSpriteFrames:function(){var t=[],i=this._spriteFrames;for(var s in i)t.push(i[s]);return t}});cc.SpriteAtlas=n,i.exports=n},{}],53:[function(t,i,s){var n=cc.T({name:"cc.TTFFont",S:cc.Font});cc.TTFFont=n,i.exports=n},{}],54:[function(t,i,s){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas")},{"../sprites/CCSpriteFrame":211,"../textures/CCTexture2D":212,"./CCAsset":43,"./CCAudioClip":44,"./CCBitmapFont":45,"./CCFont":46,"./CCLabelAtlas":47,"./CCPrefab":48,"./CCRawAsset":49,"./CCSceneAsset":50,"./CCScripts":51,"./CCSpriteAtlas":52,"./CCTTFFont":53}],55:[function(t,i,s){var n=t("../utils/misc"),h=!!cc.ActionManager,r=function(){};cc.s_globalOrderOfArrival=1,_ccsg.Node=cc.T({name:"ccsg.Node",O:{_running:!1,_localZOrder:0,_globalZOrder:0,_arrivalOrder:0,_reorderChildDirty:!1,_vertexZ:0,_customZ:void 0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:cc.p(0,0),_contentSize:cc.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.macro.NODE_TAG_INVALID,_name:"",_realOpacity:255,_realColor:cc.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_isTransitionFinished:!1,_actionManager:null,_scheduler:null,_renderCmd:null},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._renderCmd=this._createRenderCmd()},_:function(){return!0},attr:function(t){for(var i in t)this[i]=t[i]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._parent?this._parent.reorderChild(this,t):this._localZOrder=t,cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.logID(1600),this.getLocalZOrder()},setZOrder:function(t){cc.logID(1601),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,i){this._scaleX=t,this._scaleY=i||0===i?i:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,i){var s=this._position;if(void 0===i){if(s.x===t.x&&s.y===t.y)return;s.x=t.x,s.y=t.y}else{if(s.x===t&&s.y===i)return;s.x=t,s.y=i}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,i){var s=this._anchorPoint;if(void 0===i){if(t.x===s.x&&t.y===s.y)return;s.x=t.x,s.y=t.y}else{if(t===s.x&&i===s.y)return;s.x=t,s.y=i}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,i){var s=this._contentSize;if(void 0===i){if(t.width===s.width&&t.height===s.height)return;s.width=t.width,s.height=t.height}else{if(t===s.width&&i===s.height)return;s.width=t,s.height=i}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t;var i=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(i.transformDirty|i.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},setIgnoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},updateOrderOfArrival:function(){this._arrivalOrder=++cc.s_globalOrderOfArrival},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.logID(1608),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this)},getChildByTag:function(t){var i=this._children;if(null!==i)for(var s=0;s<i.length;s++){var n=i[s];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var i=this._children,s=0,n=i.length;s<n;s++)if(i[s]._name===t)return i[s];return null},addChild:function(t,i,s){i=void 0===i?t._localZOrder:i;var n,h=!1;void 0===s?n=t._name:"string"==typeof s?(n=s,s=void 0):"number"==typeof s&&(h=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),this._addChildHelper(t,i,s,n,h)},_addChildHelper:function(t,i,s,n,h){this._children||(this._children=[]),this._insertChild(t,i),h?t.setTag(s):t.setName(n),t.setParent(this),t.updateOrderOfArrival(),this._running&&(t.performRecursive(_ccsg.Node.performType.onEnter),this._isTransitionFinished&&t.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)),t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.logID(1607),this.removeFromParent(t)},removeChild:function(t,i){0!==this._children.length&&(void 0===i&&(i=!0),this._children.indexOf(t)>-1&&this._detachChild(t,i),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,i){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var s=this.getChildByTag(t);s?this.removeChild(s,i):cc.logID(1610,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var i=this._children;if(null!==i){void 0===t&&(t=!0);for(var s=0;s<i.length;s++){var n=i[s];n&&(this._running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),t&&n.performRecursive(_ccsg.Node.performType.cleanup),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,i){this._running&&(t.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),t.performRecursive(_ccsg.Node.performType.onExit)),i&&t.performRecursive(_ccsg.Node.performType.cleanup),t.parent=null,t._renderCmd.detachFromParent(),cc.js.array.remove(this._children,t)},_insertChild:function(t,i){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(i)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,i){cc.assertID(t,1617),-1!==this._children.indexOf(t)?i!==t.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.updateOrderOfArrival(),t._setLocalZOrder(i),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)):cc.logID(1635)},sortAllChildren:function(){if(this._reorderChildDirty){var t,i,s,n=this._children,h=n.length;for(t=1;t<h;t++){for(s=n[t],i=t-1;i>=0;){if(s._localZOrder<n[i]._localZOrder)n[i+1]=n[i];else{if(!(s._localZOrder===n[i]._localZOrder&&s._arrivalOrder<n[i]._arrivalOrder))break;n[i+1]=n[i]}i--}n[i+1]=s}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},performRecursive:function(t){var i=_ccsg.Node.performType;if(!(t>=i.max)){var s,n,h,r,e,c=0,o=_ccsg.Node._performStacks[_ccsg.Node._performing];for(o||(o=[],_ccsg.Node._performStacks.push(o)),o.length=0,_ccsg.Node._performing++,h=o[0]=this;h;){if((s=h._children)&&s.length>0)for(r=0,e=s.length;r<e;++r)n=s[r],o.push(n);h=o[++c]}switch(t){case i.onEnter:for(r=o.length-1;r>=0;--r)h=o[r],o[r]=null,h&&h.onEnter();break;case i.onExit:for(r=o.length-1;r>=0;--r)h=o[r],o[r]=null,h&&h.onExit();break;case i.onEnterTransitionDidFinish:for(r=o.length-1;r>=0;--r)h=o[r],o[r]=null,h&&h.onEnterTransitionDidFinish();break;case i.cleanup:for(r=o.length-1;r>=0;--r)h=o[r],o[r]=null,h&&h.cleanup();break;case i.onExitTransitionDidStart:for(r=o.length-1;r>=0;--r)h=o[r],o[r]=null,h&&h.onExitTransitionDidStart()}_ccsg.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause()},runAction:h?function(t){return cc.assertID(t,1618),cc.director.getActionManager().addAction(t,this,!this._running),t}:r,stopAllActions:h?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:r,stopAction:h?function(t){cc.director.getActionManager().removeAction(t)}:r,stopActionByTag:h?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:r,getActionByTag:h?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:h?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,i,s,n,h){var r=arguments.length;"function"==typeof t?1===r?(i=0,s=cc.macro.REPEAT_FOREVER,n=0,h=this.__instanceId):2===r?"number"==typeof i?(s=cc.macro.REPEAT_FOREVER,n=0,h=this.__instanceId):(h=i,i=0,s=cc.macro.REPEAT_FOREVER,n=0):3===r?("string"==typeof s?(h=s,s=cc.macro.REPEAT_FOREVER):h=this.__instanceId,n=0):4===r&&(h=this.__instanceId):1===r?(i=0,s=cc.macro.REPEAT_FOREVER,n=0):2===r&&(s=cc.macro.REPEAT_FOREVER,n=0),cc.assertID(t,1619),cc.assertID(i>=0,1620),i=i||0,s=isNaN(s)?cc.macro.REPEAT_FOREVER:s,n=n||0,this.scheduler.schedule(t,this,i,s,n,!this._running,h)},scheduleOnce:function(t,i,s){void 0===s&&(s=this.__instanceId),this.schedule(t,0,0,i,s)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.logID(1614),this.resume()},resume:function(){this.scheduler.resumeTarget(this),h&&cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.logID(1615),this.pause()},pause:function(){this.scheduler.pauseTarget(this),h&&cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),i=this._parent;null!==i;i=i.parent)t=cc.affineTransformConcat(t,i.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.v2(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.v2(0,0);var i=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(i)},_convertToWindowSpace:function(t){var i=this.convertToWorldSpace(t);return cc.director.convertToUI(i)},convertTouchToNodeSpace:function(t){var i=t.getLocation();return this.convertToNodeSpace(i)},convertTouchToNodeSpaceAR:function(t){var i=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(i)},updateTransform:function(){for(var t,i=this._children,s=0;s<i.length;s++)(t=i[s])&&t.updateTransform()},retain:function(){},release:function(){},visit:function(t){var i=this._renderCmd,s=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;i.visit(s);var h,r,e=this._children,c=e.length;if(c>0){for(this._reorderChildDirty&&this.sortAllChildren(),h=0;h<c&&(r=e[h])._localZOrder<0;h++)r.visit(this);for(n.pushRenderCommand(i);h<c;h++)e[h].visit(this)}else n.pushRenderCommand(i);i._dirtyFlag=0}else i._propagateFlagsDown(s)},transform:function(t,i){this._renderCmd.transform(t,i)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var i=this._renderCmd.getNodeToParentTransform();if(t){for(var s={a:i.a,b:i.b,c:i.c,d:i.d,tx:i.tx,ty:i.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())cc.affineTransformConcatIn(s,n.getNodeToParentTransform());return s}return i},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),i=this.getNodeToWorldTransform();if(cc._rectApplyAffineTransformIn(t,i),!this._children)return t;for(var s=this._children,n=0;n<s.length;n++){var h=s[n];if(h&&h._visible){var r=h._getBoundingBoxToCurrentNode(i);r&&(t=cc.rectUnion(t,r))}}return t},_getBoundingBoxToCurrentNode:function(t){var i=cc.rect(0,0,this._contentSize.width,this._contentSize.height),s=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t);if(cc._rectApplyAffineTransformIn(i,s),!this._children)return i;for(var n=this._children,h=0;h<n.length;h++){var r=n[h];if(r&&r._visible){var e=r._getBoundingBoxToCurrentNode(s);e&&(i=cc.rectUnion(i,e))}}return i},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var i=this._realColor;i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=cc._Class.extend,_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node.performType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},_ccsg.Node._performStacks=[[]],_ccsg.Node._performing=0,n.propertyDefine(_ccsg.Node,["skewX","skewY","vertexZ","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","scheduler","shaderProgram","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],width:["_getWidth","_setWidth"],height:["_getHeight","_setHeight"],anchorX:["_getAnchorX","_setAnchorX"],anchorY:["_getAnchorY","_setAnchorY"],zIndex:["getLocalZOrder","setLocalZOrder"],visible:["isVisible","setVisible"],running:["isRunning"],ignoreAnchor:["isIgnoreAnchorPointForPosition","setIgnoreAnchorPointForPosition"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]})},{"../utils/misc":223}],56:[function(t,i,s){cc.CustomRenderCmd=function(t,i){this._needDraw=!0,this._target=t,this._callback=i},cc.CustomRenderCmd.prototype.rendering=function(t,i,s){this._callback&&this._callback.call(this._target,t,i,s)};var n=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:9};cc.js.get(n,"all",function(){return(1<<n.COUNT)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){cc.assertID(!n[t],1622,t);var i=1<<n.COUNT;return n[t]=i,n.COUNT++,i};var h=Math.PI/180;_ccsg.Node.RenderCmd=function(t){this._node=t,this._anchorPointInPoints=new cc.Vec2(0,0),this._needDraw=!1,this._dirtyFlag=1,this._curLevel=-1,this._cameraFlag=0,this._displayedColor=new cc.Color(255,255,255,255),this._displayedOpacity=255,this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._transformUpdated=!1,cc.renderer.pushDirtyNode(this)},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,_ctor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(n.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(n.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&n.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,i=this._node._contentSize,s=this._node._anchorPoint;t.x=i.width*s.x,t.y=i.height*s.y,this.setDirtyFlag(n.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,i){var s=this._node,n=t?t._worldTransform:null,r=this._transform,e=this._worldTransform;if(!this._transformUpdated){var c=s._rotationX||s._rotationY,o=s._skewX||s._skewY,u=s._scaleX,a=s._scaleY,f=this._anchorPointInPoints.x,l=this._anchorPointInPoints.y,v=1,d=0,p=0,g=1;if(c||o){if(r.tx=s._position.x,r.ty=s._position.y,c){var m=s._rotationX*h;if(p=Math.sin(m),g=Math.cos(m),s._rotationY===s._rotationX)v=g,d=-p;else{var w=s._rotationY*h;v=Math.cos(w),d=-Math.sin(w)}}if(r.a=v*=u,r.b=d*=u,r.c=p*=a,r.d=g*=a,o){var _=Math.tan(s._skewX*h),C=Math.tan(s._skewY*h);_===1/0&&(_=99999999),C===1/0&&(C=99999999),r.a=v+p*C,r.b=d+g*C,r.c=p+v*_,r.d=g+d*_}(f||l)&&(r.tx-=r.a*f+r.c*l,r.ty-=r.b*f+r.d*l,s._ignoreAnchorPointForPosition&&(r.tx+=f,r.ty+=l))}else r.a=u,r.b=0,r.c=0,r.d=a,r.tx=s._position.x,r.ty=s._position.y,(f||l)&&(r.tx-=r.a*f,r.ty-=r.d*l,s._ignoreAnchorPointForPosition&&(r.tx+=f,r.ty+=l))}n?(e.a=r.a*n.a+r.b*n.c,e.b=r.a*n.b+r.b*n.d,e.c=r.c*n.a+r.d*n.c,e.d=r.c*n.b+r.d*n.d,e.tx=r.tx*n.a+r.ty*n.c+n.tx,e.ty=r.tx*n.b+r.ty*n.d+n.ty):(e.a=r.a,e.b=r.b,e.c=r.c,e.d=r.d,e.tx=r.tx,e.ty=r.ty),this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble));var b=cc.Camera;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&b&&(b.main,t&&this._cameraFlag!=b.flags.InCamera&&(this._cameraFlag=t._cameraFlag>0?b.flags.ParentInCamera:0)),i&&function(t){var i,s,n,h,r,e,c=1,o=_ccsg.Node._performStacks[_ccsg.Node._performing];for(o||(o=[],_ccsg.Node._performStacks.push(o)),o.length=0,_ccsg.Node._performing++,o[0]=t;c;)if(c--,n=o[c],o[c]=null,n&&(i=n._children)&&i.length>0)for(h=n._renderCmd,r=0,e=i.length;r<e;++r)s=i[r],o[c]=s,c++,s._renderCmd.transform(h);_ccsg.Node._performing--}(s)},getNodeToParentTransform:function(){return this._dirtyFlag&n.transformDirty&&this.transform(),this._transform},setNodeToParentTransform:function(t){t?(this._transform=t,this._transformUpdated=!0):this._transformUpdated=!1,this.setDirtyFlag(n.transformDirty)},_propagateFlagsDown:function(t){var i=this._dirtyFlag,s=t?t._node:null;s&&s._cascadeColorEnabled&&t._dirtyFlag&n.colorDirty&&(i|=n.colorDirty),s&&s._cascadeOpacityEnabled&&t._dirtyFlag&n.opacityDirty&&(i|=n.opacityDirty),t&&t._dirtyFlag&n.transformDirty&&(i|=n.transformDirty),this._dirtyFlag=i},visit:function(t){var i=this._node,s=cc.renderer;(t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),isNaN(i._customZ)&&(i._vertexZ=s.assignedZ,s.assignedZ+=s.assignedZStep),this._syncStatus(t)},_updateDisplayColor:function(t){var i,s,h,r,e=this._node,c=this._displayedColor,o=e._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!e._cascadeColorEnabled){c.r=o.r,c.g=o.g,c.b=o.b;var u=new cc.Color(255,255,255,255);for(i=0,s=(h=e._children).length;i<s;i++)(r=h[i])&&r._renderCmd&&r._renderCmd._updateDisplayColor(u);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var a=e._parent;t=a&&a._cascadeColorEnabled?a.getDisplayedColor():cc.Color.WHITE}if(c.r=0|o.r*t.r/255,c.g=0|o.g*t.g/255,c.b=0|o.b*t.b/255,e._cascadeColorEnabled)for(i=0,s=(h=e._children).length;i<s;i++)(r=h[i])&&r._renderCmd&&(r._renderCmd._updateDisplayColor(c),r._renderCmd._updateColor())}this._dirtyFlag&=~n.colorDirty},_updateDisplayOpacity:function(t){var i,s,h,r,e=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!e._cascadeOpacityEnabled){for(this._displayedOpacity=e._realOpacity,i=0,s=(h=e._children).length;i<s;i++)(r=h[i])&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var c=e._parent;t=255,c&&c._cascadeOpacityEnabled&&(t=c.getDisplayedOpacity())}if(this._displayedOpacity=e._realOpacity*t/255,e._cascadeOpacityEnabled)for(i=0,s=(h=e._children).length;i<s;i++)(r=h[i])&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag&=~n.opacityDirty},_syncDisplayColor:function(t){var i=this._node,s=this._displayedColor,n=i._realColor;if(void 0===t){var h=i._parent;t=h&&h._cascadeColorEnabled?h.getDisplayedColor():cc.Color.WHITE}s.r=0|n.r*t.r/255,s.g=0|n.g*t.g/255,s.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var i=this._node;if(void 0===t){var s=i._parent;t=255,s&&s._cascadeOpacityEnabled&&(t=s.getDisplayedOpacity())}this._displayedOpacity=i._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,i=t&n.colorDirty,s=t&n.opacityDirty;t&n.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~n.contentDirty),i&&this._updateDisplayColor(),s&&this._updateDisplayOpacity(),(i||s)&&this._updateColor(),t&n.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~n.transformDirty)},_syncStatus:function(t){var i=this._dirtyFlag,s=i&n.colorDirty,h=i&n.opacityDirty;s&&this._syncDisplayColor(),h&&this._syncDisplayOpacity(),(s||h)&&this._updateColor(),i&n.transformDirty&&this.transform(t)}},_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.RenderCmd.prototype.originUpdateStatus=_ccsg.Node.RenderCmd.prototype.updateStatus,_ccsg.Node.RenderCmd.prototype._originSyncStatus=_ccsg.Node.RenderCmd.prototype._syncStatus,_ccsg.Node.CanvasRenderCmd=function(t){this._ctor(t),this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var r=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);r.constructor=_ccsg.Node.CanvasRenderCmd,r._rootCtor=_ccsg.Node.CanvasRenderCmd,r._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var e=new cc.Rect;r.getLocalBB=function(){var t=this._node;return e.x=e.y=0,e.width=t._contentSize.width,e.height=t._contentSize.height,e},r._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},r.detachFromParent=function(){for(var t,i=this._node._children,s=0,n=i.length;s<n;s++)(t=i[s])&&t._renderCmd&&t._renderCmd.detachFromParent()},r.setShaderProgram=function(t){},r.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.macro.SRC_ALPHA&&t.dst===cc.macro.ONE||t.src===cc.macro.ONE&&t.dst===cc.macro.ONE?"lighter":t.src===cc.macro.ZERO&&t.dst===cc.macro.SRC_ALPHA?"destination-in":t.src===cc.macro.ZERO&&t.dst===cc.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}},{}],57:[function(t,i,s){_ccsg.Node.WebGLRenderCmd=function(t){this._ctor(t),this._shaderProgram=null};var n=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);n.constructor=_ccsg.Node.WebGLRenderCmd,n._rootCtor=_ccsg.Node.WebGLRenderCmd,n._updateColor=function(){},n.setShaderProgram=function(t){this._shaderProgram=t},n.getShaderProgram=function(){return this._shaderProgram}},{}],58:[function(t,i,s){function n(t,i){var s,n,h,r=i._target;r?function(t,i,s,n){for(var h=t._parent._scaleX,r=t._parent._scaleY,e=0,c=0,o=t._parent;;){var u=o._position;if(e+=u.x,c+=u.y,!(o=o._parent))return s.x=s.y=0,void(n.x=n.y=1);if(o===i)break;var a=o._scaleX,f=o._scaleY;e*=a,c*=f,h*=a,r*=f}n.x=0!==h?1/h:1,n.y=0!==r?1/r:1,s.x=-e,s.y=-c}(t,s=r,n=u,h=a):s=t._parent;var e=function(t){return t instanceof cc.Scene?cc.visibleRect:!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node?t._contentSize:t.getContentSize()}(s),f=s._anchorPoint,l=s instanceof cc.Scene,v=t._position.x,d=t._position.y,p=t._anchorPoint;if(i._alignFlags&c){var g,m,w=e.width;l?(g=cc.visibleRect.left.x,m=cc.visibleRect.right.x):m=(g=-f.x*w)+w,g+=i._isAbsLeft?i._left:i._left*w,m-=i._isAbsRight?i._right:i._right*w,r&&(g+=n.x,g*=h.x,m+=n.x,m*=h.x);var _,C=p.x,b=t._scaleX;if(b<0&&(C=1-C,b=-b),i.isStretchWidth)_=m-g,0!==b&&(t.width=_/b),v=g+C*_;else if(_=t.width*b,i.isAlignHorizontalCenter){var y=i._isAbsHorizontalCenter?i._horizontalCenter:i._horizontalCenter*w,T=(.5-f.x)*e.width;r&&(y*=h.x,T+=n.x,T*=h.x),v=T+(C-.5)*_+y}else v=i.isAlignLeft?g+C*_:m+(C-1)*_}if(i._alignFlags&o){var S,A,M=e.height;l?(A=cc.visibleRect.bottom.y,S=cc.visibleRect.top.y):S=(A=-f.y*M)+M,A+=i._isAbsBottom?i._bottom:i._bottom*M,S-=i._isAbsTop?i._top:i._top*M,r&&(A+=n.y,A*=h.y,S+=n.y,S*=h.y);var x,E=p.y,O=t._scaleY;if(O<0&&(E=1-E,O=-O),i.isStretchHeight)x=S-A,0!==O&&(t.height=x/O),d=A+E*x;else if(x=t.height*O,i.isAlignVerticalCenter){var P=i._isAbsVerticalCenter?i._verticalCenter:i._verticalCenter*M,R=(.5-f.y)*e.height;r&&(P*=h.y,R+=n.y,R*=h.y),d=R+(E-.5)*x+P}else d=i.isAlignBottom?A+E*x:S+(E-1)*x}t.setPosition(v,d)}function h(t){var i=t._widget;i&&(n(t,i),i.isAlignOnce?i.enabled=!1:f.push(i));for(var s=t._children,r=0;r<s.length;r++){var e=s[r];e._active&&h(e)}}function r(){var t=cc.director.getScene();if(t){if(l.isAligning=!0,l._nodesOrderDirty)f.length=0,h(t),l._nodesOrderDirty=!1;else{var i,s=l._activeWidgetsIterator;for(s.i=0;s.i<f.length;++s.i)n((i=f[s.i]).node,i)}l.isAligning=!1}}function e(t){var i=t._parent;cc.Node.isNode(i)&&e(i);var s=t._widget||t.getComponent(cc.Widget);s&&n(t,s)}var c=56,o=7,u=cc.Vec2.ZERO,a=cc.Vec2.ONE,f=[],l=cc._widgetManager=i.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(f),_:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,r)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},updateAlignment:e}},{}],59:[function(t,i,s){var n;n=_ccsg.Node._dirtyFlags.transformDirty,t("./CCSGCameraNode");var h=cc.T({name:"cc.Camera",S:cc._RendererUnderSG,ctor:function(){this.viewMatrix=cc.affineTransformMake(),this.invertViewMatrix=cc.affineTransformMake(),this._lastViewMatrix=cc.affineTransformMake(),this._sgTarges=[],this._checkedTimes=0,this.visibleRect={left:cc.v2(),right:cc.v2(),top:cc.v2(),bottom:cc.v2()},this.viewPort=cc.rect()},editor:!1,O:{_targets:{default:[],type:cc.Node,visible:!0},zoomRatio:1},statics:{main:null},_createSgNode:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){cc.errorID(8301);var t=new _ccsg.Node;return t.setTransform=t.addTarget=t.removeTarget=function(){},t}return new _ccsg.CameraNode},_initSgNode:function(){},_addSgTargetInSg:function(t){var i;if(t instanceof cc.Node?i=t._sgNode:t instanceof _ccsg.Node&&(i=t),i&&!i._cameraInfo){i._cameraInfo={touched:this._checkedTimes},this._sgNode.addTarget(i),this._sgTarges.push(i);var s=i._renderCmd;s.setDirtyFlag(n),s._cameraFlag=h.flags.InCamera,cc.renderer.childrenOrderDirty=!0}},_removeTargetInSg:function(t){var i;if(t instanceof cc.Node?i=t._sgNode:t instanceof _ccsg.Node&&(i=t),i&&i._cameraInfo){this._sgNode.removeTarget(i),delete i._cameraInfo,cc.js.array.remove(this._sgTarges,i);var s=i._renderCmd;s.setDirtyFlag(n),s._cameraFlag=0,cc.renderer.childrenOrderDirty=!0}},onEnable:function(){if(h.main)cc.errorID(8300);else{h.main=this;for(var t=this._targets,i=0,s=t.length;i<s;i++)this._addSgTargetInSg(t[i])}},onDisable:function(){if(h.main===this){h.main=null;for(var t=this._sgTarges,i=t.length-1;i>=0;i--)this._removeTargetInSg(t[i])}},addTarget:function(t){-1===this._targets.indexOf(t)&&(this._addSgTargetInSg(t),this._targets.push(t))},removeTarget:function(t){-1!==this._targets.indexOf(t)&&(this._removeTargetInSg(t),cc.js.array.remove(this._targets,t))},getTargets:function(){return this._targets},getNodeToCameraTransform:function(t){var i=t.getNodeToWorldTransform();return this.containsNode(t)&&(i=cc.affineTransformConcatIn(i,cc.Camera.main.viewMatrix)),i},getCameraToWorldPoint:function(t){return cc.Camera.main&&(t=cc.pointApplyAffineTransform(t,cc.Camera.main.invertViewMatrix)),t},containsNode:function(t){t instanceof cc.Node&&(t=t._sgNode);for(var i=this._sgTarges;t;){if(-1!==i.indexOf(t))return!0;t=t.parent}return!1},_setSgNodesTransformDirty:function(){for(var t=this._sgTarges,i=0;i<t.length;i++)t[i]._renderCmd.setDirtyFlag(n)},_checkSgTargets:function(){for(var t=this._targets,i=this._sgTarges,s=++this._checkedTimes,n=0,h=t.length;n<h;n++){var r=t[n],e=r;r instanceof cc.Node&&(e=r._sgNode)&&!e._cameraInfo&&this._addSgTargetInSg(e),e&&(e._cameraInfo.touched=s)}for(var c=i.length-1;c>=0;c--){var o=i[c];o._cameraInfo.touched!==s&&this._removeTargetInSg(o)}},lateUpdate:function(){this._checkSgTargets();var t=this.viewMatrix,i=this.invertViewMatrix,s=this.viewPort,n=cc.visibleRect,h=this.visibleRect,r=this.node.getNodeToWorldTransformAR(),e=.5*-(Math.atan2(r.b,r.a)+Math.atan2(-r.c,r.d)),c=1,o=0,u=0,a=1;e&&(u=Math.sin(e),c=a=Math.cos(e),o=-u);var f=this.zoomRatio;c*=f,o*=f,u*=f,a*=f,t.a=c,t.b=o,t.c=u,t.d=a;var l=n.center;t.tx=l.x-(c*r.tx+u*r.ty),t.ty=l.y-(o*r.tx+a*r.ty),cc.affineTransformInvertOut(t,i),s.x=n.bottomLeft.x,s.y=n.bottomLeft.y,s.width=n.width,s.height=n.height,cc._rectApplyAffineTransformIn(s,i),h.left.x=s.xMin,h.right.x=s.xMax,h.bottom.y=s.yMin,h.top.y=s.yMax,this._sgNode.setTransform(c,o,u,a,t.tx,t.ty);var v=this._lastViewMatrix;v.a===t.a&&v.b===t.b&&v.c===t.c&&v.d===t.d&&v.tx===t.tx&&v.ty===t.ty||(this._setSgNodesTransformDirty(),v.a=t.a,v.b=t.b,v.c=t.c,v.d=t.d,v.tx=t.tx,v.ty=t.ty)}});h.flags=cc.Enum({InCamera:1,ParentInCamera:2}),i.exports=cc.Camera=h},{"./CCSGCameraNode":60}],60:[function(t,i,s){var n=_ccsg.Node.extend({ctor:function(){this._super(),this._mat=new cc.math.Matrix4,this._mat.identity(),this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit)},setTransform:function(t,i,s,n,h,r){var e=this._mat.mat;e[0]=t,e[1]=i,e[4]=s,e[5]=n,e[12]=h,e[13]=r},addTarget:function(t){var i=t._cameraInfo;i.sgCameraNode=this,i.originVisit=t.visit,t.visit=this._visit},removeTarget:function(t){t.visit=t._cameraInfo.originVisit},_visit:function(t){var i=this._cameraInfo,s=i.sgCameraNode;cc.renderer.pushRenderCommand(s._beforeVisitCmd),i.originVisit.call(this,t),cc.renderer.pushRenderCommand(s._afterVisitCmd)},_onBeforeVisit:function(){cc.renderer._breakBatch(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.current_stack.push(),cc.current_stack.top.multiply(this._mat)},_onAfterVisit:function(){cc.renderer._breakBatch(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.current_stack.pop()}});i.exports=_ccsg.CameraNode=n},{}],61:[function(t,i,s){cc.Collider.Box=cc.T({O:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}},resetInEditor:!1});var n=cc.T({name:"cc.BoxCollider",S:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=i.exports=n},{}],62:[function(t,i,s){cc.Collider.Circle=cc.T({O:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}},resetInEditor:!1});var n=cc.T({name:"cc.CircleCollider",S:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=i.exports=n},{}],63:[function(t,i,s){var n=cc.T({name:"cc.Collider",S:cc.U,O:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=i.exports=n},{}],64:[function(t,i,s){var n=t("./CCContact"),h=n.CollisionType,r=cc.rect(),e=cc.v2(),c=cc.T({mixins:[cc.EventTarget],O:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1},update:function(t){if(this.enabled){var i,s,n=this._colliders;for(i=0,s=n.length;i<s;i++)this.updateCollider(n[i]);var r=this._contacts,e=[];for(i=0,s=r.length;i<s;i++){var c=r[i].updateState();c!==h.None&&e.push([c,r[i]])}for(i=0,s=e.length;i<s;i++){var o=e[i];this._doCollide(o[0],o[1])}this.drawColliders()}},_doCollide:function(t,i){var s;switch(t){case h.CollisionEnter:s="onCollisionEnter";break;case h.CollisionStay:s="onCollisionStay";break;case h.CollisionExit:s="onCollisionExit"}var n,r,e,c=i.collider1,o=i.collider2,u=c.node._components,a=o.node._components;for(n=0,r=u.length;n<r;n++)(e=u[n])[s]&&e[s](o,c);for(n=0,r=a.length;n<r;n++)(e=a[n])[s]&&e[s](c,o)},shouldCollide:function(t,i){var s=t.node,n=i.node,h=cc.game.collisionMatrix;return s!==n&&h[s.groupIndex][n.groupIndex]},initCollider:function(t){if(!t.world){var i=t.world={};i.aabb=cc.rect(),i.preAabb=cc.rect(),i.radius=0,t instanceof cc.BoxCollider?(i.position=null,i.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(i.position=null,i.points=t.points.map(function(t){return cc.v2(t.x,t.y)})):t instanceof cc.CircleCollider&&(i.position=cc.v2(),i.points=null)}},updateCollider:function(t){var i=t.offset,s=t.world,n=s.aabb,h=s.transform=t.node.getNodeToWorldTransformAR(),c=s.preAabb;if(c.x=n.x,c.y=n.y,c.width=n.width,c.height=n.height,t instanceof cc.BoxCollider){var o=t.size;r.x=i.x-o.width/2,r.y=i.y-o.height/2,r.width=o.width,r.height=o.height;var u=s.points,a=u[0],f=u[1],l=u[2],v=u[3];cc.obbApplyAffineTransform(r,h,a,f,l,v);var d=Math.min(a.x,f.x,l.x,v.x),p=Math.min(a.y,f.y,l.y,v.y),g=Math.max(a.x,f.x,l.x,v.x),m=Math.max(a.y,f.y,l.y,v.y);n.x=d,n.y=p,n.width=g-d,n.height=m-p}else if(t instanceof cc.CircleCollider){S=cc.pointApplyAffineTransform(t.offset,h),s.position.x=S.x,s.position.y=S.y,h.tx=h.ty=0,e.x=t.radius,e.y=0;var w=cc.pointApplyAffineTransform(e,h),_=Math.sqrt(w.x*w.x+w.y*w.y);s.radius=_,n.x=S.x-_,n.y=S.y-_,n.width=2*_,n.height=2*_}else if(t instanceof cc.PolygonCollider){var C=t.points,b=s.points;b.length=C.length,d=1e6,p=1e6,g=-1e6,m=-1e6;for(var y=0,T=C.length;y<T;y++){b[y]||(b[y]=cc.v2()),e.x=C[y].x+i.x,e.y=C[y].y+i.y;var S=cc.pointApplyAffineTransform(e,h);b[y].x=S.x,b[y].y=S.y,S.x>g&&(g=S.x),S.x<d&&(d=S.x),S.y>m&&(m=S.y),S.y<p&&(p=S.y)}n.x=d,n.y=p,n.width=g-d,n.height=m-p}},addCollider:function(t){var i=this._colliders;if(-1===i.indexOf(t)){for(var s=0,h=i.length;s<h;s++){var r=i[s];if(this.shouldCollide(t,r)){var e=new n(t,r);this._contacts.push(e)}}i.push(t),this.initCollider(t)}t.node.on("group-changed",this.onNodeGroupChanged,this)},removeCollider:function(t){var i=this._colliders,s=i.indexOf(t);if(s>=0){i.splice(s,1);for(var n=this._contacts,r=n.length-1;r>=0;r--){var e=n[r];e.collider1!==t&&e.collider2!==t||(e.touching&&this._doCollide(h.CollisionExit,e),n.splice(r,1))}t.node.off("group-changed",this.onNodeGroupChanged,this)}else cc.errorID(6600)},attachDebugDrawToCamera:function(t){this._debugDrawer&&t.addTarget(this._debugDrawer)},detachDebugDrawFromCamera:function(t){this._debugDrawer&&t.removeTarget(this._debugDrawer)},onNodeGroupChanged:function(t){for(var i=t.currentTarget.getComponents(cc.Collider),s=0,n=i.length;s<n;s++)this.removeCollider(i[s]),this.addCollider(i[s])},drawColliders:function(){var t=this._debugDrawer;if(this._enabledDebugDraw&&t){t.clear();for(var i=this._colliders,s=0,n=i.length;s<n;s++){var h=i[s];if(h instanceof cc.BoxCollider||h instanceof cc.PolygonCollider){var r=h.world.points;if(r.length>0){t.strokeColor=cc.Color.WHITE,t.moveTo(r[0].x,r[0].y);for(var e=1;e<r.length;e++)t.lineTo(r[e].x,r[e].y);t.close(),t.stroke()}}else h instanceof cc.CircleCollider&&(t.circle(h.world.position.x,h.world.position.y,h.world.radius),t.stroke());if(this.enabledDrawBoundingBox){var c=h.world.aabb;t.strokeColor=cc.Color.BLUE,t.moveTo(c.xMin,c.yMin),t.lineTo(c.xMin,c.yMax),t.lineTo(c.xMax,c.yMax),t.lineTo(c.xMax,c.yMin),t.close(),t.stroke()}}}},onSceneLaunched:function(){this._enabledDebugDraw&&this._debugDrawer&&(this._debugDrawer.removeFromParent(),cc.director.getScene()._sgNode.addChild(this._debugDrawer))}});cc.js.getset(c.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw},function(t){t&&!this._enabledDebugDraw?(this._debugDrawer||(this._debugDrawer=new _ccsg.GraphicsNode,this._debugDrawer.retain()),cc.director.getScene()._sgNode.addChild(this._debugDrawer),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(),this._debugDrawer.removeFromParent(!1),cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)),this._enabledDebugDraw=t}),cc.CollisionManager=i.exports=c},{"./CCContact":65}],65:[function(t,i,s){function n(t,i){this.collider1=t,this.collider2=i,this.touching=!1;var s=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=i instanceof cc.BoxCollider||i instanceof cc.PolygonCollider,r=t instanceof cc.CircleCollider,e=i instanceof cc.CircleCollider;s&&n?this.testFunc=h.polygonPolygon:r&&e?this.testFunc=h.circleCircle:s&&e?this.testFunc=h.polygonCircle:r&&n?(this.testFunc=h.polygonCircle,this.collider1=i,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(i))}var h=t("./CCIntersection"),r=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});n.prototype.test=function(){var t=this.collider1.world,i=this.collider2.world;return!!t.aabb.intersects(i.aabb)&&(this.testFunc===h.polygonPolygon?this.testFunc(t.points,i.points):this.testFunc===h.circleCircle?this.testFunc(t,i):this.testFunc===h.polygonCircle&&this.testFunc(t.points,i))},n.prototype.updateState=function(){var t=this.test(),i=r.None;return t&&!this.touching?(this.touching=!0,i=r.CollisionEnter):t&&this.touching?i=r.CollisionStay:!t&&this.touching&&(this.touching=!1,i=r.CollisionExit),i},n.CollisionType=r,i.exports=n},{"./CCIntersection":66}],66:[function(t,i,s){function n(t,i,s,n){var h=(n.x-s.x)*(t.y-s.y)-(n.y-s.y)*(t.x-s.x),r=(i.x-t.x)*(t.y-s.y)-(i.y-t.y)*(t.x-s.x),e=(n.y-s.y)*(i.x-t.x)-(n.x-s.x)*(i.y-t.y);if(0!==e){var c=h/e,o=r/e;if(0<=c&&c<=1&&0<=o&&o<=1)return!0}return!1}function h(t,i,s){for(var h=s.length,r=0;r<h;++r)if(n(t,i,s[r],s[(r+1)%h]))return!0;return!1}function r(t,i){for(var s=!1,n=t.x,h=t.y,r=i.length,e=0,c=r-1;e<r;c=e++){var o=i[e].x,u=i[e].y,a=i[c].x,f=i[c].y;u>h!=f>h&&n<(a-o)*(h-u)/(f-u)+o&&(s=!s)}return s}function e(t,i,s,n){var h,r=s.x-i.x,e=s.y-i.y,c=r*r+e*e,o=((t.x-i.x)*r+(t.y-i.y)*e)/c;return h=n?c?o<0?i:o>1?s:cc.v2(i.x+o*r,i.y+o*e):i:cc.v2(i.x+o*r,i.y+o*e),r=t.x-h.x,e=t.y-h.y,Math.sqrt(r*r+e*e)}var c={};c.lineLine=n,c.lineRect=function(t,i,s){var h=new cc.Vec2(s.x,s.y),r=new cc.Vec2(s.x,s.yMax),e=new cc.Vec2(s.xMax,s.yMax),c=new cc.Vec2(s.xMax,s.y);return!!(n(t,i,h,r)||n(t,i,r,e)||n(t,i,e,c)||n(t,i,c,h))},c.linePolygon=h,c.rectRect=function(t,i){var s=t.x,n=t.y,h=t.x+t.width,r=t.y+t.height,e=i.x,c=i.y,o=i.x+i.width,u=i.y+i.height;return s<=o&&h>=e&&n<=u&&r>=c},c.rectPolygon=function(t,i){var s,n,e=new cc.Vec2(t.x,t.y),c=new cc.Vec2(t.x,t.yMax),o=new cc.Vec2(t.xMax,t.yMax),u=new cc.Vec2(t.xMax,t.y);if(h(e,c,i))return!0;if(h(c,o,i))return!0;if(h(o,u,i))return!0;if(h(u,e,i))return!0;for(s=0,n=i.length;s<n;++s)if(r(i[s],t))return!0;return!!(r(e,i)||r(c,i)||r(o,i)||r(u,i))},c.polygonPolygon=function(t,i){var s,n;for(s=0,n=t.length;s<n;++s)if(h(t[s],t[(s+1)%n],i))return!0;for(s=0,n=i.length;s<n;++s)if(r(i[s],t))return!0;for(s=0,n=t.length;s<n;++s)if(r(t[s],i))return!0;return!1},c.circleCircle=function(t,i){return t.position.sub(i.position).mag()<t.radius+i.radius},c.polygonCircle=function(t,i){var s=i.position;if(r(s,t))return!0;for(var n=0,h=t.length;n<h;n++)if(e(s,0===n?t[t.length-1]:t[n-1],t[n],!0)<i.radius)return!0;return!1},c.pointInPolygon=r,c.pointLineDistance=e,cc.Intersection=i.exports=c},{}],67:[function(t,i,s){cc.Collider.Polygon=cc.T({O:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var n=cc.T({name:"cc.PolygonCollider",S:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=i.exports=n},{}],68:[function(t,i,s){t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")},{"./CCBoxCollider":61,"./CCCircleCollider":62,"./CCCollider":63,"./CCCollisionManager":64,"./CCPolygonCollider":67}],69:[function(t,i,s){function n(t,i){for(var s=i.constructor._executionOrder,n=i.__instanceId,h=0,r=t.length-1,e=r>>>1;h<=r;e=h+r>>>1){var c=t[e],o=c.constructor._executionOrder;if(o>s)r=e-1;else if(o<s)h=e+1;else{var u=c.__instanceId;if(u>n)r=e-1;else{if(!(u<n))return e;h=e+1}}}return~h}function h(t,i){for(var s=t.array,n=t.i+1;n<s.length;){var h=s[n];h._enabled&&h.node._activeInHierarchy?++n:(t.removeAt(n),i&&(h._objFlags&=~i))}}function r(t,i){return t.constructor._executionOrder-i.constructor._executionOrder}function e(t,i){var s="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}";return i?Function("it","dt",s):Function("it",s)}function c(){this.startInvoker=new v(e("c.start();c._objFlags|="+a)),this.updateInvoker=new d(e("c.update(dt)",!0)),this.lateUpdateInvoker=new d(e("c.lateUpdate(dt)",!0)),this.scheduleInNextFrame=[],this._updating=!1}t("./platform/CCClass");var o=t("./platform/CCObject").Flags,u=t("./platform/js").array,a=o.IsStartCalled,f=o.IsOnEnableCalled,l=(o.IsEditorOnEnableCalled,cc.T({__ctor__:function(t){var i=u.MutableForwardIterator;this._zero=new i([]),this._neg=new i([]),this._pos=new i([]),this._invoke=t},statics:{stableRemoveInactive:h},add:null,remove:null,invoke:null})),v=cc.T({S:l,add:function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).array.push(t)},remove:function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){h(this._zero,t),h(this._neg,t),h(this._pos,t)},invoke:function(){var t=this._neg;t.array.length>0&&(t.array.sort(r),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var i=this._pos;i.array.length>0&&(i.array.sort(r),this._invoke(i),i.array.length=0)}}),d=cc.T({S:l,add:function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.array.push(t);else{var s=i<0?this._neg.array:this._pos.array,h=n(s,t);h<0&&s.splice(~h,0,t)}},remove:function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.fastRemove(t);else{var s=i<0?this._neg:this._pos,h=n(s.array,t);h>=0&&s.removeAt(h)}},invoke:function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)}}),p=cc.T({ctor:c,unscheduleAll:c,statics:{LifeCycleInvoker:l,OneOffInvoker:v,createInvokeImpl:e,invokeOnEnable:function(t){var i=cc.director._compScheduler,s=t.array;for(t.i=0;t.i<s.length;++t.i){var n=s[t.i];n._enabled&&(n.onEnable(),!n.node._activeInHierarchy||i._onEnabled(n))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=f,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~f;var i=this.scheduleInNextFrame.indexOf(t);i>=0?u.fastRemoveAt(this.scheduleInNextFrame,i):(!t.start||t._objFlags&a||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,i){if(!(t._objFlags&f)){if(t.onEnable){if(i)return void i.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&f&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&a||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,i=0,s=t.length;i<s;i++){var n=t[i];this._scheduleImmediate(n)}t.length=0},startPhase:function(){this._updating=!0,this.scheduleInNextFrame.length>0&&this._deferredSchedule(),this.startInvoker.invoke()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1}});i.exports=p},{"./platform/CCClass":172,"./platform/CCObject":178,"./platform/js":192,"./utils/misc":223}],70:[function(t,i,s){function n(t,i){return t===i||t&&i&&(t.name===i.name||t._uuid===i._uuid)}var h=t("../../animation/animation-animator"),r=t("../../animation/animation-clip"),e=cc.T({name:"cc.Animation",S:t("./CCComponent"),mixins:[cc.EventTarget],editor:!1,ctor:function(){this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null,this._listeners=[]},O:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(t){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_clips:{default:[],type:[r],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,i){var s=this.playAdditive(t,i);return this._animator.stopStatesExcept(s),s},playAdditive:function(t,i){this._init();var s=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(s){this.enabled=!0;var n=this._animator;n.isPlaying&&s.isPlaying?s.isPaused?n.resumeState(s):(n.stopState(s),n.playState(s,i)):n.playState(s,i),this.currentClip=s.clip}return s},stop:function(t){if(this._didInit)if(t){var i=this._nameToState[t];i&&this._animator.stopState(i)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var i=this._nameToState[t];i&&this._animator.pauseState(i)}else this.enabled=!1},resume:function(t){if(this._didInit)if(t){var i=this._nameToState[t];i&&this._animator.resumeState(i)}else this.enabled=!0},setCurrentTime:function(t,i){if(this._init(),i){var s=this._nameToState[i];s&&this._animator.setStateTime(s,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var i=this._nameToState[t];return i&&!i.curveLoaded&&this._animator._reloadClip(i),i||null},addClip:function(t,i){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),i=i||t.name;var s=this._nameToState[i];if(s){if(s.clip===t)return s;var n=this._clips.indexOf(s.clip);-1!==n&&this._clips.splice(n,1)}var h=new cc.AnimationState(t,i);return this._nameToState[i]=h,h}cc.warnID(3900)},removeClip:function(t,i){if(t){this._init();var s;for(var n in this._nameToState)if((s=this._nameToState[n]).clip===t)break;if(t===this._defaultClip){if(!i)return void cc.warnID(3902);this._defaultClip=null}if(s&&s.isPlaying){if(!i)return void cc.warnID(3903);this.stop(s.name)}this._clips=this._clips.filter(function(i){return i!==t}),s&&delete this._nameToState[s.name]}else cc.warnID(3901)},sample:function(t){if(this._init(),t){var i=this._nameToState[t];i&&i.sample()}else this._animator.sample()},on:function(t,i,s,n){this._init();for(var h=this._listeners,r=0,e=h.length;r<e;r++){var c=h[r];if(c[0]===t&&c[1]===i&&c[2]===s&&c[3]===n)return}return this._animator.on(t,i,s,n),h.push([t,i,s,n]),i},off:function(t,i,s,n){this._init();for(var h=this._listeners,r=this._nameToState,e=h.length-1;e>=0;e--){var c=h[e];if(c[0]===t&&c[1]===i&&c[2]===s&&c[3]===n){for(var o in r)r[o].off(t,i,s,n);h.splice(e,1)}}},_init:function(){this._didInit||(this._didInit=!0,this._animator=new h(this.node,this),this._createStates())},_createStates:function(){this._nameToState={};for(var t=null,i=!1,s=0;s<this._clips.length;++s){var h=this._clips[s];h&&(t=new cc.AnimationState(h),this._nameToState[t.name]=t,n(this._defaultClip,h)&&(i=t))}this._defaultClip&&!i&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});cc.Animation=i.exports=e},{"../../animation/animation-animator":11,"../../animation/animation-clip":12,"./CCComponent":75}],71:[function(t,i,s){var n=cc.T({name:"cc.AudioSource",S:t("./CCComponent"),editor:!1,ctor:function(){this.audio=new cc.Audio},O:{_clip:{default:"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return!!this.audio&&this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this.audio.stop(),this.audio.src=this._clip,this.audio.preload&&this.audio.preload())},url:cc.AudioClip,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){t=cc.clamp01(t),this._volume=t;var i=this.audio;return i&&!this._mute&&(i.setVolume(t),i._loaded||i.on("load",function(){i.setVolume(t)})),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio&&this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio&&this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_pausedCallback:function(){var t=this.audio;t&&!t.paused&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this.audio&&(this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1)},onEnable:function(){this.playOnLoad&&this.play(),this.preload&&(this.audio.src=this._clip,this.audio.preload()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var t=this._mute?0:this._volume,i=this.audio,s=this._loop;if(i._loaded)return i.stop(),i.setCurrentTime(0),void i.play();i.src=this._clip,i.once("load",function(){i.setLoop(s),i.setVolume(t),i.play()}),i.preload()}},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&this.audio.setCurrentTime(0)},getCurrentTime:function(){var t=0;return this.audio&&(t=this.audio.getCurrentTime()),t},setCurrentTime:function(t){var i=this.audio;return i?i._loaded?(i.setCurrentTime(t),t):(i.once("load",function(){i.setCurrentTime(t)}),t):t},getDuration:function(){var t=0;return this.audio&&(t=this.audio.getDuration()),t}});cc.AudioSource=i.exports=n},{"./CCComponent":75}],72:[function(t,i,s){function n(t){t.stopPropagation()}var h=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"],r=cc.T({name:"cc.BlockInputEvents",S:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block-input-events"},onEnable:function(){for(var t=0;t<h.length;t++)this.node.on(h[t],n,this)},onDisable:function(){for(var t=0;t<h.length;t++)this.node.off(h[t],n,this)}});cc.BlockInputEvents=i.exports=r},{"./CCComponent":75}],73:[function(t,i,s){var n=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),h=cc.T({name:"cc.Button",S:t("./CCComponent"),ctor:function(){this._resetState(),this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=1,this._toScale=1,this._originalScale=1,this._sprite=null},_resetState:function(){this._pressed=!1,this._hovered=!1},editor:!1,O:{interactable:{default:!0,tooltip:!1,notify:function(t){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:n.NONE,tooltip:!1,type:n,animatable:!1},normalColor:{default:cc.color(214,214,214),displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.P,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.P,displayName:"Pressed",tooltip:!1},hoverSprite:{default:null,type:cc.P,displayName:"Hover",tooltip:!1},disabledSprite:{default:null,type:cc.P,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(){this._applyTarget()}},clickEvents:{default:[],type:cc.U.EventHandler,tooltip:!1}},statics:{Transition:n},__preload:function(){this.target||(this.target=this.node),this._applyTarget(),this._updateState()},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerEvent()},update:function(t){var i=this.target;if(!this._transitionFinished&&(this.transition===n.COLOR||this.transition===n.SCALE)){this.time+=t;var s=1;this.duration>0&&(s=this.time/this.duration),s>=1&&(s=1,this._transitionFinished=!0),this.transition===n.COLOR?i.color=this._fromColor.lerp(this._toColor,s):this.transition===n.SCALE&&(i.scale=cc.lerp(this._fromScale,this._toScale,s))}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getTargetSprite:function(t){var i=null;return t&&(i=t.getComponent(cc.Sprite)),i},_applyTarget:function(){this._sprite=this._getTargetSprite(this.target),this.target&&(this._originalScale=this.target.scale)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var i=t.touch,s=this.node._hitTest(i.getLocation());if(this.transition===n.SCALE&&this.target)s?(this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,this.target.scale=this._originalScale);else{var h;h=s?"pressed":"normal",this._applyTransition(h)}t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.U.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_zoomUp:function(){this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this.time=0,this._transitionFinished=!1},_zoomBack:function(){this._fromScale=this.target.scale,this._toScale=this._originalScale,this.time=0,this._transitionFinished=!1},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==n.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},onDisable:function(){this._hovered=!1,this._pressed=!1,this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getButtonState:function(){return this.interactable?this._pressed?"pressed":this._hovered?"hover":"normal":"disabled"},_updateColorTransition:function(t){var i=this[t+"Color"],s=this.target;this._fromColor=s.color.clone(),this._toColor=i,this.time=0,this._transitionFinished=!1},_updateSpriteTransition:function(t){var i=this[t+"Sprite"];this._sprite&&i&&(this._sprite.spriteFrame=i)},_updateScaleTransition:function(t){"pressed"===t?this._zoomUp():this._zoomBack()},_applyTransition:function(t){var i=this.transition;i===n.COLOR?this._updateColorTransition(t):i===n.SPRITE?this._updateSpriteTransition(t):i===n.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){this._sprite&&this._sprite._sgNode.setState(0),this.enableAutoGrayEffect&&this.transition!==n.COLOR&&(this.transition===n.SPRITE&&this.disabledSprite||this._sprite&&!this.interactable&&this._sprite._sgNode.setState(1))}});cc.Button=i.exports=h},{"./CCComponent":75}],74:[function(t,i,s){var n={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},h=cc.T({name:"cc.Canvas",S:t("./CCComponent"),editor:!1,resetInEditor:!1,statics:{instance:null},O:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(h.instance)return cc.errorID(6700,this.node.name,h.instance.node.name);h.instance=this,this.node._sizeProvider||(this.node._sizeProvider=n),cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):cc.eventManager.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===n&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.eventManager.removeCustomListeners("canvas-resize",this._thisOnResized),h.instance===this&&(h.instance=null)},alignWithScreen:function(){var t,i=cc.visibleRect,s=0,n=0;!this.fitHeight&&!this.fitWidth&&(s=.5*((t=cc.view.getDesignResolutionSize()).width-i.width),n=.5*(t.height-i.height)),this.node.setPosition(.5*i.width+s,.5*i.height+n)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,i=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?i.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?i.FIXED_WIDTH:i.FIXED_HEIGHT:i.NO_BORDER;var s=this._designResolution;cc.view.setDesignResolutionSize(s.width,s.height,t)}});cc.Canvas=i.exports=h},{"./CCComponent":75}],75:[function(t,i,s){var n=t("../platform/CCObject"),h=t("../platform/js"),r=new(t("../platform/id-generater"))("Comp"),e=n.Flags.IsOnEnableCalled,c=n.Flags.IsOnLoadCalled,o=cc.T({name:"cc.Component",S:n,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},O:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),i=t.lastIndexOf(".");return i>=0&&(t=t.slice(i+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},_id:{default:"",serializable:!1},uuid:{get:function(){var t=this._id;return t||(t=this._id=r.getNewId()),t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)){var i=cc.director._compScheduler;t?i.enableComp(this):i.disableComp(this)}},visible:!1},enabledInHierarchy:{get:function(){return(this._objFlags&e)>0},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&c}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var t=this.__eventTargets,i=0,s=t.length;i<s;++i){var n=t[i];n&&n.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return t||(t=cc.instantiate._clone(this,this)),t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,i,s,n){cc.assertID(t,1619),cc.assertID(i>=0,1620),i=i||0,s=isNaN(s)?cc.macro.REPEAT_FOREVER:s,n=n||0,cc.director.getScheduler().schedule(t,this,i,s,n,!this.enabledInHierarchy)},scheduleOnce:function(t,i){this.schedule(t,0,0,i)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});o._requireComponent=null,o._executionOrder=0,h.value(o,"_registerEditorProps",function(t,i){var s=i.requireComponent;s&&(t._requireComponent=s);var n=i.executionOrder;n&&"number"==typeof n&&(t._executionOrder=n)}),o.prototype.__scriptUuid="",cc.U=i.exports=o},{"../platform/CCObject":178,"../platform/id-generater":188,"../platform/js":192}],76:[function(t,i,s){cc.U.EventHandler=cc.T({name:"cc.ClickEvent",O:{target:{default:null,type:cc.Node},component:{default:""},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){"use strict";var i,s,n;if(arguments.length>0)for(s=0,n=(i=new Array(arguments.length-1)).length;s<n;s++)i[s]=arguments[s+1];for(s=0,n=t.length;s<n;s++){var h=t[s];h instanceof cc.U.EventHandler&&h.emit(i)}}},emit:function(t){var i=this.target;if(cc.isValid(i)){var s=i.getComponent(this.component);if(cc.isValid(s)){var n=s[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(s,t))}}}})},{}],77:[function(t,i,s){t("../editbox/CCSGEditBox");var n=_ccsg.EditBox.KeyboardReturnType,h=_ccsg.EditBox.InputMode,r=_ccsg.EditBox.InputFlag,e=cc.T({name:"cc.EditBox",S:cc._RendererUnderSG,editor:!1,O:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._sgNode.string},set:function(t){this._sgNode.string=this._string=t}},backgroundImage:{tooltip:!1,default:null,type:cc.P,notify:function(){var t=this._sgNode,i=t.getBackgroundSprite();this.backgroundImage?this._createBackgroundSprite().setContentSize(t.getContentSize()):i.removeFromParent()}},returnType:{default:n.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:n,notify:function(){this._sgNode.returnType=this.returnType}},inputFlag:{tooltip:!1,default:r.DEFAULT,type:r,notify:function(){this._sgNode.inputFlag=this.inputFlag}},inputMode:{tooltip:!1,default:h.ANY,type:h,notify:function(){this._sgNode.inputMode=this.inputMode}},fontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.fontSize=this.fontSize}},lineHeight:{tooltip:!1,default:40,notify:function(){this._sgNode.setLineHeight(this.lineHeight)}},fontColor:{tooltip:!1,default:cc.Color.WHITE,notify:function(){this._sgNode.fontColor=this.fontColor}},placeholder:{tooltip:!1,default:"Enter text here...",notify:function(){this._sgNode.placeholder=this.placeholder}},placeholderFontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.placeholderFontSize=this.placeholderFontSize}},placeholderFontColor:{tooltip:!1,default:cc.Color.GRAY,notify:function(){this._sgNode.placeholderFontColor=this.placeholderFontColor}},maxLength:{tooltip:!1,default:20,notify:function(){this._sgNode.maxLength=this.maxLength}},stayOnTop:{tooltip:!1,default:!1,notify:function(){this._sgNode.stayOnTop(this.stayOnTop),this._sgNode.fontSize=this.fontSize,this._sgNode.fontColor=this.fontColor}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(t){this._tabIndex=t,this._sgNode.setTabIndex(t)}},editingDidBegan:{default:[],type:cc.U.EventHandler},textChanged:{default:[],type:cc.U.EventHandler},editingDidEnded:{default:[],type:cc.U.EventHandler},editingReturn:{default:[],type:cc.U.EventHandler}},statics:{KeyboardReturnType:n,InputFlag:r,InputMode:h},_applyCapInset:function(t){var i=this.backgroundImage;t.setInsetTop(i.insetTop),t.setInsetBottom(i.insetBottom),t.setInsetRight(i.insetRight),t.setInsetLeft(i.insetLeft)},_createSgNode:function(){return new _ccsg.EditBox(cc.size(160,40))},_createBackgroundSprite:function(){var t=this._sgNode,i=new cc.Scale9Sprite;return i.setRenderingType(cc.Scale9Sprite.RenderingType.SLICED),this.backgroundImage&&(this.backgroundImage.ensureLoadTexture(),i.setSpriteFrame(this.backgroundImage),this._applyCapInset(i)),t.initWithSizeAndBackgroundSprite(cc.size(160,40),i),i},_initSgNode:function(){var t=this._sgNode;t.createDomElementIfNeeded(),this._createBackgroundSprite(),t.setContentSize(this.node.getContentSize()),t.inputMode=this.inputMode,t.maxLength=this.maxLength,t.string=this._string,t.fontSize=this.fontSize,t.fontColor=this.fontColor,t.placeholder=this.placeholder,t.placeholderFontSize=this.placeholderFontSize,t.placeholderFontColor=this.placeholderFontColor,t.inputFlag=this.inputFlag,t.returnType=this.returnType,t.setLineHeight(this.lineHeight),t.stayOnTop(this.stayOnTop),t.setTabIndex(this.tabIndex),t.setDelegate(this)},editBoxEditingDidBegan:function(){cc.U.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.U.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t,i){cc.U.EventHandler.emitEvents(this.textChanged,i,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.U.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onDestroy:function(){this._sgNode.setDelegate(null),this._super()},__preload:function(){this._super(),this._registerEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){this._sgNode&&this._sgNode._onTouchBegan(t.touch),t.stopPropagation()},_onTouchEnded:function(t){this._sgNode&&this._sgNode._onTouchEnded(),t.stopPropagation()},setFocus:function(){this._sgNode&&this._sgNode.setFocus()},isFocused:function(){var t=!1;return this._sgNode&&(t=this._sgNode.isFocused()),t}});cc.EditBox=i.exports=e},{"../editbox/CCSGEditBox":103}],78:[function(t,i,s){t("../label/CCSGLabel"),t("../label/CCSGLabelCanvasRenderCmd"),t("../label/CCSGLabelWebGLRenderCmd");var n=cc.TextAlignment,h=cc.VerticalTextAlignment,r=_ccsg.Label.Overflow,e=cc.T({name:"cc.Label",S:cc._RendererUnderSG,ctor:function(){},editor:!1,_updateSgNodeString:function(){this._sgNode.setString(this.string),this._updateNodeSize()},_updateSgNodeFontSize:function(){this._sgNode&&(this._sgNode.setFontSize(this._fontSize),this._updateNodeSize())},O:{_useOriginalSize:!0,string:{default:"Label",multiline:!0,tooltip:!1,notify:function(){this._sgNode&&this._updateSgNodeString()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{default:h.TOP,type:h,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_actualFontSize:{default:40},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._sgNode&&(this._actualFontSize=this._sgNode.getFontSize()),this._actualFontSize}},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateSgNodeFontSize()},tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setFontFamily(this.fontFamily)},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._sgNode&&(this._lineHeight=this._sgNode.getLineHeight()),this._lineHeight},set:function(t){this._lineHeight=t,this._sgNode&&(this._sgNode.setLineHeight(t),this._updateNodeSize())},tooltip:!1},overflow:{default:r.NONE,type:r,tooltip:!1,notify:function(){this._sgNode&&(this._sgNode.setOverflow(this.overflow),this._updateNodeSize())},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._sgNode&&(this._enableWrapText=this._sgNode.isWrapTextEnabled()),this._enableWrapText},set:function(t){this._enableWrapText=t,this._sgNode&&this._sgNode.enableWrapText(t)},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){if(t||(this._isSystemFontUsed=!0),this._N$file=t,this._bmFontOriginalSize=-1,t&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._sgNode){"string"==typeof t&&cc.warnID(4e3);var i=this.font;i instanceof cc.BitmapFont?i.spriteFrame?this._sgNode.setFontAsset(i):(cc.warnID(4011,i.name),this._sgNode.setFontFamily("")):this._sgNode.setFontAsset(i)}t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize)},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed=!!t,t&&(this.font=null,this._sgNode&&this._sgNode.setFontFamily(this.fontFamily))},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",default:-1,serializable:!1,readonly:!0,visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this._sgNode&&(this._sgNode.setSpacingX(this.spacingX),this._updateNodeSize())}}},statics:{HorizontalAlign:n,VerticalAlign:h,Overflow:r},__preload:function(){this._super(),this._sgNode.on("load",this._updateNodeSize,this),this._updateNodeSize()},_createSgNode:function(){return null},_initSgNode:function(){var t=this.font;"string"==typeof t&&cc.warnID(4e3);var i;t instanceof cc.BitmapFont?t.spriteFrame?i=this._sgNode=_ccsg.Label.pool.get(this.string,t):(cc.warnID(4011,t.name),i=this._sgNode=_ccsg.Label.pool.get(this.string)):i=this._sgNode=_ccsg.Label.pool.get(this.string,t,null,this._fontSize),t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize),i.setVisible(!1),i.setHorizontalAlign(this.horizontalAlign),i.setVerticalAlign(this.verticalAlign),i.setFontSize(this._fontSize),this.useSystemFont&&i.setFontFamily(this.fontFamily),i.setOverflow(this.overflow),i.enableWrapText(this._enableWrapText),i.setLineHeight(this._lineHeight),i.setString(this.string),t instanceof cc.BitmapFont&&i.setSpacingX(this.spacingX),i.setContentSize(this.node.getContentSize()),i.setColor(this.node.color)},_updateNodeSize:function(){this._sgNode&&this._sgNode.parent&&(this.overflow!==r.NONE&&this.overflow!==r.RESIZE_HEIGHT||this.node.setContentSize(this._sgNode.getContentSize()))},onDestroy:function(){var t=this._sgNode;this._super(),t&&(t.removeFromParent(!0),_ccsg.Label.pool.put(t))}});cc.Label=i.exports=e},{"../label/CCSGLabel":124,"../label/CCSGLabelCanvasRenderCmd":125,"../label/CCSGLabelWebGLRenderCmd":126}],79:[function(t,i,s){var n=cc.T({name:"cc.LabelOutline",S:t("./CCComponent"),editor:!1,ctor:function(){this._labelSGNode=null},O:{_color:cc.color(255,255,255,255),_width:1,color:{get:function(){return this._color},set:function(t){this._color=cc.color(t),this._labelSGNode&&this._labelSGNode.setOutlineColor(cc.color(this._color))}},width:{get:function(){return this._width},set:function(t){this._width=t,this._labelSGNode&&(this._labelSGNode.setOutlineWidth(t),this._labelSGNode.setMargin(t))}}},onEnable:function(){var t=this.node.getComponent("cc.Label"),i=this._labelSGNode=t&&t._sgNode;this._labelSGNode&&(i.setOutlined(!0),i.setOutlineColor(cc.color(this._color)),i.setOutlineWidth(this._width),i.setMargin(this._width))},onDisable:function(){this._labelSGNode&&(this._labelSGNode.setOutlined(!1),this._labelSGNode.setMargin(0)),this._labelSGNode=null}});cc.LabelOutline=i.exports=n},{"./CCComponent":75}],80:[function(t,i,s){var n=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),h=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),r=cc.Enum({HORIZONTAL:0,VERTICAL:1}),e=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),c=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),o=cc.T({name:"cc.Layout",S:t("./CCComponent"),editor:!1,O:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:h.NONE,_N$layoutType:n.NONE,type:{type:n,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:h,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(t){this.type===n.NONE&&t===h.CHILDREN||(this._resize=t,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:r.HORIZONTAL,tooltip:!1,type:r,notify:function(){this._doLayoutDirty()},animatable:!1},_N$padding:{default:0},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:e.TOP_TO_BOTTOM,type:e,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:c.LEFT_TO_RIGHT,type:c,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1}},statics:{Type:n,VerticalDirection:e,HorizontalDirection:c,ResizeMode:h,AxisDirection:r},_migratePaddingData:function(){this.paddingLeft=this._N$padding,this.paddingRight=this._N$padding,this.paddingTop=this._N$padding,this.paddingBottom=this._N$padding,this._N$padding=0},onEnable:function(){this._addEventListeners(),cc.sizeEqualToSize(this.node.getContentSize(),cc.size(0,0))&&this.node.setContentSize(this._layoutSize),0!==this._N$padding&&this._migratePaddingData(),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this._updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("child-reorder",this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this._updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("child-reorder",this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){this.node.children.forEach(function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("position-changed",this._doLayoutDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_removeChildrenEventListeners:function(){this.node.children.forEach(function(t){t.off("size-changed",this._doLayoutDirty,this),t.off("position-changed",this._doLayoutDirty,this),t.off("anchor-changed",this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_childAdded:function(t){var i=t.detail;i.on("size-changed",this._doLayoutDirty,this),i.on("position-changed",this._doLayoutDirty,this),i.on("anchor-changed",this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){var i=t.detail;i.off("size-changed",this._doLayoutDirty,this),i.off("position-changed",this._doLayoutDirty,this),i.off("anchor-changed",this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(t,i,s,r){var o=this.node.getAnchorPoint(),u=this.node.children,a=1,f=this.paddingLeft,l=-o.x*t;this.horizontalDirection===c.RIGHT_TO_LEFT&&(a=-1,l=(1-o.x)*t,f=this.paddingRight);var v=l+a*f-a*this.spacingX,d=0,p=0,g=0,m=0,w=0,_=0,C=this.cellSize.width;return this.type!==n.GRID&&this.resizeMode===h.CHILDREN&&(C=(t-(this.paddingLeft+this.paddingRight)-(u.length-1)*this.spacingX)/u.length),u.forEach(function(u){if(u.activeInHierarchy){this._resize===h.CHILDREN&&(u.width=C,this.type===n.GRID&&(u.height=this.cellSize.height));var b=u.anchorX;g>p&&(p=g),u.height>=p&&(g=p,p=u.height,_=u.getAnchorPoint().y),this.horizontalDirection===c.RIGHT_TO_LEFT&&(b=1-u.anchorX),v=v+a*b*u.width+a*this.spacingX;var y=a*(1-b)*u.width;if(i){var T=v+y+a*(a>0?this.paddingRight:this.paddingLeft),S=this.horizontalDirection===c.LEFT_TO_RIGHT&&T>(1-o.x)*t,A=this.horizontalDirection===c.RIGHT_TO_LEFT&&T<-o.x*t;(S||A)&&(u.height>=p?(0===g&&(g=p),d+=g,g=p):(d+=p,g=u.height,p=0),v=l+a*(f+b*u.width),m++)}var M=s(u,d,m);t>=u.width+this.paddingLeft+this.paddingRight&&r&&u.setPosition(cc.p(v,M));var x,E=1,O=0===p?u.height:p;this.verticalDirection===e.TOP_TO_BOTTOM?(w=w||this.node._contentSize.height,(x=M+(E=-1)*(O*_+this.paddingBottom))<w&&(w=x)):(w=w||-this.node._contentSize.height,(x=M+E*(O*_+this.paddingTop))>w&&(w=x)),v+=y}}.bind(this)),w},_getVerticalBaseHeight:function(t){var i=0,s=0;return this.resizeMode===h.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(s++,i+=t.height)}),i+=(s-1)*this.spacingY+this.paddingBottom+this.paddingTop):i=this.node.getContentSize().height,i},_doLayoutVertically:function(t,i,s,r){var o=this.node.getAnchorPoint(),u=this.node.children,a=1,f=this.paddingBottom,l=-o.y*t;this.verticalDirection===e.TOP_TO_BOTTOM&&(a=-1,l=(1-o.y)*t,f=this.paddingTop);var v=l+a*f-a*this.spacingY,d=0,p=0,g=0,m=0,w=0,_=0,C=this.cellSize.height;return this.type!==n.GRID&&this.resizeMode===h.CHILDREN&&(C=(t-(this.paddingTop+this.paddingBottom)-(u.length-1)*this.spacingY)/u.length),u.forEach(function(u){if(u.activeInHierarchy){this.resizeMode===h.CHILDREN&&(u.height=C,this.type===n.GRID&&(u.width=this.cellSize.width));var b=u.anchorY;g>p&&(p=g),u.width>=p&&(g=p,p=u.width,_=u.getAnchorPoint().x),this.verticalDirection===e.TOP_TO_BOTTOM&&(b=1-u.anchorY),v=v+a*b*u.height+a*this.spacingY;var y=a*(1-b)*u.height;if(i){var T=v+y+a*(a>0?this.paddingTop:this.paddingBottom),S=this.verticalDirection===e.BOTTOM_TO_TOP&&T>(1-o.y)*t,A=this.verticalDirection===e.TOP_TO_BOTTOM&&T<-o.y*t;(S||A)&&(u.width>=p?(0===g&&(g=p),d+=g,g=p):(d+=p,g=u.width,p=0),v=l+a*(f+b*u.height),m++)}var M=s(u,d,m);t>=u.height+(this.paddingTop+this.paddingBottom)&&r&&u.setPosition(cc.p(M,v));var x,E=1,O=0===p?u.width:p;this.horizontalDirection===c.RIGHT_TO_LEFT?(E=-1,w=w||this.node._contentSize.width,(x=M+E*(O*_+this.paddingLeft))<w&&(w=x)):(w=w||-this.node._contentSize.width,(x=M+E*(O*_+this.paddingRight))>w&&(w=x)),v+=y}}.bind(this)),w},_doLayoutBasic:function(){var t=null;if(this.node.children.forEach(function(i){i.activeInHierarchy&&(t=t?cc.rectUnion(t,i.getBoundingBoxToWorld()):i.getBoundingBoxToWorld())}),t){var i=this.node.parent.convertToNodeSpaceAR(cc.p(t.x,t.y));i=cc.pAdd(i,cc.p(-this.paddingLeft,-this.paddingBottom));var s=this.node.parent.convertToNodeSpaceAR(cc.p(t.x+t.width,t.y+t.height));s=cc.pAdd(s,cc.p(this.paddingRight,this.paddingTop));var n=cc.size(parseFloat((s.x-i.x).toFixed(2)),parseFloat((s.y-i.y).toFixed(2))),h=this.node.getPosition(),r=(h.x-i.x)/n.width,e=(h.y-i.y)/n.height,c=cc.p(parseFloat(r.toFixed(2)),parseFloat(e.toFixed(2)));this.node.setAnchorPoint(c),this.node.setContentSize(n)}},_doLayoutGridAxisHorizontal:function(t,i){var s=i.width,n=1,r=-t.y*i.height,c=this.paddingBottom;this.verticalDirection===e.TOP_TO_BOTTOM&&(n=-1,r=(1-t.y)*i.height,c=this.paddingTop);var o=function(t,i,s){return r+n*(i+t.anchorY*t.height+c+s*this.spacingY)}.bind(this),u=0;if(this.resizeMode===h.CONTAINER){var a=this._doLayoutHorizontally(s,!0,o,!1);(u=r-a)<0&&(u*=-1),r=-t.y*u,this.verticalDirection===e.TOP_TO_BOTTOM&&(n=-1,r=(1-t.y)*u)}this._doLayoutHorizontally(s,!0,o,!0),this.resizeMode===h.CONTAINER&&this.node.setContentSize(s,u)},_doLayoutGridAxisVertical:function(t,i){var s=i.height,n=1,r=-t.x*i.width,e=this.paddingLeft;this.horizontalDirection===c.RIGHT_TO_LEFT&&(n=-1,r=(1-t.x)*i.width,e=this.paddingRight);var o=function(t,i,s){return r+n*(i+t.anchorX*t.width+e+s*this.spacingX)}.bind(this),u=0;if(this.resizeMode===h.CONTAINER){var a=this._doLayoutVertically(s,!0,o,!1);(u=r-a)<0&&(u*=-1),r=-t.x*u,this.horizontalDirection===c.RIGHT_TO_LEFT&&(n=-1,r=(1-t.x)*u)}this._doLayoutVertically(s,!0,o,!0),this.resizeMode===h.CONTAINER&&this.node.setContentSize(u,s)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),i=this.node.getContentSize();this.startAxis===r.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,i):this.startAxis===r.VERTICAL&&this._doLayoutGridAxisVertical(t,i)},_getHorizontalBaseWidth:function(t){var i=0,s=0;return this.resizeMode===h.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(s++,i+=t.width)}),i+=(s-1)*this.spacingX+this.paddingLeft+this.paddingRight):i=this.node.getContentSize().width,i},_doLayout:function(){if(this.type===n.HORIZONTAL){var t=this._getHorizontalBaseWidth(this.node.children);this._doLayoutHorizontally(t,!1,function(t){return t.y},!0),this.node.width=t}else if(this.type===n.VERTICAL){var i=this._getVerticalBaseHeight(this.node.children);this._doLayoutVertically(i,!1,function(t){return t.x},!0),this.node.height=i}else this.type===n.NONE?this.resizeMode===h.CONTAINER&&this._doLayoutBasic():this.type===n.GRID&&this._doLayoutGrid()},_updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)}});Object.defineProperty(o.prototype,"padding",{get:function(){return cc.warnID(4100),this.paddingLeft},set:function(t){this._N$padding=t,this._migratePaddingData(),this._doLayoutDirty()}}),cc.Layout=i.exports=o},{"./CCComponent":75}],81:[function(t,i,s){t("../../clipping-nodes/CCClippingNode"),t("../../clipping-nodes/CCClippingNodeCanvasRenderCmd"),t("../../clipping-nodes/CCClippingNodeWebGLRenderCmd");var n=cc._RendererInSG,h=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),r=cc.T({name:"cc.Mask",S:n,editor:!1,O:{_clippingStencil:{default:null,serializable:!1},_type:h.RECT,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:h,tooltip:!1},spriteFrame:{default:null,type:cc.P,tooltip:!1,notify:function(){this._refreshStencil()}},alphaThreshold:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setAlphaThreshold(this.alphaThreshold):cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setInverted(this.inverted):cc.warnID(4202)}},_segements:64,segements:{get:function(){return this._segements},set:function(t){this._segements=cc.clampf(t,3,1e4),this._refreshStencil()},tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:h},_resizeNodeToTargetNode:!1,_initSgNode:function(){},_createSgNode:function(){return new cc.ClippingNode},_hitTest:function(t){var i=this.node.getContentSize(),s=i.width,n=i.height,r=this.node.getNodeToWorldTransform();if(this.type===h.RECT||this.type===h.IMAGE_STENCIL){var e=cc.rect(0,0,s,n);cc._rectApplyAffineTransformIn(e,r);var c=t.x-e.x,o=e.x+e.width-t.x,u=t.y-e.y,a=e.y+e.height-t.y;return c>=0&&o>=0&&a>=0&&u>=0}if(this.type===h.ELLIPSE){var f=s/2,l=n/2,v=r.a*f+r.c*l+r.tx,d=r.b*f+r.d*l+r.ty,p=t.x-v,g=t.y-d;return p*p/(f*f)+g*g/(l*l)<1}},onEnable:function(){this._super(),this.spriteFrame&&this.spriteFrame.ensureLoadTexture(),this._refreshStencil(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},_calculateCircle:function(t,i,s){for(var n=[],h=2*Math.PI/s,r=0;r<s;++r)n.push(cc.v2(i.x*Math.cos(h*r)+t.x,i.y*Math.sin(h*r)+t.y));return n},_refreshStencil:function(){if(this.type!==h.IMAGE_STENCIL||cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=this.node.getContentSize(),i=this.node.getAnchorPoint(),s=this._clippingStencil;if(this._type===h.IMAGE_STENCIL)s instanceof cc.Scale9Sprite&&s._spriteFrame===this.spriteFrame||((s=new cc.Scale9Sprite).setSpriteFrame(this.spriteFrame),this._sgNode.setStencil(s)),s.setContentSize(t),s.setAnchorPoint(i),this._sgNode.setAlphaThreshold(this.alphaThreshold);else{s instanceof cc.DrawNode||(s=new cc.DrawNode,this._sgNode.setStencil(s));var n=t.width,r=t.height,e=-n*i.x,c=-r*i.y,o=cc.color(255,255,255,0);if(s.clear(),this._type===h.RECT){var u=[cc.v2(e,c),cc.v2(e+n,c),cc.v2(e+n,c+r),cc.v2(e,c+r)];s.drawPoly(u,o,0,o)}else if(this._type===h.ELLIPSE){var a=cc.v2(e+n/2,c+r/2),f={x:n/2,y:r/2};s.drawPoly(this._calculateCircle(a,f,this._segements),o,0,o)}}this._sgNode.setInverted(this.inverted),this._clippingStencil=s,cc.renderer.childrenOrderDirty=!0}else cc.warnID(4200)}});cc.Mask=i.exports=r},{"../../clipping-nodes/CCClippingNode":26,"../../clipping-nodes/CCClippingNodeCanvasRenderCmd":27,"../../clipping-nodes/CCClippingNodeWebGLRenderCmd":28}],82:[function(t,i,s){var n=cc.Enum({Unified:0,Free:1}),h=cc.Enum({Horizontal:0,Vertical:1}),r=cc.Enum({PAGE_TURNING:0}),e=cc.T({name:"cc.PageView",S:cc.W,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},O:{sizeMode:{default:n.Unified,type:n,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:h.Horizontal,type:h,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.U.EventHandler,tooltip:!1}},statics:{SizeMode:n,Direction:h,EventType:r},__preload:function(){this.node.on("size-changed",this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this.node.off("size-changed",this._updateAllPagesSize,this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(t){this.scrollToPage(t,!0)},getPages:function(){return this._pages},addPage:function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView())},insertPage:function(t,i){i<0||!t||-1!==this._pages.indexOf(t)||!this.content||(i>=this._pages.length?this.addPage(t):(this._pages.splice(i,0,t),this.content.addChild(t),this._updatePageView()))},removePage:function(t){if(t&&this.content){var i=this._pages.indexOf(t);-1!==i?this.removePageAtIndex(i):cc.warnID(4300,t.name)}},removePageAtIndex:function(t){var i=this._pages;if(!(t<0||t>=i.length)){var s=i[t];s&&(this.content.removeChild(s),i.splice(t,1),this._updatePageView())}},removeAllPages:function(){if(this.content){for(var t=this._pages,i=0,s=t.length;i<s;i++)this.content.removeChild(t[i]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(t,i){t<0||t>this._pages.length||(i=void 0!==i?i:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),i,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===h.Horizontal,this.vertical=this.direction===h.Vertical},_syncSizeMode:function(){if(this.content){var t=this.content.getComponent(cc.Layout);if(t){if(0===this._pages.length)t.padding=0;else{var i=this._pages[this._pages.length-1];this.sizeMode===n.Free&&(this.direction===h.Horizontal?(t.paddingLeft=(this.node.width-this._pages[0].width)/2,t.paddingRight=(this.node.width-i.width)/2):this.direction===h.Vertical&&(t.paddingTop=(this.node.height-this._pages[0].height)/2,t.paddingBottom=(this.node.height-i.height)/2))}t._updateLayout()}}},_updatePageView:function(){var t=this._pages.length,i=this.content.getComponent(cc.Layout);i&&i.enabled&&i._updateLayout(),this._curPageIdx>=t&&(this._curPageIdx=0===t?0:t-1,this._lastPageIdx=this._curPageIdx);for(var s=0;s<t;++s)this._pages[s].setSiblingIndex(s),this.direction===h.Horizontal?this._scrollCenterOffsetX[s]=Math.abs(this.content.x+this._pages[s].x):this._scrollCenterOffsetY[s]=Math.abs(this.content.y+this._pages[s].y);this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===n.Unified)for(var t=this._pages,i=this.node.getContentSize(),s=0,h=t.length;s<h;s++)t[s].setContentSize(i)},_initPages:function(){if(this.content){for(var t=this.content.children,i=0;i<t.length;++i){var s=t[i];this._pages.indexOf(s)>=0||this._pages.push(s)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.U.EventHandler.emitEvents(this.pageEvents,this,r.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(t,i,s){if(this.sizeMode===n.Free){var r,e;if(this.direction===h.Horizontal)return r=this._scrollCenterOffsetX[i],e=this._scrollCenterOffsetX[s],Math.abs(t.x)>=Math.abs(r-e)*this.scrollThreshold;if(this.direction===h.Vertical)return r=this._scrollCenterOffsetY[i],e=this._scrollCenterOffsetY[s],Math.abs(t.y)>=Math.abs(r-e)*this.scrollThreshold}else{if(this.direction===h.Horizontal)return Math.abs(t.x)>=this.node.width*this.scrollThreshold;if(this.direction===h.Vertical)return Math.abs(t.y)>=this.node.height*this.scrollThreshold}},_isQuicklyScrollable:function(t){if(this.direction===h.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===h.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(t){var i=cc.p(0,0);return this.sizeMode===n.Free?this.direction===h.Horizontal?i.x=this._scrollCenterOffsetX[t]:this.direction===h.Vertical&&(i.y=this._scrollCenterOffsetY[t]):this.direction===h.Horizontal?i.x=t*this.node.width:this.direction===h.Vertical&&(i.y=t*this.node.height),i},_getDragDirection:function(t){return this.direction===h.Horizontal?0===t.x?0:t.x>0?1:-1:this.direction===h.Vertical?0===t.y?0:t.y<0?1:-1:void 0},_handleReleaseLogic:function(t){var i=this._startBounceBackIfNeeded(),s=cc.pSub(this._touchBeganPosition,this._touchEndPosition);if(i){var n=this._getDragDirection(s);if(0===n)return;this._curPageIdx=n>0?this._pages.length-1:0,this.indicator&&this.indicator._changedState()}else{var h=this._curPageIdx,r=h+this._getDragDirection(s),e=this.pageTurningSpeed*Math.abs(h-r);if(r<this._pages.length){if(this._isScrollable(s,h,r))return void this.scrollToPage(r,e);var c=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(c))return void this.scrollToPage(r,e)}this.scrollToPage(h,e)}},_onTouchBegan:function(t,i){this._touchBeganPosition=t.touch.getLocation(),this._super(t,i)},_onTouchMoved:function(t,i){this._super(t,i)},_onTouchEnded:function(t,i){this._touchEndPosition=t.touch.getLocation(),this._super(t,i)},_onTouchCancelled:function(t,i){this._touchEndPosition=t.touch.getLocation(),this._super(t,i)},_onMouseWheel:function(){}});cc.PageView=i.exports=e},{}],83:[function(t,i,s){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),h=cc.T({name:"cc.PageViewIndicator",S:t("./CCComponent"),editor:!1,O:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.P,tooltip:!1},direction:{default:n.HORIZONTAL,type:n,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:n},onLoad:function(){this._updateLayout()},setPageView:function(t){this._pageView=t,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===n.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===n.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var t=new cc.Node;return t.addComponent(cc.Sprite).spriteFrame=this.spriteFrame,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t},_changedState:function(){var t=this._indicators;if(0!==t.length){var i=this._pageView._curPageIdx;if(!(i>=t.length)){for(var s=0;s<t.length;++s)t[s].opacity=127.5;t[i].opacity=255}}},_refresh:function(){if(this._pageView){var t=this._indicators,i=this._pageView.getPages();if(i.length!==t.length){var s=0;if(i.length>t.length)for(s=0;s<i.length;++s)t[s]||(t[s]=this._createIndicator());else for(s=t.length-i.length;s>0;--s){var n=t[s-1];this.node.removeChild(n),t.splice(s-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout._updateLayout(),this._changedState()}}}});cc.PageViewIndicator=i.exports=h},{"./CCComponent":75}],84:[function(t,i,s){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),h=cc.T({name:"cc.ProgressBar",S:t("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var i=this.node.getContentSize(),s=this.node.getAnchorPoint(),h=t.getContentSize();t.parent===this.node&&this.node.setContentSize(h),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=n.FILLED);var r=t.getContentSize();if(this.mode===n.HORIZONTAL?this.totalLength=r.width:this.mode===n.VERTICAL?this.totalLength=r.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node){var e=-i.width*s.x;t.setPosition(cc.p(e,0))}}},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var i,s,h,r=t.getAnchorPoint(),e=t.getContentSize(),c=t.getPosition(),o=cc.p(0,.5),u=cc.clamp01(this.progress),a=this.totalLength*u;switch(this.mode){case n.HORIZONTAL:this.reverse&&(o=cc.p(1,.5)),i=cc.size(a,e.height),s=this.totalLength,h=e.height;break;case n.VERTICAL:o=this.reverse?cc.p(.5,1):cc.p(.5,0),i=cc.size(e.width,a),s=e.width,h=this.totalLength}if(this.mode===n.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(a*=-1),this.barSprite.fillRange=a);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var f=o.x-r.x,l=o.y-r.y,v=cc.p(s*f,h*l);t.setPosition(cc.pAdd(c,v)),t.setAnchorPoint(o),t.setContentSize(i)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},O:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:n.HORIZONTAL,type:n,tooltip:!1,notify:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var i=t.getContentSize();this.mode===n.HORIZONTAL?this.totalLength=i.width:this.mode===n.VERTICAL?this.totalLength=i.height:this.mode===n.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(t){this.mode===n.FILLED&&(t=cc.clamp01(t)),this._N$totalLength=t,this._updateBarStatus()}},progress:{default:1,type:"Float",range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:n}});cc.Q=i.exports=h},{"./CCComponent":75}],85:[function(t,i,s){var n=cc.T({S:t("./CCSGComponent"),name:"cc._RendererInSG",ctor:function(){(this._sgNode=this._createSgNode()).setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(t){var i=this.node,s=i._sgNode;s._entity=null;var n=s.getChildren().slice();s.removeAllChildren(!1),t.getChildrenCount()>0&&t.removeAllChildren(!1);for(var h=0,r=n.length;h<r;++h)t.addChild(n[h]);var e=s.getParent();e&&(e.removeChild(s,!1),e.addChild(t),t._arrivalOrder=s._arrivalOrder,cc.renderer.childrenOrderDirty=e._reorderChildDirty=!0),i._sgNode=t,i._sgNode._entity=i,i._updateSgNode()}});cc._RendererInSG=i.exports=n},{"./CCSGComponent":88}],86:[function(t,i,s){var n=cc.T({S:t("./CCSGComponent"),name:"cc._RendererUnderSG",ctor:function(){var t=this._sgNode=this._createSgNode();t&&t.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(t){if(t){var i=this.node;t.setColor(i._color),i._cascadeOpacityEnabled||t.setOpacity(i._opacity),t.setAnchorPoint(i._anchorPoint),t.setOpacityModifyRGB(i._opacityModifyRGB),t.setLocalZOrder(-1),i._sgNode.addChild(t)}}});cc._RendererUnderSG=i.exports=n},{"./CCSGComponent":88}],87:[function(t,i,s){t("../label/CCHtmlTextParser"),t("../label/CCTextUtils");var n=cc.TextAlignment,h=cc.VerticalTextAlignment,r=cc.T({name:"cc.RichText",S:cc._RendererUnderSG,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._resetState(),this._updateRichTextStatus=this._updateRichText},editor:!1,O:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font&&this._onTTFLoaded(),this._updateRichTextStatus())}},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}}},statics:{HorizontalAlign:n,VerticalAlign:h},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_createSgNode:function(){var t=new _ccsg.Node;t.setCascadeOpacityEnabled(!0);var i=this;return t.setColor=function(){i._updateLabelSegmentTextAttributes()},t._setContentSize=t.setContentSize,t.setContentSize=function(){},t},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t)}.bind(this))},_initSgNode:function(){this._updateRichText(),this._onTTFLoaded()},_createFontLabel:function(t){return _ccsg.Label.pool.get(t,this.font,null,this.fontSize)},_getFontRawUrl:function(){return this.font instanceof cc.TTFFont?this.font.rawUrl:""},_onTTFLoaded:function(){var t=this._getFontRawUrl();if(t){var i=this;cc.CustomFontLoader.loadTTF(t,function(){i._layoutDirty=!0,i._updateRichText()})}},_measureText:function(t,i){var s=this,n=function(i){var n;return 0===s._labelSegmentsCache.length?(n=s._createFontLabel(i),s._labelSegmentsCache.push(n)):(n=s._labelSegmentsCache[0]).setString(i),n._styleIndex=t,s._applyTextAttribute(n),n.getContentSize().width};return i?n(i):n},_onTouchEnded:function(t){if(this.enabledInHierarchy)for(var i=this.node.getComponents(cc.U),s=0;s<this._labelSegments.length;++s){var n=this._labelSegments[s],h=n._clickHandler;h&&this._containsTouchLocation(n,t.touch.getLocation())&&i.forEach(function(i){i.enabledInHierarchy&&i[h]&&i[h](t)})}},_containsTouchLocation:function(t,i){var s=t.getBoundingBoxToWorld();return cc.rectContainsPoint(s,i)},_resetState:function(){var t=this._sgNode;t&&t.removeAllChildren(),this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},_addLabelSegment:function(t,i){var s;return 0===this._labelSegmentsCache.length?s=this._createFontLabel(t):(s=this._labelSegmentsCache.pop()).setString(t),s._styleIndex=i,s._lineCount=this._lineCount,this._applyTextAttribute(s),s.setAnchorPoint(0,0),this._sgNode.addChild(s),this._labelSegments.push(s),s},_updateRichTextWithMaxWidth:function(t,i,s){var n=i;if(this._lineOffsetX>0&&n+this._lineOffsetX>this.maxWidth)for(var h=0;this._lineOffsetX<=this.maxWidth;){var r=this._getFirstWordLen(t,h,t.length),e=t.substr(h,r),c=this._measureText(s,e);if(!(this._lineOffsetX+c<=this.maxWidth)){if(h>0){var o=t.substr(0,h);this._addLabelSegment(o,s),t=t.substr(h,t.length),n=this._measureText(s,t)}this._updateLineInfo();break}this._lineOffsetX+=c,h+=r}if(n>this.maxWidth)for(var u=cc.TextUtils.fragmentText(t,n,this.maxWidth,this._measureText(s)),a=0;a<u.length;++a){var f=u[a],l=this._addLabelSegment(f,s).getContentSize();this._lineOffsetX+=l.width,u.length>1&&a<u.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,s)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var i=0;i<this._textArray.length;++i){var s=this._textArray[i],n=t[i];if(s.text!=n.text)return!0;if(s.style){if(n.style){if(s.style.size!==n.style.size||s.style.italic!==n.style.italic||s.style.isImage!==n.style.isImage)return!0;if(s.style.isImage===n.style.isImage&&s.style.src!==n.style.src)return!0}else if(s.style.size||s.style.italic||s.style.isImage)return!0}else if(n.style&&(n.style.size||n.style.italic||n.style.isImage))return!0}return!1},_onSpriteFrameLoaded:function(t,i){var s;(s=i||t.target).__sprite.setSpriteFrame(s)},_applySpriteFrame:function(t){t&&(t.textureLoaded()?this._onSpriteFrameLoaded(null,t):(t.once("load",this._onSpriteFrameLoaded,this),t.ensureLoadTexture()))},_addRichTextImageElement:function(t){var i=t.style.src,s=this.imageAtlas.getSpriteFrame(i);if(s){var n=new cc.Scale9Sprite;n.setAnchorPoint(0,0),s.__sprite=n,this._sgNode.addChild(n),this._labelSegments.push(n);var h=s.getRect(),r=1,e=h.width,c=h.height,o=t.style.imageWidth,u=t.style.imageHeight;u>0&&u<this.lineHeight?(e*=r=u/c,c*=r):(e*=r=this.lineHeight/c,c*=r),o>0&&(e=o),this.maxWidth>0?(this._lineOffsetX+e>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=e):(this._lineOffsetX+=e,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),this._applySpriteFrame(s),n.setContentSize(e,c),n._lineCount=this._lineCount,t.style.event&&t.style.event.click&&(n._clickHandler=t.style.event.click)}else cc.warnID(4400)},_updateRichText:function(){if(this.enabled){var t=cc.htmlTextParser.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t;var i=this._sgNode;this._resetState();for(var s,n=!1,h=0;h<this._textArray.length;++h){var r=this._textArray[h],e=r.text;if(""===e){if(r.style&&r.style.newline){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this.imageAtlas){this._addRichTextImageElement(r);continue}}for(var c=e.split("\n"),o=0;o<c.length;++o){var u=c[o];if(""!==u)if(n=!1,this.maxWidth>0){var a=this._measureText(h,u);this._updateRichTextWithMaxWidth(u,a,h),c.length>1&&o<c.length-1&&this._updateLineInfo()}else s=this._addLabelSegment(u,h).getContentSize(),this._lineOffsetX+=s.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),c.length>1&&o<c.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(e)&&o==c.length-1)continue;this._updateLineInfo(),n=!0}}}n||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=this._lineCount*this.lineHeight,i._setContentSize(this._labelWidth,this._labelHeight),this.node.emit("size-changed"),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,i,s){var n=t.charAt(i);if(cc.TextUtils.isUnicodeCJK(n)||cc.TextUtils.isUnicodeSpace(n))return 1;for(var h=1,r=i+1;r<s&&(n=t.charAt(r),!cc.TextUtils.isUnicodeSpace(n)&&!cc.TextUtils.isUnicodeCJK(n));++r)h++;return h},_updateRichTextPosition:function(){for(var t=0,i=1,s=this._lineCount,n=0;n<this._labelSegments.length;++n){var h=this._labelSegments[n],r=h._lineCount;r>i&&(t=0,i=r);var e=0;switch(this.horizontalAlign){case cc.TextAlignment.LEFT:e=0;break;case cc.TextAlignment.CENTER:e=(this._labelWidth-this._linesWidth[r-1])/2;break;case cc.TextAlignment.RIGHT:e=this._labelWidth-this._linesWidth[r-1]}h.setPositionX(t+e);var c=h.getContentSize(),o=(s-r)*this.lineHeight;h instanceof cc.Scale9Sprite&&(o+=(this.lineHeight-h.getContentSize().height)/2),h.setPositionY(o),r===i&&(t+=c.width)}},_convertLiteralColorValue:function(t){var i=t.toUpperCase();return cc.Color[i]?cc.Color[i]:cc.hexToColor(t)},_applyTextAttribute:function(t){if(!(t instanceof cc.Scale9Sprite)){var i=t._styleIndex;t.setLineHeight(this.lineHeight),t.setVerticalAlign(h.CENTER);var s=null;this._textArray[i]&&(s=this._textArray[i].style),s&&s.color?t.setColor(this._convertLiteralColorValue(s.color)):t.setColor(this.node.color),s&&s.bold?t.enableBold(!0):t.enableBold(!1),s&&s.italic?t.enableItalics(!0):t.enableItalics(!1),s&&s.underline?t.enableUnderline(!0):t.enableUnderline(!1),s&&s.outline?(t.setOutlined(!0),t.setOutlineColor(this._convertLiteralColorValue(s.outline.color)),t.setOutlineWidth(s.outline.width),t.setMargin(s.outline.width)):(t.setOutlined(!1),t.setMargin(0)),s&&s.size?t.setFontSize(s.size):t.setFontSize(this.fontSize),s&&s.event&&s.event.click&&(t._clickHandler=s.event.click)}},onDestroy:function(){this._super();for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(!0),_ccsg.Label.pool.put(this._labelSegments[t]);this._resetState()}});cc.RichText=i.exports=r},{"../label/CCHtmlTextParser":123,"../label/CCTextUtils":127}],88:[function(t,i,s){var n=t("../utils/scene-graph-helper"),h=cc.T({S:t("./CCComponent"),name:"cc._SGComponent",editor:!1,O:{_sgNode:{default:null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:n.removeSgNode,_registSizeProvider:function(){this.node._sizeProvider||(this.node._sizeProvider=this._sgNode)}});cc._SGComponent=i.exports=h},{"../utils/scene-graph-helper":226,"./CCComponent":75}],89:[function(t,i,s){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),h=cc.T({name:"cc.Scrollbar",S:t("./CCComponent"),editor:!1,O:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},direction:{default:n.HORIZONTAL,type:n,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:n},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var i=t.convertToWorldSpace(cc.p(0,0));return this._scrollView.node.convertToNodeSpace(i)},_setOpacity:function(t){this.handle&&this.node.setOpacity(t)},_onScroll:function(t){if(this._scrollView){var i=this._scrollView.content;if(i){var s=i.getContentSize(),h=this._scrollView.node.getContentSize(),r=this.node.getContentSize();if(this._conditionalDisableScrollBar(s,h))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var e=0,c=0,o=0,u=0,a=0;this.direction===n.HORIZONTAL?(e=s.width,c=h.width,a=r.width,o=t.x,u=-this._convertToScrollViewSpace(i).x):this.direction===n.VERTICAL&&(e=s.height,c=h.height,a=r.height,o=t.y,u=-this._convertToScrollViewSpace(i).y);var f=this._calculateLength(e,c,a,o),l=this._calculatePosition(e,c,a,u,o,f);this._updateLength(f),this._updateHanlderPosition(l)}}},_updateHanlderPosition:function(t){if(this.handle){var i=this._fixupHandlerPosition();this.handle.node.setPosition(cc.pAdd(t,i))}},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),i=this.node.getAnchorPoint(),s=this.handle.node.getContentSize(),h=this.handle.node.parent,r=this.node.convertToWorldSpaceAR(cc.p(-t.width*i.x,-t.height*i.y)),e=h.convertToNodeSpaceAR(r);return this.direction===n.HORIZONTAL?e=cc.pAdd(e,cc.p(0,(t.height-s.height)/2)):this.direction===n.VERTICAL&&(e=cc.pAdd(e,cc.p((t.width-s.width)/2,0))),this.handle.node.setPosition(e),e},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,i){return t.width<=i.width&&this.direction===n.HORIZONTAL||t.height<=i.height&&this.direction===n.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var i=t.getContentSize(),s=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(i,s))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,i,s,n){var h=t;return n&&(h+=20*(n>0?n:-n)),s*(i/h)},_calculatePosition:function(t,i,s,h,r,e){var c=t-i;r&&(c+=Math.abs(r));var o=0;c&&(o=h/c,o=cc.clamp01(o));var u=(s-e)*o;return this.direction===n.VERTICAL?cc.p(0,u):cc.p(u,0)},_updateLength:function(t){if(this.handle){var i=this.handle.node,s=i.getContentSize();i.setAnchorPoint(cc.p(0,0)),this.direction===n.HORIZONTAL?i.setContentSize(t,s.height):i.setContentSize(s.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var i=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(i)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=i.exports=h},{"./CCComponent":75}],90:[function(t,i,s){var n=function(){return(new Date).getMilliseconds()},h=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,AUTOSCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11}),r={"scroll-to-top":h.SCROLL_TO_TOP,"scroll-to-bottom":h.SCROLL_TO_BOTTOM,"scroll-to-left":h.SCROLL_TO_LEFT,"scroll-to-right":h.SCROLL_TO_RIGHT,scrolling:h.SCROLLING,"bounce-bottom":h.BOUNCE_BOTTOM,"bounce-left":h.BOUNCE_LEFT,"bounce-right":h.BOUNCE_RIGHT,"bounce-top":h.BOUNCE_TOP,"scroll-ended":h.AUTOSCROLL_ENDED,"touch-up":h.TOUCH_UP,"scroll-ended-with-threshold":h.AUTOSCROLL_ENDED_WITH_THRESHOLD},e=cc.T({name:"cc.ScrollView",S:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),this._outOfBoundaryAmount=cc.p(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1},O:{content:{default:void 0,type:cc.Node,tooltip:!1},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:"Float",range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.U.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1}},statics:{EventType:h},scrollToBottom:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s,!0)},scrollToTop:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToLeft:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToRight:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToTopLeft:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToTopRight:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToBottomLeft:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToBottomRight:function(t,i){var s=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(s,t,!1!==i):this._moveContent(s)},scrollToOffset:function(t,i,s){var n=this.getMaxScrollOffset(),h=cc.p(0,0);0===n.x?h.x=0:h.x=t.x/n.x,0===n.y?h.y=1:h.y=(n.y-t.y)/n.y,this.scrollTo(h,i,s)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,i=this._getContentLeftBoundary()-this._leftBoundary;return cc.p(i,t)},getMaxScrollOffset:function(){var t=this.node.getContentSize(),i=this.content.getContentSize(),s=i.width-t.width,n=i.height-t.height;return s=s>=0?s:0,n=n>=0?n:0,cc.p(s,n)},scrollToPercentHorizontal:function(t,i,s){var n=this._calculateMovePercentDelta({anchor:cc.p(t,0),applyToHorizontal:!0,applyToVertical:!1});i?this._startAutoScroll(n,i,!1!==s):this._moveContent(n)},scrollTo:function(t,i,s){var n=this._calculateMovePercentDelta({anchor:t,applyToHorizontal:!0,applyToVertical:!0});i?this._startAutoScroll(n,i,!1!==s):this._moveContent(n)},scrollToPercentVertical:function(t,i,s){var n=this._calculateMovePercentDelta({anchor:cc.p(0,t),applyToHorizontal:!1,applyToVertical:!0});i?this._startAutoScroll(n,i,!1!==s):this._moveContent(n)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){cc.pFuzzyEqual(t,this.getContentPosition(),1e-4)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,i){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,i)){var s=cc.p(0,0);this.vertical?s=cc.p(0,-.1*t.getScrollY()):this.horizontal&&(s=cc.p(-.1*t.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(s),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},_checkMouseWheel:function(t){var i=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(i,cc.p(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var i=t.anchor,s=t.applyToHorizontal,n=t.applyToVertical;this._calculateBoundary(),i=cc.pClamp(i,cc.p(0,0),cc.p(1,1));var h=this.node.getContentSize(),r=this.content.getContentSize(),e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var c=this._getContentLeftBoundary()-this._leftBoundary;c=-c;var o=cc.p(0,0),u=0;return s&&(u=r.width-h.width,o.x=c-u*i.x),n&&(u=r.height-h.height,o.y=e-u*i.y),o},_moveContentToTopLeft:function(t){var i=this.content.getContentSize(),s=this._getContentBottomBoundary()-this._bottomBoundary;s=-s;var n=cc.p(0,0),h=0,r=this._getContentLeftBoundary()-this._leftBoundary;r=-r,i.height<t.height?(h=i.height-t.height,n.y=s-h,this.verticalScrollBar&&this.verticalScrollBar.hide()):this.verticalScrollBar&&this.verticalScrollBar.show(),i.width<t.width?(h=i.width-t.width,n.x=r,this.horizontalScrollBar&&this.horizontalScrollBar.hide()):this.horizontalScrollBar&&this.horizontalScrollBar.show(),this._moveContent(n),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t._updateLayout();var i=this.node.getContentSize(),s=this._convertToContentParentSpace(cc.p(0,0));this._leftBoundary=s.x,this._bottomBoundary=s.y;var n=this._convertToContentParentSpace(cc.p(i.width,i.height));this._rightBoundary=n.x,this._topBoundary=n.y,this._moveContentToTopLeft(i)}},_convertToContentParentSpace:function(t){var i=this.node.convertToWorldSpace(t);return this.content.parent.convertToNodeSpaceAR(i)},_hasNestedViewGroup:function(t,i){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(i)for(var s=0;s<i.length;++s){var n=i[s];if(this.node===n)return!!t.target.getComponent(cc.ViewGroup);if(n.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,i){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,i)){var s=t.touch;this.content&&this._handlePressLogic(s),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},_onTouchMoved:function(t,i){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,i)){var s=t.touch;if(this.content&&this._handleMoveLogic(s),this.cancelInnerEvents){var n=cc.pSub(s.getLocation(),s.getStartLocation());if(cc.pLength(n)>7&&!this._touchMoved&&t.target!==this.node){var h=new cc.Event.EventTouch(t.getTouches(),t.bubbles);h.type=cc.Node.EventType.TOUCH_CANCEL,h.touch=t.touch,h.simulate=!0,t.target.dispatchEvent(h),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},_onTouchEnded:function(t,i){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,i)){this._dispatchEvent("touch-up");var s=t.touch;this.content&&this._handleReleaseLogic(s),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)}},_onTouchCancelled:function(t,i){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,i)){if(!t.simulate){var s=t.touch;this.content&&this._handleReleaseLogic(s)}this._stopPropagationIfTargetIsMe(t)}},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_handleMoveLogic:function(t){var i=t.getDelta();this._processDeltaMove(i)},_scrollChildren:function(t){var i,s=t=this._clampDelta(t);this.elastic&&(i=this._getHowMuchOutOfBoundary(),s.x*=0===i.x?1:.5,s.y*=0===i.y?1:.5),this.elastic||(i=this._getHowMuchOutOfBoundary(s),s=cc.pAdd(s,i));var n=-1;s.y>0?this.content.y-this.content.anchorY*this.content.height+s.y>this._bottomBoundary&&(n="scroll-to-bottom"):s.y<0?this.content.y-this.content.anchorY*this.content.height+this.content.height+s.y<=this._topBoundary&&(n="scroll-to-top"):s.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+s.x<=this._rightBoundary&&(n="scroll-to-right"):s.x>0&&this.content.x-this.content.anchorX*this.content.width+s.x>=this._leftBoundary&&(n="scroll-to-left"),this._moveContent(s,!1),0===s.x&&0===s.y||this._dispatchEvent("scrolling"),-1!==n&&this._dispatchEvent(n)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=n(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var i=this.content.getContentSize(),s=this.node.getContentSize();return i.width<s.width&&(t.x=0),i.height<s.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var i=n();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(t=this._clampDelta(t),cc.pFuzzyEqual(t,cc.p(0,0),1e-4))return!1;var i=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,i,!0),this._isBouncing||(t.y>0&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),t.x>0&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var i=t.getDelta();this._gatherTouchMove(i),this._processInertiaScroll()},_isOutOfBoundary:function(){var t=this._getHowMuchOutOfBoundary();return!cc.pFuzzyEqual(t,cc.p(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(t){var i=this._isNecessaryAutoScrollBrake(),s=i?.05:1;this._autoScrollAccumulatedTime+=t*(1/s);var n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(n=function(t){return(t-=1)*t*t*t*t+1}(n));var h=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,n)),r=Math.abs(n-1)<=1e-4;if(Math.abs(n-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var e=cc.pSub(h,this._autoScrollBrakingStartPosition);i&&(e=cc.pMult(e,s)),h=cc.pAdd(this._autoScrollBrakingStartPosition,e)}else{var c=cc.pSub(h,this.getContentPosition()),o=this._getHowMuchOutOfBoundary(c);cc.pFuzzyEqual(o,cc.p(0,0),1e-4)||(h=cc.pAdd(h,o),r=!0)}r&&(this._autoScrolling=!1);var u=cc.pSub(h,this.getContentPosition());this._moveContent(u,r),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var i=cc.pMult(t,.7);this._startAttenuatingAutoScroll(i,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,i){var s=this._calculateAutoScrollTimeByInitalSpeed(cc.pLength(i)),n=cc.pNormalize(t),h=this.content.getContentSize(),r=this.node.getContentSize(),e=h.width-r.width,c=h.height-r.height,o=this._calculateAttenuatedFactor(e),u=this._calculateAttenuatedFactor(c);n=cc.p(n.x*e*(1-this.brake)*o,n.y*c*u*(1-this.brake));var a=cc.pLength(t),f=cc.pLength(n)/a;n=cc.pAdd(n,t),this.brake>0&&f>7&&(f=Math.sqrt(f),n=cc.pAdd(cc.pMult(t,f),t)),this.brake>0&&f>3&&(s*=f=3),0===this.brake&&f>1&&(s*=f),this._startAutoScroll(n,s,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,i,s){var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=s,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=i,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var h=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(h,cc.p(0,0),1e-4)){this._autoScrollCurrentlyOutOfBoundary=!0;var r=this._getHowMuchOutOfBoundary(n);(h.x*r.x>0||h.y*r.y>0)&&(this._autoScrollBraking=!0)}},_calculateTouchMoveVelocity:function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce(function(t,i){return t+i},t))<=0||t>=.5)return cc.p(0,0);var i=cc.p(0,0);return i=this._touchMoveDisplacements.reduce(function(t,i){return cc.pAdd(t,i)},i),cc.p(i.x*(1-this.brake)/t,i.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){var i=t;return i.x=this.horizontal?i.x:0,i.y=this.vertical?i.y:0,i},_moveContent:function(t,i){var s=this._flattenVectorByDirection(t),n=cc.pAdd(this.getContentPosition(),s);this.setContentPosition(n);var h=this._getHowMuchOutOfBoundary();this._updateScrollBar(h),this.elastic&&i&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if(t=t||cc.p(0,0),cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var i=cc.p(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?i.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(i.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?i.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(i.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&(this._outOfBoundaryAmount=i,this._outOfBoundaryAmountDirty=!1),i=this._clampDelta(i)},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var i=1<<r[t];if(this._scrollEventEmitMask&i)return;this._scrollEventEmitMask|=i}cc.U.EventHandler.emitEvents(this.scrollEvents,this,r[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var t=this._getHowMuchOutOfBoundary(cc.p(0,0)),i=cc.pAdd(this.getContentPosition(),t);this.content&&(this.content.setPosition(i),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_AFTER_VISIT,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},_showScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.show(),this.verticalScrollBar&&this.verticalScrollBar.show()},onDisable:function(){this._unregisterEvent(),this.node.off("size-changed",this._calculateBoundary,this),this.content&&this.content.off("size-changed",this._calculateBoundary,this),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.node.on("size-changed",this._calculateBoundary,this),this.content&&this.content.on("size-changed",this._calculateBoundary,this),this._showScrollbar()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.W=i.exports=e},{"./CCViewGroup":98}],91:[function(t,i,s){var n=cc.Enum({Horizontal:0,Vertical:1}),h=cc.T({name:"cc.Slider",S:t("./CCComponent"),editor:!1,ctor:function(){this._dragging=!1},O:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:n.Horizontal,type:n,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.U.EventHandler,tooltip:!1}},statics:{Direction:n},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.U.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){if(this.handle){var i=null,s=0,h=this.node.convertTouchToNodeSpaceAR(t);this.direction===n.Horizontal?(i=this.node.width/2-this.handle.node.width*this.handle.node.anchorX,s=cc.clamp01((h.x+i)/(2*i),0,1)):this.direction===n.Vertical&&(i=this.node.height/2-this.handle.node.height*this.handle.node.anchorY,s=cc.clamp01((h.y+i)/(2*i),0,1)),this.progress=s}},_updateHandlePosition:function(){if(this.handle){var t;t=this.direction===n.Horizontal?cc.p(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.p(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var i=this.node.convertToWorldSpaceAR(t);this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(i)}}});cc.Slider=i.exports=h},{"./CCComponent":75}],92:[function(t,i,s){var n=t("./CCRendererUnderSG"),h=cc.Scale9Sprite.RenderingType,r=cc.Scale9Sprite.FillType,e=cc.BlendFunc.BlendFactor,c=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),o=cc.T({name:"cc.Sprite",S:n,editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},O:{_spriteFrame:{default:null,type:cc.P},_type:h.SIMPLE,_sizeMode:c.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:e.SRC_ALPHA,_dstBlendFactor:e.ONE_MINUS_SRC_ALPHA,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,i){var s=this._spriteFrame;s!==t&&(this._spriteFrame=t,this._applySpriteFrame(s))},type:cc.P},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(t)},type:h,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:r,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t))},animatable:!1,tooltip:!1},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:e,tooltip:!1},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:e,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){this._sizeMode=t,t!==c.CUSTOM&&this._applySpriteSize()},animatable:!1,type:c,tooltip:!1}},statics:{FillType:r,Type:h,SizeMode:c},setVisible:function(t){this.enabled=t},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},_applyAtlas:!1,_applySpriteFrameInsets:function(){var t=this._spriteFrame,i=this._sgNode;i.setInsetTop(t.insetTop),i.setInsetBottom(t.insetBottom),i.setInsetRight(t.insetRight),i.setInsetLeft(t.insetLeft)},_applySpriteSize:function(){if(c.CUSTOM!==this._sizeMode&&this._spriteFrame)if(c.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(c.TRIMMED===this._sizeMode){var i=this._spriteFrame.getRect();this.node.setContentSize(cc.size(i.width,i.height))}else this.node.setContentSize(this.node.getContentSize(!0));else this.node.setContentSize(this.node.getContentSize(!0))},_onTextureLoaded:function(t){if(this.isValid){var i=this._sgNode;i.setSpriteFrame(this._spriteFrame),this._applySpriteSize(),this.enabledInHierarchy&&!i.isVisible()&&i.setVisible(!0)}},_applySpriteFrame:function(t,i){var s=this._sgNode;t&&t.off&&t.off("load",this._onTextureLoaded,this);var n=this._spriteFrame;n?(i||this._applySpriteFrameInsets(),n.textureLoaded()?this._onTextureLoaded(null):(n.once("load",this._onTextureLoaded,this),n.ensureLoadTexture())):s.setVisible(!1)},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){var t=this._sgNode,i=0!==t.getInsetLeft()||0!==t.getInsetRight()||0!==t.getInsetTop()||0!==t.getInsetBottom();this._applySpriteFrame(null,i),t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:!1});t("../utils/misc").propertyDefine(o,["insetLeft","insetTop","insetRight","insetBottom"],{type:[null,"setRenderingType"]}),cc.Sprite=i.exports=o},{"../utils/misc":223,"./CCRendererUnderSG":86}],93:[function(t,i,s){var n=cc.T({name:"cc.SpriteDistortion",S:t("./CCComponent"),editor:!1,ctor:function(){this._spriteSGNode=null},O:{_distortionOffset:cc.v2(0,0),offset:{get:function(){return this._distortionOffset},set:function(t){this._distortionOffset.x=t.x,this._distortionOffset.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionOffset(this._distortionOffset)}},_distortionTiling:cc.v2(1,1),tiling:{get:function(){return this._distortionTiling},set:function(t){this._distortionTiling.x=t.x,this._distortionTiling.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionTiling(this._distortionTiling)}}},onEnable:function(){var t=this.node.getComponent("cc.Sprite"),i=this._spriteSGNode=t&&t._sgNode;this._spriteSGNode&&(i.setState(cc.Scale9Sprite.state.DISTORTION),i.setDistortionOffset(this._distortionOffset),i.setDistortionTiling(this._distortionTiling))},onDisable:function(){this._spriteSGNode&&this._spriteSGNode.setState(cc.Scale9Sprite.state.NORMAL),this._spriteSGNode=null}});cc.SpriteDistortion=i.exports=n},{"./CCComponent":75}],94:[function(t,i,s){var n=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),h=cc.Enum({VERTICAL:0,HORIZONTAL:1}),r=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),c=cc.T({name:"cc.StudioComponent",S:cc.U,editor:!1,O:!1,statics:{ComponentType:n,ListDirection:h,VerticalAlign:r,HorizontalAlign:e}});cc.StudioComponent=i.exports=c},{}],95:[function(t,i,s){var n=cc.T({name:"cc.Toggle",S:t("./CCButton"),editor:!1,O:{isChecked:{default:!0,tooltip:!1,notify:function(){this._updateCheckMark()}},toggleGroup:{default:null,tooltip:!1,type:cc.ToggleGroup},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.U.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},__preload:function(){this._super()},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.removeToggle(this)},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){this._super(),this.checkMark&&this.checkMark._sgNode.setState(0),this.enableAutoGrayEffect&&this.checkMark&&!this.interactable&&this.checkMark._sgNode.setState(1)},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},toggle:function(t){this.toggleGroup&&this.toggleGroup.enabled&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!this.isChecked,this._updateCheckMark(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.updateToggles(this),this._emitToggleEvents(t))},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.U.EventHandler.emitEvents(this.checkEvents,this)},check:function(){this.toggleGroup&&this.toggleGroup.enabled&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!0,this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.updateToggles(this),this._emitToggleEvents())},uncheck:function(){this.toggleGroup&&this.toggleGroup.enabled&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!1,this._emitToggleEvents())}});cc.Toggle=i.exports=n},{"./CCButton":73}],96:[function(t,i,s){var n=cc.T({name:"cc.ToggleGroup",S:cc.U,ctor:function(){this._toggleItems=[]},editor:!1,O:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(t){this.enabledInHierarchy&&this._toggleItems.forEach(function(i){t.isChecked&&i!==t&&i.isChecked&&i.enabled&&(i.isChecked=!1)})},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){var i=this._toggleItems.indexOf(t);i>-1&&this._toggleItems.splice(i,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var t=!1;return this._toggleItems.forEach(function(i){t&&i.enabled&&(i.isChecked=!1),i.isChecked&&i.enabled&&(t=!0)}),t},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}});cc.ToggleGroup=i.exports=n},{}],97:[function(t,i,s){t("../videoplayer/CCSGVideoPlayer");var n=_ccsg.VideoPlayer.EventType,h=cc.Enum({REMOTE:0,LOCAL:1}),r=cc.T({name:"cc.VideoPlayer",S:cc._RendererUnderSG,editor:!1,O:{_resourceType:h.REMOTE,resourceType:{tooltip:!1,type:h,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{default:null,url:cc.RawAsset},clip:{tooltip:!1,get:function(){return this._clip},set:function(t){"string"!=typeof t&&(t=""),this._clip=t,this._updateVideoSource()},url:cc.RawAsset},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._sgNode&&this._sgNode.seekTo(t)},get:function(){return this._sgNode?this._sgNode.currentTime():-1}},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._sgNode.setKeepAspectRatioEnabled(this.keepAspectRatio)}},isFullscreen:{tooltip:!1,default:!1,type:cc.Boolean,notify:function(){this._sgNode.setFullScreenEnabled(this.isFullscreen)}},videoPlayerEvent:{default:[],type:cc.U.EventHandler}},statics:{EventType:n,ResourceType:h},onLoad:function(){},_createSgNode:function(){return new _ccsg.VideoPlayer},_updateVideoSource:function(){var t=this._sgNode;this.resourceType===h.REMOTE?t.setURL(this.remoteURL):t.setURL(this._clip||"")},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),this._updateVideoSource(),t.seekTo(this.currentTime),t.setKeepAspectRatioEnabled(this.keepAspectRatio),t.setFullScreenEnabled(this.isFullscreen),t.setContentSize(this.node.getContentSize()),this.pause(),t.setEventListener(n.PLAYING,this.onPlaying.bind(this)),t.setEventListener(n.PAUSED,this.onPasued.bind(this)),t.setEventListener(n.STOPPED,this.onStopped.bind(this)),t.setEventListener(n.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(n.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(n.CLICKED,this.onClicked.bind(this)),t.setEventListener(n.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onReadyToPlay:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PLAYING),this.node.emit("playing",this)},onPasued:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PAUSED),this.node.emit("paused",this)},onStopped:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){cc.U.EventHandler.emitEvents(this.videoPlayerEvent,this,n.COMPLETED),this.node.emit("completed",this)},play:function(){this._sgNode&&this._sgNode.play()},resume:function(){this._sgNode&&this._sgNode.resume()},pause:function(){this._sgNode&&this._sgNode.pause()},stop:function(){this._sgNode&&this._sgNode.stop()},getDuration:function(){return this._sgNode?this._sgNode.duration():-1},isPlaying:function(){return!!this._sgNode&&this._sgNode.isPlaying()}});cc.VideoPlayer=i.exports=r},{"../videoplayer/CCSGVideoPlayer":237}],98:[function(t,i,s){var n=cc.T({name:"cc.ViewGroup",S:t("./CCComponent")});cc.ViewGroup=i.exports=n},{"./CCComponent":75}],99:[function(t,i,s){t("../webview/CCSGWebView");var n=_ccsg.WebView.EventType,h=cc.T({name:"cc.WebView",S:cc._RendererUnderSG,editor:!1,O:{_useOriginalSize:!0,_url:"",url:{type:String,tooltip:!1,get:function(){return this._url},set:function(t){this._url=t;var i=this._sgNode;i&&i.loadURL(t)}},webviewEvents:{default:[],type:cc.U.EventHandler}},statics:{EventType:n},onLoad:!1,_createSgNode:function(){return new _ccsg.WebView},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),t.setEventListener(n.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(n.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(n.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setContentSize(this.node.getContentSize()))},_onWebViewLoaded:function(){cc.U.EventHandler.emitEvents(this.webviewEvents,this,n.LOADED),this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.U.EventHandler.emitEvents(this.webviewEvents,this,n.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.U.EventHandler.emitEvents(this.webviewEvents,this,n.ERROR),this.node.emit("error",this)},setJavascriptInterfaceScheme:function(t){this._sgNode&&this._sgNode.setJavascriptInterfaceScheme(t)},setOnJSCallback:function(t){this._sgNode&&this._sgNode.setOnJSCallback(t)}});cc.WebView=i.exports=h},{"../webview/CCSGWebView":238}],100:[function(t,i,s){var n=t("../base-ui/CCWidgetManager"),h=n._AlignFlags,r=h.TOP,e=h.MID,c=h.BOT,o=h.LEFT,u=h.CENTER,a=h.RIGHT,f=r|c,l=o|a,v=cc.T({name:"cc.Widget",S:t("./CCComponent"),editor:!1,O:{target:{get:function(){return this._target},set:function(t){this._target=t},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return(this._alignFlags&r)>0},set:function(t){this._setAlign(r,t)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return(this._alignFlags&e)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=e):this._alignFlags&=~e},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return(this._alignFlags&c)>0},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return(this._alignFlags&o)>0},set:function(t){this._setAlign(o,t)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&u)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=u):this._alignFlags&=~u},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return(this._alignFlags&a)>0},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&l)===l},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&f)===f},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:!1},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:!1},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},isAlignOnce:{default:!0,tooltip:!1,displayName:"AlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){n.add(this)},onDisable:function(){n.remove(this)},_setAlign:function(t,i){if(i!=(this._alignFlags&t)>0){var s=(t&l)>0;i?(this._alignFlags|=t,s?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(s?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t)}},updateAlignment:function(){n.updateAlignment(this.node)}});cc.Widget=i.exports=v},{"../base-ui/CCWidgetManager":58,"./CCComponent":75}],101:[function(t,i,s){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),i.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./CCEditBox"),t("./CCVideoPlayer"),t("./CCWebView"),t("./CCSpriteDistortion"),t("./CCLabelOutline"),t("./CCRichText"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents")]},{"./CCAnimation":70,"./CCAudioSource":71,"./CCBlockInputEvents":72,"./CCButton":73,"./CCCanvas":74,"./CCComponent":75,"./CCComponentEventHandler":76,"./CCEditBox":77,"./CCLabel":78,"./CCLabelOutline":79,"./CCLayout":80,"./CCMask":81,"./CCPageView":82,"./CCPageViewIndicator":83,"./CCProgressBar":84,"./CCRendererInSG":85,"./CCRendererUnderSG":86,"./CCRichText":87,"./CCScrollBar":89,"./CCScrollView":90,"./CCSlider":91,"./CCSprite":92,"./CCSpriteDistortion":93,"./CCToggle":95,"./CCToggleGroup":96,"./CCVideoPlayer":97,"./CCWebView":99,"./CCWidget":100,"./missing-script":102}],102:[function(t,i,s){var n=cc.js,h=t("../utils/misc").isBuiltinClassId,r=cc.T({name:"cc.MissingClass",O:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),e=cc.T({name:"cc.MissingScript",S:cc.U,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},O:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,i){return n._getClassById(t)||(t?(cc.deserialize.reportMissingClass(t),e.getMissingWrapper(t,i)):null)},getMissingWrapper:function(t,i){return i.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||h(t))?e:r}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=i.exports=e},{"../utils/misc":223}],103:[function(t,i,s){function n(t){var i=t.convertToWorldSpace(cc.p(0,0)),s=cc.visibleRect.height,n=.5;cc.visibleRect.width>s&&(n=.7),setTimeout(function(){if(window.scrollY<h&&i.y<s*n){var t=s*n-i.y-window.scrollY;t<35&&(t=35),t>320&&(t=320),window.scrollTo(t,t)}},r)}var h=40,r=400,e=t("../platform/utils"),c=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4}),o=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),u=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});cc.EditBoxDelegate=cc._Class.extend({editBoxEditingDidBegan:function(t){},editBoxEditingDidEnded:function(t){},editBoxTextChanged:function(t,i){},editBoxEditingReturn:function(t){}}),_ccsg.EditBox=_ccsg.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:o.ANY,_editBoxInputFlag:u.DEFAULT,_keyboardReturnType:c.DEFAULT,_maxLength:50,_text:"",_placeholderText:"",_alwaysOnTop:!1,_placeholderFontName:"",_placeholderFontSize:14,__fullscreen:!1,__autoResize:!1,_placeholderColor:null,_className:"EditBox",ctor:function(t,i){_ccsg.Node.prototype.ctor.call(this),this._textColor=cc.Color.WHITE,this._placeholderColor=cc.Color.GRAY,this.initWithSizeAndBackgroundSprite(t,i),this._renderCmd._createLabels()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.EditBox.CanvasRenderCmd(this):new _ccsg.EditBox.WebGLRenderCmd(this)},setContentSize:function(t,i){void 0!==t.width&&void 0!==t.height&&(i=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,i),this._updateEditBoxSize(t,i)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||this._renderCmd._createDomTextArea()},setTabIndex:function(t){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=t)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warnID(4700),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warnID(4700),!1)},stayOnTop:function(t){this._alwaysOnTop!==t&&(this._alwaysOnTop=t,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd.removeDom()},_onTouchBegan:function(t){var i=t.getLocation(),s=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return!!cc.rectContainsPoint(s,this.convertToNodeSpace(i))||(this._renderCmd._endEditing(),!1)},_onTouchEnded:function(){this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(t,i){this._backgroundSprite&&this._backgroundSprite.setContentSize(t,i)},_updateEditBoxSize:function(t,i){var s="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:i;this._updateBackgroundSpriteSize(s,n),this._renderCmd.updateSize(s,n)},setLineHeight:function(t){this._renderCmd.setLineHeight(t)},setFont:function(t,i){this._renderCmd.setFont(t,i)},_setFont:function(t){this._renderCmd._setFont(t)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(t){this._renderCmd.setFontName(t)},setFontSize:function(t){this._renderCmd.setFontSize(t)},setString:function(t){t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._text=t,this._renderCmd.setString(t)},setFontColor:function(t){this._textColor=t,this._renderCmd.setFontColor(t)},setMaxLength:function(t){isNaN(t)||(t<0&&(t=65535),this._maxLength=t,this._renderCmd.setMaxLength(t))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){null!==t&&(this._renderCmd.setPlaceHolder(t),this._placeholderText=t)},setPlaceholderFont:function(t,i){this._placeholderFontName=t,this._placeholderFontSize=i,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(t){var i=cc.LabelTTF._fontStyleRE.exec(t);i&&(this._placeholderFontName=i[2],this._placeholderFontSize=parseInt(i[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._renderCmd.setPlaceholderFontColor(t)},setInputFlag:function(t){this._editBoxInputFlag=t,this._renderCmd.setInputFlag(t)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(t,i){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=i,_ccsg.Node.prototype.setContentSize.call(this,t),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(t.width,t.height)),this.x=0,this.y=0,!0},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){if(this._editBoxInputMode!==t){var i=this.getString();this._editBoxInputMode=t,this._renderCmd.setInputMode(t),this._renderCmd.transform(),this.setString(i),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(t){this._keyboardReturnType=t,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(t,i){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(i)}});var a=_ccsg.EditBox.prototype;cc.defineGetterSetter(a,"font",null,a._setFont),cc.defineGetterSetter(a,"fontName",null,a.setFontName),cc.defineGetterSetter(a,"fontSize",null,a.setFontSize),cc.defineGetterSetter(a,"fontColor",null,a.setFontColor),cc.defineGetterSetter(a,"string",a.getString,a.setString),cc.defineGetterSetter(a,"maxLength",a.getMaxLength,a.setMaxLength),cc.defineGetterSetter(a,"placeholder",a.getPlaceHolder,a.setPlaceHolder),cc.defineGetterSetter(a,"placeholderFont",null,a._setPlaceholderFont),cc.defineGetterSetter(a,"placeholderFontName",null,a.setPlaceholderFontName),cc.defineGetterSetter(a,"placeholderFontSize",null,a.setPlaceholderFontSize),cc.defineGetterSetter(a,"placeholderFontColor",null,a.setPlaceholderFontColor),cc.defineGetterSetter(a,"inputFlag",null,a.setInputFlag),cc.defineGetterSetter(a,"delegate",null,a.setDelegate),cc.defineGetterSetter(a,"inputMode",null,a.setInputMode),cc.defineGetterSetter(a,"returnType",null,a.setReturnType),a=null,_ccsg.EditBox.InputMode=o,_ccsg.EditBox.InputFlag=u,_ccsg.EditBox.KeyboardReturnType=c,function(t){t._polyfill={zoomInvalid:!1},cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0)}(_ccsg.EditBox),function(t){var i=function(){}.prototype=Object.create(Object.prototype);i.updateMatrix=function(){if(this._edTxt){var i=this._node,s=cc.view._scaleX,n=cc.view._scaleY,h=cc.view._devicePixelRatio,r=this._worldTransform;s/=h,n/=h;var e=cc.game.container,c=r.a*s,o=r.b,u=r.c,a=r.d*n,f=e&&e.style.paddingLeft&&parseInt(e.style.paddingLeft),l=e&&e.style.paddingBottom&&parseInt(e.style.paddingBottom),v=r.tx*s+f,d=r.ty*n+l;t.zoomInvalid&&(this.updateSize(i._contentSize.width*c,i._contentSize.height*a),c=1,a=1);var p="matrix("+c+","+-o+","+-u+","+a+","+v+","+-d+")";this._edTxt.style.transform=p,this._edTxt.style["-webkit-transform"]=p,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},i.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},i.stayOnTop=function(t){t?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._showLabels())},i._beginEditingOnMobile=function(t){this.__orientationChanged=function(){n(t)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},i._endEditingOnMobile=function(){if(this.__rotateScreen){cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)";var t=cc.view,i=t._originalDesignResolutionSize.width,s=t._originalDesignResolutionSize.height;i>0&&t.setDesignResolutionSize(i,s,t._resolutionPolicy),this.__rotateScreen=!1}window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},i._onFocusOnMobile=function(t){cc.view._isRotated?(cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",cc.view._isRotated=!1,cc.view.getResolutionPolicy().apply(cc.view,cc.view.getDesignResolutionSize()),cc.view._isRotated=!0,window.scrollTo(35,35),this.__rotateScreen=!0):this.__rotateScreen=!1,n(t)},i._createDomInput=function(){this.removeDom();var t=this,i=this._edTxt=document.createElement("input");return i.type="text",i.style.fontSize=this._edFontSize+"px",i.style.color="#000000",i.style.border=0,i.style.background="transparent",i.style.width="100%",i.style.height="100%",i.style.active=0,i.style.outline="medium",i.style.padding="0",i.style.textTransform="uppercase",i.style.display="none",i.style.position="absolute",i.style.bottom="0px",i.style.left="2px",i.style.className="cocosEditBox",i.addEventListener("input",function(){var i=t._editBox;this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength)),i._delegate&&i._delegate.editBoxTextChanged&&i._text!==this.value&&(i._text=this.value,t._updateDomTextCases(),i._delegate.editBoxTextChanged(i,i._text))}),i.addEventListener("keypress",function(i){var s=t._editBox;i.keyCode===cc.KEY.enter&&(i.stopPropagation(),i.preventDefault(),""===this.value&&(this.style.fontSize=s._placeholderFontSize+"px",this.style.color=cc.colorToHex(s._placeholderColor)),s._text=this.value,t._updateDomTextCases(),t._endEditing(),s._delegate&&s._delegate.editBoxEditingReturn&&s._delegate.editBoxEditingReturn(s),cc._canvas.focus())}),i.addEventListener("focus",function(){var i=t._editBox;this.style.fontSize=t._edFontSize+"px",this.style.color=cc.colorToHex(i._textColor),t._hiddenLabels(),cc.sys.isMobile&&t._onFocusOnMobile(i),i._delegate&&i._delegate.editBoxEditingDidBegan&&i._delegate.editBoxEditingDidBegan(i)}),i.addEventListener("blur",function(){var i=t._editBox;i._text=this.value,t._updateDomTextCases(),i._delegate&&i._delegate.editBoxEditingDidEnded&&i._delegate.editBoxEditingDidEnded(i),""===this.value&&(this.style.fontSize=i._placeholderFontSize+"px",this.style.color=cc.colorToHex(i._placeholderColor)),t._endEditing()}),this._addDomToGameContainer(),i},i._createDomTextArea=function(){this.removeDom();var t=this,i=this._edTxt=document.createElement("textarea");return i.type="text",i.style.fontSize=this._edFontSize+"px",i.style.color="#000000",i.style.border=0,i.style.background="transparent",i.style.width="100%",i.style.height="100%",i.style.active=0,i.style.outline="medium",i.style.padding="0",i.style.resize="none",i.style.textTransform="uppercase",i.style.overflow_y="scroll",i.style.display="none",i.style.position="absolute",i.style.bottom="0px",i.style.left="2px",i.style.className="cocosEditBox",i.addEventListener("input",function(){this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength));var i=t._editBox;i._delegate&&i._delegate.editBoxTextChanged&&i._text.toLowerCase()!==this.value.toLowerCase()&&(i._text=this.value,t._updateDomTextCases(),i._delegate.editBoxTextChanged(i,i._text))}),i.addEventListener("focus",function(){var i=t._editBox;t._hiddenLabels(),this.style.fontSize=t._edFontSize+"px",this.style.color=cc.colorToHex(i._textColor),cc.sys.isMobile&&t._onFocusOnMobile(i),i._delegate&&i._delegate.editBoxEditingDidBegan&&i._delegate.editBoxEditingDidBegan(i)}),i.addEventListener("keypress",function(i){var s=t._editBox;i.keyCode===cc.KEY.enter&&(i.stopPropagation(),s._delegate&&s._delegate.editBoxEditingReturn&&s._delegate.editBoxEditingReturn(s))}),i.addEventListener("blur",function(){var i=t._editBox;i._text=this.value,t._updateDomTextCases(),i._delegate&&i._delegate.editBoxEditingDidEnded&&i._delegate.editBoxEditingDidEnded(i),""===this.value&&(this.style.fontSize=i._placeholderFontSize+"px",this.style.color=cc.colorToHex(i._placeholderColor)),t._endEditing()}),this._addDomToGameContainer(),i},i._createLabels=function(){var t=this._editBox.getContentSize();this._textLabel||(this._textLabel=_ccsg.Label.pool.get(),this._textLabel.setAnchorPoint(cc.p(0,1)),this._textLabel.setOverflow(_ccsg.Label.Overflow.CLAMP),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=_ccsg.Label.pool.get(),this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.Color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(t)},i._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},i._updateLabelPosition=function(t){if(this._textLabel&&this._placeholderLabel){var i=cc.size(t.width-2,t.height);this._textLabel.setContentSize(i),this._placeholderLabel.setLineHeight(t.height);var s=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===o.ANY?(this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,t.height),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.enableWrapText(!0)):(this._textLabel.enableWrapText(!1),this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,(t.height+s.height)/2),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER))}},i.setLineHeight=function(t){this._textLabel&&this._textLabel.setLineHeight(t)},i._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},i._updateDomTextCases=function(){var t=this._editBox._editBoxInputFlag;t===u.INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():t===u.INITIAL_CAPS_WORD?this._editBox._text=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})}(this._editBox._text):t===u.INITIAL_CAPS_SENTENCE&&(this._editBox._text=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(this._editBox._text))},i._updateLabelStringStyle=function(){if("password"===this._edTxt.type){for(var t="",i=this._editBox._text.length,s=0;s<i;++s)t+="●";this._textLabel&&this._textLabel.setString(t)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},i._showLabels=function(){this._hiddenLabels(),""===this._edTxt.value?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},i._beginEditing=function(){this._editBox._alwaysOnTop||"none"===this._edTxt.style.display&&(this._edTxt.style.display="",cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?setTimeout(function(){this._edTxt.focus()}.bind(this),r):this._edTxt.focus()),cc.sys.isMobile&&!this._editingMode&&this._beginEditingOnMobile(this._editBox),this._editingMode=!0},i._endEditing=function(){if(this._editBox._alwaysOnTop||(this._edTxt.style.display="none"),this._showLabels(),cc.sys.isMobile&&this._editingMode){var t=this;setTimeout(function(){t._endEditingOnMobile()},r)}this._editingMode=!1},i._setFont=function(t){var i=cc.LabelTTF._fontStyleRE.exec(t),s=i[2],n=parseInt(i[1]);i&&this.setFont(s,n)},i.setFont=function(t,i){this._edFontName=t||this._edFontName,this._edFontSize=i||this._edFontSize,this._updateDOMFontStyle()},i.setFontName=function(t){this._edFontName=t||this._edFontName,this._updateDOMFontStyle()},i.setFontSize=function(t){this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},i.setFontColor=function(t){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(t)),this._textLabel&&this._textLabel.setColor(t))},i.setPlaceHolder=function(t){this._placeholderLabel.setString(t)},i.setMaxLength=function(t){this._edTxt&&(this._edTxt.maxLength=t)},i._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontFamily(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},i.setPlaceholderFontColor=function(t){this._placeholderLabel.setColor(t)},i._updateDomInputType=function(){var t=this._editBox._editBoxInputMode;t===o.EMAIL_ADDR?this._edTxt.type="email":t===o.NUMERIC||t===o.DECIMAL?this._edTxt.type="number":t===o.PHONE_NUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):t===o.URL?this._edTxt.type="url":(this._edTxt.type="text",this._editBox._keyboardReturnType===c.SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===u.PASSWORD&&(this._edTxt.type="password")},i.setInputFlag=function(t){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",t===u.INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":t===u.INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},i.setInputMode=function(t){t===o.ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();var i=this._node.getContentSize();this.updateSize(i.width,i.height)},i.setString=function(t){this._edTxt&&null!==t&&(this._edTxt.value=t,""===t?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},i._updateDOMFontStyle=function(){this._edTxt&&(""!==this._edTxt.value&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontFamily(this._edFontName)))},i.updateSize=function(t,i){var s=this._edTxt;s&&(s.style.width=t+"px",s.style.height=i+"px",this._updateLabelPosition(cc.size(t,i)))},i._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},i.removeDom=function(){var t=this._edTxt;t&&e.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._edTxt=null},i.initializeRenderCmd=function(t){this._editBox=t,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},_ccsg.EditBox.CanvasRenderCmd=function(t){this._rootCtor(t),this.initializeRenderCmd(t)};var s=_ccsg.EditBox.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(s,i),s.constructor=_ccsg.EditBox.CanvasRenderCmd,s.transform=function(t,i){this.originTransform(t,i),this.updateMatrix()},_ccsg.EditBox.WebGLRenderCmd=function(t){this._rootCtor(t),this.initializeRenderCmd(t)};var h=_ccsg.EditBox.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(h,i),h.constructor=_ccsg.EditBox.WebGLRenderCmd,h.transform=function(t,i){this.originTransform(t,i),this.updateMatrix()}}(_ccsg.EditBox._polyfill)},{"../platform/utils":197}],104:[function(t,i,s){var n=cc.js;t("../event/event");var h=function(t,i){cc.Event.call(this,cc.Event.MOUSE,i),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};n.extend(h,cc.Event);var r=h.prototype;r.setScrollData=function(t,i){this._scrollX=t,this._scrollY=i},r.getScrollX=function(){return this._scrollX},r.getScrollY=function(){return this._scrollY},r.setLocation=function(t,i){this._x=t,this._y=i},r.getLocation=function(){return{x:this._x,y:this._y}},r.getLocationInView=function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},r._setPrevCursor=function(t,i){this._prevX=t,this._prevY=i},r.getPreviousLocation=function(){return{x:this._prevX,y:this._prevY}},r.getDelta=function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},r.getDeltaX=function(){return this._x-this._prevX},r.getDeltaY=function(){return this._y-this._prevY},r.setButton=function(t){this._button=t},r.getButton=function(){return this._button},r.getLocationX=function(){return this._x},r.getLocationY=function(){return this._y},h.NONE=0,h.DOWN=1,h.UP=2,h.MOVE=3,h.SCROLL=4,h.BUTTON_LEFT=0,h.BUTTON_RIGHT=2,h.BUTTON_MIDDLE=1,h.BUTTON_4=3,h.BUTTON_5=4,h.BUTTON_6=5,h.BUTTON_7=6,h.BUTTON_8=7;var e=function(t,i){cc.Event.call(this,cc.Event.TOUCH,i),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null};n.extend(e,cc.Event),(r=e.prototype).getEventCode=function(){return this._eventCode},r.getTouches=function(){return this._touches},r._setEventCode=function(t){this._eventCode=t},r._setTouches=function(t){this._touches=t},r.setLocation=function(t,i){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,i)},r.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},r.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},r.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},r.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},r.getID=function(){return this.touch?this.touch.getID():null},r.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},r.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},r.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},r.getLocationX=function(){return this.touch?this.touch.getLocationX():0},r.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e.MAX_TOUCHES=5,e.BEGAN=0,e.MOVED=1,e.ENDED=2,e.CANCELED=3;var c=function(t,i){cc.Event.call(this,cc.Event.ACCELERATION,i),this.acc=t};n.extend(c,cc.Event);var o=function(t,i,s){cc.Event.call(this,cc.Event.KEYBOARD,s),this.keyCode=t,this.isPressed=i};n.extend(o,cc.Event),cc.Event.EventMouse=h,cc.Event.EventTouch=e,cc.Event.EventAcceleration=c,cc.Event.EventKeyboard=o,i.exports=cc.Event},{"../event/event":112}],105:[function(t,i,s){cc.EventListener=cc._Class.extend({ctor:function(t,i,s){this._onEvent=s,this._type=t||0,this._listenerID=i||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,i){this._onCustomEvent=i,cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,this._callback)},_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(t){var i=cc.Event.EventMouse;switch(t._eventType){case i.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case i.UP:this.onMouseUp&&this.onMouseUp(t);break;case i.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case i.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var i=t.event;delete t.event;var s=null;i===cc.EventListener.TOUCH_ONE_BY_ONE?s=new cc._EventListenerTouchOneByOne:i===cc.EventListener.TOUCH_ALL_AT_ONCE?s=new cc._EventListenerTouchAllAtOnce:i===cc.EventListener.MOUSE?s=new cc._EventListenerMouse:i===cc.EventListener.CUSTOM?(s=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):i===cc.EventListener.KEYBOARD?s=new cc._EventListenerKeyboard:i===cc.EventListener.ACCELERATION&&(s=new cc._EventListenerAcceleration(t.callback),delete t.callback);for(var n in t)s[n]=t[n];return s},cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t,cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,this._callback)},_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,this._callback)},_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],106:[function(t,i,s){var n=cc._Class.extend({ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t.getChildren)for(var i=t.getChildren(),s=0,n=i?i.length:0;s<n;s++)this._setDirtyForNode(i[s])},pauseTarget:function(t,i){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var s,n,h=this._nodeListenersMap[t.__instanceId];if(h)for(s=0,n=h.length;s<n;s++)h[s]._setPaused(!0);if(!0===i){var r=t.getChildren();for(s=0,n=r?r.length:0;s<n;s++)this.pauseTarget(r[s],!0)}}else cc.warnID(3506)},resumeTarget:function(t,i){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var s,n,h=this._nodeListenersMap[t.__instanceId];if(h)for(s=0,n=h.length;s<n;s++)h[s]._setPaused(!1);if(this._setDirtyForNode(t),!0===i&&t.getChildren){var r=t.getChildren();for(s=0,n=r?r.length:0;s<n;s++)this.resumeTarget(r[s],!0)}}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var i=t._getListenerID(),s=this._listenersMap[i];if(s||(s=new n,this._listenersMap[i]=s),s.push(t),0===t._getFixedPriority()){this._setDirty(i,this.DIRTY_SCENE_GRAPH_PRIORITY);var h=t._getSceneGraphPriority();null===h&&cc.logID(3507),this._associateNodeAndEventListener(h,t),h.isRunning()&&this.resumeTarget(h)}else this._setDirty(i,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,i,s=this._dirtyNodes,n=this._nodeListenersMap,h=0,r=s.length;h<r;h++)if(t=n[s[h].__instanceId])for(var e=0,c=t.length;e<c;e++)(i=t[e])&&this._setDirty(i._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var i,s=0;s<t.length;)(i=t[s])._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,i):++s},_removeListenersForListenerID:function(t){var i,s=this._listenersMap[t];if(s){var n=s.getFixedPriorityListeners(),h=s.getSceneGraphPriorityListeners();this._removeAllListenersInVector(h),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(s.clear(),delete this._listenersMap[t])}var r,e=this._toAddedListeners;for(i=0;i<e.length;)(r=e[i])&&r._getListenerID()===t?cc.js.array.remove(e,r):++i},_sortEventListeners:function(t){var i=this.DIRTY_NONE,s=this._priorityDirtyFlagMap;if(s[t]&&(i=s[t]),i!==this.DIRTY_NONE&&(s[t]=this.DIRTY_NONE,i&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),i&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=cc.director.getScene();n&&this._sortListenersOfSceneGraphPriority(t,n)}},_sortListenersOfSceneGraphPriority:function(t,i){var s=this._getListeners(t);if(s){var n=s.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(i,!0),s.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,i){var s=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),h=i._getSceneGraphPriority();return i&&h&&s[h.__instanceId]?t&&n&&s[n.__instanceId]?s[h.__instanceId]-s[n.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var i=this._listenersMap[t];if(i){var s=i.getFixedPriorityListeners();if(s&&0!==s.length){s.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,h=s.length;n<h&&!(s[n]._getFixedPriority()>=0);)++n;i.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,i){return t._getFixedPriority()-i._getFixedPriority()},_onUpdateListeners:function(t){var i,s,n,h=t.getFixedPriorityListeners(),r=t.getSceneGraphPriorityListeners(),e=this._toRemovedListeners;if(r)for(i=0;i<r.length;)(s=r[i])._isRegistered()?++i:(cc.js.array.remove(r,s),-1!==(n=e.indexOf(s))&&e.splice(n,1));if(h)for(i=0;i<h.length;)(s=h[i])._isRegistered()?++i:(cc.js.array.remove(h,s),-1!==(n=e.indexOf(s))&&e.splice(n,1));r&&0===r.length&&t.clearSceneGraphListeners(),h&&0===h.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,i=this._priorityDirtyFlagMap;for(var s in t)t[s].empty()&&(delete i[s],delete t[s]);var n=this._toAddedListeners;if(0!==n.length){for(var h=0,r=n.length;h<r;h++)this._forceAddEventListener(n[h]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var i=this._inDispatch;if(cc.assertID(i>0,3508),!(i>1)){var s;(s=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(s),(s=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(s),cc.assertID(1===i,3509);var n=this._toAddedListeners;if(0!==n.length){for(var h=0,r=n.length;h<r;h++)this._forceAddEventListener(n[h]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,i=0;i<t.length;i++){var s=t[i],n=this._listenersMap[s._getListenerID()];if(n){var h,r=n.getFixedPriorityListeners(),e=n.getSceneGraphPriorityListeners();e&&-1!==(h=e.indexOf(s))&&e.splice(h,1),r&&-1!==(h=r.indexOf(s))&&r.splice(h,1)}}t.length=0},_onTouchEventCallback:function(t,i){if(!t._isRegistered)return!1;var s=i.event,n=s.currentTouch;s.currentTarget=t._node;var h,r=!1,e=s.getEventCode(),c=cc.Event.EventTouch;return e===c.BEGAN?t.onTouchBegan&&(r=t.onTouchBegan(n,s))&&t._registered&&t._claimedTouches.push(n):t._claimedTouches.length>0&&-1!==(h=t._claimedTouches.indexOf(n))&&(r=!0,e===c.MOVED&&t.onTouchMoved?t.onTouchMoved(n,s):e===c.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,s),t._registered&&t._claimedTouches.splice(h,1)):e===c.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,s),t._registered&&t._claimedTouches.splice(h,1))),s.isStopped()?(cc.eventManager._updateTouchListeners(s),!0):!!(r&&t._registered&&t.swallowTouches)&&(i.needsMutableSet&&i.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var i=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),s=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==i||null!==s){var n=t.getTouches(),h=cc.js.array.copy(n),r={event:t,needsMutableSet:i&&s,touches:h,selTouch:null};if(i)for(var e=0;e<n.length;e++)if(t.currentTouch=n[e],this._dispatchEventToListeners(i,this._onTouchEventCallback,r),t.isStopped())return;s&&h.length>0&&(this._dispatchEventToListeners(s,this._onTouchesEventCallback,{event:t,touches:h}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,i){if(!t._registered)return!1;var s=cc.Event.EventTouch,n=i.event,h=i.touches,r=n.getEventCode();return n.currentTarget=t._node,r===s.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(h,n):r===s.MOVED&&t.onTouchesMoved?t.onTouchesMoved(h,n):r===s.ENDED&&t.onTouchesEnded?t.onTouchesEnded(h,n):r===s.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(h,n),!!n.isStopped()&&(cc.eventManager._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,i){var s=this._nodeListenersMap[t.__instanceId];s||(s=[],this._nodeListenersMap[t.__instanceId]=s),s.push(i)},_dissociateNodeAndEventListener:function(t,i){var s=this._nodeListenersMap[t.__instanceId];s&&(cc.js.array.remove(s,i),0===s.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,i,s){var n,h,r=!1,e=t.getFixedPriorityListeners(),c=t.getSceneGraphPriorityListeners(),o=0;if(e&&0!==e.length)for(;o<t.gt0Index;++o)if((h=e[o]).isEnabled()&&!h._isPaused()&&h._isRegistered()&&i(h,s)){r=!0;break}if(c&&!r)for(n=0;n<c.length;n++)if((h=c[n]).isEnabled()&&!h._isPaused()&&h._isRegistered()&&i(h,s)){r=!0;break}if(e&&!r)for(;o<e.length;++o)if((h=e[o]).isEnabled()&&!h._isPaused()&&h._isRegistered()&&i(h,s)){r=!0;break}},_setDirty:function(t,i){var s=this._priorityDirtyFlagMap;null==s[t]?s[t]=i:s[t]=i|s[t]},_visitTarget:function(t,i){t._reorderChildDirty&&t.sortAllChildren();var s=t.getChildren(),n=0,h=s.length,r=this._globalZOrderNodeMap,e=this._nodeListenersMap;if(h>0){for(var c;n<h&&(c=s[n])&&c.getLocalZOrder()<0;n++)this._visitTarget(c,!1);for(void 0!==e[t.__instanceId]&&(r[t.getGlobalZOrder()]||(r[t.getGlobalZOrder()]=[]),r[t.getGlobalZOrder()].push(t.__instanceId));n<h;n++)(c=s[n])&&this._visitTarget(c,!1)}else void 0!==e[t.__instanceId]&&(r[t.getGlobalZOrder()]||(r[t.getGlobalZOrder()]=[]),r[t.getGlobalZOrder()].push(t.__instanceId));if(i){var o=[];for(var u in r)o.push(u);o.sort(this._sortNumberAsc);var a,f,l=o.length,v=this._nodePriorityMap;for(n=0;n<l;n++)for(a=r[o[n]],f=0;f<a.length;f++)v[a[f]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,i){return t-i},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,i){if(cc.assertID(t&&i,3503),cc.js.isNumber(i)||i instanceof cc._BaseNode||i instanceof _ccsg.Node){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(i),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(i)){if(0===i)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(i),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(i),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,i){var s=new cc._EventListenerCustom(t,i);return this.addListener(s,1),s},removeListener:function(t){if(null!=t){var i,s=this._listenersMap;for(var n in s){var h=s[n],r=h.getFixedPriorityListeners(),e=h.getSceneGraphPriorityListeners();if((i=this._removeListenerInVector(e,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(i=this._removeListenerInVector(r,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),h.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete s[n]),i)break}if(!i)for(var c=this._toAddedListeners,o=0,u=c.length;o<u;o++){var a=c[o];if(a===t){cc.js.array.remove(c,a),a._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,i){if(null==t)return!1;for(var s=0,n=t.length;s<n;s++){var h=t[s];if(h._onCustomEvent===i||h._onEvent===i)return h._setRegistered(!1),null!=h._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(h._getSceneGraphPriority(),h),h._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,h):this._toRemovedListeners.push(h),!0}return!1},_removeListenerInVector:function(t,i){if(null==t)return!1;for(var s=0,n=t.length;s<n;s++){var h=t[s];if(h===i)return h._setRegistered(!1),null!=h._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(h._getSceneGraphPriority(),h),h._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,h):this._toRemovedListeners.push(h),!0}return!1},removeListeners:function(t,i){if(cc.js.isNumber(t)||t instanceof cc._BaseNode||t instanceof _ccsg.Node)if(void 0!==t.__instanceId){delete this._nodePriorityMap[t.__instanceId],cc.js.array.remove(this._dirtyNodes,t);var s,n=this._nodeListenersMap[t.__instanceId];if(n){var h=cc.js.array.copy(n);for(s=0;s<h.length;s++)this.removeListener(h[s]);delete this._nodeListenersMap[t.__instanceId]}var r=this._toAddedListeners;for(s=0;s<r.length;){var e=r[s];e._getSceneGraphPriority()===t?(e._setSceneGraphPriority(null),e._setRegistered(!1),r.splice(s,1)):++s}if(!0===i){var c,o=t.getChildren();for(s=0,c=o.length;s<c;s++)this.removeListeners(o[s],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,i=this._internalCustomListenerIDs;for(var s in t)-1===i.indexOf(s)&&this._removeListenersForListenerID(s)},setPriority:function(t,i){if(null!=t){var s=this._listenersMap;for(var n in s){var h=s[n].getFixedPriorityListeners();if(h&&-1!==h.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==i&&(t._setFixedPriority(i),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var i=function(t){var i=cc.Event,s=t.type;return s===i.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:s===i.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:s.startsWith(i.MOUSE)?cc._EventListenerMouse.LISTENER_ID:(s.startsWith(i.TOUCH)&&cc.logID(2e3),"")}(t);this._sortEventListeners(i);var s=this._listenersMap[i];null!=s&&(this._dispatchEventToListeners(s,this._onListenerCallback,t),this._onUpdateListeners(s)),this._inDispatch--}},_onListenerCallback:function(t,i){return i.currentTarget=t._target,t._onEvent(i),i.isStopped()},dispatchCustomEvent:function(t,i){var s=new cc.Event.EventCustom(t);s.setUserData(i),this.dispatchEvent(s)}}},{}],107:[function(t,i,s){var n=t("../event/event-target"),h=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),r=null,e=null,c=0,o=cc.T({name:"SystemEvent",S:n,statics:{EventType:h},on:function(t,i,s,n){if(this._super(t,i,s,n),(t===h.KEY_DOWN||t===h.KEY_UP)&&(r||(r=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,i){i.type=h.KEY_DOWN,cc.systemEvent.dispatchEvent(i)},onKeyReleased:function(t,i){i.type=h.KEY_UP,cc.systemEvent.dispatchEvent(i)}})),!cc.eventManager.hasEventListener(cc._EventListenerKeyboard.LISTENER_ID))){var o=cc.director.getTotalFrames();o!==c&&(cc.eventManager.addListener(r,1),c=o)}t===h.DEVICEMOTION&&(e||(e=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,i){i.type=h.DEVICEMOTION,cc.systemEvent.dispatchEvent(i)}})),cc.eventManager.hasEventListener(cc._EventListenerAcceleration.LISTENER_ID)||cc.eventManager.addListener(e,1))},off:function(t,i,s,n){if(this._super(t,i,s,n),r&&(t===h.KEY_DOWN||t===h.KEY_UP)){var c=this.hasEventListener(h.KEY_DOWN),o=this.hasEventListener(h.KEY_UP);c||o||cc.eventManager.removeListener(r)}e&&t===h.DEVICEMOTION&&cc.eventManager.removeListener(e)}});cc.SystemEvent=i.exports=o,cc.systemEvent=new cc.SystemEvent},{"../event/event-target":111}],108:[function(t,i,s){cc.Touch=cc._Class.extend({ctor:function(t,i,s){this._lastModified=0,this.setTouchInfo(s,t,i)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,i,s){this._prevPoint=this._point,this._point=cc.p(i||0,s||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,i){void 0===i?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=i)},_setPrevPoint:function(t,i){this._prevPoint=void 0===i?cc.p(t.x,t.y):cc.p(t||0,i||0)}})},{}],109:[function(t,i,s){t("./CCTouch"),t("./CCEventListener"),t("./CCEventManager"),t("./CCEvent"),t("./CCSystemEvent")},{"./CCEvent":104,"./CCEventListener":105,"./CCEventManager":106,"./CCSystemEvent":107,"./CCTouch":108}],110:[function(t,i,s){function n(){r.call(this)}var h=cc.js,r=t("../platform/callbacks-invoker").CallbacksHandler,e=r.REMOVE_PLACEHOLDER;h.extend(n,r),n.prototype.invoke=function(t,i){var s,n,h,r,c=t.type,o=this._callbackTable[c];if(this._invoking[c]=!0,o)if(1===o.length)(h=o[0])!==e&&h.call(t.currentTarget,t,i);else for(n=o.length-1,s=0;s<=n;){var u=1;if((h=o[s])!==e&&((r=o[s+1])&&"object"==typeof r?(h.call(r,t,i),u=2):h.call(t.currentTarget,t,i),t._propagationImmediateStopped||s+u>n))break;s+=u}this._invoking[c]=!1,this._clearToRemove(c)},i.exports=n},{"../platform/callbacks-invoker":186}],111:[function(t,i,s){function n(){this._capturingListeners=null,this._bubblingListeners=null}var h=t("./event-listeners");t("./event");var r=cc.js.array.fastRemove,e=new Array(16);e.length=0;var c=n.prototype;c.hasEventListener=function(t,i){return!!(i&&this._capturingListeners&&this._capturingListeners.has(t))||!(i||!this._bubblingListeners||!this._bubblingListeners.has(t))},c.on=function(t,i,s,n){if("boolean"==typeof s?(n=s,s=void 0):n=!!n,i){var r=null;return(r=n?this._capturingListeners=this._capturingListeners||new h:this._bubblingListeners=this._bubblingListeners||new h).has(t,i,s)||(r.add(t,i,s),s&&s.__eventTargets&&s.__eventTargets.push(this)),i}cc.errorID(6800)},c.off=function(t,i,s,n){if("boolean"==typeof s?(n=s,s=void 0):n=!!n,i){var h=n?this._capturingListeners:this._bubblingListeners;h&&(h.remove(t,i,s),s&&s.__eventTargets&&r(s.__eventTargets,this))}else this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},c.targetOff=function(t){this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},c.once=function(t,i,s,n){var h=this,r=function(e){h.off(t,r,s,n),i.call(this,e)};this.on(t,r,s,n)},c.dispatchEvent=function(t){(function(t,i){var s,n;for(i.target=t,e.length=0,t._getCapturingTargets(i.type,e),i.eventPhase=1,n=e.length-1;n>=0;--n)if((s=e[n])._isTargetActive(i.type)&&s._capturingListeners&&(i.currentTarget=s,s._capturingListeners.invoke(i,e),i._propagationStopped))return void(e.length=0);if(e.length=0,t._isTargetActive(i.type)&&(i.eventPhase=2,i.currentTarget=t,t._capturingListeners&&t._capturingListeners.invoke(i),!i._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.invoke(i)),!i._propagationStopped&&i.bubbles)for(t._getBubblingTargets(i.type,e),i.eventPhase=3,n=0;n<e.length;++n)if((s=e[n])._isTargetActive(i.type)&&s._bubblingListeners&&(i.currentTarget=s,s._bubblingListeners.invoke(i),i._propagationStopped))return void(e.length=0);e.length=0})(this,t),e.length=0},c.emit=function(t,i){var s=this._capturingListeners&&this._capturingListeners._callbackTable[t],n=this._bubblingListeners&&this._bubblingListeners._callbackTable[t];if(s&&0!==s.length||n&&0!==n.length){var h=cc.Event.EventCustom.get(t);h.detail=i,h.eventPhase=2,h.target=h.currentTarget=this,s&&this._capturingListeners.invoke(h),n&&!h._propagationImmediateStopped&&this._bubblingListeners.invoke(h),cc.Event.EventCustom.put(h)}},c._isTargetActive=function(t){return!0},c._getCapturingTargets=function(t,i){},c._getBubblingTargets=function(t,i){},n.prototype._EventTargetOn=n.prototype.on,n.prototype._EventTargetOnce=n.prototype.once,n.prototype._EventTargetOff=n.prototype.off,n.prototype._EventTargetTargetOff=n.prototype.targetOff,cc.EventTarget=i.exports=n},{"./event":112,"./event-listeners":110}],112:[function(t,i,s){var n=t("../platform/js");cc.Event=function(t,i){this.type=t,this.bubbles=!!i,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,i){this.type=t,this.bubbles=i||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var h=function(t,i){cc.Event.call(this,t,i),this.detail=null};n.extend(h,cc.Event),h.prototype.reset=h,h.prototype.setUserData=function(t){this.detail=t},h.prototype.getUserData=function(){return this.detail},h.prototype.getEventName=cc.Event.prototype.getType;var r=new n.Pool(10);h.put=function(t){r.put(t)},h.get=function(t,i){var s=r._get();return s?s.reset(t,i):s=new h(t,i),s},cc.Event.EventCustom=h,i.exports=cc.Event},{"../platform/js":192}],113:[function(t,i,s){t("./event"),t("./event-listeners"),t("./event-target")},{"./event":112,"./event-listeners":110,"./event-target":111}],114:[function(t,i,s){"use strict";function n(t,i,s){s=s||2;var n=i&&i.length,o=n?i[0]*s:t.length,a=h(t,0,o,s,!0),f=[];if(!a)return f;var l,p,g,m,w,_,C;if(n&&(a=function(t,i,s,n){var e,o,a,f=[];for(e=0,o=i.length;e<o;e++)(a=h(t,i[e]*n,e<o-1?i[e+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),f.push(function(t){var i=t,s=t;do{i.x<s.x&&(s=i),i=i.next}while(i!==t);return s}(a));for(f.sort(c),e=0;e<f.length;e++)(function(t,i){if(i=function(t,i){var s,n=i,h=t.x,r=t.y,e=-1/0;do{if(r<=n.y&&r>=n.next.y){var c=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(c<=h&&c>e){if(e=c,c===h){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==i);if(!s)return null;if(h===e)return s.prev;var o,a=s,f=s.x,l=s.y,d=1/0;for(n=s.next;n!==a;)h>=n.x&&n.x>=f&&u(r<l?h:e,r,f,l,r<l?e:h,r,n.x,n.y)&&((o=Math.abs(r-n.y)/(h-n.x))<d||o===d&&n.x>s.x)&&v(n,t)&&(s=n,d=o),n=n.next;return s}(t,i)){var s=d(i,t);r(s,s.next)}})(f[e],s),s=r(s,s.next);return s}(t,i,a,s)),t.length>80*s){l=g=t[0],p=m=t[1];for(var b=s;b<o;b+=s)w=t[b],_=t[b+1],w<l&&(l=w),_<p&&(p=_),w>g&&(g=w),_>m&&(m=_);C=Math.max(g-l,m-p)}return e(a,f,s,l,p,C),f}function h(t,i,s,n,h){var r,e;if(h===w(t,i,s,n)>0)for(r=i;r<s;r+=n)e=p(r,t[r],t[r+1],e);else for(r=s-n;r>=i;r-=n)e=p(r,t[r],t[r+1],e);return e&&f(e,e.next)&&(g(e),e=e.next),e}function r(t,i){if(!t)return t;i||(i=t);var s,n=t;do{if(s=!1,n.steiner||!f(n,n.next)&&0!==a(n.prev,n,n.next))n=n.next;else{if(g(n),(n=i=n.prev)===n.next)return null;s=!0}}while(s||n!==i);return i}function e(t,i,s,n,h,c,p){if(t){!p&&c&&function(t,i,s,n){var h=t;do{null===h.z&&(h.z=o(h.x,h.y,i,s,n)),h.prevZ=h.prev,h.nextZ=h.next,h=h.next}while(h!==t);h.prevZ.nextZ=null,h.prevZ=null,function(t){var i,s,n,h,r,e,c,o,u=1;do{for(s=t,t=null,r=null,e=0;s;){for(e++,n=s,c=0,i=0;i<u&&(c++,n=n.nextZ);i++);for(o=u;c>0||o>0&&n;)0===c?(h=n,n=n.nextZ,o--):0!==o&&n?s.z<=n.z?(h=s,s=s.nextZ,c--):(h=n,n=n.nextZ,o--):(h=s,s=s.nextZ,c--),r?r.nextZ=h:t=h,h.prevZ=r,r=h;s=n}r.nextZ=null,u*=2}while(e>1)}(h)}(t,n,h,c);for(var m,w,_=t;t.prev!==t.next;)if(m=t.prev,w=t.next,c?function(t,i,s,n){var h=t.prev,r=t,e=t.next;if(a(h,r,e)>=0)return!1;for(var c=h.x<r.x?h.x<e.x?h.x:e.x:r.x<e.x?r.x:e.x,f=h.y<r.y?h.y<e.y?h.y:e.y:r.y<e.y?r.y:e.y,l=h.x>r.x?h.x>e.x?h.x:e.x:r.x>e.x?r.x:e.x,v=h.y>r.y?h.y>e.y?h.y:e.y:r.y>e.y?r.y:e.y,d=o(c,f,i,s,n),p=o(l,v,i,s,n),g=t.nextZ;g&&g.z<=p;){if(g!==t.prev&&g!==t.next&&u(h.x,h.y,r.x,r.y,e.x,e.y,g.x,g.y)&&a(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(g=t.prevZ;g&&g.z>=d;){if(g!==t.prev&&g!==t.next&&u(h.x,h.y,r.x,r.y,e.x,e.y,g.x,g.y)&&a(g.prev,g,g.next)>=0)return!1;g=g.prevZ}return!0}(t,n,h,c):function(t){var i=t.prev,s=t,n=t.next;if(a(i,s,n)>=0)return!1;for(var h=t.next.next;h!==t.prev;){if(u(i.x,i.y,s.x,s.y,n.x,n.y,h.x,h.y)&&a(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}(t))i.push(m.i/s),i.push(t.i/s),i.push(w.i/s),g(t),t=w.next,_=w.next;else if((t=w)===_){p?1===p?e(t=function(t,i,s){var n=t;do{var h=n.prev,r=n.next.next;!f(h,r)&&l(h,n,n.next,r)&&v(h,r)&&v(r,h)&&(i.push(h.i/s),i.push(n.i/s),i.push(r.i/s),g(n),g(n.next),n=t=r),n=n.next}while(n!==t);return n}(t,i,s),i,s,n,h,c,2):2===p&&function(t,i,s,n,h,c){var o=t;do{for(var u=o.next.next;u!==o.prev;){if(o.i!==u.i&&function(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==i.i&&s.next.i!==i.i&&l(s,s.next,t,i))return!0;s=s.next}while(s!==t);return!1}(t,i)&&v(t,i)&&v(i,t)&&function(t,i){var s=t,n=!1,h=(t.x+i.x)/2,r=(t.y+i.y)/2;do{s.y>r!=s.next.y>r&&h<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(n=!n),s=s.next}while(s!==t);return n}(t,i)}(o,u)){var a=d(o,u);return o=r(o,o.next),a=r(a,a.next),e(o,i,s,n,h,c),void e(a,i,s,n,h,c)}u=u.next}o=o.next}while(o!==t)}(t,i,s,n,h,c):e(r(t),i,s,n,h,c,1);break}}}function c(t,i){return t.x-i.x}function o(t,i,s,n,h){return t=32767*(t-s)/h,i=32767*(i-n)/h,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),i=16711935&(i|i<<8),i=252645135&(i|i<<4),i=858993459&(i|i<<2),i=1431655765&(i|i<<1),t|i<<1}function u(t,i,s,n,h,r,e,c){return(h-e)*(i-c)-(t-e)*(r-c)>=0&&(t-e)*(n-c)-(s-e)*(i-c)>=0&&(s-e)*(r-c)-(h-e)*(n-c)>=0}function a(t,i,s){return(i.y-t.y)*(s.x-i.x)-(i.x-t.x)*(s.y-i.y)}function f(t,i){return t.x===i.x&&t.y===i.y}function l(t,i,s,n){return!!(f(t,i)&&f(s,n)||f(t,n)&&f(s,i))||a(t,i,s)>0!=a(t,i,n)>0&&a(s,n,t)>0!=a(s,n,i)>0}function v(t,i){return a(t.prev,t,t.next)<0?a(t,i,t.next)>=0&&a(t,t.prev,i)>=0:a(t,i,t.prev)<0||a(t,t.next,i)<0}function d(t,i){var s=new m(t.i,t.x,t.y),n=new m(i.i,i.x,i.y),h=t.next,r=i.prev;return t.next=i,i.prev=t,s.next=h,h.prev=s,n.next=s,s.prev=n,r.next=n,n.prev=r,n}function p(t,i,s,n){var h=new m(t,i,s);return n?(h.next=n.next,h.prev=n,n.next.prev=h,n.next=h):(h.prev=h,h.next=h),h}function g(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function m(t,i,s){this.i=t,this.x=i,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function w(t,i,s,n){for(var h=0,r=i,e=s-n;r<s;r+=n)h+=(t[e]-t[r])*(t[r+1]+t[e+1]),e=r;return h}i.exports=n,n.deviation=function(t,i,s,n){var h=i&&i.length,r=h?i[0]*s:t.length,e=Math.abs(w(t,0,r,s));if(h)for(var c=0,o=i.length;c<o;c++){var u=i[c]*s,a=c<o-1?i[c+1]*s:t.length;e-=Math.abs(w(t,u,a,s))}var f=0;for(c=0;c<n.length;c+=3){var l=n[c]*s,v=n[c+1]*s,d=n[c+2]*s;f+=Math.abs((t[l]-t[d])*(t[v+1]-t[l+1])-(t[l]-t[v])*(t[d+1]-t[l+1]))}return 0===e&&0===f?0:Math.abs((f-e)/e)},n.flatten=function(t){for(var i=t[0][0].length,s={vertices:[],holes:[],dimensions:i},n=0,h=0;h<t.length;h++){for(var r=0;r<t[h].length;r++)for(var e=0;e<i;e++)s.vertices.push(t[h][r][e]);h>0&&(n+=t[h-1].length,s.holes.push(n))}return s}},{}],115:[function(t,i,s){cc.js;var n=t("./types").LineCap,h=t("./types").LineJoin,r=t("./helper"),e=function(t){this._rootCtor(t),this._needDraw=!0,this.cmds=[],this.style={strokeStyle:"black",fillStyle:"white",lineCap:"butt",lineJoin:"miter",miterLimit:10}},c=e.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);c.constructor=e,c._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,this._currentRegion.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height)},c.rendering=function(t,i,s){var n=t||cc._renderContext,h=n.getContext();n.setTransform(this._worldTransform,i,s),h.save(),h.scale(1,-1);var r=this.style;h.strokeStyle=r.strokeStyle,h.fillStyle=r.fillStyle,h.lineWidth=r.lineWidth,h.lineJoin=r.lineJoin,h.miterLimit=r.miterLimit;for(var e=!0,c=this.cmds,o=0,u=c.length;o<u;o++){var a=c[o],f=a[0],l=a[1];"moveTo"===f&&e?(h.beginPath(),e=!1):"fill"!==f&&"stroke"!==f&&"fillRect"!==f||(e=!0),"function"==typeof h[f]?h[f].apply(h,l):h[f]=l}h.restore()},c.setStrokeColor=function(t){var i="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["strokeStyle",i]),this.style.strokeStyle=i},c.setFillColor=function(t){var i="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["fillStyle",i]),this.style.fillStyle=i},c.setLineWidth=function(t){this.cmds.push(["lineWidth",t]),this.style.lineWidth=t},c.setLineCap=function(t){var i="butt";t===n.BUTT?i="butt":t===n.ROUND?i="round":t===n.SQUARE&&(i="square"),this.cmds.push(["lineCap",i]),this.style.lineCap=i},c.setLineJoin=function(t){var i="bevel";t===h.BEVEL?i="bevel":t===h.ROUND?i="round":t===h.MITER&&(i="miter"),this.cmds.push(["lineJoin",i]),this.style.lineJoin=i},c.setMiterLimit=function(t){this.cmds.push(["miterLimit",t]),this.style.miterLimit=t},c.beginPath=function(){},c.moveTo=function(t,i){this.cmds.push(["moveTo",[t,i]])},c.lineTo=function(t,i){this.cmds.push(["lineTo",[t,i]])},c.bezierCurveTo=function(t,i,s,n,h,r){this.cmds.push(["bezierCurveTo",[t,i,s,n,h,r]])},c.quadraticCurveTo=function(t,i,s,n){this.cmds.push(["quadraticCurveTo",[t,i,s,n]])},c.arc=function(t,i,s,n,h,e){r.arc(this,t,i,s,n,h,e)},c.ellipse=function(t,i,s,n){r.ellipse(this,t,i,s,n)},c.circle=function(t,i,s){r.ellipse(this,t,i,s,s)},c.rect=function(t,i,s,n){this.moveTo(t,i),this.lineTo(t+s,i),this.lineTo(t+s,i+n),this.lineTo(t,i+n),this.close()},c.roundRect=function(t,i,s,n,h){r.roundRect(this,t,i,s,n,h)},c.fillRect=function(t,i,s,n){this.cmds.push(["fillRect",[t,i,s,n]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},c.close=function(){this.cmds.push(["closePath",[]])},c.stroke=function(){this.cmds.push(["stroke",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},c.fill=function(){this.cmds.push(["fill",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},c.clear=function(){this.cmds.length=0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},i.exports=e},{"./helper":119,"./types":121}],116:[function(t,i,s){var n=t("./graphics-canvas-cmd"),h=t("./graphics-webgl-cmd"),r=t("./types").LineCap,e=t("./types").LineJoin,c=(cc.js,_ccsg.Node.extend({ctor:function(){this._super(),this.strokeColor=cc.Color.BLACK,this.fillColor=cc.Color.WHITE},clear:function(t){this._renderCmd.clear(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new n(this):new h(this)}})),o=c.prototype;o._strokeColor=null,o._fillColor=null,o._lineWidth=1,o._lineCap=r.BUTT,o._lineJoin=e.MITER,o._miterLimit=10,o.setStrokeColor=function(t){this._strokeColor=t,this._renderCmd.setStrokeColor(t)},o.getStrokeColor=function(){return this._strokeColor},o.setFillColor=function(t){this._fillColor=t,this._renderCmd.setFillColor(t)},o.getFillColor=function(){return this._fillColor},o.setLineWidth=function(t){this._lineWidth=t,this._renderCmd.setLineWidth(t)},o.getLineWidth=function(){return this._lineWidth},o.setLineCap=function(t){this._lineCap=t,this._renderCmd.setLineCap(t)},o.getLineCap=function(){return this._lineCap},o.setLineJoin=function(t){this._lineJoin=t,this._renderCmd.setLineJoin(t)},o.getLineJoin=function(){return this._lineJoin},o.setMiterLimit=function(t){this._miterLimit=t,this._renderCmd.setMiterLimit(t)},o.getMiterLimit=function(){return this._miterLimit},o.beginPath=function(){this._renderCmd.beginPath()},o.moveTo=function(t,i){this._renderCmd.moveTo(t,i)},o.lineTo=function(t,i){this._renderCmd.lineTo(t,i)},o.bezierCurveTo=function(t,i,s,n,h,r){this._renderCmd.bezierCurveTo(t,i,s,n,h,r)},o.quadraticCurveTo=function(t,i,s,n){this._renderCmd.quadraticCurveTo(t,i,s,n)},o.arc=function(t,i,s,n,h,r){this._renderCmd.arc(t,i,s,n,h,r)},o.ellipse=function(t,i,s,n){this._renderCmd.ellipse(t,i,s,n)},o.circle=function(t,i,s){this._renderCmd.circle(t,i,s)},o.rect=function(t,i,s,n){this._renderCmd.rect(t,i,s,n)},o.roundRect=function(t,i,s,n,h){this._renderCmd.roundRect(t,i,s,n,h)},o.fillRect=function(t,i,s,n){this._renderCmd.fillRect(t,i,s,n)},o.close=function(){this._renderCmd.close()},o.stroke=function(){this._renderCmd.stroke()},o.fill=function(){this._renderCmd.fill()},i.exports=c},{"./graphics-canvas-cmd":115,"./graphics-webgl-cmd":117,"./types":121}],117:[function(t,i,s){function n(t,i,s){return t<i?i:t>s?s:t}function h(t,i){l.call(this,t,i),this.reset()}function r(){this.reset()}function e(){this.vertsOffset=0,this.vertsVBO=gl.createBuffer(),this.vertsBuffer=null,this.uint32VertsBuffer=null,this.vertsDirty=!1,this.indicesOffset=0,this.indicesVBO=gl.createBuffer(),this.indicesBuffer=null,this.indicesDirty=!1}function c(t){this._rootCtor(t),this._needDraw=!0,cc._renderContext,this._buffers=[],this._buffer=null,this._allocBuffer(),this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._paths=[],this._points=[],this._curColorValue=0,this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var i=new cc.GLProgram;i.initWithVertexShaderByteArray(cc.PresetShaders.POSITION_COLOR_VERT,cc.PresetShaders.POSITION_COLOR_FRAG),i.retain(),i.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),i.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),i.link(),i.updateUniforms(),this._shaderProgram=i,this._allocVerts(d)}var o=t("./types").LineCap,u=t("./types").LineJoin,a=t("./earcut"),f=t("./helper"),l=cc.Vec2,v=cc.js,d=32,p=Math.PI,g=Math.min,m=Math.max,w=Math.ceil,_=Math.acos,C=Math.cos,b=Math.sin,y=Math.atan2,T=Math.abs,S=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});v.extend(h,l),h.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},r.prototype.reset=function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},e.prototype.clear=function(){this.vertsOffset=0,this.indicesOffset=0},e.prototype.alloc=function(t,i){var s=this.vertsOffset+t;if(s>65535)return!1;var n=this.vertsBuffer,h=n?n.length/3:0;if(s>h){for(0===h&&(h=d);s>h;)h*=2;var r=new Float32Array(3*h),e=new Uint32Array(r.buffer);if(n)for(var c=this.uint32VertsBuffer,o=0,u=n.length;o<u;o+=3)r[o]=n[o],r[o+1]=n[o+1],e[o+2]=c[o+2];this.vertsBuffer=r,this.uint32VertsBuffer=e}var a=this.indicesBuffer,f=this.indicesOffset+i,l=a?a.length:0;if(f>l){for(0===l&&(l=3*d);f>l;)l*=2;var v=new Uint16Array(l);if(a)for(o=0,u=a.length;o<u;o++)v[o]=a[o];this.indicesBuffer=v}return!0},(c.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype)).constructor=c;var A=c.prototype;A._tessTol=.25,A._distTol=.01,A.lineWidth=1,A.lineCap=o.BUTT,A.lineJoin=u.MITER,A.miterLimit=10,A.beginPath=function(){this._pathOffset=this._pathLength},A.moveTo=function(t,i){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,i,S.PT_CORNER),this._commandx=t,this._commandy=i},A.lineTo=function(t,i){this._addPoint(t,i,S.PT_CORNER),this._commandx=t,this._commandy=i},A.bezierCurveTo=function(t,i,s,n,h,r){var e=this._curPath,c=e.points[e.points.length-1];c.x!==t||c.y!==i||s!==h||n!==r?(this._tesselateBezier(c.x,c.y,t,i,s,n,h,r,0,S.PT_CORNER),this._commandx=h,this._commandy=r):this.lineTo(h,r)},A.quadraticCurveTo=function(t,i,s,n){var h=this._commandx,r=this._commandy;this.bezierCurveTo(h+2/3*(t-h),r+2/3*(i-r),s+2/3*(t-s),n+2/3*(i-n),s,n)},A.arc=function(t,i,s,n,h,r){f.arc(this,t,i,s,n,h,r)},A.ellipse=function(t,i,s,n){f.ellipse(this,t,i,s,n),this._curPath.complex=!1},A.circle=function(t,i,s){f.ellipse(this,t,i,s,s),this._curPath.complex=!1},A.rect=function(t,i,s,n){this.moveTo(t,i),this.lineTo(t,i+n),this.lineTo(t+s,i+n),this.lineTo(t+s,i),this.close(),this._curPath.complex=!1},A.roundRect=function(t,i,s,n,h){f.roundRect(this,t,i,s,n,h),this._curPath.complex=!1},A.fillRect=function(t,i,s,n){this.rect(t,i,s,n),this.fill()},A.close=function(){this._curPath.closed=!0},A.stroke=function(){this._flattenPaths();var t=this._strokeColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandStroke(),this._updatePathOffset=!0},A.fill=function(){var t=this._fillColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandFill(),this._updatePathOffset=!0,this._filling=!1},A._strokeColor=null,A._fillColor=null,A.setStrokeColor=function(t){this._strokeColor=t},A.getStrokeColor=function(){return this._strokeColor},A.setFillColor=function(t){this._fillColor=t},A.getFillColor=function(){return this._fillColor},A.setLineWidth=function(t){this.lineWidth=t},A.setLineJoin=function(t){this.lineJoin=t},A.setLineCap=function(t){this.lineCap=t},A.setMiterLimit=function(t){this.miterLimit=t},v.getset(A,"strokeColor",A.getStrokeColor,A.setStrokeColor),v.getset(A,"fillColor",A.getFillColor,A.setFillColor),A._render=function(){var t=this._buffers;if(0!==t.length)for(var i=cc._renderContext,s=0,n=t.length;s<n;s++){var h=t[s];i.bindBuffer(i.ARRAY_BUFFER,h.vertsVBO),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,h.indicesVBO),h.vertsDirty&&(i.bufferData(i.ARRAY_BUFFER,h.vertsBuffer,i.STREAM_DRAW),h.vertsDirty=!1),h.indicesDirty&&h.indicesBuffer&&(i.bufferData(i.ELEMENT_ARRAY_BUFFER,h.indicesBuffer,i.STREAM_DRAW),h.indicesDirty=!1),i.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),i.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,12,0),i.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,12,8),i.drawElements(i.TRIANGLES,h.indicesOffset,i.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++}},A.rendering=function(){cc.gl.blendFunc(this._blendFunc.src,this._blendFunc.dst);var t=this._worldTransform,i=this._matrix.mat;i[0]=t.a,i[4]=t.c,i[12]=t.tx,i[1]=t.b,i[5]=t.d,i[13]=t.ty;var s=this._shaderProgram;s.use(),s._setUniformForMVPMatrixWithMat4(this._matrix),this._render()},A.clear=function(t){if(this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t)this._paths.length=0,this._points.length=0,this._buffer=null,this._buffers=[];else{for(var i=this._buffers,s=0;s<i.length;s++)i[s].clear();this._buffer=i[0]}},A._updatePathOffset=!1,A._paths=null,A._pathLength=0,A._pathOffset=0,A._points=null,A._pointsOffset=0,A._commandx=0,A._commandy=0,A._addPath=function(){var t=this._pathLength,i=this._paths[t];return i?i.reset():(i=new r,this._paths.push(i)),this._pathLength++,this._curPath=i,i},A._addPoint=function(t,i,s){var n=this._curPath;if(n){var r,e=this._points,c=n.points;(r=e[this._pointsOffset++])?(r.x=t,r.y=i):(r=new h(t,i),e.push(r)),r.flags=s,c.push(r)}},A._flattenPaths=function(){for(var t=this._paths,i=this._pathOffset,s=this._pathLength;i<s;i++){var n=t[i],h=n.points,r=h[h.length-1],e=h[0];r.equals(e)&&(n.closed=!0,h.pop(),r=h[h.length-1]);for(var c=0,o=h.length;c<o;c++){var u=e.sub(r);r.len=u.mag(),(u.x||u.y)&&u.normalizeSelf(),r.dx=u.x,r.dy=u.y,r=e,e=h[c+1]}}},A._allocBuffer=function(){if(this._buffer){var t=this._buffers.indexOf(this._buffer);if(t<this._buffers.length-1)return void(this._buffer=this._buffers[t+1])}var i=new e;this._buffers.push(i),this._buffer=i},A._allocVerts=function(t){this._buffer||this._allocBuffer();var i=3*(t-2*(this._pathLength-this._pathOffset));this._buffer.alloc(t,i)||(this._allocBuffer(),this._buffer.alloc(t,i)),this._buffer.vertsDirty=!0},A._expandStroke=function(){var t=.5*this.lineWidth,i=this.lineCap,s=this.lineJoin,n=this.miterLimit,h=this._curveDivs(t,p,this._tessTol),r=this._paths;this._calculateJoins(t,s,n);for(var e=0,c=this._pathOffset,a=this._pathLength;c<a;c++)C=(w=r[c]).points.length,s===u.ROUND?e+=2*(C+w.nbevel*(h+2)+1):e+=2*(C+5*w.nbevel+1),w.closed||(i===o.ROUND?e+=2*(2*h+2):e+=12);this._allocVerts(e);var f=this._buffer;for(c=this._pathOffset,a=this._pathLength;c<a;c++){var l,v,d,g,m,w=r[c],_=w.points,C=w.points.length;m=w.closed;var b=f.vertsOffset;if(m?(l=_[C-1],v=_[0],d=0,g=C):(l=_[0],v=_[1],d=1,g=C-1),!m){(x=v.sub(l)).normalizeSelf();var y=x.x,T=x.y;i===o.BUTT?this._buttCap(l,y,T,t,0):i===o.SQUARE?this._buttCap(l,y,T,t,t):i===o.ROUND&&this._roundCapStart(l,y,T,t,h)}for(var A=d;A<g;++A)s===u.ROUND?this._roundJoin(l,v,t,t,h):0!=(v.flags&(S.PT_BEVEL|S.PT_INNERBEVEL))?this._bevelJoin(l,v,t,t):(this._vset(v.x+v.dmx*t,v.y+v.dmy*t),this._vset(v.x-v.dmx*t,v.y-v.dmy*t)),l=v,v=_[A+1];if(m){var M=f.vertsBuffer;this._vset(M[3*b],M[3*b+1]),this._vset(M[3*(b+1)],M[3*(b+1)+1])}else{var x=v.sub(l);x.normalizeSelf(),y=x.x,T=x.y,i===o.BUTT?this._buttCap(v,y,T,t,0):i===o.BUTT||i===o.SQUARE?this._buttCap(v,y,T,t,t):i===o.ROUND&&this._roundCapEnd(v,y,T,t,h)}for(var E=f.indicesOffset,O=f.indicesBuffer,P=b+2,R=f.vertsOffset;P<R;P++)O[E++]=P-2,O[E++]=P-1,O[E++]=P;f.indicesOffset=E,f.indicesDirty=!0}},A._expandFill=function(){for(var t=this._paths,i=0,s=this._pathOffset,n=this._pathLength;s<n;s++)i+=c=(r=t[s]).points.length;this._allocVerts(i);var h=this._buffer;for(s=this._pathOffset,n=this._pathLength;s<n;s++){var r=t[s],e=r.points,c=e.length;if(0!==c){for(var o=h.vertsOffset,u=0;u<c;++u)this._vset(e[u].x,e[u].y,.5,1);var f=r.indicesOffset=h.indicesOffset,l=h.indicesBuffer,v=0;if(r.complex){var d=[],p=3*o,g=3*h.vertsOffset;for(s=p;s<g;s+=3)d.push(h.vertsBuffer[s]),d.push(h.vertsBuffer[s+1]);var m=a(d,null,2);if(!m||0===m.length)continue;u=0;for(var w=v=m.length;u<w;u++)l[f+u]=m[u]+o}else{var _=o;for(p=o+2,g=h.vertsOffset;p<g;p++)l[f++]=_,l[f++]=p-1,l[f++]=p;v=f-h.indicesOffset}h.indicesOffset+=v,h.indicesDirty=!0}}},A._curveDivs=function(t,i,s){var n=2*_(t/(t+s));return m(2,w(i/n))},A._calculateJoins=function(t,i,s){var n=0;t>0&&(n=1/t);for(var h=this._paths,r=this._pathOffset,e=this._pathLength;r<e;r++){var c=h[r],o=c.points,a=o.length,f=o[a-1],l=o[0];c.nbevel=0;for(var v=0;v<a;v++){var d,p,w=f.dy,_=-f.dx,C=l.dy,b=-l.dx;if(l.dmx=.5*(w+C),l.dmy=.5*(_+b),(d=l.dmx*l.dmx+l.dmy*l.dmy)>1e-6){var y=1/d;y>600&&(y=600),l.dmx*=y,l.dmy*=y}l.dx*f.dy-f.dx*l.dy>0&&(l.flags|=S.PT_LEFT),d*(p=m(11,g(f.len,l.len)*n))*p<1&&(l.flags|=S.PT_INNERBEVEL),l.flags&S.PT_CORNER&&(d*s*s<1||i===u.BEVEL||i===u.ROUND)&&(l.flags|=S.PT_BEVEL),0!=(l.flags&(S.PT_BEVEL|S.PT_INNERBEVEL))&&c.nbevel++,f=l,l=o[v+1]}}},A._vset=function(t,i){var s=this._buffer,n=3*s.vertsOffset,h=s.vertsBuffer;h[n]=t,h[n+1]=i,s.uint32VertsBuffer[n+2]=this._curColorValue,s.vertsOffset++},A._chooseBevel=function(t,i,s,n){var h,r,e,c,o=s.x,u=s.y;return 0!==t?(h=o+i.dy*n,r=u-i.dx*n,e=o+s.dy*n,c=u-s.dx*n):(h=e=o+s.dmx*n,r=c=u+s.dmy*n),[h,r,e,c]},A._buttCap=function(t,i,s,n,h){var r=t.x-i*h,e=t.y-s*h,c=s,o=-i;this._vset(r+c*n,e+o*n),this._vset(r-c*n,e-o*n)},A._roundCapStart=function(t,i,s,n,h){for(var r=t.x,e=t.y,c=s,o=-i,u=0;u<h;u++){var a=u/(h-1)*p,f=C(a)*n,l=b(a)*n;this._vset(r-c*f-i*l,e-o*f-s*l),this._vset(r,e)}this._vset(r+c*n,e+o*n),this._vset(r-c*n,e-o*n)},A._roundCapEnd=function(t,i,s,n,h){var r=t.x,e=t.y,c=s,o=-i;this._vset(r+c*n,e+o*n),this._vset(r-c*n,e-o*n);for(var u=0;u<h;u++){var a=u/(h-1)*p,f=C(a)*n,l=b(a)*n;this._vset(r,e),this._vset(r-c*f+i*l,e-o*f+s*l)}},A._roundJoin=function(t,i,s,h,r){var e=t.dy,c=-t.dx,o=i.dy,u=-i.dx,a=i.x,f=i.y;if(0!=(i.flags&S.PT_LEFT)){var l=(x=this._chooseBevel(i.flags&S.PT_INNERBEVEL,t,i,s))[0],v=x[1],d=x[2],g=x[3],m=y(-c,-e);(I=y(-u,-o))>m&&(I-=2*p),this._vset(l,v),this._vset(a-e*h,i.y-c*h);for(var _=n(w((m-I)/p)*r,2,r),T=0;T<_;T++){var A=a+C(D=m+(L=T/(_-1))*(I-m))*h,M=f+b(D)*h;this._vset(a,f),this._vset(A,M)}this._vset(d,g),this._vset(a-o*h,f-u*h)}else{var x=this._chooseBevel(i.flags&S.PT_INNERBEVEL,t,i,-h),E=x[0],O=x[1],P=x[2],R=x[3],I=(m=y(c,e),y(u,o));for(I<m&&(I+=2*p),this._vset(a+e*h,f+c*h),this._vset(E,O),_=n(w((I-m)/p)*r,2,r),T=0;T<_;T++){var L=T/(_-1),D=m+L*(I-m),F=a+C(D)*s,N=f+b(D)*s;this._vset(F,N),this._vset(a,f)}this._vset(a+o*h,f+u*h),this._vset(P,R)}},A._bevelJoin=function(t,i,s,n){var h,r,e,c,o,u,a,f,l=t.dy,v=-t.dx,d=i.dy,p=-i.dx;if(i.flags&S.PT_LEFT)o=(g=this._chooseBevel(i.flags&S.PT_INNERBEVEL,t,i,s))[0],u=g[1],a=g[2],f=g[3],this._vset(o,u),this._vset(i.x-l*n,i.y-v*n),this._vset(a,f),this._vset(i.x-d*n,i.y-p*n);else{var g=this._chooseBevel(i.flags&S.PT_INNERBEVEL,t,i,-n);h=g[0],r=g[1],e=g[2],c=g[3],this._vset(i.x+l*s,i.y+v*s),this._vset(h,r),this._vset(i.x+d*s,i.y+p*s),this._vset(e,c)}},A._tesselateBezier=function(t,i,s,n,h,r,e,c,o,u){var a,f,l,v,d,p,g,m,w,_,C,b,y,A,M,x;o>10||(d=.5*(h+e),p=.5*(r+c),g=.5*((a=.5*(t+s))+(l=.5*(s+h))),m=.5*((f=.5*(i+n))+(v=.5*(n+r))),((M=T((s-e)*(A=c-i)-(n-c)*(y=e-t)))+(x=T((h-e)*A-(r-c)*y)))*(M+x)<this._tessTol*(y*y+A*A)?this._addPoint(e,c,0===u?u|S.PT_BEVEL:u):(C=.5*(g+(w=.5*(l+d))),b=.5*(m+(_=.5*(v+p))),this._tesselateBezier(t,i,a,f,g,m,C,b,o+1,0),this._tesselateBezier(C,b,w,_,d,p,e,c,o+1,u)))},i.exports=c},{"./earcut":114,"./helper":119,"./types":121}],118:[function(t,i,s){var n=t("./types").LineCap,h=t("./types").LineJoin,r=cc.T({name:"cc.Graphics",S:cc._RendererUnderSG,editor:!1,O:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:h.MITER,_lineCap:n.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._sgNode.lineWidth=this._lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._sgNode.lineJoin=this._lineJoin=t},type:h},lineCap:{get:function(){return this._lineCap},set:function(t){this._sgNode.lineCap=this._lineCap=t},type:n},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._sgNode.strokeColor=this._strokeColor=t}},fillColor:{get:function(){return this._fillColor},set:function(t){this._sgNode.fillColor=this._fillColor=t}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._sgNode.miterLimit=this._miterLimit=t}}},statics:{LineJoin:h,LineCap:n},_createSgNode:function(){return new _ccsg.GraphicsNode},_initSgNode:function(){var t=this._sgNode;t.lineWidth=this._lineWidth,t.lineJoin=this._lineJoin,t.lineCap=this._lineCap,t.strokeColor=this._strokeColor,t.fillColor=this._fillColor,t.miterLimit=this._miterLimit,t.setContentSize(this.node.getContentSize(!0))},moveTo:function(t,i){this._sgNode.moveTo(t,i)},lineTo:function(t,i){this._sgNode.lineTo(t,i)},bezierCurveTo:function(t,i,s,n,h,r){this._sgNode.bezierCurveTo(t,i,s,n,h,r)},quadraticCurveTo:function(t,i,s,n){this._sgNode.quadraticCurveTo(t,i,s,n)},arc:function(t,i,s,n,h,r){r=r||!1,this._sgNode.arc(t,i,s,n,h,r)},ellipse:function(t,i,s,n){this._sgNode.ellipse(t,i,s,n)},circle:function(t,i,s){this._sgNode.circle(t,i,s)},rect:function(t,i,s,n){this._sgNode.rect(t,i,s,n)},roundRect:function(t,i,s,n,h){this._sgNode.roundRect(t,i,s,n,h)},fillRect:function(t,i,s,n){this._sgNode.fillRect(t,i,s,n)},clear:function(t){this._sgNode.clear(!!t)},close:function(){this._sgNode.close()},stroke:function(){this._sgNode.stroke()},fill:function(){this._sgNode.fill()}});cc.Graphics=i.exports=r},{"./types":121}],119:[function(t,i,s){var n=Math.PI,h=Math.min,r=Math.max,e=Math.cos,c=Math.sin,o=Math.abs,u=Math.sign,a=.5522847493;i.exports={arc:function(t,i,s,u,a,f,l){var v,d,p=0,g=0,m=0,w=0,_=0,C=0,b=0,y=0,T=0,S=0,A=0,M=0,x=0,E=0;if(g=f-a,l=l||!1)if(o(g)>=2*n)g=2*n;else for(;g<0;)g+=2*n;else if(o(g)>=2*n)g=2*-n;else for(;g>0;)g-=2*n;for(d=0|r(1,h(o(g)/(.5*n)+.5,5)),w=o(4/3*(1-e(m=g/d/2))/c(m)),l||(w=-w),v=0;v<=d;v++)b=i+(_=e(p=a+g*(v/d)))*u,y=s+(C=c(p))*u,T=-C*u*w,S=_*u*w,0===v?t.moveTo(b,y):t.bezierCurveTo(A+x,M+E,b-T,y-S,b,y),A=b,M=y,x=T,E=S},ellipse:function(t,i,s,n,h){t.moveTo(i-n,s),t.bezierCurveTo(i-n,s+h*a,i-n*a,s+h,i,s+h),t.bezierCurveTo(i+n*a,s+h,i+n,s+h*a,i+n,s),t.bezierCurveTo(i+n,s-h*a,i+n*a,s-h,i,s-h),t.bezierCurveTo(i-n*a,s-h,i-n,s-h*a,i-n,s),t.close()},roundRect:function(t,i,s,n,r,e){if(e<.1)t.rect(i,s,n,r);else{var c=h(e,.5*o(n))*u(n),f=h(e,.5*o(r))*u(r);t.moveTo(i,s+f),t.lineTo(i,s+r-f),t.bezierCurveTo(i,s+r-f*(1-a),i+c*(1-a),s+r,i+c,s+r),t.lineTo(i+n-c,s+r),t.bezierCurveTo(i+n-c*(1-a),s+r,i+n,s+r-f*(1-a),i+n,s+r-f),t.lineTo(i+n,s+f),t.bezierCurveTo(i+n,s+f*(1-a),i+n-c*(1-a),s,i+n-c,s),t.lineTo(i+c,s),t.bezierCurveTo(i+c*(1-a),s,i,s+f*(1-a),i,s+f),t.close()}}}},{}],120:[function(t,i,s){"use strict";var n;(n=cc.sys.isNative?_ccsg.GraphicsNode=cc.GraphicsNode:_ccsg.GraphicsNode=t("./graphics-node"))&&t("../utils/misc").propertyDefine(n,["lineWidth","lineCap","lineJoin","miterLimit","strokeColor","fillColor"],{}),t("./graphics")},{"../utils/misc":223,"./graphics":118,"./graphics-node":116}],121:[function(t,i,s){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),h=cc.Enum({BEVEL:0,ROUND:1,MITER:2});i.exports={LineCap:n,LineJoin:h}},{}],122:[function(t,i,s){t("./platform"),t("./assets"),t("./CCNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./physics"),t("./camera/CCCamera"),t("./base-ui/CCWidgetManager")},{"./CCNode":40,"./CCScene":41,"./assets":54,"./base-ui/CCWidgetManager":58,"./camera/CCCamera":59,"./collider":68,"./components":101,"./graphics":120,"./physics":155,"./platform":189}],123:[function(t,i,s){var n=/^(click)(\s)*=/,h=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;cc.HtmlTextParser=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])},cc.HtmlTextParser.prototype={constructor:cc.HtmlTextParser,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var i=0,s=t.length;i<s;){var n=t.indexOf("<",i);if(n<0)this._stack.pop(),this._processResult(t.substring(i)),i=s;else{this._processResult(t.substring(i,n));var h=t.indexOf(">",i);-1===h?h=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(t.substring(n+1,h)),i=h+1}}return this._resultObjectArray},_attributeToObject:function(t){var i,s,n,r,e={},c=(t=t.trim()).match(/^(color|size)(\s)*=/);if(c){if(i=c[0],""===(t=t.substring(i.length).trim()))return e;switch(s=t.indexOf(" "),i[0]){case"c":e.color=s>-1?t.substring(0,s).trim():t;break;case"s":e.size=parseInt(t)}return s>-1&&(r=t.substring(s+1).trim(),n=this._processEventHandler(r),e.event=n),e}if((c=t.match(/^(br(\s)*\/)/))&&c[0].length>0&&(i=c[0].trim()).startsWith("br")&&"/"===i[i.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),e;if((c=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&c[0].length>0&&(i=c[0].trim()).startsWith("img")&&"/"===i[i.length-1]){c=t.match(h);for(var o,u=!1;c;)i=(t=t.substring(t.indexOf(c[0]))).substr(0,c[0].length),l=(s=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(s).trim(),"src"===i?(e.isImage=!0,l.endsWith("/")&&(l=l.substring(0,l.length-1)),0===l.indexOf("'")?(u=!0,l=l.substring(1,l.length-1)):0===l.indexOf('"')&&(u=!0,l=l.substring(1,l.length-1)),e.src=l):"height"===i?e.imageHeight=parseInt(l):"width"===i?e.imageWidth=parseInt(l):"click"===i&&(e.event=this._processEventHandler(i+"="+l)),c=t.match(h);return u&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(c=t.match(/^(outline(\s)*[^>]*)/)){var a={color:"#ffffff",width:1};if(t=c[0].substring("outline".length).trim()){var f=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;c=t.match(f);for(var l;c;)i=(t=t.substring(t.indexOf(c[0]))).substr(0,c[0].length),l=(s=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(s).trim(),"click"===i?e.event=this._processEventHandler(i+"="+l):"color"===i?a.color=l:"width"===i&&(a.width=parseInt(l)),c=t.match(f)}e.outline=a}if((c=t.match(/^(on|u|b|i)(\s)*/))&&c[0].length>0){switch(i=c[0],t=t.substring(i.length).trim(),i[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;n=this._processEventHandler(t),e.event=n}return e},_processEventHandler:function(t){for(var i=0,s={},h=t.match(n),r=!1;h;){var e=h[0],c="";if(r=!1,'"'===(t=t.substring(e.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(c=t.substring(1,i).trim(),r=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(c=t.substring(1,i).trim(),r=!0),i++;else{var o=t.match(/(\S)+/);i=(c=o?o[0]:"").length}r&&(s[e=e.substring(0,e.length-1).trim()]=c),h=(t=t.substring(i).trim()).match(n)}return s},_addToStack:function(t){var i=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(i);else{if(i.isNewLine||i.isImage)return;var s=this._stack[this._stack.length-1];for(var n in s)i[n]||(i[n]=s[n]);this._stack.push(i)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var i=0;i<this._specialSymbolArray.length;++i){var s=this._specialSymbolArray[i][0],n=this._specialSymbolArray[i][1];t=t.replace(s,n)}return t}},cc.htmlTextParser=new cc.HtmlTextParser},{}],124:[function(t,i,s){t("./CCTextUtils");var n=t("../event/event-target"),h=t("../platform/js"),r=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};cc.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},cc.FontAtlas.prototype={constructor:cc.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,i){this._letterDefinitions[t]=i},cloneLetterDefinition:function(){var t={};for(var i in this._letterDefinitions){var s=new r;cc.js.mixin(s,this._letterDefinitions[i]),t[i]=s}return t},assignLetterDefinitions:function(t){for(var i in this._letterDefinitions){var s=t[i],n=this._letterDefinitions[i];cc.js.mixin(n,s)}},scaleFontLetterDefinition:function(t){for(var i in this._letterDefinitions){var s=this._letterDefinitions[i];s._width*=t,s._height*=t,s._offsetX*=t,s._offsetY*=t,s._xAdvance*=t}},getLetterDefinitionForChar:function(t){return this._letterDefinitions.hasOwnProperty(t.charCodeAt(0))?this._letterDefinitions[t.charCodeAt(0)]:null}};var e=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._atlasIndex=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:cc.TextAlignment.LEFT,_vAlign:cc.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_drawFontsize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:cc.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_outlined:!1,_outlineColor:null,_outlineWidth:1,_gradientEnabled:!1,_gradientStartColor:cc.color(255,255,255,255),_gradientEndColor:cc.color(255,255,255,255),_gradientDirection:0,_className:"Label",_margin:0,_isBold:!1,_isItalic:!1,_isUnderline:!1,_fontAsset:null,ctor:function(t,i){n.call(this);var s=i instanceof cc.Font,h=s?i.rawUrl:"";this._fontHandle=h,"string"!=typeof t&&(t=""+t),this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(this,128,128),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._imageOffset=cc.p(0,0),this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._horizontalKernings=[],this._reusedRect=cc.rect(0,0,0,0),s?this.setFontAsset(i):this.setFontFamily(h),this.setString(this._string)},_resetBMFont:function(){this._imageOffset.x=this._imageOffset.y=0,this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo.length=0,this._linesWidth.length=0,this._linesOffsetX.length=0,this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._bmfontScale=1,this._horizontalKernings.length=0,this._lineBreakWithoutSpaces=!1,this._reusedRect.x=this._reusedRect.y=this._reusedRect.width=this._reusedRect.height=0,this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},setHorizontalAlign:function(t){this._hAlign!==t&&(this._hAlign=t,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){this._vAlign!==t&&(this._vAlign=t,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(t){"string"!=typeof t&&(t=""+t),this._string!==t&&(this._string=t,this._notifyLabelSkinDirty())},setMargin:function(t){this._margin!==t&&(this._margin=t,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){this._isWrapText!==t&&this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE&&(this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},enableItalics:function(t){this._isItalic=t,t?this.setSkewX(12):this.setSkewX(0)},enableBold:function(t){this._isBold!==t&&(this._isBold=t,this._notifyLabelSkinDirty())},enableUnderline:function(t){this._isUnderline!==t&&(this._isUnderline=t,this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._drawFontsize=t,this._notifyLabelSkinDirty())},getFontSize:function(){return this._fontSize},isOutlined:function(){return this._outlined},setOutlined:function(t){this._outlined!==t&&(this._outlined=!!t,this._notifyLabelSkinDirty())},setFillColorGradientEnabled:function(t){this._gradientEnabled!==t&&(this._gradientEnabled=!!t,this._notifyLabelSkinDirty())},getFillColorGradientEnabled:function(){return this._gradientEnabled},setGradientStartColor:function(t){this._gradientStartColor!==t&&(this._gradientStartColor=t,this._notifyLabelSkinDirty())},getGradientStartColor:function(){return this._gradientStartColor},setGradientEndColor:function(t){this._gradientEndColor!==t&&(this._gradientEndColor=t,this._notifyLabelSkinDirty())},getGradientEndColor:function(){return this._gradientEndColor},setFillColorGradientDirection:function(t){this._gradientDirection=t,this._notifyLabelSkinDirty()},getFillColorGradientDirection:function(){return this._gradientDirection},getOutlineColor:function(){return this._outlineColor},setOutlineColor:function(t){this._outlineColor!==t&&(this._outlineColor=cc.color(t),this._notifyLabelSkinDirty())},setOutlineWidth:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._notifyLabelSkinDirty())},getOutlineWidth:function(){return this._outlineWidth},_updateWrapText:function(t){t===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(this._isWrapText=!0),t===_ccsg.Label.Overflow.NONE&&(this._isWrapText=!1)},_setOverflowBMFont:function(){this._labelType===_ccsg.Label.Type.BMFont&&(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._setDimensions(this._labelDimensions.width,0),this._overFlow===_ccsg.Label.Overflow.NONE&&this._setDimensions(0,0),this._rescaleWithOriginalFontSize())},setOverflow:function(t){this._overFlow!==t&&(this._overFlow=t,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(t){this._spacingX!==t&&(this._spacingX=t,this._notifyLabelSkinDirty())},setLineHeight:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces!==t&&(this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},getBMFontLineHeight:function(){if(this._fontAtlas)return this._fontAtlas._lineHeight},setFontFamily:function(t){this._resetBMFont(),this._fontHandle=t||"Arial",this._labelType=_ccsg.Label.Type.SystemFont,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._notifyLabelSkinDirty(),this.emit("load")},setFontAsset:function(t){this._fontAsset=t;var i=t instanceof cc.Font;if(i){var s=i?t.rawUrl:"",n=cc.path.extname(s);this._resetBMFont(),".ttf"===n?(this._labelType=_ccsg.Label.Type.TTF,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._fontHandle=this._loadTTFFont(s)):t.spriteFrame&&(this._labelType=_ccsg.Label.Type.BMFont,this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._renderCmd._needDraw=!1,this._initBMFontWithString(this._string,t)),this._notifyLabelSkinDirty()}else this.setFontFamily("")},_loadTTFFont:function(t){var i=this,s=cc.CustomFontLoader._getFontFamily(t);return cc.CustomFontLoader.loadTTF(t,function(){i._notifyLabelSkinDirty(),i.emit("load")}),s},setContentSize:function(t,i){this._overFlow!==_ccsg.Label.Overflow.NONE&&this._setDimensions(t,i)},setBlendFunc:function(t,i){var s=this._blendFunc;void 0===i?(s.src=t.src,s.dst=t.dst):(s.src=t,s.dst=i)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_setupBMFontOverflowMetrics:function(t,i){this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(i=0),this._overFlow===_ccsg.Label.Overflow.NONE&&(t=0,i=0),this._labelWidth=t,this._labelHeight=i,this._labelDimensions.width=t,this._labelDimensions.height=i,this._maxLineWidth=t},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._contentSize,i=t.width,s=t.height;this._setupBMFontOverflowMetrics(i,s),this._updateContent(),this.setColor(this.color)}else this._labelType!==_ccsg.Label.Type.TTF&&this._labelType!==_ccsg.Label.Type.SystemFont||this._renderCmd._bakeLabel()},_notifyLabelSkinDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty|_ccsg.Node._dirtyFlags.contentDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new _ccsg.Label.WebGLRenderCmd(this):new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getHeight.call(this)},_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK&&this.getFontSize()>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this)),!this._updateQuads()){t=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,i){var s=this._linesWidth[i],n=t>this._contentSize.width||t<0;return this._isWrapText?s>this._contentSize.width&&n:n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var i=0;i<this._string.length;++i)if(this._lettersInfo[i]._valid){var s=this._fontAtlas._letterDefinitions[this._lettersInfo[i]._char];this._reusedRect.height=s._height,this._reusedRect.width=s._width,this._reusedRect.x=s._u,this._reusedRect.y=s._v;var n=this._lettersInfo[i]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(n>this._tailoredTopY){var h=n-this._tailoredTopY;this._reusedRect.y+=h,this._reusedRect.height-=h,n-=h}n-s._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=n<this._tailoredBottomY?0:n-this._tailoredBottomY)}var r=this._lettersInfo[i]._lineIndex,e=this._lettersInfo[i]._positionX+s._width/2*this._bmfontScale+this._linesOffsetX[r];if(this._labelWidth>0&&this._isHorizontalClamped(e,r))if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK){if(this._contentSize.width>s._width){t=!1;break}this._reusedRect.width=0}if(this._reusedRect.height>0&&this._reusedRect.width>0){var c=this.getChildByTag(i),o=this._spriteBatchNode._texture,u=this._spriteFrame,a=this._spriteFrame.isRotated(),f=u._originalSize,l=u._rect,v=u._offset,d=v.x+(f.width-l.width)/2,p=v.y-(f.height-l.height)/2;if(a){var g=this._reusedRect.x;this._reusedRect.x=l.x+l.height-this._reusedRect.y-this._reusedRect.height-p,this._reusedRect.y=g+l.y-d,this._reusedRect.y<0&&(this._reusedRect.height=this._reusedRect.height+p)}else this._reusedRect.x+=l.x-d,this._reusedRect.y+=l.y+p;c?c.setTextureRect(this._reusedRect,a):((c=new _ccsg.Sprite).initWithTexture(o,this._reusedRect,a),c.setAnchorPoint(cc.p(0,1)));var m=this._lettersInfo[i]._positionX+this._linesOffsetX[this._lettersInfo[i]._lineIndex];c.setPosition(m,n);var w=this._spriteBatchNode.getChildrenCount();this._lettersInfo[i]._atlasIndex=w,this._updateLetterSpriteScale(c),this._spriteBatchNode.addChild(c)}}return t},_updateLetterSpriteScale:function(t){this._labelType===_ccsg.Label.Type.BMFont&&this._fontSize>0&&t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,i){if(t>=this._lettersInfo.length){var s=new e;this._lettersInfo.push(s)}this._lettersInfo[t]._char=i,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,i,s,n){if(s>=this._lettersInfo.length){var h=new e;this._lettersInfo.push(h)}i=i.charCodeAt(0),this._lettersInfo[s]._lineIndex=n,this._lettersInfo[s]._char=i,this._lettersInfo[s]._valid=this._fontAtlas._letterDefinitions[i]._validDefinition,this._lettersInfo[s]._positionX=t.x,this._lettersInfo[s]._positionY=t.y},_setDimensions:function(t,i){var s="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:i,h=this.getContentSize();_ccsg.Node.prototype.setContentSize.call(this,t,i),n===h.height&&s===h.width||(this._setupBMFontOverflowMetrics(s,n),this._drawFontsize>0&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(t){var i=this.getStringLength(),s=0,n=0,h=0,r=0,e=0,c=this._lineSpacing,o=0,u=0,a=null,f=cc.p(0,0);this._updateBMFontScale();for(var l=0;l<i;){var v=this._string.charAt(l);if("\n"!==v){for(var d=t(this._string,l,i),p=o,g=u,m=e,w=n,_=!1,C=0;C<d;++C){var b=l+C;if("\r"!==(v=this._string.charAt(b)))if(a=this._fontAtlas.getLetterDefinitionForChar(v)){var y=w+a._offsetX*this._bmfontScale;if(this._isWrapText&&this._maxLineWidth>0&&n>0&&y+a._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(v)){this._linesWidth.push(e),e=0,s++,n=0,h-=this._lineHeight*this._bmfontScale+c,_=!0;break}f.x=y,f.y=h-a._offsetY*this._bmfontScale,this._recordLetterInfo(f,v,b,s),b+1<this._horizontalKernings.length&&b<i-1&&(w+=this._horizontalKernings[b+1]),w+=a._xAdvance*this._bmfontScale+this._spacingX,m=f.x+a._width*this._bmfontScale,p<f.y&&(p=f.y),g>f.y-a._height*this._bmfontScale&&(g=f.y-a._height*this._bmfontScale)}else this._recordPlaceholderInfo(b,v),console.log("Can't find letter definition in texture atlas "+this._config.atlasName+" for letter:"+v);else this._recordPlaceholderInfo(b,v)}_||(n=w,e=m,o<p&&(o=p),u>g&&(u=g),r<e&&(r=e),l+=d)}else this._linesWidth.push(e),e=0,s++,n=0,h-=this._lineHeight*this._bmfontScale+c,this._recordPlaceholderInfo(l,v),l++}this._linesWidth.push(e),this._numberOfLines=s+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,this._numberOfLines>1&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var T=cc.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(T.width=parseFloat(r.toFixed(2))),this._labelHeight<=0&&(T.height=parseFloat(this._textDesiredHeight.toFixed(2))),_ccsg.Node.prototype.setContentSize.call(this,T),this._tailoredTopY=T.height,this._tailoredBottomY=0,o>0&&(this._tailoredTopY=T.height+o),u<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+u),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height},_isHorizontalClamp:function(){for(var t=!1,i=0;i<this.getStringLength();++i)if(this._lettersInfo[i]._valid){var s=this._fontAtlas._letterDefinitions[this._lettersInfo[i]._char],n=this._lettersInfo[i]._positionX+s._width/2*this._bmfontScale,h=this._lettersInfo[i]._lineIndex;if(this._labelWidth>0)if(this._isWrapText){if(this._linesWidth[h]>this._contentSize.width&&(n>this._contentSize.width||n<0)){t=!0;break}}else if(n>this._contentSize.width){t=!0;break}}return t},_shrinkLabelToContentSize:function(t){for(var i=this.getFontSize(),s=0,n=this._fontAtlas.cloneLetterDefinition(),h=this._lineHeight,r=!0;t();){var e=i-++s;if(r=!1,e<=0)break;var c=e/i;this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(c),this._lineHeight=h*c,this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset()}this._lineHeight=h,this._fontAtlas.assignLetterDefinitions(n),r||i-s>=0&&this._scaleFontSizeDown(i-s)},_scaleFontSizeDown:function(t){var i=!0;this._labelType===_ccsg.Label.Type.BMFont&&(t||(t=.1,i=!1),this._fontSize=t,i&&this._updateContent())},_updateContent:function(){this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),this._alignText())},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case cc.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case cc.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case cc.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case cc.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case cc.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case cc.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(){return 1},_getFirstWordLen:function(t,i,s){var n=t.charAt(i);if(cc.TextUtils.isUnicodeCJK(n)||"\n"===n||cc.TextUtils.isUnicodeSpace(n))return 1;var h=1;if(!(r=this._fontAtlas.getLetterDefinitionForChar(n)))return h;for(var r,e=r._xAdvance*this._bmfontScale+this._spacingX,c=i+1;c<s&&(n=t.charAt(c),r=this._fontAtlas.getLetterDefinitionForChar(n));++c){if(e+r._offsetX*this._bmfontScale+r._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(n)&&this._maxLineWidth>0)return h;if(e+=r._xAdvance*this._bmfontScale+this._spacingX,"\n"===n||cc.TextUtils.isUnicodeSpace(n)||cc.TextUtils.isUnicodeCJK(n))break;h++}return h},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/t}else this._bmfontScale=1},_initBMFontWithString:function(t,i){if(this._config)return cc.logID(4002),!1;this._string=t,this._setBMFontFile(i)},_createSpriteBatchNode:function(t){this._spriteBatchNode=new cc.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new cc.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var t=this._config.fontDefDictionary;for(var i in t){var s=new r,n=t[i].rect;s._offsetX=t[i].xOffset,s._offsetY=t[i].yOffset,s._width=n.width,s._height=n.height,s._u=n.x+this._imageOffset.x,s._v=n.y+this._imageOffset.y,s._textureID=0,s._validDefinition=!0,s._xAdvance=t[i].xAdvance,this._fontAtlas.addLetterDefinitions(i,s)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();this._drawFontsize-t>=1&&this._overFlow===_ccsg.Label.Overflow.SHRINK&&(this._labelType===_ccsg.Label.Type.BMFont?this._scaleFontSizeDown(this._drawFontsize):this._fontSize=this._drawFontsize)},_computeHorizontalKerningForText:function(){for(var t=this.getStringLength(),i=this._config.kerningDict,s=-1,n=0;n<t;++n){var h=this._string.charCodeAt(n),r=i[s<<16|65535&h]||0;this._horizontalKernings[n]=n<t-1?r:0,s=h}},_setBMFontFile:function(t){if(t&&this._labelType===_ccsg.Label.Type.BMFont){var i=this;this._resetBMFont();var s=this._fontAsset._fntConfig;s?i._config=s:cc.warn("Invalid BMFont Assets!");var n=t.spriteFrame;i._createFontChars(),i._spriteFrame=n;var h=function(){var t=n.getTexture();i._textureLoaded=t.isLoaded(),i._createSpriteBatchNode(t),i.emit("load")};n.textureLoaded()?h():(n.once("load",h),n.ensureLoadTexture())}}}),_ccsg.Label.pool=new h.Pool(function(t){return t instanceof _ccsg.Label&&(t._string="",t._fontAsset=null,t._fontHandle="",t._labelType=0,t._resetBMFont(),t._renderCmd._labelCanvas.width=1,t._renderCmd._labelCanvas.height=1,t._updateLabel(),!0)},20),_ccsg.Label.pool.get=function(t,i){var s=this._get();if(s){var n=i instanceof cc.Font,h=n?i.rawUrl:"";return s._fontHandle=h,"string"!=typeof t&&(t=""+t),s._string=t,s._position.x=0,s._position.y=0,s.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(s,128,128),n?s.setFontAsset(i):s.setFontFamily("Arial"),s.setString(t),s.setHorizontalAlign(cc.TextAlignment.LEFT),s.setVerticalAlign(cc.VerticalTextAlignment.TOP),s.setFontSize(40),s.setOverflow(0),s.enableWrapText(!0),s.setVisible(!0),s.setLineHeight(40),s.setOutlined(!1),s.enableBold(!1),s.enableItalics(!1),s.enableUnderline(!1),s}return new _ccsg.Label(t||"",i)};var c=_ccsg.Label.prototype;cc.js.addon(c,n.prototype),_ccsg.Label.Type=cc.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var o=_ccsg.Label.prototype;Object.defineProperty(o,"width",{get:o._getWidth,set:_ccsg.Node.prototype._setWidth}),Object.defineProperty(o,"height",{get:o._getHeight,set:_ccsg.Node.prototype._setHeight})},{"../event/event-target":111,"../platform/js":192,"./CCTextUtils":127}],125:[function(t,i,s){!function(){_ccsg.Label.TTFLabelBaker=function(){};var t=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,s=i&t.colorDirty,n=i&t.opacityDirty;s&&this._updateDisplayColor(),n&&(this._updateDisplayOpacity(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)),i&t.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~t.contentDirty),(s||i&t.textDirty)&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._rebuildLabelSkin()),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~t.transformDirty)},t._syncStatus=function(t){var i=_ccsg.Node._dirtyFlags,s=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(s|=i.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(s|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(s|=i.transformDirty);var h=s&i.colorDirty,r=s&i.opacityDirty;this._dirtyFlag=s,h&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),(h||r||this._dirtyFlag&i.textDirty)&&this._rebuildLabelSkin(),this._dirtyFlag&i.transformDirty&&this.transform(t)},t._getLineHeight=function(){var t=this._node.getLineHeight(),i=this._node;return 0|(t=0===t?i._fontSize:t*i._fontSize/this._drawFontsize)},t._constructFontDesc=function(){var t=this._node,i=t._fontSize.toString()+"px ";return i+=0===t._fontHandle.length?"serif":t._fontHandle,t._isBold&&(i="bold "+i),i},t._measureText=function(t){return function(i){return t.measureText(i).width}},t._calculateLabelFont=function(){var t=this._node,i=t._string.split("\n");t._fontSize=t._drawFontsize;var s=this._constructFontDesc();this._labelContext.font=s;var n=this._calculateParagraphLength(i,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===t._overFlow){this._splitedStrings=i;var h=0,r=0,e=0;if(t._isWrapText){var c=this._canvasSize.width-2*this._getMargin(),o=this._canvasSize.height-2*this._getMargin();if(c<0||o<0)return s=this._constructFontDesc(),this._labelContext.font=s,s;r=o+1,e=c+1;for(var u=this._drawFontsize+1,a="",f=!0,l=0|u;r>o||e>c;){if(f?u=l/2|0:l=u=l-1,u<=0){cc.logID(4003);break}for(t._fontSize=u,s=this._constructFontDesc(),this._labelContext.font=s,this._splitedStrings=[],r=0,h=0;h<i.length;++h){var v=0,d=this._labelContext.measureText(i[h]).width;for(a=cc.TextUtils.fragmentText(i[h],d,c,this._measureText(this._labelContext));v<a.length;)e=this._labelContext.measureText(a[v]).width,r+=this._getLineHeight(),++v;this._splitedStrings=this._splitedStrings.concat(a)}f&&(r>o?l=0|u:(f=!1,r=o+1))}}else{for(r=i.length*this._getLineHeight(),h=0;h<i.length;++h)e<n[h]&&(e=n[h]);var p=(this._canvasSize.width-2*this._getMargin())/e,g=this._canvasSize.height/r;t._fontSize=this._drawFontsize*Math.min(1,p,g)|0,s=this._constructFontDesc(),this._labelContext.font=s}}return s},t._getMargin=function(){return this._node&&this._node._margin||0},t._calculateParagraphLength=function(t,i){for(var s=[],n=0;n<t.length;++n){var h=i.measureText(t[n]);s.push(h.width)}return s},t._calculateCanvasSize=function(){var t=this._node,i=t._contentSize.width,s=t._contentSize.height;return i<=0&&(i=1),s<=0&&(s=1),cc.size(i,s)},t._calculateSplitedStrings=function(){var t,i=this._node,s=i._string.split("\n");if(i._isWrapText){this._splitedStrings=[];var n=this._canvasSize.width-2*this._getMargin();for(t=0;t<s.length;++t){var h=this._labelContext.measureText(s[t]).width,r=cc.TextUtils.fragmentText(s[t],h,n,this._measureText(this._labelContext));this._splitedStrings=this._splitedStrings.concat(r)}}else this._splitedStrings=s},t._updateLabelDimensions=function(){var t,i=this._node,s=i._string.split("\n"),n=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===i._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(i,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===i._overFlow){this._splitedStrings=s;var h=0,r=0;for(t=0;t<s.length;++t){var e=n.measureText(s[t]).width;h=h>e?h:e}r=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=parseFloat(h.toFixed(2))+2*this._getMargin(),this._canvasSize.height=parseFloat(r.toFixed(2)),i._isItalic&&(this._canvasSize.width+=i._drawFontsize*Math.tan(.20943951)),_ccsg.Node.prototype.setContentSize.call(i,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},t._calculateFillTextStartPosition=function(){var t,i,s=this._node,n=this._getLineHeight(),h=this._splitedStrings.length;return t=cc.TextAlignment.RIGHT===s._hAlign?this._canvasSize.width-this._getMargin():cc.TextAlignment.CENTER===s._hAlign?this._canvasSize.width/2:0+this._getMargin(),i=cc.VerticalTextAlignment.TOP===s._vAlign?0:cc.VerticalTextAlignment.CENTER===s._vAlign?this._canvasSize.height/2-n*(h-1)/2:this._canvasSize.height-n*(h-1),cc.p(t,i)},t._calculateTextBaseline=function(){var t,i,s=this._node;t=cc.TextAlignment.RIGHT===s._hAlign?"right":cc.TextAlignment.CENTER===s._hAlign?"center":"left",this._labelContext.textAlign=t,i=cc.VerticalTextAlignment.TOP===s._vAlign?"top":cc.VerticalTextAlignment.CENTER===s._vAlign?"middle":"bottom",this._labelContext.textBaseline=i},t._bakeLabel=function(){var t=this._node;this._drawFontsize=t._drawFontsize,this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},t._calculateUnderlineStartPosition=function(){var t,i,s=this._node,n=this._getLineHeight(),h=this._splitedStrings.length;return t=0+this._getMargin(),i=cc.VerticalTextAlignment.TOP===s._vAlign?s._fontSize:cc.VerticalTextAlignment.CENTER===s._vAlign?this._canvasSize.height/2-n*(h-1)/2+s._fontSize/2:this._canvasSize.height-n*(h-1),cc.p(t,i)},t._updateTexture=function(){this._labelContext.clearRect(0,0,this._labelCanvas.width,this._labelCanvas.height),this._labelContext.font=this._fontDesc;var t=this._calculateFillTextStartPosition(),i=this._getLineHeight();this._labelContext.lineJoin="round";var s=this._displayedColor;this._labelContext.fillStyle="rgb("+s.r+","+s.g+","+s.b+")";for(var n,h=0;h<this._splitedStrings.length;++h){if(this._node.isOutlined()){var r=this._node.getOutlineColor()||cc.color(255,255,255,255);this._labelContext.globalCompositeOperation="source-over",this._labelContext.strokeStyle="rgb("+r.r+","+r.g+","+r.b+")",this._labelContext.lineWidth=2*this._node.getOutlineWidth(),this._labelContext.strokeText(this._splitedStrings[h],t.x,t.y+h*i)}if(this._node.getFillColorGradientEnabled()){var e=this._node.getGradientStartColor()||cc.color(255,255,255,255),c=this._node.getGradientEndColor()||cc.color(255,255,255,255),o=this._getGradientArgs(),u=this._labelContext.createLinearGradient(o.left,o.top,o.right,o.bottom);u.addColorStop(0,cc.colorToHex(e)),u.addColorStop(1,cc.colorToHex(c)),this._labelContext.fillStyle=u}this._labelContext.fillText(this._splitedStrings[h],t.x,t.y+h*i),this._node._isUnderline&&(n=this._calculateUnderlineStartPosition(),this._labelContext.save(),this._labelContext.beginPath(),this._labelContext.lineWidth=this._node._fontSize/8,this._labelContext.strokeStyle="rgb("+s.r+","+s.g+","+s.b+")",this._labelContext.moveTo(n.x,n.y+h*i-1),this._labelContext.lineTo(n.x+this._labelCanvas.width,n.y+h*i-1),this._labelContext.stroke(),this._labelContext.restore())}this._texture._textureLoaded=!1,this._texture._htmlElementObj=this._labelCanvas,this._texture.handleLoadedTexture(!0)},t._getGradientArgs=function(){this._gradientArgument={},this._gradientArgument.left=0,this._gradientArgument.top=0;var t=this._node._contentSize;switch(this._node.getFillColorGradientDirection()){case 0:this._gradientArgument.right=t.width,this._gradientArgument.bottom=0;break;case 1:this._gradientArgument.right=0,this._gradientArgument.bottom=t.height;break;case 2:this._gradientArgument.right=t.width,this._gradientArgument.bottom=t.height}return this._gradientArgument},t._rebuildLabelSkin=function(){this._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty,this._node._updateLabel()}}(),function(){_ccsg.Label.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._texture.initWithElement(this._labelCanvas),this._splitedStrings=null};var t=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(t,_ccsg.Label.TTFLabelBaker.prototype),t.constructor=_ccsg.Label.CanvasRenderCmd,t.transform=function(t,i){this.originTransform(t,i);var s=this._currentRegion,n=s._minX,h=s._maxX,r=s._minY,e=s._maxY,c=cc.visibleRect,o=c.left.x,u=c.right.x,a=c.top.y,f=c.bottom.y;this._needDraw=!(h<o||n>u||e<f||r>a)},t.rendering=function(t,i,s){var n=this._node;if(n._labelType===_ccsg.Label.Type.TTF||n._labelType===_ccsg.Label.Type.SystemFont){var h=this._displayedOpacity,r=h/255;if(0===h)return;var e=t||cc._renderContext,c=e.getContext();if(e.setTransform(this._worldTransform,i,s),e.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),e.setGlobalAlpha(r),this._texture){var o,u,a,f,l;a=-this._node._contentSize.height,f=this._node._contentSize.width,l=this._node._contentSize.height,o=this._texture.getPixelWidth(),u=this._texture.getPixelHeight();var v=this._texture._htmlElementObj;""!==this._texture._pattern?(e.setFillStyle(c.createPattern(v,this._texture._pattern)),c.fillRect(0,a,f,l)):0!==o&&0!==u&&0!==f&&0!==l&&c.drawImage(v,0,0,o,u,0,a,f,l)}cc.g_NumberOfDraws=cc.g_NumberOfDraws+1}}}()},{}],126:[function(t,i,s){_ccsg.Label.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,this._labelCanvas=document.createElement("canvas"),this._texture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._splitedStrings=null,this._drawFontsize=0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:1},{x:0,y:0,u:1,v:0},{x:0,y:0,u:1,v:1}],this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var n=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(n,_ccsg.Label.TTFLabelBaker.prototype),n.constructor=_ccsg.Label.WebGLRenderCmd,n.transform=function(t,i){this.originTransform(t,i);var s=this._node,n=this._labelCanvas.width,h=this._labelCanvas.height,r=this._worldTransform,e=this._vertices;if(e[0].x=0*r.a+h*r.c+r.tx,e[0].y=0*r.b+h*r.d+r.ty,e[1].x=0*r.a+0*r.c+r.tx,e[1].y=0*r.b+0*r.d+r.ty,e[2].x=n*r.a+h*r.c+r.tx,e[2].y=n*r.b+h*r.d+r.ty,e[3].x=n*r.a+0*r.c+r.tx,e[3].y=n*r.b+0*r.d+r.ty,s._string&&(s._labelType===_ccsg.Label.Type.TTF||s._labelType===_ccsg.Label.Type.SystemFont)){var c,o,u,a,f=cc.visibleRect;this._cameraFlag>0&&(f=cc.Camera.main.visibleRect),c=f.left.x,o=f.right.x,a=f.top.y,u=f.bottom.y,(e[0].x-c&e[1].x-c&e[2].x-c&e[3].x-c)>>31||(o-e[0].x&o-e[1].x&o-e[2].x&o-e[3].x)>>31||(e[0].y-u&e[1].y-u&e[2].y-u&e[3].y-u)>>31||(a-e[0].y&a-e[1].y&a-e[2].y&a-e[3].y)>>31?this._needDraw=!1:this._needDraw=!0}},n.uploadData=function(t,i,s){var n=this._node;if(!n._string||n._labelType!==_ccsg.Label.Type.TTF&&n._labelType!==_ccsg.Label.Type.SystemFont)return 0;var h=this._displayedOpacity;this._color[0]=h<<24|h<<16|h<<8|h;var r,e,c=n._vertexZ,o=this._vertices,u=o.length,a=s;for(r=0;r<u;++r)e=o[r],t[a]=e.x,t[a+1]=e.y,t[a+2]=c,i[a+3]=this._color[0],t[a+4]=e.u,t[a+5]=e.v,a+=6;return u}},{}],127:[function(t,i,s){var n=function(){this._status="unloaded",this._observers=[],this._isLoadWithCSS=!1};n.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach(function(t){t()})},n.prototype.isLoaded=function(){return"loaded"===this._status},n.prototype.addHandler=function(t){-1===this._observers.indexOf(t)&&this._observers.push(t)};var h={_fontCache:{},_fontWidthCache:{},_canvasContext:null,_testString:"BESbswy",_allFontsLoaded:!1,_intervalId:0,loadTTF:function(t,i){var s=this._getFontFamily(t),n=cc.loader.md5Pipe;n&&(t=n.transformURL(t));var h=cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_APP&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&h?this._loadWithFontFace(s,t,i):this._loadWithCSS(s,t,i),0===this._intervalId&&(this._intervalId=setInterval(this._checkFontLoaded.bind(this),100))},_checkFontLoaded:function(){this._allFontsLoaded=!0;for(var t in this._fontCache){var i=this._fontCache[t];if(!i.isLoaded()&&i._isLoadWithCSS){var s=this._fontWidthCache[t];this._canvasContext.font="40px "+t,s!==this._canvasContext.measureText(this._testString).width?i.onLoaded():this._allFontsLoaded=!1}}this._allFontsLoaded&&(clearInterval(this._intervalId),this._intervalId=0)},_loadWithFontFace:function(t,i,s){var h=this._fontCache[t];if(h)h.isLoaded()||h.addHandler(s);else{var r=new FontFace(t,"url('"+i+"')");document.fonts.add(r),(h=new n).addHandler(s),this._fontCache[t]=h,r.loaded.then(function(){h.onLoaded()})}},_loadWithCSS:function(t,i,s){var h=this._fontCache[t];if(h)h.isLoaded()||h.addHandler(s);else{var r=document,e=document.createElement("style");e.type="text/css",r.body.appendChild(e);var c="";isNaN(t-0)?c+="@font-face { font-family:"+t+"; src:":c+="@font-face { font-family:'"+t+"'; src:",c+="url('"+i+"');",e.textContent=c+"}";var o=document.createElement("div"),u=o.style;if(u.fontFamily=t,o.innerHTML=".",u.position="absolute",u.left="-100px",u.top="-100px",r.body.appendChild(o),(h=new n).addHandler(s),this._fontCache[t]=h,h._isLoadWithCSS=!0,!this._canvasContext){var a=document.createElement("canvas");a.width=100,a.height=100,this._canvasContext=a.getContext("2d")}var f="40px "+t;this._canvasContext.font=f;var l=this._canvasContext.measureText(this._testString).width;this._fontWidthCache[t]=l;var v=this;e.onload=function(){setTimeout(function(){v._allFontsLoaded||(cc.logID(4004),h.onLoaded(),cc.director.getScheduler().unschedule(this._checkFontLoaded,this))},2e4)}}},_getFontFamily:function(t){var i=t.lastIndexOf(".ttf");if(-1===i)return t;var s=t.lastIndexOf("/");return-1===s?t.substring(0,i)+"_LABEL":t.substring(s+1,i)+"_LABEL"}};cc.TextUtils=i.exports={label_wordRex:/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,label_symbolRex:/^[!,.:;}\]%\?>、‘“》？。，！]/,label_lastWordRex:/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+$/,label_firsrEnglish:/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]/,label_wrapinspection:!0,isUnicodeCJK:function(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)},isUnicodeSpace:function(t){return(t=t.charCodeAt(0))>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},fragmentText:function(t,i,s,n){var h=[];if(0===t.length||s<0)return h.push(""),h;for(var r=t;i>s&&r.length>1;){for(var e=r.length*(s/i)|0,c=r.substr(e),o=i-n(c),u=c,a=0,f=0;o>s&&f++<10;)e*=s/o,e|=0,o=i-n(c=r.substr(e));for(f=0;o<s&&f++<10;){if(c){var l=this.label_wordRex.exec(c);a=l?l[0].length:1,u=c}e+=a,o=i-n(c=r.substr(e))}0==(e-=a)&&(e=1,u=u.substr(1));var v,d=r.substr(0,e);this.label_wrapinspection&&this.label_symbolRex.test(u||c)&&(0==(e-=(v=this.label_lastWordRex.exec(d))?v[0].length:0)&&(e=1),u=r.substr(e),d=r.substr(0,e)),this.label_firsrEnglish.test(u)&&(v=this.label_lastEnglish.exec(d))&&d!==v[0]&&(e-=v[0].length,u=r.substr(e),d=r.substr(0,e)),d.trim().length>0&&h.push(d),i=n(r=u||c)}return r.length>0&&h.push(r),h}},cc.CustomFontLoader=i.exports=h},{}],128:[function(t,i,s){function n(t){var i,s,n;if("object"==typeof t){if(s=t,t.url)return s;i=t.uuid}else s={},i=t;return n=s.type?"uuid"===s.type:cc.AssetLibrary._getAssetUrl(i),cc.AssetLibrary._getAssetInfoInRuntime(i,p),s.url=n?p.url:i,p.url&&"uuid"===s.type&&p.raw?(s.type=null,s.isRawAsset=!0):n||(s.isRawAsset=!0),s}function h(){var t=new o,i=new u,s=new a;e.call(this,[t,i,s]),this.assetLoader=t,this.downloader=i,this.loader=s,this.onProgress=null,this._autoReleaseSetting={}}var r=t("../platform/js"),e=t("./pipeline"),c=t("./loading-items"),o=t("./asset-loader"),u=t("./downloader"),a=t("./loader"),f=t("./asset-table"),l=t("../platform/utils").callInNextTick,v=t("./auto-release-utils"),d=new f,p={url:null,raw:!1},g=[],m=[];r.extend(h,e);var w=h.prototype;w.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},w.addDownloadHandlers=function(t){this.downloader.addHandlers(t)},w.addLoadHandlers=function(t){this.loader.addHandlers(t)},w.load=function(t,i,s){void 0===s&&(s=i,i=this.onProgress||null);var h=this,r=!1;t instanceof Array||(r=!0,t=t?[t]:[]),g.length=0;for(var e=0;e<t.length;++e){var o=t[e];o&&o.id&&(cc.warnID(4920,o.id),o.uuid||o.url||(o.url=o.id));var u=n(o);if(u.url||u.uuid){var a=this._cache[u.url];g.push(a||u)}}var f=c.create(this,i,function(t,i){l(function(){s&&(r?(n=u.url,s.call(h,i.getError(n),i.getContent(n))):s.call(h,t,i),s=null);var n;i.destroy()})});c.initQueueDeps(f),f.append(g),g.length=0},w.flowInDeps=function(t,i,s){m.length=0;for(var h=0;h<i.length;++h){var r=n(i[h]);if(r.url||r.uuid){var e=this._cache[r.url];e?m.push(e):m.push(r)}}var o=c.create(this,t?function(t,i,s){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(s)}:null,function(i,n){s(i,n),t&&t.deps&&(t.deps.length=0),n.destroy()});if(t){var u=c.getQueue(t);o._ownerQueue=u._ownerQueue||u}var a=o.append(m,t);return m.length=0,a},w._resources=d,w._getResUuid=function(t,i,s){if(!t)return null;var n=t.indexOf("?");-1!==n&&(t=t.substr(0,n));var h=d.getUuid(t,i);if(!h){var r=cc.path.extname(t);r&&(t=t.slice(0,-r.length),(h=d.getUuid(t,i))&&!s&&cc.warnID(4901,t,r))}return h},w._getReferenceKey=function(t){var i;return"object"==typeof t?i=t._uuid||null:"string"==typeof t&&(i=this._getResUuid(t,null,!0)||t),i?(cc.AssetLibrary._getAssetInfoInRuntime(i,p),this._cache[p.url]?p.url:i):(cc.warnID(4800,t),i)},w._urlNotFound=function(t,i,s){l(function(){t=cc.url.normalize(t);var n=(i?r.getClassName(i):"Asset")+' in "resources/'+t+'" does not exist.';s&&s(new Error(n),[])})},w._parseLoadResArgs=function(t,i,s){if(void 0===s){var n=cc.isChildClassOf(t,cc.RawAsset);i?(s=i,n&&(i=this.onProgress||null)):void 0!==i||n||(s=t,i=this.onProgress||null,t=null),void 0===i||n||(i=t,t=null)}return{type:t,onProgress:i,onComplete:s}},w.loadRes=function(t,i,s,n){var h=this._parseLoadResArgs(i,s,n);i=h.type,s=h.onProgress,n=h.onComplete;var r=this,e=r._getResUuid(t,i);e?this.load({type:"uuid",uuid:e},s,function(t,i){i&&r.setAutoReleaseRecursively(e,!1),n&&n(t,i)}):r._urlNotFound(t,i,n)},w._loadResUuids=function(t,i,s,n){if(t.length>0){var h=this,r=t.map(function(t){return{type:"uuid",uuid:t}});this.load(r,i,function(t,i){if(s){for(var e=[],c=n&&[],o=0;o<r.length;++o){var u=r[o].uuid,a=this._getReferenceKey(u),f=i.getContent(a);f&&(h.setAutoReleaseRecursively(u,!1),e.push(f),c&&c.push(n[o]))}n?s(t,e,c):s(t,e)}})}else s&&l(function(){n?s(null,[],[]):s(null,[])})},w.loadResArray=function(t,i,s,n){var h=this._parseLoadResArgs(i,s,n);i=h.type,s=h.onProgress,n=h.onComplete;for(var r=[],e=0;e<t.length;e++){var c=t[e],o=this._getResUuid(c,i);if(!o)return void this._urlNotFound(c,i,n);r.push(o)}this._loadResUuids(r,s,n)},w.loadResDir=function(t,i,s,n){var h=this._parseLoadResArgs(i,s,n);i=h.type,s=h.onProgress,n=h.onComplete;var r=[],e=d.getUuidArray(t,i,r);this._loadResUuids(e,s,n,r)},w.getRes=function(t,i){var s=this._cache[t];if(!s){var n=this._getResUuid(t,i,!0);if(!n)return null;var h=this._getReferenceKey(n);s=this._cache[h]}return s&&s.alias&&(s=s.alias),s&&s.complete?s.content:null},w.getResCount=function(){return Object.keys(this._cache).length},w.getDependsRecursively=function(t){if(t){var i=this._getReferenceKey(t),s=v.getDependsRecursively(i);return s.push(i),s}return[]},w.release=function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var s=t[i];this.release(s)}else if(t){var n=this._getReferenceKey(t),h=this.getItem(n);if(h)if(this.removeItem(n),(t=h.content)instanceof cc.Asset)for(var r=t.rawUrls,e=0;e<r.length;e++)this.release(r[e]);else t instanceof cc.Texture2D&&cc.textureCache.removeTextureForKey(h.url)}},w.releaseAsset=function(t){var i=t._uuid;i&&this.release(i)},w.releaseRes=function(t,i){var s=this._getResUuid(t,i);s?this.release(s):cc.errorID(4914,t)},w.releaseResDir=function(t,i){for(var s=d.getUuidArray(t,i),n=0;n<s.length;n++){var h=s[n];this.release(h)}},w.releaseAll=function(){for(var t in this._cache)this.release(t)},w.removeItem=function(t){var i=e.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],i},w.setAutoRelease=function(t,i){var s=this._getReferenceKey(t);s&&(this._autoReleaseSetting[s]=!!i)},w.setAutoReleaseRecursively=function(t,i){i=!!i;var s=this._getReferenceKey(t);if(s){this._autoReleaseSetting[s]=i;for(var n=v.getDependsRecursively(s),h=0;h<n.length;h++){var r=n[h];this._autoReleaseSetting[r]=i}}},w.isAutoRelease=function(t){var i=this._getReferenceKey(t);return!!i&&!!this._autoReleaseSetting[i]},cc.loader=new h,i.exports=cc.loader},{"../platform/js":192,"../platform/utils":197,"./asset-loader":129,"./asset-table":130,"./auto-release-utils":132,"./downloader":133,"./loader":136,"./loading-items":137,"./pipeline":140}],129:[function(t,i,s){var n=t("../utils/CCPath"),h=t("./pipeline"),r=t("./loading-items"),e=function(t){this.id="AssetLoader",this.async=!0,this.pipeline=null};e.ID="AssetLoader";var c=[];e.prototype.handle=function(t,i){var s=t.uuid;if(!s)return t.content?t.content:null;cc.AssetLibrary.queryAssetInfo(s,function(h,e,o){if(h)i(h);else if(t.url=t.rawUrl=e,t.isRawAsset=o,o){var u=n.extname(e).toLowerCase();if(!u)return void i(new Error("Download Uuid: can not find type of raw asset["+s+"]: "+e));u=u.substr(1);var a=r.getQueue(t);c[0]={queueId:t.queueId,id:e,url:e,type:u,error:null,alias:t,complete:!0},a.append(c),t.type=u,i(null,t.content)}else t.type="uuid",i(null,t.content)})},h.AssetLoader=i.exports=e},{"../utils/CCPath":216,"./loading-items":137,"./pipeline":140}],130:[function(t,i,s){function n(){this._pathToUuid={}}function h(t,i){if(t.length>i.length){var s=t.charCodeAt(i.length);return 46===s||47===s}return!0}var r=n.prototype;r.getUuid=function(t,i){t=cc.url.normalize(t);var s=this._pathToUuid[t];if(s)if(Array.isArray(s)){if(!i)return s[0].uuid;for(var n=0;n<s.length;n++){var h=s[n];if(cc.isChildClassOf(h.type,i))return h.uuid}}else if(!i||cc.isChildClassOf(s.type,i))return s.uuid;return""},r.getUuidArray=function(t,i,s){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var n=this._pathToUuid,r=[],e=cc.isChildClassOf;for(var c in n)if(c.startsWith(t)&&h(c,t)||!t){var o=n[c];if(Array.isArray(o))for(var u=0;u<o.length;u++){var a=o[u];i&&!e(a.type,i)||(r.push(a.uuid),s&&s.push(c))}else i&&!e(o.type,i)||(r.push(o.uuid),s&&s.push(c))}return r},r.getAllPaths=function(){return Object.keys(this._pathToUuid)},r.add=function(t,i,s,n){t=t.substring(0,t.length-cc.path.extname(t).length);var h=new function(t,i){this.uuid=t,this.type=i}(i,s),r=this._pathToUuid,e=r[t];e?Array.isArray(e)?n?e.unshift(h):e.push(h):r[t]=n?[h,e]:[e,h]:r[t]=h},r.reset=function(){this._pathToUuid={}},i.exports=n},{}],131:[function(t,i,s){t("../utils/CCPath");var n=t("../platform/CCSys"),h=(t("./pipeline"),t("../../audio/CCAudioEngine"),n.__audioSupport),r=h.format,e=h.context;i.exports=function(t,i){if(0===r.length)return new Error("Audio Downloader: audio not supported on this browser!");t.content=t.url,!h.WEB_AUDIO||t.urlParam&&t.urlParam.useDom?function(t,i){var s=document.createElement("audio");s.src=t.url;var n=function(){clearTimeout(r),s.removeEventListener("canplaythrough",e,!1),s.removeEventListener("error",c,!1),h.USE_LOADER_EVENT&&s.removeEventListener(h.USE_LOADER_EVENT,e,!1)},r=setTimeout(function(){0===s.readyState?c():e()},8e3),e=function(){n(),t.element=s,i(null,t.url)},c=function(){n();var s="load audio failure - "+t.url;cc.log(s),i(s,t.url)};s.addEventListener("canplaythrough",e,!1),s.addEventListener("error",c,!1),h.USE_LOADER_EVENT&&s.addEventListener(h.USE_LOADER_EVENT,e,!1)}(t,i):function(t,i){e||i(new Error("Audio Downloader: no web audio context."));var s=cc.loader.getXMLHttpRequest();s.open("GET",t.url,!0),s.responseType="arraybuffer",s.onload=function(){e.decodeAudioData(s.response,function(s){t.buffer=s,i(null,t.url)},function(){i("decode error - "+t.url,null)})},s.onerror=function(){i("request error - "+t.url,null)},s.send()}(t,i)}},{"../../audio/CCAudioEngine":24,"../platform/CCSys":181,"../utils/CCPath":216,"./pipeline":140}],132:[function(t,i,s){function n(t,i){var s=cc.loader.getItem(t);if(s){var h=s.dependKeys;if(h)for(var r=0;r<h.length;r++){var e=h[r];i[e]||(i[e]=!0,n(e,i))}}}function h(t,i){var s=cc.loader._getReferenceKey(t);i[s]||(i[s]=!0,n(s,i))}function r(t,i){for(var s=Object.getOwnPropertyNames(t),n=0;n<s.length;n++){var r=t[s[n]];if("object"==typeof r&&r)if(Array.isArray(r))for(var e=0;e<r.length;e++){var c=r[e];c instanceof cc.RawAsset&&h(c,i)}else if(r.constructor&&r.constructor!==Object)r instanceof cc.RawAsset&&h(r,i);else for(var o=Object.getOwnPropertyNames(r),u=0;u<o.length;u++){var a=r[o[u]];a instanceof cc.RawAsset&&h(a,i)}}}function e(t,i){for(var s=0;s<t._components.length;s++)r(t._components[s],i);for(var n=0;n<t._children.length;n++)e(t._children[n],i)}var c=t("../platform/js");i.exports={autoRelease:function(t,i,s){var n=cc.loader._autoReleaseSetting,h=c.createMap();if(i)for(var r=0;r<i.length;r++)h[i[r]]=!0;for(var o=0;o<s.length;o++)e(s[o],h);if(t)for(var u=0;u<t.length;u++){var a=t[u];!1===n[a]||h[a]||cc.loader.release(a)}for(var f=Object.keys(n),l=0;l<f.length;l++){var v=f[l];!0!==n[v]||h[v]||cc.loader.release(v)}},getDependsRecursively:function(t){var i={};return n(t,i),Object.keys(i)}}},{"../platform/js":192}],133:[function(t,i,s){function n(t,i,s,h){void 0===s&&(s=!0);var r=v(t.url);if(h=h||u.imagePool.get(),s&&"file:"!==window.location.protocol?h.crossOrigin="anonymous":h.crossOrigin=null,h.complete&&h.naturalWidth>0&&h.src===r)return h;!function(){function s(){h.removeEventListener("load",s),h.removeEventListener("error",e),i(null,h)}function e(){h.removeEventListener("load",s),h.removeEventListener("error",e),"https:"!==window.location.protocol&&h.crossOrigin&&"anonymous"===h.crossOrigin.toLowerCase()?n(t,i,!1,h):i(new Error("Load image ("+r+") failed"))}h.addEventListener("load",s),h.addEventListener("error",e),h.src=r}()}function h(t,i,s){var n=document,h=document.createElement("style");h.type="text/css",n.body.appendChild(h);var r="";if(isNaN(t-0)?r+="@font-face { font-family:"+t+"; src:":r+="@font-face { font-family:'"+t+"'; src:",i instanceof Array)for(var e=0,c=i.length;e<c;e++){var u=i[e];s=o.extname(u).toLowerCase(),r+="url('"+i[e]+"') format('"+d[s]+"')",r+=e===c-1?";":","}else s=s.toLowerCase(),r+="url('"+i+"') format('"+d[s]+"');";h.textContent+=r+"}";var a=document.createElement("div"),f=a.style;f.fontFamily=t,a.innerHTML=".",f.position="absolute",f.left="-100px",f.top="-100px",n.body.appendChild(a)}function r(t,i){var s=t.url,n=t.type,r=t.name,e=t.srcs;if(r&&e?(-1===e.indexOf(s)&&e.push(s),h(r,e)):(n=o.extname(s),h(r=o.basename(s,n),s,n)),!document.fonts)return null;document.fonts.load("1em "+r).then(function(){i(null,null)},function(t){i(t)})}var e,c=t("../platform/js"),o=t("../utils/CCPath"),u=t("../utils/misc"),a=t("./pipeline"),f=t("./pack-downloader"),l=t("./text-downloader"),v=t("./utils").urlAppendTimestamp,d={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},p={js:function(t,i,s){function n(){c.parentNode.removeChild(c),c.removeEventListener("load",n,!1),c.removeEventListener("error",h,!1),i(null,r)}function h(){c.parentNode.removeChild(c),c.removeEventListener("load",n,!1),c.removeEventListener("error",h,!1),i(new Error("Load "+r+" failed!"),r)}var r=t.url,e=document,c=document.createElement("script");c.async=s,c.src=v(r),c.addEventListener("load",n,!1),c.addEventListener("error",h,!1),e.body.appendChild(c)},png:n,jpg:n,bmp:n,jpeg:n,gif:n,ico:n,tiff:n,webp:function(t,i,s,h){return cc.sys.capabilities.webp?n(t,i,s,h):new Error("Load Webp ( "+t.url+" ) failed")},image:n,mp3:e=t("./audio-downloader"),ogg:e,wav:e,m4a:e,txt:l,xml:l,vsh:l,fsh:l,atlas:l,tmx:l,tsx:l,json:l,ExportJson:l,plist:l,fnt:l,font:r,eot:r,ttf:r,woff:r,svg:r,ttc:r,uuid:function(t,i){var s=f.load(t,i);return void 0===s?this.extMap.json(t,i):s||void 0},default:l},g=function(t){this.id="Downloader",this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this.extMap=c.mixin(t,p)};g.ID="Downloader",g.prototype.addHandlers=function(t){c.mixin(this.extMap,t)},g.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var i=this.handle(t.item,t.callback);void 0!==i&&(i instanceof Error?t.callback(i):t.callback(null,i))}},g.prototype.handle=function(t,i){var s=this,n=this.extMap[t.type]||this.extMap.default,h=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(h=n.call(this,t,function(t,n){s._curConcurrent=Math.max(0,s._curConcurrent-1),s._handleLoadQueue(),i&&i(t,n)})))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),h}else if(t.ignoreMaxConcurrency){if(void 0!==(h=n.call(this,t,i)))return h}else this._loadQueue.push({item:t,callback:i})},a.Downloader=i.exports=g},{"../platform/js":192,"../utils/CCPath":216,"../utils/misc":223,"./audio-downloader":131,"./pack-downloader":139,"./pipeline":140,"./text-downloader":141,"./utils":142}],134:[function(t,i,s){t("./downloader"),t("./loader"),t("./json-unpacker"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":128,"./downloader":133,"./json-unpacker":135,"./loader":136,"./loading-items":137,"./pipeline":140}],135:[function(t,i,s){function n(){this.jsons={},this.state=-1}n.prototype.read=function(t,i){var s="string"==typeof i?JSON.parse(i):i;s.length!==t.length&&cc.errorID(4915);for(var n=0;n<t.length;n++){var h=t[n],r=s[n];this.jsons[h]=r}},n.prototype.retrieve=function(t){return this.jsons[t]||null},i.exports=n},{}],136:[function(t,i,s){function n(t,i){if("string"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(t.content)}catch(i){return new Error("JSON Loader: Parse json ["+t.id+"] failed : "+i)}}function h(t,i){if(!(t.content instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var s=t.rawUrl,n=cc.textureCache.getTextureForKey(s)||new c;return n.url=s,n.initWithElement(t.content),n.handleLoadedTexture(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&u.imagePool.put(t.content),cc.textureCache.cacheImage(s,n),n}var r=t("../platform/js"),e=t("./pipeline"),c=t("../textures/CCTexture2D"),o=t("./uuid-loader"),u=t("../utils/misc"),a={png:h,jpg:h,bmp:h,jpeg:h,gif:h,ico:h,tiff:h,webp:h,image:h,json:n,ExportJson:n,plist:function(t,i){return"string"!=typeof t.content?new Error("Plist Loader: Input item doesn't contain string content"):cc.plistParser.parse(t.content)||new Error("Plist Loader: Parse ["+t.id+"] failed")},uuid:o,prefab:o,fire:o,scene:o,default:function(t,i){return null}},f=function(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=r.mixin(t,a)};f.ID="Loader",f.prototype.addHandlers=function(t){this.extMap=r.mixin(this.extMap,t)},f.prototype.handle=function(t,i){return(this.extMap[t.type]||this.extMap.default).call(this,t,i)},e.Loader=i.exports=f},{"../platform/js":192,"../textures/CCTexture2D":212,"../utils/misc":223,"./pipeline":140,"./uuid-loader":143}],137:[function(t,i,s){function n(t){return"string"==typeof(t.url||t)}function h(t,i){var s="object"==typeof t?t.url:t,n={queueId:i,id:s,url:s,rawUrl:void 0,urlParam:function(t){if(s){var i=s.split("?");if(i&&i[0]&&i[1]){var n={};return i[1].split("&").forEach(function(t){var i=t.split("=");n[i[0]]=i[1]}),n}}}(),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(o.mixin(n,t),t.skips))for(var h=0;h<t.skips.length;h++){var r=t.skips[h];n.states[r]=l.COMPLETE}return n.rawUrl=n.url,s&&!n.type&&(n.type=c.extname(s).toLowerCase().substr(1)),n}function r(t,i,s){if(!t||!i)return!1;var n=!1;if(d.push(i.id),i.deps){var h,e,c=i.deps;for(h=0;h<c.length;h++){if((e=c[h]).id===t.id){n=!0;break}if(!(d.indexOf(e.id)>=0)&&e.deps&&r(t,e,!0)){n=!0;break}}}return s||(d.length=0),n}var e=t("../platform/callbacks-invoker"),c=t("../utils/CCPath"),o=t("../platform/js"),u=0|998*Math.random(),a={},f=[],l={WORKING:1,COMPLETE:2,ERROR:3},v={},d=[],p=function(t,i,s,n){e.call(this),this._id=++u,a[this._id]=this,this._pipeline=t,this._errorUrls=[],this._appending=!1,this._ownerQueue=null,this.onProgress=s,this.onComplete=n,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,i&&(i.length>0?this.append(i):this.allComplete())};p.ItemState=new cc.Enum(l),p.create=function(t,i,s,n){void 0===s?"function"==typeof i&&(n=i,i=s=null):void 0===n&&("function"==typeof i?(n=s,s=i,i=null):(n=s,s=null));var h=f.pop();return h?(h._pipeline=t,h.onProgress=s,h.onComplete=n,a[h._id]=h,h._pipeline&&(h.active=!0),i&&h.append(i)):h=new p(t,i,s,n),h},p.getQueue=function(t){return t.queueId?a[t.queueId]:null},p.itemComplete=function(t){var i=a[t.queueId];i&&i.itemComplete(t.id)},p.initQueueDeps=function(t){var i=v[t._id];i?(i.completed.length=0,i.deps.length=0):i=v[t._id]={completed:[],deps:[]}},p.registerQueueDep=function(t,i){var s=t.queueId||t;if(!s)return!1;var n=v[s];if(n)-1===n.deps.indexOf(i)&&n.deps.push(i);else if(t.id)for(var h in v){var r=v[h];-1!==r.deps.indexOf(t.id)&&-1===r.deps.indexOf(i)&&r.deps.push(i)}},p.finishDep=function(t){for(var i in v){var s=v[i];-1!==s.deps.indexOf(t)&&-1===s.completed.indexOf(t)&&s.completed.push(t)}};var g=p.prototype;o.mixin(g,e.prototype),g.append=function(t,i){if(!this.active)return[];i&&!i.deps&&(i.deps=[]),this._appending=!0;var s,e,c,o=[];for(s=0;s<t.length;++s)if(!(e=t[s]).queueId||this.map[e.id]){if(n(e)){var u=(c=h(e,this._id)).id;this.map[u]||(this.map[u]=c,this.totalCount++,i&&i.deps.push(c),p.registerQueueDep(i||this._id,u),o.push(c))}}else{if(this.map[e.id]=e,i&&i.deps.push(e),e.complete||r(i,e)){this.totalCount++,this.itemComplete(e.id);continue}var f=this,l=a[e.queueId];l&&(this.totalCount++,p.registerQueueDep(i||this._id,e.id),l.addListener(e.id,function(t){f.itemComplete(t.id)}))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(o),o},g._childOnProgress=function(t){if(this.onProgress){var i=v[this._id];this.onProgress(i?i.completed.length:this.completedCount,i?i.deps.length:this.totalCount,t)}},g.allComplete=function(){var t=0===this._errorUrls.length?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},g.isCompleted=function(){return this.completedCount>=this.totalCount},g.isItemCompleted=function(t){return!!this.completed[t]},g.exists=function(t){return!!this.map[t]},g.getContent=function(t){var i=this.map[t],s=null;return i&&(i.content?s=i.content:i.alias&&(s=i.alias.content)),s},g.getError=function(t){var i=this.map[t],s=null;return i&&(i.error?s=i.error:i.alias&&(s=i.alias.error)),s},g.addListener=e.prototype.add,g.hasListener=e.prototype.has,g.removeListener=e.prototype.remove,g.removeAllListeners=e.prototype.removeAll,g.removeItem=function(t){var i=this.map[t];i&&this.completed[i.alias||t]&&(delete this.completed[t],delete this.map[t],i.alias&&(delete this.completed[i.alias.id],delete this.map[i.alias.id]),this.completedCount--,this.totalCount--)},g.itemComplete=function(t){var i=this.map[t];if(i){var s=this._errorUrls.indexOf(t);if(i.error&&-1===s?this._errorUrls.push(t):i.error||-1===s||this._errorUrls.splice(s,1),this.completed[t]=i,this.completedCount++,p.finishDep(i.id),this.onProgress){var n=v[this._id];this.onProgress(n?n.completed.length:this.completedCount,n?n.deps.length:this.totalCount,i)}this.invokeAndRemove(t,i),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},g.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,this._errorUrls.length=0,this.onProgress=null,this.onComplete=null,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,e.call(this),a[this._id]=null,v[this._id]&&(v[this._id].completed.length=0,v[this._id].deps.length=0),-1===f.indexOf(this)&&f.length<10&&f.push(this)},cc.LoadingItems=i.exports=p},{"../platform/callbacks-invoker":186,"../platform/js":192,"../utils/CCPath":216}],138:[function(t,i,s){var n=t("./pipeline"),h=/(\.[^.\n\\/]*)$/,r=function(t,i,s){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.libraryBase=i,this.rawAssetsBase=s};r.ID="MD5Pipe",r.prototype.handle=function(t){return t.url=this.transformURL(t.url),t},r.prototype.transformURL=function(t){var i=t.indexOf("?"),s=t;if(-1!==i&&(s=t.substr(0,i)),s.startsWith(this.libraryBase))s=s.slice(this.libraryBase.length);else{if(!s.startsWith(this.rawAssetsBase))return t;s=s.slice(this.rawAssetsBase.length)}var n=this.md5AssetsMap[s];if(n){var r=!1;t=t.replace(h,function(t,i){return r=!0,"."+n+i}),r||(t=t+"."+n)}return t},n.MD5Pipe=i.exports=r},{"./pipeline":140}],139:[function(t,i,s){function n(t,i){return new Error("Can not retrieve "+t+" from packer "+i)}var h=t("./json-unpacker"),r={},e={},c={};i.exports={initPacks:function(t){e=t;for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var h=s[n],c=r[h];if(c){if(Array.isArray(c)?c.push(i):r[h]=c=[c,i],1===s.length){var o=c[0];c[0]=c[c.length-1],c[c.length-1]=o}}else r[h]=i}},_loadNewPack:function(t,i,s){var h=this,r=cc.AssetLibrary.getLibUrlNoExt(i)+".json";cc.loader.load({url:r,ignoreMaxConcurrency:!0},function(r,e){if(r)return cc.errorID(4916,t),s(r);var c=h._doLoadNewPack(t,i,e);c?s(null,c):s(n(t,i))})},_doLoadNewPack:function(t,i,s){var n=c[i];return 3!==n.state&&(n.read(e[i],s),n.state=3),n.retrieve(t)},_selectLoadedPack:function(t){for(var i=0,s="",n=0;n<t.length;n++){var h=t[n],r=c[h];if(r){var e=r.state;if(3===e)return h;e>i&&(i=e,s=h)}}return 0!==i?s:t[0]},load:function(t,i){var s=t.uuid,e=r[s];if(e){Array.isArray(e)&&(e=this._selectLoadedPack(e));var o=c[e];return o&&3===o.state?o.retrieve(s)||n(s,e):(o||(console.log("Create unpacker %s for %s",e,s),(o=c[e]=new h).state=2),this._loadNewPack(s,e,i),null)}}}},{"./json-unpacker":135}],140:[function(t,i,s){function n(t,i){var s=t.id,h=i.states[s],e=t.next,c=t.pipeline;if(!i.error&&h!==r.WORKING&&h!==r.ERROR)if(h===r.COMPLETE)e?n(e,i):c.flowOut(i);else{i.states[s]=r.WORKING;var o=t.handle(i,function(t,h){t?(i.error=t,i.states[s]=r.ERROR,c.flowOut(i)):(h&&(i.content=h),i.states[s]=r.COMPLETE,e?n(e,i):c.flowOut(i))});o instanceof Error?(i.error=o,i.states[s]=r.ERROR,c.flowOut(i)):void 0!==o&&(null!==o&&(i.content=o),i.states[s]=r.COMPLETE,e?n(e,i):c.flowOut(i))}}t("../platform/js");var h=t("./loading-items"),r=h.ItemState,e=function(t){this._pipes=t,this._cache={};for(var i=0;i<t.length;++i){var s=t[i];s.handle&&s.id&&(s.pipeline=this,s.next=i<t.length-1?t[i+1]:null)}};e.ItemState=r;var c=e.prototype;c.insertPipe=function(t,i){if(!t.handle||!t.id||i>this._pipes.length)cc.warnID(4921);else if(this._pipes.indexOf(t)>0)cc.warnID(4922);else{t.pipeline=this;var s=null;i<this._pipes.length&&(s=this._pipes[i]);var n=null;i>0&&(n=this._pipes[i-1]),n&&(n.next=t),t.next=s,this._pipes.splice(i,0,t)}},c.insertPipeAfter=function(t,i){var s=this._pipes.indexOf(t);s<0||this.insertPipe(i,s+1)},c.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,this._pipes.length>0&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t))},c.flowIn=function(t){var i,s,h=this._pipes[0];if(h){for(i=0;i<t.length;i++)s=t[i],this._cache[s.id]=s;for(i=0;i<t.length;i++)n(h,s=t[i])}else for(i=0;i<t.length;i++)this.flowOut(t[i])},c.flowInDeps=function(t,i,s){return h.create(this,function(t,i){s(t,i),i.destroy()}).append(i,t)},c.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,h.itemComplete(t)},c.copyItemStates=function(t,i){if(i instanceof Array)for(var s=0;s<i.length;++s)i[s].states=t.states;else i.states=t.states},c.isFlowing=function(){return!0},c.getItems=function(){return null},c.getItem=function(t){var i=this._cache[t];return i?(i.alias&&(i=i.alias),i):i},c.removeItem=function(t){var i=this._cache[t];return i&&i.complete&&delete this._cache[t],i},c.clear=function(){for(var t in this._cache){var i=this._cache[t];delete this._cache[t],i.complete||(i.error=new Error("Canceled manually"),this.flowOut(i))}},cc.Pipeline=i.exports=e},{"../platform/js":192,"./loading-items":137}],141:[function(t,i,s){var n=t("./utils").urlAppendTimestamp;i.exports=function(t,i){var s=t.url,h=cc.loader.getXMLHttpRequest(),r="Load "+s+" failed!",e=window.navigator;s=n(s),h.open("GET",s,!0),/msie/i.test(e.userAgent)&&!/opera/i.test(e.userAgent)?(h.setRequestHeader("Accept-Charset","utf-8"),h.onreadystatechange=function(){4===h.readyState&&(200===h.status||0===h.status?i(null,h.responseText):i({status:h.status,errorMessage:r}))}):(h.overrideMimeType&&h.overrideMimeType("text/plain; charset=utf-8"),h.onload=function(){4===h.readyState&&(200===h.status||0===h.status?i(null,h.responseText):i({status:h.status,errorMessage:r}))},h.onerror=function(){i({status:h.status,errorMessage:r})}),h.send(null)}},{"./utils":142}],142:[function(t,i,s){var n=/\?/;i.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(n.test(t)?t+="&_t="+(new Date-0):t+="?_t="+(new Date-0)),t}}},{}],143:[function(t,i,s){function n(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__)}function h(t,i){var s;if("string"==typeof t.content)try{s=JSON.parse(t.content)}catch(i){return new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+i.stack)}else{if("object"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");s=t.content}var h,c=n(s);h=c?cc._MissingScript.safeFindClass:function(t){return r._getClassById(t)||(cc.warnID(4903,t),Object)};var o,u=cc.deserialize.Details.pool.get();try{o=cc.deserialize(s,u,{classFinder:h,target:t.existingAsset,customEnv:t})}catch(i){cc.deserialize.Details.pool.put(u);var a=i.stack;return new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+a)}o._uuid=t.uuid;var f=function(i,s,n){var h=t.deferredLoadRaw;return h?i instanceof cc.Asset&&i.constructor.preventDeferredLoadDependents&&(h=!1):n&&(i instanceof cc.SceneAsset||i instanceof cc.V)&&(h=i.asyncLoadAssets),h}(o,0,c);!function(t,i,s,n,h,r){var c,o,u,a,f,l=n.uuidList,v=i.dependKeys=[];if(h)for(c=[],o=[],u=[],a=0;a<l.length;a++){f=l[a];var d=n.uuidObjList[a],p=n.uuidPropList[a],g=cc.AssetLibrary._getAssetInfoInRuntime(f);if(g.raw){var m=g.url;d[p]=m,v.push(m)}else c.push(d),o.push(p),u.push({type:"uuid",uuid:f,deferredLoadRaw:!0})}else for(c=n.uuidObjList,o=n.uuidPropList,u=new Array(l.length),a=0;a<l.length;a++)f=l[a],u[a]={type:"uuid",uuid:f};if(n.rawProp&&(c.push(s),o.push(n.rawProp),u.push(i.url)),s._preloadRawFiles){var w=r;r=function(){s._preloadRawFiles(function(t){w(t||null,s)})}}if(0===u.length)return cc.deserialize.Details.pool.put(n),r(null,s);i.content=s,t.flowInDeps(i,u,function(t,i){function h(t){var i=t.isRawAsset?t.rawUrl:t.content;this.obj[this.prop]=i,t.uuid!==s._uuid&&v.indexOf(t.id)<0&&v.push(t.id)}var a;for(var f in i.map)(a=i.map[f]).uuid&&a.content&&(a.content._uuid=a.uuid);for(var l=0;l<u.length;l++){var d=u[l].uuid,p=u[l].url,g=c[l],m=o[l];if(a=i.map[p]){var w={obj:g,prop:m};if(a.complete||a.content)a.error?cc._throw(a.error):h.call(w,a);else{var _=e.getQueue(a),C=_._callbackTable[d];C?C.unshift(h,w):_.addListener(d,h,w)}}}cc.deserialize.Details.pool.put(n),r(null,s)})}(this.pipeline,t,o,u,f,i)}var r=t("../platform/js");t("../platform/deserialize");var e=t("./loading-items");i.exports=h,h.isSceneObj=n},{"../platform/deserialize":187,"../platform/js":192,"./loading-items":137}],144:[function(t,i,s){function n(t,i,s){i?t._removeComponent(i):c.array.removeAt(t._components,s)}function h(){this._activatingStack=[]}var r=t("./component-scheduler"),e=t("./platform/CCObject").Flags,c=t("./platform/js"),o=e.IsPreloadStarted,u=e.IsOnLoadStarted,a=e.IsOnLoadCalled,f=e.Deactivating,l=cc.T({S:r.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){r.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),v=r.createInvokeImpl("c.__preload();"),d=r.createInvokeImpl("c.onLoad();c._objFlags|="+a),p=new c.Pool(4);p.get=function(){var t=this._get()||{preload:new l(v),onLoad:new r.OneOffInvoker(d),onEnable:new r.OneOffInvoker(r.invokeOnEnable)};t.preload._zero.i=-1;var i=t.onLoad;return i._zero.i=-1,i._neg.i=-1,i._pos.i=-1,i=t.onEnable,i._zero.i=-1,i._neg.i=-1,i._pos.i=-1,t};var g=cc.T({ctor:h,reset:h,_activateNodeRecursively:function(t,i,s,h){if(t._objFlags&f)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var r=t._components.length,e=0;e<r;++e){var c=t._components[e];c instanceof cc.U?this.activateComp(c,i,s,h):(n(t,c,e),--e,--r)}for(var o=0,u=t._children.length;o<u;++o){var a=t._children[o];a._active&&this._activateNodeRecursively(a,i,s,h)}t._onPostActivated(!0)}},_deactivateNodeRecursively:function(t){t._objFlags|=f,t._activeInHierarchy=!1;for(var i=t._components.length,s=0;s<i;++s){var n=t._components[s];if(n._enabled&&(cc.director._compScheduler.disableComp(n),t._activeInHierarchy))return void(t._objFlags&=~f)}for(var h=0,r=t._children.length;h<r;++h){var e=t._children[h];if(e._activeInHierarchy&&(this._deactivateNodeRecursively(e),t._activeInHierarchy))return void(t._objFlags&=~f)}t._onPostActivated(!1),t._objFlags&=~f},activateNode:function(t,i){if(i){var s=p.get();this._activatingStack.push(s),this._activateNodeRecursively(t,s.preload,s.onLoad,s.onEnable),s.preload.invoke(),s.onLoad.invoke(),s.onEnable.invoke(),this._activatingStack.pop(),p.put(s)}else{this._deactivateNodeRecursively(t);for(var n=this._activatingStack,h=0;h<n.length;h++){var r=n[h];r.preload.cancelInactive(o),r.onLoad.cancelInactive(u),r.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,i,s,n){if(t._objFlags&o||(t._objFlags|=o,"function"==typeof t.__preload&&(i?i.add(t):t.__preload())),t._objFlags&u||(t._objFlags|=u,t.onLoad?s?s.add(t):(t.onLoad(),t._objFlags|=a):t._objFlags|=a),t._enabled){if(!t.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(t,n)}},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&a&&t.onDestroy()},resetComp:!1});i.exports=g},{"./component-scheduler":69,"./platform/CCObject":178,"./platform/js":192,"./utils/misc":223}],145:[function(t,i,s){function n(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0}function h(){}var r,e=t("./CCPhysicsTypes").PTM_RATIO,c=t("./CCPhysicsTypes").ContactType,o=[],u=[cc.v2(),cc.v2()];r=new b2.WorldManifold;var a={points:[],separations:[],normal:cc.v2()},f=[new n,new n];new b2.Manifold;var l={type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]},v={normalImpulses:[],tangentImpulses:[]};h.prototype._=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=t,t._contact=this},h.prototype.reset=function(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null},h.prototype.getWorldManifold=function(){var t=a.points,i=a.separations,s=a.normal;this._b2contact.GetWorldManifold(r);var n=r.points,h=r.separations,c=this._b2contact.GetManifold().pointCount;t.length=i.length=c;for(var o=0;o<c;o++){var f=u[o];f.x=n[o].x*e,f.y=n[o].y*e,t[o]=f,i[o]=h[o]*e}return s.x=r.normal.x,s.y=r.normal.y,this._inverted&&(s.x*=-1,s.y*=-1),a},h.prototype.getManifold=function(){for(var t=l.points,i=l.localNormal,s=l.localPoint,n=this._b2contact.GetManifold(),h=n.points,r=t.length=n.pointCount,c=0;c<r;c++){var o=f[c],u=h[c];o.localPoint.x=u.localPoint.x*e,o.localPoint.Y=u.localPoint.Y*e,o.normalImpulse=u.normalImpulse*e,o.tangentImpulse=u.tangentImpulse,t[c]=o}return s.x=n.localPoint.x*e,s.y=n.localPoint.y*e,i.x=n.localNormal.x,i.y=n.localNormal.y,l.type=n.type,this._inverted&&(i.x*=-1,i.y*=-1),l},h.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;var i,s=v.normalImpulses,n=v.tangentImpulses;i=t.count;for(var h=0;h<i;h++)s[h]=t.normalImpulses[h]*e,n[h]=t.tangentImpulses[h];return n.length=s.length=i,v},h.prototype.emit=function(t){var i;switch(t){case c.BEGIN_CONTACT:i="onBeginContact";break;case c.END_CONTACT:i="onEndContact";break;case c.PRE_SOLVE:i="onPreSolve";break;case c.POST_SOLVE:i="onPostSolve"}var s,n,h,r,e=this.colliderA,o=this.colliderB,u=e.body,a=o.body;if(u.enabledContactListener)for(s=u.node._components,this._inverted=!1,n=0,h=s.length;n<h;n++)(r=s[n])[i]&&r[i](this,e,o);if(a.enabledContactListener)for(s=a.node._components,this._inverted=!0,n=0,h=s.length;n<h;n++)(r=s[n])[i]&&r[i](this,o,e);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},h.get=function(t){var i;return(i=0===o.length?new cc.PhysicsContact:o.pop())._(t),i},h.put=function(t){var i=t._contact;i&&(o.push(i),i.reset())};var d=h.prototype;d.setEnabled=function(t){this._b2contact.SetEnabled(t)},d.isTouching=function(){return this._b2contact.IsTouching()},d.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/e)},d.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*e},d.setFriction=function(t){this._b2contact.SetFriction(t)},d.getFriction=function(){return this._b2contact.GetFriction()},d.resetFriction=function(){return this._b2contact.ResetFriction()},d.setRestitution=function(t){this._b2contact.SetRestitution(t)},d.getRestitution=function(){return this._b2contact.GetRestitution()},d.resetRestitution=function(){return this._b2contact.ResetRestitution()},h.ContactType=c,cc.PhysicsContact=i.exports=h},{"./CCPhysicsTypes":147}],146:[function(t,i,s){var n=t("./CCPhysicsTypes").ContactType,h=t("./CCPhysicsTypes").BodyType,r=t("./CCPhysicsTypes").RayCastType,e=t("./CCPhysicsTypes").PTM_RATIO,c=(t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,new b2.AABB),o=new b2.Vec2,u=new b2.Vec2,a=cc.T({mixins:[cc.EventTarget],statics:{DrawBits:b2.Draw,PTM_RATIO:e,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,this.enabledAccumulator=!1},pushDelayEvent:function(t,i,s){this._steping?this._delayEvents.push({target:t,func:i,args:s}):t[i].apply(t,s)},update:function(t){var i=this._world;if(i&&this.enabled){this.emit("before-step"),this._steping=!0;var s=a.VELOCITY_ITERATIONS,n=a.POSITION_ITERATIONS;if(this.enabledAccumulator)for(this._accumulator+=t,this._accumulator>.2&&(this._accumulator=.2);this._accumulator>1/60;)i.Step(1/60,s,n),this._accumulator-=1/60;else{var h=1/cc.game.config.frameRate;i.Step(h,s,n)}i.DrawDebugData(),this._steping=!1;for(var r=this._delayEvents,e=0,c=r.length;e<c;e++){var o=r[e];o.target[o.func].apply(o.target,o.args)}r.length=0,this._syncNode()}},testPoint:function(t){var i=o.x=t.x/e,s=o.y=t.y/e,n=.2/e;c.lowerBound.x=i-n,c.lowerBound.y=s-n,c.upperBound.x=i+n,c.upperBound.y=s+n;var h=this._aabbQueryCallback;h._(o),this._world.QueryAABB(h,c);var r=h.getFixture();return r?r.collider:null},testAABB:function(t){c.lowerBound.x=t.xMin/e,c.lowerBound.y=t.yMin/e,c.upperBound.x=t.xMax/e,c.upperBound.y=t.yMax/e;var i=this._aabbQueryCallback;return i._(),this._world.QueryAABB(i,c),i.getFixtures().map(function(t){return t.collider})},rayCast:function(t,i,s){if(t.equals(i))return[];s=s||r.Closest,o.x=t.x/e,o.y=t.y/e,u.x=i.x/e,u.y=i.y/e;var n=this._raycastQueryCallback;n._(s),this._world.RayCast(n,o,u);var h=n.getFixtures();if(h.length>0){for(var c=n.getPoints(),a=n.getNormals(),f=n.getFractions(),l=[],v=0,d=h.length;v<d;v++){var p=h[v],g=p.collider;if(s===r.AllClosest){var m=l.find(function(t){return t.collider===g});if(m){f[v]<m.fraction&&(m.fixtureIndex=g._getFixtureIndex(p),m.point.x=c[v].x*e,m.point.y=c[v].y*e,m.normal.x=a[v].x,m.normal.y=a[v].y,m.fraction=f[v]);continue}}l.push({collider:g,fixtureIndex:g._getFixtureIndex(p),point:cc.v2(c[v].x*e,c[v].y*e),normal:cc.v2(a[v]),fraction:f[v]})}return l}return[]},syncPosition:function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncPosition()},syncRotation:function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncRotation()},attachDebugDrawToCamera:function(t){this._debugDrawer&&t.addTarget(this._debugDrawer.getDrawer())},detachDebugDrawFromCamera:function(t){this._debugDrawer&&t.removeTarget(this._debugDrawer.getDrawer())},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t)},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t)},_addBody:function(t,i){var s=this._world,n=t.node;s&&n&&(t._b2Body=s.CreateBody(i),t._b2Body.body=t,this._utils.addB2Body(t._b2Body),this._bodies.push(t))},_removeBody:function(t){var i=this._world;if(i){t._b2Body.body=null,this._utils.removeB2Body(t._b2Body),i.DestroyBody(t._b2Body),t._b2Body=null;var s=this._bodies.indexOf(t);-1!==s&&this._bodies.splice(s,1)}},_initCallback:function(){if(this._world){if(!this._contactListener){var t=new cc.PhysicsContactListener;t.setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback,this._raycastQueryCallback=new cc.PhysicsRayCastCallback}}else cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0,this.debugDrawFlags=b2.Draw.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){this._utils.syncNode();for(var t=this._bodies,i=0,s=t.length;i<s;i++){var n=t[i];n.type===h.Animated&&n.resetVelocity()}},_onSceneLaunched:function(){this._debugDrawer.AddDrawerToNode(cc.director.getScene()._sgNode)},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(n.BEGIN_CONTACT)},_onEndContact:function(t){var i=t._contact;i&&(i.emit(n.END_CONTACT),cc.PhysicsContact.put(t))},_onPreSolve:function(t){var i=t._contact;i&&i.emit(n.PRE_SOLVE)},_onPostSolve:function(t,i){var s=t._contact;s&&(s._impulse=i,s.emit(n.POST_SOLVE),s._impulse=null)}});cc.js.getset(a.prototype,"enabled",function(){return this._enabled},function(t){if(t&&!this._world){var i=new b2.World(new b2.Vec2(0,-10));i.SetAllowSleeping(!0),this._world=i,this._utils=new cc.PhysicsUtils,this._initCallback()}this._enabled=t}),cc.js.getset(a.prototype,"debugDrawFlags",function(){return this._debugDrawFlags},function(t){t&&!this._debugDrawFlags?(this._debugDrawer||(this._debugDrawer=new cc.PhysicsDebugDraw(e),this._world.SetDebugDraw(this._debugDrawer)),cc.director.getScene()&&this._debugDrawer.AddDrawerToNode(cc.director.getScene()._sgNode),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this._onSceneLaunched,this)):!t&&this._debugDrawFlags&&cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this._onSceneLaunched,this),this._debugDrawFlags=t,this._debugDrawer&&this._debugDrawer.SetFlags(t)}),cc.js.getset(a.prototype,"gravity",function(){if(this._world){var t=this._world.GetGravity();return cc.v2(t.x*e,t.y*e)}return cc.v2()},function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/e,t.y/e))}),cc.PhysicsManager=i.exports=a},{"./CCPhysicsTypes":147}],147:[function(t,i,s){var n=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3});cc.RigidBodyType=n;var h=cc.Enum({Closest:0,Any:1,AllClosest:2,All:3});cc.RayCastType=h,i.exports={BodyType:n,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:h,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}},{}],148:[function(t,i,s){function n(t,i){var s=i.length;return i[t<0?s- -t%s:t%s]}function h(t,i,s){for(var h=[];i<t;)i+=s.length;for(;t<=i;++t)h.push(n(t,s));return h}function r(t){l(t);for(var i,s,v,p,g,m,w=[],_=cc.v2(),C=cc.v2(),b=0,y=0,T=0;T<t.length;++T)if(e(T,t)){for(s=v=1e8,x=0;x<t.length;++x)o(n(T-1,t),n(T,t),n(x,t))&&a(n(T-1,t),n(T,t),n(x-1,t))&&(p=d(n(T-1,t),n(T,t),n(x,t),n(x-1,t)),c(n(T+1,t),n(T,t),p)&&(i=f(n(T,t),p))<s&&(s=i,_=p,b=x)),o(n(T+1,t),n(T,t),n(x+1,t))&&a(n(T+1,t),n(T,t),n(x,t))&&(p=d(n(T+1,t),n(T,t),n(x,t),n(x+1,t)),o(n(T-1,t),n(T,t),p)&&(i=f(n(T,t),p))<v&&(v=i,y=x,C=p));if(b==(y+1)%t.length){var S=_.add(C).div(2);(g=h(T,y,t)).push(S),(m=h(b,T,t)).push(S)}else{for(var A=0,M=b;y<b;)y+=t.length;for(var x=b;x<=y;++x)if(function(t,i,s){if(e(t,s)){if(u(n(t,s),n(t-1,s),n(i,s))&&a(n(t,s),n(t+1,s),n(i,s)))return!1}else if(a(n(t,s),n(t+1,s),n(i,s))||u(n(t,s),n(t-1,s),n(i,s)))return!1;if(e(i,s)){if(u(n(i,s),n(i-1,s),n(t,s))&&a(n(i,s),n(i+1,s),n(t,s)))return!1}else if(a(n(i,s),n(i+1,s),n(t,s))||u(n(i,s),n(i-1,s),n(t,s)))return!1;for(var h=0;h<s.length;++h)if((h+1)%s.length!=t&&h!=t&&(h+1)%s.length!=i&&h!=i){var r=cc.v2();if(function(t,i,s,n,h){if(t==s||t==n||i==s||i==n)return!1;var r=t.x,e=t.y,c=i.x,o=i.y,u=s.x,a=s.y,f=n.x,l=n.y;if(Math.max(r,c)<Math.min(u,f)||Math.max(u,f)<Math.min(r,c))return!1;if(Math.max(e,o)<Math.min(a,l)||Math.max(a,l)<Math.min(e,o))return!1;var v=(f-u)*(e-a)-(l-a)*(r-u),d=(c-r)*(e-a)-(o-e)*(r-u),p=(l-a)*(c-r)-(f-u)*(o-e);return!(Math.abs(p)<1e-6)&&(v/=p,d/=p,0<v&&v<1&&0<d&&d<1&&(h.x=r+v*(c-r),h.y=e+v*(o-e),!0))}(n(t,s),n(i,s),n(h,s),n(h+1,s),r))return!1}return!0}(T,x,t)){var E=1/(f(n(T,t),n(x,t))+1);e(x,t)?a(n(x-1,t),n(x,t),n(T,t))&&u(n(x+1,t),n(x,t),n(T,t))?E+=3:E+=2:E+=1,E>A&&(M=x,A=E)}g=h(T,M,t),m=h(M,T,t)}return w=w.concat(r(g)),w=w.concat(r(m))}for(w.push(t),T=w.length-1;T>=0;T--)0==w[T].length&&w.splice(T,0);return w}function e(t,i){return c(t,i)}function c(t,i,s){if(void 0===s){var h=t,r=i;t=n(h-1,r),i=n(h,r),s=n(h+1,r)}return p(t,i,s)<0}function o(t,i,s){return p(t,i,s)>0}function u(t,i,s){return p(t,i,s)>=0}function a(t,i,s){return p(t,i,s)<=0}function f(t,i){var s=i.x-t.x,n=i.y-t.y;return s*s+n*n}function l(t){v(t)||t.reverse()}function v(t){return t.length<3||function(t){var i,s=0;for(i=0;i<t.length;i++){var n=(i+1)%t.length;s+=t[i].x*t[n].y,s-=t[i].y*t[n].x}return s/=2}(t)>0}function d(t,i,s,n){var h=cc.v2(),r=i.y-t.y,e=t.x-i.x,c=r*t.x+e*t.y,o=n.y-s.y,u=s.x-n.x,a=o*s.x+u*s.y,f=r*u-o*e;return function(t,i){return Math.abs(t-0)<=1e-6}(f)||(h.x=(u*c-e*a)/f,h.y=(r*a-o*c)/f),h}function p(t,i,s){return t.x*(i.y-s.y)+i.x*(s.y-t.y)+s.x*(t.y-i.y)}i.exports={ConvexPartition:r,ForceCounterClockWise:l,IsCounterClockWise:v}},{}],149:[function(t,i,s){var n=t("./CCPhysicsTypes").PTM_RATIO,h=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,e=t("./utils").getWorldRotation,c=t("./CCPhysicsTypes").BodyType,o=new b2.Vec2,u=new b2.Vec2,a=cc.Vec2.ZERO,f=cc.T({name:"cc.RigidBody",S:cc.U,editor:!1,O:{_type:c.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID("8200")},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:c,tooltip:!1,get:function(){return this._type},set:function(t){this._type=t,this._b2Body&&(t===c.Animated?this._b2Body.SetType(c.Kinematic):this._b2Body.SetType(t))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetAllowSleeping(t)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t=this._linearVelocity;if(this._b2Body){var i=this._b2Body.GetLinearVelocity();t.x=i.x*n,t.y=i.y*n}return t},set:function(t){this._linearVelocity=t;var i=this._b2Body;if(i){var s=i.m_linearVelocity;s.Set(t.x/n,t.y/n),i.SetLinearVelocity(s)}}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*r:this._angularVelocity},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*h)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t)}},awake:{tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(t){this._b2Body&&this._b2Body.SetAwake(t)}},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(t){this._b2Body&&this._b2Body.SetActive(t)}}},getLocalPoint:function(t,i){if(i=i||cc.v2(),this._b2Body){o.Set(t.x/n,t.y/n);var s=this._b2Body.GetLocalPoint(o);i.x=s.x*n,i.y=s.y*n}return i},getWorldPoint:function(t,i){if(i=i||cc.v2(),this._b2Body){o.Set(t.x/n,t.y/n);var s=this._b2Body.GetWorldPoint(o);i.x=s.x*n,i.y=s.y*n}return i},getWorldVector:function(t,i){if(i=i||cc.v2(),this._b2Body){o.Set(t.x/n,t.y/n);var s=this._b2Body.GetWorldVector(o);i.x=s.x*n,i.y=s.y*n}return i},getLocalVector:function(t,i){if(i=i||cc.v2(),this._b2Body){o.Set(t.x/n,t.y/n);var s=this._b2Body.GetLocalVector(o);i.x=s.x*n,i.y=s.y*n}return i},getWorldPosition:function(t){if(t=t||cc.v2(),this._b2Body){var i=this._b2Body.GetPosition();t.x=i.x*n,t.y=i.y*n}return t},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*r:0},getLocalCenter:function(t){if(t=t||cc.v2(),this._b2Body){var i=this._b2Body.GetLocalCenter();t.x=i.x*n,t.y=i.y*n}return t},getWorldCenter:function(t){if(t=t||cc.v2(),this._b2Body){var i=this._b2Body.GetWorldCenter();t.x=i.x*n,t.y=i.y*n}return t},getLinearVelocityFromWorldPoint:function(t,i){if(i=i||cc.v2(),this._b2Body){o.Set(t.x/n,t.y/n);var s=this._b2Body.GetLinearVelocityFromWorldPoint(o);i.x=s.x*n,i.y=s.y*n}return i},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*n*n:0},getJointList:function(){if(!this._b2Body)return[];var t=[],i=this._b2Body.GetJointList();if(!i)return[];t.push(i.joint._joint);for(var s=i.prev;s;)t.push(s.joint._joint),s=s.prev;for(var n=i.next;n;)t.push(n.joint._joint),n=n.next;return t},applyForce:function(t,i,s){this._b2Body&&(o.Set(t.x/n,t.y/n),u.Set(i.x/n,i.y/n),this._b2Body.ApplyForce(o,u,s))},applyForceToCenter:function(t,i){this._b2Body&&(o.Set(t.x/n,t.y/n),this._b2Body.ApplyForceToCenter(o,i))},applyTorque:function(t,i){this._b2Body&&this._b2Body.ApplyTorque(t/n,i)},applyLinearImpulse:function(t,i,s){this._b2Body&&(o.Set(t.x/n,t.y/n),u.Set(i.x/n,i.y/n),this._b2Body.ApplyLinearImpulse(o,u,s))},applyAngularImpulse:function(t,i){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/n/n,i)},syncPosition:function(t){var i=this._b2Body;if(i){var s,h=this.node.convertToWorldSpaceAR(a);if(s=this.type===c.Animated?i.GetLinearVelocity():i.GetPosition(),s.x=h.x/n,s.y=h.y/n,this.type===c.Animated&&t){var r=i.GetPosition(),e=cc.game.config.frameRate;s.x=(s.x-r.x)*e,s.y=(s.y-r.y)*e,i.SetAwake(!0),i.SetLinearVelocity(s)}else i.SetTransform(s,i.GetAngle())}},syncRotation:function(t){var i=this._b2Body;if(i){var s=h*e(this.node);if(this.type===c.Animated&&t){var n=i.GetAngle(),r=cc.game.config.frameRate;i.SetAwake(!0),i.SetAngularVelocity((s-n)*r)}else i.SetTransform(i.GetPosition(),s)}},resetVelocity:function(){var t=this._b2Body;if(t){var i=t.m_linearVelocity;i.Set(0,0),t.SetLinearVelocity(i),t.SetAngularVelocity(0)}},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var t=this.node;t.on("position-changed",this._onNodePositionChanged,this),t.on("rotation-changed",this._onNodeRotationChanged,this),t.on("scale-changed",this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var t=this.node;t.off("position-changed",this._onNodePositionChanged,this),t.off("rotation-changed",this._onNodeRotationChanged,this),t.off("scale-changed",this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(t){this.syncRotation(!0)},_onNodeScaleChanged:function(t){if(this._b2Body)for(var i=this.getComponents(cc.PhysicsCollider),s=0;s<i.length;s++)i[s].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){this._registerNodeEvents();var t=new b2.BodyDef;this.type===c.Animated?t.type=c.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping;var i=this.linearVelocity;t.linearVelocity=new b2.Vec2(i.x/n,i.y/n),t.angularVelocity=this.angularVelocity*h,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet;var s=this.node,r=s.convertToWorldSpaceAR(a);t.position=new b2.Vec2(r.x/n,r.y/n),t.angle=-Math.PI/180*e(s),cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0}},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=i.exports=f},{"./CCPhysicsTypes":147,"./utils":170}],150:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.PhysicsBoxCollider",S:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var i=Math.abs(t.x),s=Math.abs(t.y),h=this.size.width/2/n*i,r=this.size.height/2/n*s,e=this.offset.x/n*i,c=this.offset.y/n*s,o=new b2.PolygonShape;return o.SetAsBox(h,r,new b2.Vec2(e,c),0),o}});cc.PhysicsBoxCollider=i.exports=h},{"../CCPhysicsTypes":147}],151:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.PhysicsChainCollider",S:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},O:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){for(var i=new b2.ChainShape,s=this.points,h=[],r=0;r<s.length;r++){var e=s[r];h.push(new b2.Vec2(e.x/n*t.x,e.y/n*t.y))}return this.loop?i.CreateLoop(h,h.length):i.CreateChain(h,h.length),i},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=i.exports=h},{"../CCPhysicsTypes":147}],152:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.PhysicsCircleCollider",S:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var i=Math.abs(t.x),s=Math.abs(t.y),h=this.offset.x/n*i,r=this.offset.y/n*s,e=new b2.CircleShape;return e.m_radius=this.radius/n*i,e.m_p=new b2.Vec2(h,r),e}});cc.PhysicsCircleCollider=i.exports=h},{"../CCPhysicsTypes":147}],153:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../utils").getWorldScale,r=cc.T({name:"cc.PhysicsCollider",S:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect()},O:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(t){this._density=t}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(t){this._sensor=t}},friction:{tooltip:!1,get:function(){return this._friction},set:function(t){this._friction=t}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(t){this._restitution=t}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(t){return this._fixtures.indexOf(t)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var i=t._getBody();if(i){var s=t.node,n=h(s),r=0===n.x&&0===n.y?[]:this._createShape(n);r instanceof Array||(r=[r]);for(var e=1<<s.groupIndex,c=0,o=cc.game.collisionMatrix[s.groupIndex],u=0;u<o.length;u++)o[u]&&(c|=1<<u);for(var a={categoryBits:e,maskBits:c,groupIndex:0},f=cc.director.getPhysicsManager(),l=0;l<r.length;l++){var v=r[l],d=new b2.FixtureDef;d.density=this.density,d.isSensor=this.sensor,d.friction=this.friction,d.restitution=this.restitution,d.shape=v,d.filter=a;var p=i.CreateFixture(d);p.collider=this,t.enabledContactListener&&f._registerContactFixture(p),this._shapes.push(v),this._fixtures.push(p)}this.body=t,this._inited=!0}}}},__destroy:function(){if(this._inited){for(var t=this._fixtures,i=this.body._getBody(),s=cc.director.getPhysicsManager(),n=t.length-1;n>=0;n--){var h=t[n];h.collider=null,s._unregisterContactFixture(h),i&&i.DestroyFixture(h)}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_createShape:function(){},apply:function(){this._destroy(),this._init()},getAABB:function(){for(var t=1e7,i=1e7,s=-1e7,h=-1e7,r=this._fixtures,e=0;e<r.length;e++)for(var c=r[e],o=c.GetShape().GetChildCount(),u=0;u<o;u++){var a=c.GetAABB(u);a.lowerBound.x<t&&(t=a.lowerBound.x),a.lowerBound.y<i&&(i=a.lowerBound.y),a.upperBound.x>s&&(s=a.upperBound.x),a.upperBound.y>h&&(h=a.upperBound.y)}t*=n,i*=n,s*=n,h*=n;var f=this._rect;return f.x=t,f.y=i,f.width=s-t,f.height=h-i,f}});cc.PhysicsCollider=i.exports=r},{"../CCPhysicsTypes":147,"../utils":170}],154:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPolygonSeparator"),r=cc.T({name:"cc.PhysicsPolygonCollider",S:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(t){var i=[],s=this.points;s.length>0&&s[0].equals(s[s.length-1])&&(s.length-=1);for(var r=h.ConvexPartition(s),e=this.offset,c=0;c<r.length;c++){for(var o=r[c],u=null,a=[],f=null,l=0,v=o.length;l<v;l++){u||(u=new b2.PolygonShape);var d=o[l],p=(d.x+e.x)/n*t.x,g=(d.y+e.y)/n*t.y,m=new b2.Vec2(p,g);a.push(m),f||(f=m),a.length===b2.maxPolygonVertices&&(u.Set(a,a.length),i.push(u),u=null,l<v-1&&(a=[f,a[a.length-1]]))}u&&(u.Set(a,a.length),i.push(u))}return i}});cc.PhysicsPolygonCollider=i.exports=r},{"../CCPhysicsTypes":147,"../CCPolygonSeparator":148}],155:[function(t,i,s){window.b2=t("../../../external/box2d/box2d"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsDebugDraw"),t("./platform/CCPhysicsUtils"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback")},{"../../../external/box2d/box2d":310,"./CCPhysicsContact":145,"./CCPhysicsManager":146,"./CCRigidBody":149,"./collider/CCPhysicsBoxCollider":150,"./collider/CCPhysicsChainCollider":151,"./collider/CCPhysicsCircleCollider":152,"./collider/CCPhysicsCollider":153,"./collider/CCPhysicsPolygonCollider":154,"./joint/CCDistanceJoint":156,"./joint/CCJoint":157,"./joint/CCMotorJoint":158,"./joint/CCMouseJoint":159,"./joint/CCPrismaticJoint":160,"./joint/CCRevoluteJoint":161,"./joint/CCRopeJoint":162,"./joint/CCWeldJoint":163,"./joint/CCWheelJoint":164,"./platform/CCPhysicsAABBQueryCallback":165,"./platform/CCPhysicsContactListner":166,"./platform/CCPhysicsDebugDraw":167,"./platform/CCPhysicsRayCastCallback":168,"./platform/CCPhysicsUtils":169}],156:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.DistanceJoint",S:cc.Joint,editor:!1,O:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.DistanceJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.length=this.distance/n,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.DistanceJoint=i.exports=h},{"../CCPhysicsTypes":147}],157:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.Joint",S:cc.U,editor:{requireComponent:cc.RigidBody},O:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy(),this._init()},getWorldAnchor:function(){if(this._joint){var t=this._joint.GetAnchorA();return cc.v2(t.x*n,t.y*n)}return cc.Vec2.ZERO},getWorldConnectedAnchor:function(){if(this._joint){var t=this._joint.GetAnchorB();return cc.v2(t.x*n,t.y*n)}return cc.Vec2.ZERO},getReactionForce:function(t){return this._joint?this._joint.GetReactionForce(t):0},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited&&(this.body=this.getComponent(cc.RigidBody),this._isValid())){var t=cc.director.getPhysicsManager()._getWorld(),i=this._createJointDef();if(!i)return;i.bodyA=this.body._getBody(),i.bodyB=this.connectedBody._getBody(),i.collideConnected=this.collideConnected,this._joint=t.CreateJoint(i),this._joint&&(this._joint._joint=this),this._inited=!0}},__destroy:function(){this._inited&&(this._isValid()&&cc.director.getPhysicsManager()._getWorld().DestroyJoint(this._joint),this._joint&&(this._joint._joint=null),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=i.exports=h},{"../CCPhysicsTypes":147}],158:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=cc.T({name:"cc.MotorJoint",S:cc.Joint,editor:!1,O:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/n,t.y/n))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}},_createJointDef:function(){var t=new b2.MotorJointDef;return t.linearOffset=new b2.Vec2(this.linearOffset.x/n,this.linearOffset.y/n),t.angularOffset=this.angularOffset*h,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t}});cc.MotorJoint=i.exports=r},{"../CCPhysicsTypes":147}],159:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=new b2.Vec2,r=cc.T({name:"cc.MouseJoint",S:cc.Joint,editor:!1,O:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(t){this._target=t,this._joint&&(h.x=t.x/n,h.y=t.y/n,this._joint.SetTarget(h))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(t){var i=cc.director.getPhysicsManager(),s=this._pressPoint=t.touch.getLocation();cc.Camera&&cc.Camera.main&&(s=cc.Camera.main.getCameraToWorldPoint(s));var n=i.testPoint(s);n&&((this.connectedBody=n.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=s,this._init())},onTouchMove:function(t){this._pressPoint=t.touch.getLocation()},onTouchEnd:function(t){this._destroy(),this._pressPoint=null},_createJointDef:function(){var t=new b2.MouseJointDef;return h.x=this.target.x/n,h.y=this.target.y/n,t.target=h,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t},update:function(){this._pressPoint&&this._isValid()&&(cc.Camera&&cc.Camera.main?this.target=cc.Camera.main.getCameraToWorldPoint(this._pressPoint):this.target=this._pressPoint)}});cc.MouseJoint=i.exports=r},{"../CCPhysicsTypes":147}],160:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=cc.T({name:"cc.PrismaticJoint",S:cc.Joint,editor:!1,O:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}}},_createJointDef:function(){var t=new b2.PrismaticJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*h,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/n,t.upperTranslation=this.upperLimit/n,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t}});cc.PrismaticJoint=i.exports=r},{"../CCPhysicsTypes":147}],161:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,e=cc.T({name:"cc.RevoluteJoint",S:cc.Joint,editor:!1,O:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*h)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*r:0},_createJointDef:function(){var t=new b2.RevoluteJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.lowerAngle=(this.upperAngle+90)*h,t.upperAngle=(this.lowerAngle+90)*h,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*h,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*h,t}});cc.RevoluteJoint=i.exports=e},{"../CCPhysicsTypes":147}],162:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.RopeJoint",S:cc.Joint,editor:!1,O:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t)}}},_createJointDef:function(){var t=new b2.RopeJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.maxLength=this.maxLength/n,t}});cc.RopeJoint=i.exports=h},{"../CCPhysicsTypes":147}],163:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=cc.T({name:"cc.WeldJoint",S:cc.Joint,editor:!1,O:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WeldJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.referenceAngle=this.referenceAngle*h,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t}});cc.WeldJoint=i.exports=r},{"../CCPhysicsTypes":147}],164:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,r=cc.T({name:"cc.WheelJoint",S:cc.Joint,editor:!1,O:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*h)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WheelJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*h,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.WheelJoint=i.exports=r},{"../CCPhysicsTypes":147}],165:[function(t,i,s){function n(){this._point=new b2.Vec2,this._fixtures=[]}n.prototype._=function(t){this._point.x=t.x,this._point.y=t.y,this._fixtures.length=0},n.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===b2.Body.b2_dynamicBody)if(this._point){if(t.TestPoint(this._point))return this._fixtures.push(t),!1}else this._fixtures.push(t);return!0},n.prototype.getFixture=function(){return this._fixtures[0]},n.prototype.getFixtures=function(){return this._fixtures},cc.PhysicsAABBQueryCallback=i.exports=n},{}],166:[function(t,i,s){function n(){this._contactFixtures=[]}n.prototype.setBeginContact=function(t){this._BeginContact=t},n.prototype.setEndContact=function(t){this._EndContact=t},n.prototype.setPreSolve=function(t){this._PreSolve=t},n.prototype.setPostSolve=function(t){this._PostSolve=t},n.prototype.BeginContact=function(t){if(this._BeginContact){var i=t.GetFixtureA(),s=t.GetFixtureB(),n=this._contactFixtures;t._shouldReport=!1,-1===n.indexOf(i)&&-1===n.indexOf(s)||(t._shouldReport=!0,this._BeginContact(t))}},n.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.prototype.PreSolve=function(t,i){this._PreSolve&&t._shouldReport&&this._PreSolve(t,i)},n.prototype.PostSolve=function(t,i){this._PostSolve&&t._shouldReport&&this._PostSolve(t,i)},n.prototype.registerContactFixture=function(t){this._contactFixtures.push(t)},n.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t)},cc.PhysicsContactListener=i.exports=n},{}],167:[function(t,i,s){var n=t("../CCPhysicsTypes").PTM_RATIO,h=cc.T({name:"cc.PhysicsDebugDraw",mixins:[b2.Draw],ctor:function(){this._drawer=new _ccsg.GraphicsNode,this._drawer.retain()},getDrawer:function(){return this._drawer},AddDrawerToNode:function(t){this._drawer.removeFromParent(),t.addChild(this._drawer)},ClearDraw:function(){this._drawer.clear()},_DrawPolygon:function(t,i){for(var s=this._drawer,h=0;h<i;h++)0===h?s.moveTo(t[h].x*n,t[h].y*n):s.lineTo(t[h].x*n,t[h].y*n);s.close()},DrawPolygon:function(t,i,s){this._applyStrokeColor(s),this._DrawPolygon(t,i),this._drawer.stroke()},DrawSolidPolygon:function(t,i,s){this._applyFillColor(s),this._DrawPolygon(t,i),this._drawer.fill(),this._drawer.stroke()},_DrawCircle:function(t,i){this._drawer.circle(t.x*n,t.y*n,i*n)},DrawCircle:function(t,i,s){this._applyStrokeColor(s),this._DrawCircle(t,i),this._drawer.stroke()},DrawSolidCircle:function(t,i,s,n){this._applyFillColor(n),this._DrawCircle(t,i),this._drawer.fill()},DrawSegment:function(t,i,s){var h=this._drawer;if(t.x===i.x&&t.y===i.y)return this._applyFillColor(s),this._DrawCircle(t,2/n),void h.fill();this._applyStrokeColor(s),h.moveTo(t.x*n,t.y*n),h.lineTo(i.x*n,i.y*n),h.stroke()},DrawPoint:function(t,i,s){},_applyStrokeColor:function(t){this._drawer.setStrokeColor(cc.color(255*t.r,255*t.g,255*t.b,150))},_applyFillColor:function(t){this._drawer.setFillColor(cc.color(255*t.r,255*t.g,255*t.b,150))}});cc.PhysicsDebugDraw=i.exports=h},{"../CCPhysicsTypes":147}],168:[function(t,i,s){function n(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[]}n.prototype._=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},n.prototype.ReportFixture=function(t,i,s,n){return 0===this._type?(this._fixtures[0]=t,this._points[0]=i,this._normals[0]=s,this._fractions[0]=n,n):(this._fixtures.push(t),this._points.push(i),this._normals.push(s),this._fractions.push(n),1===this._type?0:this._type>=2?1:n)},n.prototype.getFixtures=function(){return this._fixtures},n.prototype.getPoints=function(){return this._points},n.prototype.getNormals=function(){return this._normals},n.prototype.getFractions=function(){return this._fractions},cc.PhysicsRayCastCallback=i.exports=n},{}],169:[function(t,i,s){function n(){}var h=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,r=t("../CCPhysicsTypes").PTM_RATIO,e=t("../utils").convertToNodeRotation,c=cc.v2();n.prototype.addB2Body=function(t){},n.prototype.removeB2Body=function(t){},n.prototype.syncNode=function(){for(var t=cc.director.getPhysicsManager()._bodies,i=0,s=t.length;i<s;i++){var n=t[i],o=n.node,u=n._b2Body,a=u.GetPosition();c.x=a.x*r,c.y=a.y*r;var f=u.GetAngle()*h;null!==o.parent.parent&&(c=o.parent.convertToNodeSpaceAR(c),f=e(o.parent,f));var l=o._sgNode,v=o._position;v.x=c.x,v.y=c.y,l.setPosition(v),o._rotationX=o._rotationY=f,l.rotation=f}},cc.PhysicsUtils=i.exports=n},{"../CCPhysicsTypes":147,"../utils":170}],170:[function(t,i,s){i.exports={getWorldRotation:function(t){for(var i=t.rotationX,s=t.parent;s.parent;)i+=s.rotationX,s=s.parent;return i},getWorldScale:function(t){for(var i=t.scaleX,s=t.scaleY,n=t.parent;n.parent;)i*=n.scaleX,s*=n.scaleY,n=n.parent;return cc.v2(i,s)},convertToNodeRotation:function(t,i){i-=t.rotationX;for(var s=t.parent;s.parent;)i-=s.rotationX,s=s.parent;return i}}},{}],171:[function(t,i,s){function n(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}function h(t,i){this.url=t,this.type=i}var r=t("../assets/CCAsset"),e=t("./utils").callInNextTick,c=t("../load-pipeline/CCLoader"),o=t("../load-pipeline/pack-downloader"),u=t("../load-pipeline/auto-release-utils"),a=t("../utils/decode-uuid"),f=t("../load-pipeline/md5-pipe"),l="",v="",d={},p={loadAsset:function(t,i,s){if("string"!=typeof t)return e(i,new Error("[AssetLibrary] uuid must be string"),null);var h={uuid:t,type:"uuid"};s&&s.existingAsset&&(h.existingAsset=s.existingAsset),c.load(h,function(s,h){if(s||!h)s=new Error("[AssetLibrary] loading JSON or dependencies failed: "+(s?s.message:"Unknown error"));else{if(h.constructor===cc.SceneAsset){var r=cc.loader._getReferenceKey(t);h.scene.dependAssets=u.getDependsRecursively(r)}if(n(h)){var e=cc.loader._getReferenceKey(t);c.removeItem(e)}}i&&i(s,h)})},getLibUrlNoExt:function(t){return t=a(t),l+t.slice(0,2)+"/"+t},_queryAssetInfoInEditor:function(t,i){},_getAssetInfoInRuntime:function(t,i){i=i||{url:null,raw:!1};var s=d[t];return s&&!cc.isChildClassOf(s.type,cc.Asset)?(i.url=v+s.url,i.raw=!0):(i.url=this.getLibUrlNoExt(t)+".json",i.raw=!1),i},_getAssetUrl:function(t){var i=d[t];return i?v+i.url:null},queryAssetInfo:function(t,i){var s=this._getAssetInfoInRuntime(t);i(null,s.url,s.raw)},parseUuidInEditor:function(t){},loadJson:function(t,i){var s=""+((new Date).getTime()+Math.random()),h={uuid:s,type:"uuid",content:t,skips:[c.assetLoader.id,c.downloader.id]};c.load(h,function(t,h){if(t)t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message);else{if(h.constructor===cc.SceneAsset){var r=cc.loader._getReferenceKey(s);h.scene.dependAssets=u.getDependsRecursively(r)}if(n(h)){var e=cc.loader._getReferenceKey(s);c.removeItem(e)}}h._uuid="",i&&i(t,h)})},getAssetByUuid:function(t){return p._uuidToAsset[t]||null},_:function(t){var i=t.libraryPath;i=i.replace(/\\/g,"/"),l=cc.path.stripSep(i)+"/",v=t.rawAssetsBase;var s=t.md5AssetsMap;if(s){var n=new f(s,l,v);cc.loader.insertPipeAfter(cc.loader.assetLoader,n),cc.loader.md5Pipe=n}var e=c._resources;e.reset();var u=t.rawAssets;if(u)for(var a in u){var p=u[a];for(var g in p){var m=p[g],w=m[0],_=m[1],C=cc.js._getClassById(_);if(C){if(d[g]=new h(a+"/"+w,C),"assets"===a&&w.startsWith("resources/")){if(cc.isChildClassOf(C,r)){var b=cc.path.extname(w);w=b?w.slice("resources/".length,-b.length):w.slice("resources/".length)}else w=w.slice("resources/".length);var y=1===m[2];e.add(w,g,C,!y)}}else cc.error("Cannot get",_)}}t.packedAssets&&o.initPacks(t.packedAssets);var T=t.mountPaths;T||(T={assets:v+"assets",internal:v+"internal"}),cc.url._init(T)}};p._uuidToAsset={},i.exports=cc.AssetLibrary=p},{"../assets/CCAsset":43,"../load-pipeline/CCLoader":128,"../load-pipeline/auto-release-utils":132,"../load-pipeline/md5-pipe":138,"../load-pipeline/pack-downloader":139,"../utils/decode-uuid":220,"./utils":197}],172:[function(t,i,s){function n(t,i){t.indexOf(i)<0&&t.push(i)}function h(t,i,s,h,r){var e=h.default;m.setClassAttr(t,s,"default",e),function(i,s){n(t.__props__,s)}(0,s);var c=v(t,h,0,s);if(c){for(var o=T,u=0;u<c.length;u++){var a=c[u];m.attr(t,s,a),a._onAfterProp&&o.push(a._onAfterProp)}for(var f=0;f<o.length;f++)o[f](t,s);T.length=0,c.length=0}}function r(t,i,s,n,h){var r=n.get,e=n.set,c=t.prototype,o=!Object.getOwnPropertyDescriptor(c,s);if(r){for(var u=v(t,n,0,s),a=0;a<u.length;a++)m.attr(t,s,u[a]);u.length=0,m.setClassAttr(t,s,"serializable",!1),h||d.get(c,s,r,o,o)}e&&(h||d.set(c,s,e,o,o))}function e(t){return"function"==typeof t?t():t}function c(t,i,s){for(var n in i)t.hasOwnProperty(n)||s&&!s(n)||Object.defineProperty(t,n,d.getPropertyDescriptor(i,n))}function o(t){var i,s=d.getClassName(t),n=t.constructor,h="new "+s+"(";if(n===cc.Mat3||n===cc.Mat4){var r=t.data;for(i=0;i<r.length;i++)h+=r[i],i<r.length-1&&(h+=",")}else for(i=0;i<n.__props__.length;i++){var e=t[n.__props__[i]];if("object"==typeof e)return cc.errorID(3641,s),"new "+s+"()";h+=e,i<n.__props__.length-1&&(h+=",")}return h+")"}function u(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function a(t){var i=m.getClassAttrs(t),s=t.__props__;null===s&&(y._(),s=t.__props__);for(var n=[],h="",r=0;r<s.length;r++){var e=s[r],c=e+w+"default";if(c in i){var a;a=S.test(e)?"this."+e+"=":"this["+u(e)+"]=";var f,l=i[c];if("object"==typeof l&&l)f=l instanceof cc.ValueType?o(l):Array.isArray(l)?"[]":"{}";else if("function"==typeof l){var v=n.length;n.push(l),f="F["+v+"]()"}else f="string"==typeof l?u(l):l;h+=a=a+f+";\n"}}var d;d=0===n.length?Function(h):Function("F","return (function(){\n"+h+"})")(n),t.prototype.__initProps__=d,d.call(this)}function f(t,i,s,n,e,c){if(t.__props__=[],n&&n.__props__&&(t.__props__=n.__props__.slice()),e)for(var o=0;o<e.length;++o){var u=e[o];u.__props__&&(t.__props__=t.__props__.concat(u.__props__.filter(function(i){return t.__props__.indexOf(i)<0})))}if(s){C.preprocessAttrs(s,i,t,c);for(var a in s){var f=s[a];"default"in f?h(t,0,a,f):r(t,0,a,f,c)}}}function l(t){var i=(t=t||{}).name,s=t.S,h=t.mixins,r=function(t,i,s,h){var r=cc.U,e=cc._RF.peek();if(e&&cc.isChildClassOf(i,r)){if(cc.isChildClassOf(e.cls,r))return cc.errorID(3615),null;t=t||e.script}var o=function(t,i,s,h){var r,e,o=h.__ctor__,u=h.ctor,f=h.__ES6__;f?(r=[u],e=u):(e=function(t,s,n,r){var e="return function CCClass(){\n";i&&function(t,i,s){var n=!1;for(var h in i)if(!(b.indexOf(h)>=0)){var r=i[h];if("function"==typeof r){var e=d.getPropertyDescriptor(t.prototype,h);if(e){var c=e.value;if("function"==typeof c){A.test(r)&&(n=!0,i[h]=function(t,i){return function(){var s=this._super;this._super=t;var n=i.apply(this,arguments);return this._super=s,n}}(c,r));continue}}}}return n}(i,h)&&(e+="this._super=null;\n"),e+="this.__initProps__(CCClass);\n";var c=t.length;if(c>0){var o=!(n&&n.startsWith("cc."));o&&(e+="try{\n");var u="].apply(this,arguments);\n";if(1===c)e+="CCClass.__ctors__[0"+u;else{e+="var cs=CCClass.__ctors__;\n";for(var a=0;a<c;a++)e+="cs["+a+u}o&&(e+="}catch(e){\ncc._throw(e);\n}\n")}return e+="}",Function(e)()}(r=o?[o]:function(t,h,r){for(var e=[],c=[i].concat(s),o=0;o<c.length;o++){var u=c[o];if(u)for(var a=function(t){return l._isCCClass(t)?t.__ctors__||[]:[t]}(u),f=0;f<a.length;f++)n(e,a[f])}var v=r.ctor;return v&&e.push(v),e}(0,0,h),0,t),d.value(e,"extend",function(t){return t.S=this,l(t)},!0)),d.value(e,"__ctors__",r.length>0?r:null,!0);var v=e.prototype;if(i&&(f||(d.extend(e,i),v=e.prototype),d.value(e,"$super",i)),s){for(var p=s.length-1;p>=0;p--){var g=s[p];c(v,g.prototype),c(e,g,function(t){return g.hasOwnProperty(t)&&!0}),l._isCCClass(g)&&c(m.getClassAttrs(e).constructor.prototype,m.getClassAttrs(g).constructor.prototype)}v.constructor=e}return f||(v.__initProps__=a),d.setClassName(t,e),e}(t,i,s,h);if(e)if(cc.isChildClassOf(i,r)){var u=e.uuid;u&&d._setClassId(u,o),e.cls=o}else cc.isChildClassOf(e.cls,r)||(e.cls=o);return o}(i,s,h,t);i||(i=cc.js.getClassName(r));var e=t.O;"function"==typeof e||s&&null===s.__props__||h&&h.some(function(t){return null===t.__props__})?(y.push({cls:r,props:e,mixins:h}),r.__props__=null):f(r,i,e,s,t.mixins,t.__ES6__);var o=t.statics;if(o){var u;for(u in o)r[u]=o[u]}for(var v in t)if(!(b.indexOf(v)>=0)){var p=t[v];C.validateMethodWithProps(p,v,i,r,s)&&d.value(r.prototype,v,p,!0,!0)}var g=t.editor;return g&&cc.isChildClassOf(s,cc.U)&&cc.U._registerEditorProps(r,g),r}function v(t,i,s,n,h){function r(){return o=n+w,c=m.getClassAttrsProto(t)}function e(t,s){if(t in i){var n=i[t];typeof n===s&&((c||r())[o+t]=n)}}var c=null,o="";x.length=0;var u=x,a=i.type;if(a){var f=M[a];if(f)u.push({type:a,_onAfterProp:_(f,"cc."+a)});else if("Object"===a);else if(a===m.ScriptUuid){var l=m.ObjectType(cc.ScriptAsset);l.type="Script",u.push(l)}else"object"==typeof a?p.isEnum(a)&&u.push({type:"Enum",enumList:p.getList(a)}):"function"==typeof a&&(i.url?u.push({type:"Object",ctor:a,_onAfterProp:_("String","cc.String")}):u.push(i._short?{type:"Object",ctor:a}:m.ObjectType(a)))}i.editorOnly&&((c||r())[o+"editorOnly"]=!0),i.url&&((c||r())[o+"saveUrlAsAsset"]=!0),!1===i.serializable&&((c||r())[o+"serializable"]=!1);var v=i.range;return v&&Array.isArray(v)&&v.length>=2&&((c||r())[o+"min"]=v[0],c[o+"max"]=v[1],v.length>2&&(c[o+"step"]=v[2])),e("min","number"),e("max","number"),e("step","number"),u}var d=t("./js"),p=t("./CCEnum"),g=t("./utils"),m=(g.isPlainEmptyObj_DEV,g.cloneable_DEV,t("./attribute")),w=m.DELIMETER,_=m.getTypeChecker,C=t("./preprocess-class");t("./requiring-frame");var b=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"],y={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var i=this;setTimeout(function(){i._()},0)}},_:function(){var t=this.datas;if(t){for(var i=0;i<t.length;++i){var s=t[i],n=s.cls,h=s.props;"function"==typeof h&&(h=h());var r=d.getClassName(n);h?f(n,r,h,n.$super,s.mixins):cc.errorID(3633,r)}this.datas=null}}},T=[],S=/^[$A-Za-z_][0-9A-Za-z_$]*$/,A=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;/xyz/.test(function(){xyz}),l._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},l._fastDefine=function(t,i,s){d.setClassName(t,i);for(var n=i.__props__=Object.keys(s),h=m.getClassAttrsProto(i),r=0;r<n.length;r++){var e=n[r];h[e+w+"visible"]=!1,h[e+w+"default"]=s[e]}},l.Attr=m,l.attr=m.attr,cc.isChildClassOf=function(t,i){if(t&&i){if("function"!=typeof t)return!1;if("function"!=typeof i)return!1;if(t===i)return!0;for(;;){if(!(t=d.getSuper(t)))return!1;if(t===i)return!0}}return!1},l.getInheritanceChain=function(t){for(var i=[];t=d.getSuper(t);)t!==Object&&i.push(t);return i};var M={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},x=[];cc.T=l,i.exports={isArray:function(t){return t=e(t),Array.isArray(t)},fastDefine:l._fastDefine,getNewValueTypeCode:o,IDENTIFIER_RE:S,escapeForJS:u,getDefault:e}},{"./CCEnum":174,"./attribute":185,"./js":192,"./preprocess-class":194,"./requiring-frame":195,"./utils":197}],173:[function(t,i,s){function n(t){return t}function h(t,i){return t[i]||(t[i]={})}function r(t){return function(i){return"function"==typeof i?t(i):function(s){return t(s,i)}}}function e(t,i,s){return function(t){return function(s){return i(s,t)}}}function c(t){return e.bind(null,!1)}function o(t,i){return h(t,v)}function u(t,i,s){return t(function(t,n){var r=o(t);if(r){var e=void 0!==s?s:n;h(h(r,"proto"),"editor")[i]=e}},i)}function a(t){return t(n)}t("./CCClass");var f=t("./preprocess-class"),l=t("./js"),v="__ccclassCache__",d=e.bind(null,!1),p=c(),g=c(),m=r(function(t,i){var s=l.getSuper(t);s===Object&&(s=null);var n={name:i,S:s,ctor:t,__ES6__:!0},h=t[v];if(h){var r=h.proto;r&&l.mixin(n,r),t[v]=void 0}return cc.T(n)}),w=a(r),_=u(d,"requireComponent"),C=a(p),b=u(g,"executionOrder"),y=a(r),T=a(r),S=a(p),A=a(p),M=a(p);cc._decorator=i.exports={ccclass:m,property:function(t,i,s){function n(t,i,s){var n=o(t.constructor);if(n){var e=h(h(n,"proto"),"properties");!function(t,i,s,n,h,r){var e=n&&(f.getFullFormOfProperty(n)||n),c=i[s],o=l.mixin(c||{},e||{});if(h&&(h.get||h.set))h.get&&(o.get=h.get),h.set&&(o.set=h.set);else{var u=void 0;if(h)h.initializer&&(u=function(t){var i;try{i=t()}catch(i){return t}return"object"!=typeof i||null===i?i:t}(h.initializer));else{var a=r.default||(r.default=function(t){var i;try{i=new t}catch(t){return{}}return i}(t));a.hasOwnProperty(s)&&(u=a[s])}o.default=u}i[s]=o}(t.constructor,e,i,r,s,n)}}var r=null;if(void 0===i)return r=t,n;n(t,i,s)},executeInEditMode:w,requireComponent:_,menu:C,executionOrder:b,disallowMultiple:y,playOnFocus:T,inspector:S,icon:A,help:M,mixins:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return function(i){var s=o(i);s&&(h(s,"proto").mixins=t)}}}},{"./CCClass":172,"./js":192,"./preprocess-class":194,"./utils":197}],174:[function(t,i,s){function n(t){if("__enums__"in t)return t;h.value(t,"__enums__",null,!0);for(var i=-1,s=Object.keys(t),n=0;n<s.length;n++){var r=s[n],e=t[r];if(-1===e)e=++i,t[r]=e;else if("number"==typeof e)i=e;else if("string"==typeof e&&Number.isInteger(parseFloat(r)))continue;var c=""+e;r!==c&&h.value(t,c,r)}return t}var h=t("./js");n.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},n.getList=function(t){if(t.__enums__)return t.__enums__;var i=t.__enums__=[];for(var s in t){var n=t[s];Number.isInteger(n)&&i.push({name:s,value:n})}return i.sort(function(t,i){return t.value-i.value}),i},i.exports=cc.Enum=n},{"./js":192}],175:[function(t,i,s){cc.ClassManager||t("./_CCClass");var n=t("./CCInputManager");n.__instanceId=cc.ClassManager.getNewInstanceId(),n.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var i=cc.director.getScheduler();this._accelEnabled,this._accelCurTime=0,i.scheduleUpdate(this)}},n.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},n._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},n._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var i=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",s=navigator.userAgent;(/Android/.test(s)||/Adr/.test(s)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),t.addEventListener(i,this.didAccelerate.bind(this),!1)},n.didAccelerate=function(t){var i=window;if(this._accelEnabled){var s,n,h,r=this._acceleration;if(this._accelDeviceEvent===window.DeviceMotionEvent){var e=t.accelerationIncludingGravity;s=this._accelMinus*e.x*.1,n=this._accelMinus*e.y*.1,h=.1*e.z}else s=t.gamma/90*.981,n=-t.beta/90*.981,h=t.alpha/90*.981;r.x=s,r.y=n,r.z=h,r.timestamp=t.timeStamp||Date.now();var c=r.x;i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(r.x=-r.y,r.y=c):i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(r.x=r.y,r.y=-c):i.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(r.x=-r.x,r.y=-r.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(r.x=-r.x,r.y=-r.y)}}},{"./CCInputManager":176,"./_CCClass":184}],176:[function(t,i,s){var n=t("./CCMacro").TOUCH_TIMEOUT,h={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,i=cc.sys.now(),s=0;s<this._maxTouches;s++){if(!(1&t))return this._indexBitsUsed|=1<<s,s;var h=this._touches[s];if(i-h._lastModified>n)return this._removeUsedIndexBit(s),delete this._touchesIntegerDict[h.getID()],s;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var i=1<<t;i=~i,this._indexBitsUsed&=i}},_glView:null,handleTouchesBegin:function(t){for(var i,s,n,h=[],r=this._touchesIntegerDict,e=cc.sys.now(),c=0,o=t.length;c<o;c++)if(i=t[c],n=i.getID(),null==r[n]){var u=this._getUnUsedIndex();if(-1===u){cc.logID(2300,u);continue}(s=this._touches[u]=new cc.Touch(i._point.x,i._point.y,i.getID()))._lastModified=e,s._setPrevPoint(i._prevPoint),r[n]=u,h.push(s)}if(h.length>0){this._glView._convertTouchesWithScale(h);var a=new cc.Event.EventTouch(h);a._eventCode=cc.Event.EventTouch.BEGAN,cc.eventManager.dispatchEvent(a)}},handleTouchesMove:function(t){for(var i,s,n,h=[],r=this._touches,e=cc.sys.now(),c=0,o=t.length;c<o;c++)n=(i=t[c]).getID(),null!=(s=this._touchesIntegerDict[n])&&r[s]&&(r[s]._setPoint(i._point),r[s]._setPrevPoint(i._prevPoint),r[s]._lastModified=e,h.push(r[s]));if(h.length>0){this._glView._convertTouchesWithScale(h);var u=new cc.Event.EventTouch(h);u._eventCode=cc.Event.EventTouch.MOVED,cc.eventManager.dispatchEvent(u)}},handleTouchesEnd:function(t){var i=this.getSetOfTouchesEndOrCancel(t);if(i.length>0){this._glView._convertTouchesWithScale(i);var s=new cc.Event.EventTouch(i);s._eventCode=cc.Event.EventTouch.ENDED,cc.eventManager.dispatchEvent(s)}},handleTouchesCancel:function(t){var i=this.getSetOfTouchesEndOrCancel(t);if(i.length>0){this._glView._convertTouchesWithScale(i);var s=new cc.Event.EventTouch(i);s._eventCode=cc.Event.EventTouch.CANCELLED,cc.eventManager.dispatchEvent(s)}},getSetOfTouchesEndOrCancel:function(t){for(var i,s,n,h=[],r=this._touches,e=this._touchesIntegerDict,c=0,o=t.length;c<o;c++)null!=(s=e[n=(i=t[c]).getID()])&&r[s]&&(r[s]._setPoint(i._point),r[s]._setPrevPoint(i._prevPoint),h.push(r[s]),this._removeUsedIndexBit(s),delete e[n]);return h},getHTMLElementPosition:function(t){var i=document.documentElement,s=window,n=null;return n="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():t instanceof HTMLCanvasElement?{left:0,top:0,width:t.width,height:t.height}:{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:n.left+s.pageXOffset-i.clientLeft,top:n.top+s.pageYOffset-i.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var i=null,s=this._preTouchPool,n=t.getID(),h=s.length-1;h>=0;h--)if(s[h].getID()===n){i=s[h];break}return i||(i=t),i},setPreTouch:function(t){for(var i=!1,s=this._preTouchPool,n=t.getID(),h=s.length-1;h>=0;h--)if(s[h].getID()===n){s[h]=t,i=!0;break}i||(s.length<=50?s.push(t):(s[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,i,s){var n=this._preTouchPoint,h=this._glView.convertToLocationInView(t,i,s),r=new cc.Touch(h.x,h.y);return r._setPrevPoint(n.x,n.y),n.x=h.x,n.y=h.y,r},getMouseEvent:function(t,i,s){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,i);var h=new cc.Event.EventMouse(s);return h.setLocation(t.x,t.y),h._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,h},getPointByEvent:function(t,i){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(i.left-=document.body.scrollLeft,i.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,i){for(var s,n,h,r=[],e=this._glView,c=this._preTouchPoint,o=t.changedTouches.length,u=0;u<o;u++)if(s=t.changedTouches[u]){var a;a=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?e.convertToLocationInView(s.pageX,s.pageY,i):e.convertToLocationInView(s.clientX,s.clientY,i),null!=s.identifier?(n=new cc.Touch(a.x,a.y,s.identifier),h=this.getPreTouch(n).getLocation(),n._setPrevPoint(h.x,h.y),this.setPreTouch(n)):(n=new cc.Touch(a.x,a.y))._setPrevPoint(c.x,c.y),c.x=a.x,c.y=a.y,r.push(n)}return r},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=cc.view;var i=this,s="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,h=!1;if(cc.sys.isMobile&&(h=!0),s&&(!h&&window.addEventListener("mousedown",function(){i._mousePressed=!0},!1),!h&&window.addEventListener("mouseup",function(s){var n=i._mousePressed;if(i._mousePressed=!1,n){var h=i.getHTMLElementPosition(t),r=i.getPointByEvent(s,h);if(!cc.rectContainsPoint(new cc.Rect(h.left,h.top,h.width,h.height),r)){i.handleTouchesEnd([i.getTouchByXY(r.x,r.y,h)]);var e=i.getMouseEvent(r,h,cc.Event.EventMouse.UP);e.setButton(s.button),cc.eventManager.dispatchEvent(e)}}},!1),!h&&t.addEventListener("mousedown",function(s){i._mousePressed=!0;var n=i.getHTMLElementPosition(t),h=i.getPointByEvent(s,n);i.handleTouchesBegin([i.getTouchByXY(h.x,h.y,n)]);var r=i.getMouseEvent(h,n,cc.Event.EventMouse.DOWN);r.setButton(s.button),cc.eventManager.dispatchEvent(r),s.stopPropagation(),s.preventDefault(),t.focus()},!1),!h&&t.addEventListener("mouseup",function(s){i._mousePressed=!1;var n=i.getHTMLElementPosition(t),h=i.getPointByEvent(s,n);i.handleTouchesEnd([i.getTouchByXY(h.x,h.y,n)]);var r=i.getMouseEvent(h,n,cc.Event.EventMouse.UP);r.setButton(s.button),cc.eventManager.dispatchEvent(r),s.stopPropagation(),s.preventDefault()},!1),!h&&t.addEventListener("mousemove",function(s){var n=i.getHTMLElementPosition(t),h=i.getPointByEvent(s,n);i.handleTouchesMove([i.getTouchByXY(h.x,h.y,n)]);var r=i.getMouseEvent(h,n,cc.Event.EventMouse.MOVE);i._mousePressed?r.setButton(s.button):r.setButton(null),cc.eventManager.dispatchEvent(r),s.stopPropagation(),s.preventDefault()},!1),t.addEventListener("mousewheel",function(s){var n=i.getHTMLElementPosition(t),h=i.getPointByEvent(s,n),r=i.getMouseEvent(h,n,cc.Event.EventMouse.SCROLL);r.setButton(s.button),r.setScrollData(0,s.wheelDelta),cc.eventManager.dispatchEvent(r),s.stopPropagation(),s.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(s){var n=i.getHTMLElementPosition(t),h=i.getPointByEvent(s,n),r=i.getMouseEvent(h,n,cc.Event.EventMouse.SCROLL);r.setButton(s.button),r.setScrollData(0,-120*s.detail),cc.eventManager.dispatchEvent(r),s.stopPropagation(),s.preventDefault()},!1)),window.navigator.msPointerEnabled){var r={MSPointerDown:i.handleTouchesBegin,MSPointerMove:i.handleTouchesMove,MSPointerUp:i.handleTouchesEnd,MSPointerCancel:i.handleTouchesCancel};for(var e in r)!function(s,n){t.addEventListener(s,function(s){var h=i.getHTMLElementPosition(t);h.left-=document.documentElement.scrollLeft,h.top-=document.documentElement.scrollTop,n.call(i,[i.getTouchByXY(s.clientX,s.clientY,h)]),s.stopPropagation()},!1)}(e,r[e])}n&&(t.addEventListener("touchstart",function(s){if(s.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesBegin(i.getTouchesByEvent(s,n)),s.stopPropagation(),s.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(s){if(s.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesMove(i.getTouchesByEvent(s,n)),s.stopPropagation(),s.preventDefault()}},!1),t.addEventListener("touchend",function(s){if(s.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesEnd(i.getTouchesByEvent(s,n)),s.stopPropagation(),s.preventDefault()}},!1),t.addEventListener("touchcancel",function(s){if(s.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesCancel(i.getTouchesByEvent(s,n)),s.stopPropagation(),s.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};cc.inputManager=h,i.exports=h},{"./CCMacro":177}],177:[function(t,i,s){t("./_CCClass"),cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.ImageFormat.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:0,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_ATLAS_USE_TRIANGLE_STRIP:0,TEXTURE_ATLAS_USE_VAO:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_GC_FOR_NATIVE_OBJECTS:!0,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1},cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA}),cc.lerp=function(t,i,s){return t+(i-t)*s},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.logID(2400,t)}},i.exports=cc.macro},{"./_CCClass":184}],178:[function(t,i,s){function n(){this._name="",this._objFlags=0}var h=t("./js"),r=t("./CCClass");r.fastDefine("cc.Object",n,{_name:"",_objFlags:0}),h.value(n,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var e=[];h.value(n,"_deferredDestroy",function(){for(var t=e.length,i=0;i<t;++i){var s=e[i];1&s._objFlags||s._destroyImmediate()}t===e.length?e.length=0:e.splice(0,t)});var c=n.prototype;h.getset(c,"name",function(){return this._name},function(t){this._name=t}),h.get(c,"isValid",function(){return!(1&this._objFlags)}),c.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,e.push(this),0))},c._destruct=function(){var t=this.constructor,i=t.__destruct__;i||(i=function(t,i){var s,n={};for(s in t)if(t.hasOwnProperty(s))switch(typeof t[s]){case"string":n[s]="";break;case"object":case"function":n[s]=null}if(cc.T._isCCClass(i))for(var h=cc.T.Attr.getClassAttrs(i),e=i.__props__,c=0;c<e.length;c++){var o=(s=e[c])+cc.T.Attr.DELIMETER+"default";if(o in h)switch(typeof h[o]){case"string":n[s]="";break;case"object":case"function":n[s]=null;break;case"undefined":n[s]=void 0}}var u=t instanceof cc._BaseNode||t instanceof cc.U,a="";for(s in n)if(!u||"_id"!==s){var f;f=r.IDENTIFIER_RE.test(s)?"o."+s+"=":"o["+r.escapeForJS(s)+"]=";var l=n[s];""===l&&(l='""'),a+=f+l+";\n"}return Function("o",a)}(this,t),h.value(t,"__destruct__",i,!0)),i(this)},c._onPreDestroy=null,c._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},c._deserialize=null,cc.isValid=function(t){return"object"==typeof t?!(!t||1&t._objFlags):void 0!==t},cc.Object=i.exports=n},{"./CCClass":172,"./js":192}],179:[function(t,i,s){cc.SAXParser=cc._Class.extend({ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var i;return this._isSupportDOMParser?i=this._parser.parseFromString(t,"text/xml"):((i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(t)),i}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var i=this._parseXML(t),s=i.documentElement;if("plist"!==s.tagName)return cc.warnID(5100),{};for(var n=null,h=0,r=s.childNodes.length;h<r&&1!==(n=s.childNodes[h]).nodeType;h++);return i=null,this._parseNode(n)},_parseNode:function(t){var i=null,s=t.tagName;if("dict"===s)i=this._parseDict(t);else if("array"===s)i=this._parseArray(t);else if("string"===s)if(1===t.childNodes.length)i=t.firstChild.nodeValue;else{i="";for(var n=0;n<t.childNodes.length;n++)i+=t.childNodes[n].nodeValue}else"false"===s?i=!1:"true"===s?i=!0:"real"===s?i=parseFloat(t.firstChild.nodeValue):"integer"===s&&(i=parseInt(t.firstChild.nodeValue,10));return i},_parseArray:function(t){for(var i=[],s=0,n=t.childNodes.length;s<n;s++){var h=t.childNodes[s];1===h.nodeType&&i.push(this._parseNode(h))}return i},_parseDict:function(t){for(var i={},s=null,n=0,h=t.childNodes.length;n<h;n++){var r=t.childNodes[n];1===r.nodeType&&("key"===r.tagName?s=r.firstChild.nodeValue:i[s]=this._parseNode(r))}return i}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],180:[function(t,i,s){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],_:function(){this._fn={};var t,i,s,n,h=this._fnMap;for(t=0,i=h.length;t<i;t++)if((s=h[t])&&s[1]in document){for(t=0,n=s.length;t<n;t++)this._fn[h[0][t]]=s[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,i){if(this._supportsFullScreen){if(t=t||document.documentElement,i){var s=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(s,this._preOnFullScreenChange),this._preOnFullScreenChange=i,document.addEventListener(s,i,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,i){function s(){n.removeEventListener(h._touchEvent,s),h.requestFullScreen(t,i)}t=t||document.body;var n=cc.game.canvas||t,h=this;this.requestFullScreen(t,i),n.addEventListener(this._touchEvent,s)}},cc.screen._()},{}],181:[function(t,i,s){if(!cc.sys){cc.sys={};var n=cc.sys;n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_TURKISH="tr",n.LANGUAGE_UKRAINIAN="uk",n.LANGUAGE_ROMANIAN="ro",n.LANGUAGE_BULGARIAN="bg",n.LANGUAGE_UNKNOWN="unknown",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document;var h=window,r=h.navigator,e=document,c=e.documentElement,o=r.userAgent.toLowerCase();n.isMobile=/mobile|android|iphone|ipad/.test(o),n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER;var u=r.language;u=(u=u||r.browserLanguage)?u.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=u;var a=!1,f=!1,l="",v=0,d=/android (\d+(?:\.\d+)+)/i.exec(o)||/android (\d+(?:\.\d+)+)/i.exec(r.platform);d&&(a=!0,l=d[1]||"",v=parseInt(l)||0),(d=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(o))?(f=!0,l=d[2]||"",v=parseInt(l)||0):/(iPhone|iPad|iPod)/.exec(r.platform)&&(f=!0,l="",v=0);var p=n.OS_UNKNOWN;-1!==r.appVersion.indexOf("Win")?p=n.OS_WINDOWS:f?p=n.OS_IOS:-1!==r.appVersion.indexOf("Mac")?p=n.OS_OSX:-1!==r.appVersion.indexOf("X11")&&-1===r.appVersion.indexOf("Linux")?p=n.OS_UNIX:a?p=n.OS_ANDROID:-1===r.appVersion.indexOf("Linux")&&-1===o.indexOf("ubuntu")||(p=n.OS_LINUX),n.os=p,n.osVersion=l,n.osMainVersion=v,n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(o);t||(t=/qqbrowser|chrome|safari|firefox|trident|opera|opr|oupeng/i.exec(o));var i=t?t[0].toLowerCase():n.BROWSER_TYPE_UNKNOWN;"micromessenger"===i?i=n.BROWSER_TYPE_WECHAT:"safari"===i&&a?i=n.BROWSER_TYPE_ANDROID:"qq"===i&&o.match(/android.*applewebkit/i)?brwoserType=n.BROWSER_TYPE_ANDROID:"trident"===i?i=n.BROWSER_TYPE_IE:"360 aphone"===i?i=n.BROWSER_TYPE_360:"mxbrowser"===i?i=n.BROWSER_TYPE_MAXTHON:"opr"===i&&(i=n.BROWSER_TYPE_OPERA),n.browserType=i}(),n.browserVersion="",function(){var t=o.match(/(mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|uc|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui)(mobile)?(browser)?\/?([\d.]+)/i);t||(t=o.match(/(qqbrowser|chrome|safari|firefox|trident|opera|opr|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),n.browserVersion=t?t[4]:""}();var g=window.innerWidth||document.documentElement.clientWidth,m=window.innerHeight||document.documentElement.clientHeight,w=window.devicePixelRatio||1;n.windowPixelResolution={width:w*g,height:w*m},n._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var _=document.createElement("canvas"),C=document.createElement("canvas");if(cc.create3DContext=function(t,i,s){if(!s)return cc.create3DContext(t,i,"webgl")||cc.create3DContext(t,i,"experimental-webgl")||cc.create3DContext(t,i,"webkit-3d")||cc.create3DContext(t,i,"moz-webgl")||null;try{return t.getContext(s,i)}catch(t){return null}},n._supportCanvasNewBlendModes=function(){var t=_;t.width=1,t.height=1;var i=t.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,1,1),i.globalCompositeOperation="multiply";var s=C;s.width=1,s.height=1;var n=s.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,1,1),i.drawImage(s,0,0,1,1),0===i.getImageData(0,0,1,1).data[0]}(),cc.sys.isMobile){var b=document.createElement("style");b.type="text/css",document.body.appendChild(b),b.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var y=n.localStorage=h.localStorage;y.setItem("storage",""),y.removeItem("storage"),y=null}catch(t){var T=function(){cc.warnID(5200)};n.localStorage={getItem:T,setItem:T,removeItem:T,clear:T}}var S=_.toDataURL("image/webp").startsWith("data:image/webp"),A=!!_.getContext("2d"),M=!1;if(h.WebGLRenderingContext&&(cc.create3DContext(document.createElement("CANVAS"))&&(M=!0),M&&n.os===n.OS_IOS&&9===n.osMainVersion&&(h.indexedDB||(M=!1)),M&&n.os===n.OS_ANDROID)){var x=parseFloat(n.browserVersion);switch(n.browserType){case n.BROWSER_TYPE_MOBILE_QQ:case n.BROWSER_TYPE_BAIDU:case n.BROWSER_TYPE_BAIDU_APP:M=x>=6.2;break;case n.BROWSER_TYPE_ANDROID:n.osMainVersion&&n.osMainVersion>=5&&(M=!0);break;case n.BROWSER_TYPE_CHROME:M=x>=30;break;case n.BROWSER_TYPE_UC:M=x>11;case n.BROWSER_TYPE_360:M=!1}}var E=n.capabilities={canvas:A,opengl:M,webp:S};(void 0!==c.ontouchstart||void 0!==e.ontouchstart||r.msPointerEnabled)&&(E.touches=!0),void 0!==c.onmouseup&&(E.mouse=!0),void 0!==c.onkeyup&&(E.keyboard=!0),(h.DeviceMotionEvent||h.DeviceOrientationEvent)&&(E.accelerometer=!0);var O;!function(){n.browserVersion;var t=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);O={ONLY_ONE:!1,WEB_AUDIO:t,DELAY_CREATE_CTX:!1},n.os===n.OS_IOS&&(O.USE_LOADER_EVENT="loadedmetadata"),n.browserType===n.BROWSER_TYPE_FIREFOX&&(O.DELAY_CREATE_CTX=!0,O.USE_LOADER_EVENT="canplay"),n.os===n.OS_ANDROID&&n.browserType===n.BROWSER_TYPE_UC&&(O.ONE_SOURCE=!0)}();try{O.WEB_AUDIO&&(O.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),O.DELAY_CREATE_CTX&&setTimeout(function(){O.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(t){O.WEB_AUDIO=!1,cc.logID(5201)}var P=[];!function(){var t=document.createElement("audio");t.canPlayType&&(t.canPlayType('audio/ogg; codecs="vorbis"')&&P.push(".ogg"),t.canPlayType("audio/mpeg")&&P.push(".mp3"),t.canPlayType('audio/wav; codecs="1"')&&P.push(".wav"),t.canPlayType("audio/mp4")&&P.push(".mp4"),t.canPlayType("audio/x-m4a")&&P.push(".m4a"))}(),O.format=P,n.__audioSupport=O,n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){return!!t},n.dump=function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t)},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},i.exports=n}},{}],182:[function(t,i,s){var n={_:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(n.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(n.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),n.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:n.meta["minimal-ui"]="true",n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:n.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:n._=function(t){if(!t.__resizeWithBrowserSize){var i=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",i,!1)};window.addEventListener("resize",i,!1)}}}var h=null,r=cc._Class.extend({ctor:function(){var t=cc.ContainerStrategy,i=cc.ContentStrategy;n._(this),this._frameSize=cc.size(0,0),this._initFrameSize();var s=cc.game.canvas.width,h=cc.game.canvas.height;this._designResolutionSize=cc.size(s,h),this._originalDesignResolutionSize=cc.size(s,h),this._viewPortRect=cc.rect(0,0,s,h),this._visibleRect=cc.rect(0,0,s,h),this._contentTranslateLeftTop={left:0,top:0},this._autoFullScreen=!1,this._devicePixelRatio=1,this._viewName="Cocos2dHTML5",this._resizeCallback=null,this._orientationChanging=!0,this._resizing=!1,this._scaleX=1,this._originalScaleX=1,this._scaleY=1,this._originalScaleY=1,this._isRotated=!1,this._orientation=3;var r=cc.sys;this.enableRetina(r.os===r.OS_IOS||r.os===r.OS_OSX),cc.visibleRect&&cc.visibleRect._(this._visibleRect),this._resolutionPolicy=null,this._rpExactFit=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(t.PROPORTION_TO_FRAME,i.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.FIXED_WIDTH),this._initialized=!1,this._contentTranslateLeftTop=null,this._frameZoomFactor=1,this.__resizeWithBrowserSize=!1,this._isAdjustViewPort=!0,this._targetDensityDPI=cc.macro.DENSITYDPI_HIGH,this.enableAntiAlias(!0)},_resizeEvent:function(){var t,i=(t=this.setDesignResolutionSize?this:cc.view)._frameSize.width,s=t._frameSize.height,n=t._isRotated;if(cc.sys.isMobile){var h=cc.game.container.style,r=h.margin;h.margin="0",h.display="none",t._initFrameSize(),h.margin=r,h.display="block"}else t._initFrameSize();if(t._isRotated!==n||t._frameSize.width!==i||t._frameSize.height!==s){var e=t._originalDesignResolutionSize.width,c=t._originalDesignResolutionSize.height;t._resizing=!0,e>0&&t.setDesignResolutionSize(e,c,t._resolutionPolicy),t._resizing=!1,cc.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if((t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t){this._orientation=t;var i=this._originalDesignResolutionSize.width,s=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(i,s,this._resolutionPolicy)}},_initFrameSize:function(){var t=this._frameSize,i=n.availWidth(cc.game.frame),s=n.availHeight(cc.game.frame),h=i>=s;!cc.sys.isMobile||h&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!h&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=i,t.height=s,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=s,t.height=i,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,i,this._resolutionPolicy)},_setViewportMeta:function(t,i){var s=document.getElementById("cocosMetaElement");s&&i&&document.head.removeChild(s);var n,h,r,e=document.getElementsByName("viewport"),c=e?e[0]:null;n=c?c.content:"",(s=s||document.createElement("meta")).id="cocosMetaElement",s.name="viewport",s.content="";for(h in t)-1==n.indexOf(h)?n+=","+h+"="+t[h]:i&&(r=new RegExp(h+"s*=s*[^,]+"),n.replace(r,h+"="+t[h]));/^,/.test(n)&&(n=n.substr(1)),s.content=n,c&&(c.content=n),document.head.appendChild(s)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(n.meta,!1),this._isAdjustViewPort=!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var i=cc.loader._cache;for(var s in i){var n=i[s],h=n&&n.content instanceof cc.Texture2D?n.content:null;h&&(t?h.setAntiAliasTexParameters():h.setAliasTexParameters())}}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=cc._canvas.getContext("2d");r.imageSmoothingEnabled=t,r.mozImageSmoothingEnabled=t;var e=cc.rendererCanvas._dirtyRegion;if(e){var c=new cc.Region;c.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height),e.addRegion(c)}}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(t,i){this._contentTranslateLeftTop={left:t,top:i}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,i){var s=cc.game.canvas,n=cc.game.container;s.width=t*this._devicePixelRatio,s.height=i*this._devicePixelRatio,s.style.width=t+"px",s.style.height=i+"px",n.style.width=t+"px",n.style.height=i+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,i){this._frameSize.width=t,this._frameSize.height=i,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=i+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){if(t instanceof cc.ResolutionPolicy)this._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===i.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===i.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===i.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===i.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(t,i,s){if(t>0||i>0){this.setResolutionPolicy(s);var n=this._resolutionPolicy;if(n&&n.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),n){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=i;var h=n.apply(this,this._designResolutionSize);if(h.scale&&2===h.scale.length&&(this._scaleX=h.scale[0],this._scaleY=h.scale[1]),h.viewport){var r=this._viewPortRect,e=this._visibleRect,c=h.viewport;r.x=c.x,r.y=c.y,r.width=c.width,r.height=c.height,e.x=-r.x/this._scaleX,e.y=-r.y/this._scaleY,e.width=cc.game.canvas.width/this._scaleX,e.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(r.x,-r.y)}var o=cc.director;o._winSizeInPoints.width=this._designResolutionSize.width,o._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=o._winSizeInPoints.width,cc.winSize.height=o._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?o.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect._(this._visibleRect)}else cc.logID(2201)}else cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,i,s){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,i,s)},setViewPortInPoints:function(t,i,s,n){var h=this._frameZoomFactor,r=this._scaleX,e=this._scaleY;cc._renderContext.viewport(t*r*h+this._viewPortRect.x*h,i*e*h+this._viewPortRect.y*h,s*r*h,n*e*h)},setScissorInPoints:function(t,i,s,n){var r=this._frameZoomFactor,e=this._scaleX,c=this._scaleY,o=Math.ceil(t*e*r+this._viewPortRect.x*r),u=Math.ceil(i*c*r+this._viewPortRect.y*r),a=Math.ceil(s*e*r),f=Math.ceil(n*c*r);if(!h){var l=gl.getParameter(gl.SCISSOR_BOX);h=cc.rect(l[0],l[1],l[2],l[3])}h.x===o&&h.y===u&&h.width===a&&h.height===f||(h.x=o,h.y=u,h.width=a,h.height=f,cc._renderContext.scissor(o,u,a,f))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!h){var t=gl.getParameter(gl.SCISSOR_BOX);h=cc.rect(t[0],t[1],t[2],t[3])}var i=1/this._scaleX,s=1/this._scaleY;return cc.rect((h.x-this._viewPortRect.x)*i,(h.y-this._viewPortRect.y)*s,h.width*i,h.height*s)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,i,s){var n=this._devicePixelRatio*(t-s.left),h=this._devicePixelRatio*(s.top+s.height-i);return this._isRotated?{x:this._viewPortRect.width-h,y:n}:{x:n,y:h}},_convertMouseToLocationInView:function(t,i){var s=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-i.left)-s.x)/this._scaleX,t.y=(this._devicePixelRatio*(i.top+i.height-t.y)-s.y)/this._scaleY},_convertPointWithScale:function(t){var i=this._viewPortRect;t.x=(t.x-i.x)/this._scaleX,t.y=(t.y-i.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var i,s,n,h=this._viewPortRect,r=this._scaleX,e=this._scaleY,c=0;c<t.length;c++)s=(i=t[c])._point,n=i._prevPoint,s.x=(s.x-h.x)/r,s.y=(s.y-h.y)/e,n.x=(n.x-h.x)/r,n.y=(n.y-h.y)/e}});r._getInstance=function(){return this._instance||(this._instance=this._instance||new r,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,i){},postApply:function(t){},_setupContainer:function(t,i,s){var n=cc.game.canvas,h=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?s:i)+"px",document.body.style.height=(t._isRotated?i:s)+"px"),h.style.width=n.style.width=i+"px",h.style.height=n.style.height=s+"px";var r=t._devicePixelRatio=1;t.isRetinaEnabled()&&(r=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=i*r,n.height=s*r,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var i=cc.container.style;i.position="fixed",i.left=i.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,i,s,n,h,r){Math.abs(t-s)<2&&(s=t),Math.abs(i-n)<2&&(n=i);var e=cc.rect(Math.round((t-s)/2),Math.round((i-n)/2),s,n);return cc._renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[h,r],this._result.viewport=e,this._result},preApply:function(t){},apply:function(t,i){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){var i=t._frameSize.height,s=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?s.margin="0 0 0 "+i+"px":s.margin="0px"}}),i=cc.ContainerStrategy.extend({apply:function(t,i){var s,n,h=t._frameSize.width,r=t._frameSize.height,e=cc.container.style,c=i.width,o=i.height,u=h/c,a=r/o;u<a?(s=h,n=o*u):(s=c*a,n=r);var f=Math.round((h-s)/2),l=Math.round((r-n)/2);s=h-2*f,n=r-2*l,this._setupContainer(t,s,n),t._isRotated?e.margin="0 0 0 "+r+"px":e.margin="0px",e.paddingLeft=f+"px",e.paddingRight=f+"px",e.paddingTop=l+"px",e.paddingBottom=l+"px"}}),s=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),i.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,i){this._super(t,i),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new i,cc.ContainerStrategy.ORIGINAL_CONTAINER=new s;var n=cc.ContentStrategy.extend({apply:function(t,i){var s=cc.game.canvas.width,n=cc.game.canvas.height,h=s/i.width,r=n/i.height;return this._buildResult(s,n,s,n,h,r)}}),h=cc.ContentStrategy.extend({apply:function(t,i){var s,n,h=cc.game.canvas.width,r=cc.game.canvas.height,e=i.width,c=i.height,o=h/e,u=r/c,a=0;return o<u?(a=o,s=h,n=c*a):(a=u,s=e*a,n=r),this._buildResult(h,r,s,n,a,a)}}),r=cc.ContentStrategy.extend({apply:function(t,i){var s,n,h,r=cc.game.canvas.width,e=cc.game.canvas.height,c=i.width,o=i.height,u=r/c,a=e/o;return u<a?(s=a,n=c*s,h=e):(s=u,n=r,h=o*s),this._buildResult(r,e,n,h,s,s)}}),e=cc.ContentStrategy.extend({apply:function(t,i){var s=cc.game.canvas.width,n=cc.game.canvas.height,h=n/i.height,r=s,e=n;return this._buildResult(s,n,r,e,h,h)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),c=cc.ContentStrategy.extend({apply:function(t,i){var s=cc.game.canvas.width,n=cc.game.canvas.height,h=s/i.width,r=s,e=n;return this._buildResult(s,n,r,e,h,h)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new h,cc.ContentStrategy.NO_BORDER=new r,cc.ContentStrategy.FIXED_HEIGHT=new e,cc.ContentStrategy.FIXED_WIDTH=new c}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,i){this.setContainerStrategy(t),this.setContentStrategy(i)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,i){return this._containerStrategy.apply(t,i),this._contentStrategy.apply(t,i)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,i.exports=r},{}],183:[function(t,i,s){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,_:function(t){var i=this.width=t.width,s=this.height=t.height,n=t.x,h=t.y,r=h+s,e=n+i;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=e,this.topRight.y=r,this.top.x=n+i/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=h,this.bottomRight.x=e,this.bottomRight.y=h,this.bottom.x=n+i/2,this.bottom.y=h,this.center.x=n+i/2,this.center.y=h+s/2,this.left.x=n,this.left.y=h+s/2,this.right.x=e,this.right.y=h+s/2}}},{}],184:[function(t,i,s){var n=cc.ClassManager={instanceId:0|998*Math.random(),getNewInstanceId:function(){return this.instanceId++}},h=/\b_super\b/,r=function(){};r.extend=function(t){var i,s=this.prototype,e=Object.create(s),c={writable:!0,enumerable:!1,configurable:!0};if(cc.game&&cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]){var o="return (function "+(t._className||"Class")+"(arg0,arg1,arg2,arg3,arg4) {\nthis.__instanceId = cc.ClassManager.getNewInstanceId();\nif (this.ctor) {\nswitch (arguments.length) {\ncase 0: this.ctor(); break;\ncase 1: this.ctor(arg0); break;\ncase 2: this.ctor(arg0,arg1); break;\ncase 3: this.ctor(arg0,arg1,arg2); break;\ncase 4: this.ctor(arg0,arg1,arg2,arg3); break;\ncase 5: this.ctor(arg0,arg1,arg2,arg3,arg4); break;\ndefault: this.ctor.apply(this, arguments);\n}\n}\n});";i=Function(o)()}else i=function(t,i,s,h,r){if(this.__instanceId=n.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(t);break;case 2:this.ctor(t,i);break;case 3:this.ctor(t,i,s);break;case 4:this.ctor(t,i,s,h);break;case 5:this.ctor(t,i,s,h,r);break;default:this.ctor.apply(this,arguments)}};i.prototype=e,c.value=i,Object.defineProperty(e,"constructor",c);for(var u in t){var a="function"==typeof t[u];a&&"function"==typeof s[u]&&h.test(t[u])?(c.value=function(t,i){return function(){var n=this._super;this._super=s[t];var h=i.apply(this,arguments);return this._super=n,h}}(u,t[u]),Object.defineProperty(e,u,c)):a?(c.value=t[u],Object.defineProperty(e,u,c)):e[u]=t[u]}return i.extend=r.extend,i.implement=function(t){for(var i in t)e[i]=t[i]},i},cc.defineGetterSetter=function(t,i,s,n,h,r){if(t.__defineGetter__)s&&t.__defineGetter__(i,s),n&&t.__defineSetter__(i,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var e={configurable:!0};s&&(e.get=s),n&&(e.set=n),Object.defineProperty(t,i,e)}},cc.clone=function(t){var i=t.constructor?new t.constructor:{};for(var s in t){var n=t[s];"object"!=typeof n||!n||n instanceof _ccsg.Node||n instanceof HTMLElement?i[s]=n:i[s]=cc.clone(n)}return i},cc._Class=i.exports=r},{}],185:[function(t,i,s){function n(t,i,s){var n;n=function(){},s&&e.extend(n,s.constructor);var h=new n;return e.value(t,"__attrs__",h),h}function h(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){for(var i,s=cc.T.getInheritanceChain(t),h=s.length-1;h>=0;h--){var r=s[h];r.hasOwnProperty("__attrs__")&&r.__attrs__||n(r,0,(i=s[h+1])&&i.__attrs__)}return i=s[0],n(t,0,i&&i.__attrs__),t.__attrs__}(t)}function r(t){return h(t).constructor.prototype}var e=t("./js"),c=(t("./utils").isPlainEmptyObj_DEV,"$_$");cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String",i.exports={attr:function(t,i,s){var r,e,o;if("function"==typeof t)e=(r=h(t)).constructor.prototype;else{var u=t;(r=u.__attrs__)||(r=n(u,t=u.constructor,h(t))),e=r}if(void 0===s){var a=i+c,f={};for(o in r)o.startsWith(a)&&(f[o.slice(a.length)]=r[o]);return f}if("object"==typeof s)for(o in s)95!==o.charCodeAt(0)&&(e[i+c+o]=s[o])},getClassAttrs:h,getClassAttrsProto:r,setClassAttr:function(t,i,s,n){r(t)[i+c+s]=n},DELIMETER:c,getTypeChecker:function(t,i){},ObjectType:function(t){return{type:"Object",ctor:t,_onAfterProp:!1}},ScriptUuid:{}}},{"./CCClass":172,"./js":192,"./utils":197}],186:[function(t,i,s){var n=t("./js"),h=function(){this._callbackTable={},this._invoking={},this._toRemove={},this._toRemoveAll=null},r={};h.REMOVE_PLACEHOLDER=r,h.prototype._clearToRemove=function(t){var i=this._callbackTable[t];if(this._toRemove[t]&&i){for(var s=i.indexOf(r),n=s,h=s+1;h<i.length;++h){var e=i[h];e!==r&&(i[n]=e,++n)}i.length=n,this._toRemove[t]=!1}this._toRemoveAll&&(this.removeAll(this._toRemoveAll),this._toRemoveAll=null)},h.prototype.add=function(t,i,s){var n=this._callbackTable[t];return void 0!==n?("object"==typeof s?n.push(i,s):n.push(i),!1):(n="object"==typeof s?[i,s]:[i],this._callbackTable[t]=n,!0)},h.prototype.has=function(t,i,s){if(this._toRemoveAll===t)return!1;var n,h,e=this._callbackTable[t];if(!e)return!1;if(!i){if(this._toRemove[t]){for(h=0;h<e.length;h++)if(e[h]!==r)return!0;return!1}return e.length>0}if("function"!=typeof i)return!1;for(h=e.indexOf(i);-1!==h;){if("object"!=typeof(n=e[h+1])&&(n=void 0),n===s)return!0;h=cc.js.array.indexOf.call(e,i,h+1)}return!1},h.prototype.removeAll=function(t){if(this._invoking[t])this._toRemoveAll=t;else if("object"==typeof t){var i,s,n=t;for(t in this._callbackTable)for(s=(i=this._callbackTable[t]).lastIndexOf(n);-1!==s;)"function"==typeof i[s-1]?i.splice(s-1,2):i.splice(s,1),s=i.lastIndexOf(n)}else delete this._callbackTable[t],delete this._toRemove[t]},h.prototype.remove=function(t,i,s){var n,h,e=this._callbackTable[t];if(e){for(n=e.indexOf(i);-1!==n;){if("object"!=typeof(h=e[n+1])&&(h=void 0),h===s){this._invoking[t]?(e[n]=r,h&&(e[n+1]=r),this._toRemove[t]=!0):e.splice(n,h?2:1);break}n=cc.js.array.indexOf.call(e,i,n+1)}return!0}return!1};var e=function(){h.call(this)};n.extend(e,h),e.prototype.invoke=function(t,i,s,n,h,e){this._invoking[t]=!0;var c=this._callbackTable[t];if(c){var o,u=c.length-1;for(o=0;o<=u;){var a=c[o],f=1;if(a!==r){var l=c[o+1];l&&"object"==typeof l?(a.call(l,i,s,n,h,e),f=2):a(i,s,n,h,e)}o+=f}}this._invoking[t]=!1,this._clearToRemove(t)},e.prototype.invokeAndRemove=function(t,i,s,n,h,e){this._invoking[t]=!0;var c,o,u,a,f,l=this._callbackTable[t];if(l)for(c=0,o=l.length;c<o;)u=1,(a=l[c])!==r&&((f=l[c+1])&&"object"==typeof f?(a.call(f,i,s,n,h,e),u=2):a(i,s,n,h,e)),c+=u;this._invoking[t]=!1,this._toRemove[t]=!1,this.removeAll(t)},e.prototype.bindKey=function(t,i){var s=this;return function(n,h,r,e,c){var o,u,a,f=s._callbackTable[t];if(f)for(o=0,u=f.length;o<u;)(a=f[o+1])&&"object"==typeof a?(f[o].call(a,n,h,r,e,c),o+=2):(f[o](n,h,r,e,c),++o);i&&s.removeAll(t)}},e.CallbacksHandler=h,i.exports=e},{"./js":192}],187:[function(t,i,s){var n=t("./js"),h=(t("./CCObject"),t("./attribute")),r=t("./CCClass"),e=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};e.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},e.prototype.getUuidOf=function(t,i){for(var s=0;s<this.uuidObjList.length;s++)if(this.uuidObjList[s]===t&&this.uuidPropList[s]===i)return this.uuidList[s];return""},e.prototype.push=function(t,i,s){this.uuidList.push(s),this.uuidObjList.push(t),this.uuidPropList.push(i)},(e.pool=new n.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new e};var c=function(){function t(t,i,s,n,h){this.result=t,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=s,this._idList=[],this._idObjList=[],this._idPropList=[]}var i=t.prototype;return i.deserialize=function(t){if(Array.isArray(t)){var i=t,s=i.length;this.deserializedList.length=s;for(var n=0;n<s;n++)i[n]&&(this.deserializedList[n]=this._deserializeObject(i[n]));this.deserializedData=s>0?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t):null,this.deserializedList[0]=this.deserializedData;return function(t){var i,s,n,h=t.deserializedList,r=t._idPropList,e=t._idList,c=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,i=0;i<e.length;i++)s=r[i],n=e[i],c[i][s]=h[n]}(this),this.deserializedData},i._deserializeObject=function(t,i,s,e){var c,o=null,u=null;if(t.__type__){var a=t.__type__;if(!(u=this._classFinder(a,t,s,e)))return this._classFinder===n._getClassById&&cc.deserialize.reportMissingClass(a),null;if((o=new u)._deserialize)return o._deserialize(t.content,this),o;cc.T._isCCClass(u)?function(t,i,s,e,c){var o;e.hasOwnProperty("__deserialize__")?o=e.__deserialize__:(o=function(t,i){for(var s=h.DELIMETER+"rawType",e=(h.DELIMETER,h.DELIMETER+"serializable"),c=h.DELIMETER+"default",o=h.getClassAttrs(i),u=i.__props__,a=["var prop;"],f=0;f<u.length;f++){var l,v=u[f];if(o[v+s])l=r.IDENTIFIER_RE.test(v)?'"'+v+'"':r.escapeForJS(v),a.push('if(s.result.rawProp)\ncc.error("not support multi raw object in a file");'),a.push("s.result.rawProp="+l+";");else{if(!1===o[v+e])continue;var d;r.IDENTIFIER_RE.test(v)?(l='"'+v+'"',d="."+v):d="["+(l=r.escapeForJS(v))+"]",a.push("prop=d"+d+";"),a.push('if(typeof prop!=="undefined"){'),a.push('if(typeof prop!=="object"){o'+d+"=prop;"),a.push("}else{if(prop){");var p=r.getDefault(o[v+c]);if(p instanceof cc.ValueType){var g=n.getClassName(p);a.push("s._deserializeTypedObject(o"+d+",prop,"+g+");")}else a.push("s._deserializeObjField(o,prop,"+l+");");a.push("}else o"+d+"=null;}}")}}return"_$erialized"===u[u.length-1]&&(a.push("o._$erialized=JSON.parse(JSON.stringify(d));"),a.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k","t",a.join(""))}(0,e),n.value(e,"__deserialize__",o,!0)),o(t,i,s,e,c)}(this,o,t,u,i):this._deserializeTypedObject(o,t,u)}else if(Array.isArray(t)){o=new Array(t.length);for(var f=0;f<t.length;f++)"object"==typeof(c=t[f])&&c?this._deserializeObjField(o,c,""+f):o[f]=c}else o={},this._deserializePrimitiveObject(o,t);return o},i._deserializeObjField=function(t,i,s,n){var h=i.__id__;if(void 0===h){var r=i.__uuid__;r?(this.result.uuidList.push(r),this.result.uuidObjList.push(t),this.result.uuidPropList.push(s)):t[s]=this._deserializeObject(i)}else{var e=this.deserializedList[h];e?t[s]=e:(this._idList.push(h),this._idObjList.push(t),this._idPropList.push(s))}},i._deserializePrimitiveObject=function(t,i){for(var s in i)if(i.hasOwnProperty(s)){var n=i[s];"object"!=typeof n?"__type__"!==s&&(t[s]=n):n?this._deserializeObjField(t,n,s):t[s]=null}},i._deserializeTypedObject=function(t,i,s){if(s===cc.Vec2)return t.x=i.x||0,void(t.y=i.y||0);if(s!==cc.Color){var n=s.__props__;n||(n=Object.keys(t));for(var h=0;h<n.length;h++){var r=n[h],e=i[r];void 0!==e&&i.hasOwnProperty(r)&&("object"!=typeof e?t[r]=e:e?this._deserializeObjField(t,e,r):t[r]=null)}}else{t.r=i.r||0,t.g=i.g||0,t.b=i.b||0;var c=i.a;t.a=void 0===c?255:c}},t.pool=new n.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1),t.pool.get=function(i,s,n,h,r){var e=this._get();return e?(e.result=i,e.customEnv=h,e._classFinder=n,e):new t(i,s,n,h,r)},t}();cc.deserialize=function(t,i,s){var h=(s=s||{}).classFinder||n._getClassById,r=s.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,o=s.customEnv,u=s.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t));var a=!i;i=i||e.pool.get();var f=c.pool.get(i,!1,h,o,u);cc.game._isCloning=!0;var l=f.deserialize(t);return cc.game._isCloning=!1,c.pool.put(f),r&&i.assignAssetsBy(Editor.serialize.asAsset),a&&e.pool.put(i),l},cc.deserialize.Details=e,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t)}},{"./CCClass":172,"./CCObject":178,"./attribute":185,"./js":192}],188:[function(t,i,s){function n(t){this.id=0|998*Math.random(),this.prefix=t?t+h:""}var h=".";n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),i.exports=n},{}],189:[function(t,i,s){t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),cc.sys.isBrowser&&t("./CCAssetLibrary"),t("./miniFramework"),t("./CCVisibleRect")},{"./CCAssetLibrary":171,"./CCClass":172,"./CCClassDecorator":173,"./CCEnum":174,"./CCMacro":177,"./CCObject":178,"./CCSys":181,"./CCVisibleRect":183,"./callbacks-invoker":186,"./deserialize":187,"./instantiate":191,"./instantiate-jit":190,"./js":192,"./miniFramework":193,"./requiring-frame":195,"./url":196}],190:[function(t,i,s){function n(t,i){this.varName=t,this.expression=i}function h(t,i){return i instanceof n?new n(i.varName,t+i.expression):t+i}function r(t,i,s){Array.isArray(s)?(s[0]=h(i,s[0]),t.push(s)):t.push(h(i,s)+";")}function e(t){this._exps=[],this._targetExp=t}function c(t,i){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===i)return!0;if(t&&i){if(t instanceof cc.ValueType&&t.equals(i))return!0;if(Array.isArray(t)&&Array.isArray(i)||t.constructor===Object&&i.constructor===Object)try{return JSON.stringify(t)===JSON.stringify(i)}catch(t){}}return!1}function o(t){return w.test(t)?"."+t:"["+_(t)+"]"}function u(t,i){this.parent=i,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=d.createMap(),d.mixin(this.funcModuleCache,T),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push(C+b+","+y+";","if(R){",b+"=R;","}else{",b+"=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t);var s;this.globalVariables.length>0&&(s=C+this.globalVariables.join(",")+";");var n=function(t,i){var s=[];return function t(i){for(var n=0;n<i.length;n++){var h=i[n];Array.isArray(h)?t(h):s.push(h)}}(t),s.join("")}(["return (function(R){",s||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",n)(this.objs,this.funcs);for(var h=0,r=this.objsToClear_iN$t.length;h<r;++h)this.objsToClear_iN$t[h]._iN$t=null;this.objsToClear_iN$t.length=0}var a=t("./CCObject"),f=a.Flags.Destroyed,l=a.Flags.PersistentMask,v=t("./attribute"),d=t("./js"),p=t("./CCClass"),g=v.DELIMETER+"serializable",m=v.DELIMETER+"default",w=p.IDENTIFIER_RE,_=p.escapeForJS,C="var ",b="o",y="t",T={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};n.prototype.toString=function(){return C+this.varName+"="+this.expression+";"},e.prototype.append=function(t,i){this._exps.push([t,i])},e.prototype.writeCode=function(t){var i;if(this._exps.length>1)t.push(y+"="+this._targetExp+";"),i=y;else{if(1!==this._exps.length)return;i=this._targetExp}for(var s=0;s<this._exps.length;s++){var n=this._exps[s];r(t,i+o(n[0])+"=",n[1])}},(e.pool=new d.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var i=this._get()||new e;return i._targetExp=t,i};var S=u.prototype;S.getFuncModule=function(t,i){var s=d.getClassName(t);if(s){var n=this.funcModuleCache[s];if(n)return n;if(void 0===n){var h=-1!==s.indexOf(".");if(h)try{if(h=t===Function("return "+s)())return this.funcModuleCache[s]=s,s}catch(t){}}}var r=this.funcs.indexOf(t);r<0&&(r=this.funcs.length,this.funcs.push(t));var e="F["+r+"]";return i&&(e="("+e+")"),this.funcModuleCache[s]=e,e},S.getObjRef=function(t){var i=this.objs.indexOf(t);return i<0&&(i=this.objs.length,this.objs.push(t)),"O["+i+"]"},S.setValueType=function(t,i,s,n){var h=e.pool.get(n),r=i.constructor.__props__;r||(r=Object.keys(i));for(var c=0;c<r.length;c++){var o=r[c],u=s[o];if(i[o]!==u){var a=this.enumerateField(s,o,u);h.append(o,a)}}h.writeCode(t),e.pool.put(h)},S.enumerateCCClass=function(t,i,s){for(var n=s.__props__,h=v.getClassAttrs(s),r=0;r<n.length;r++){var e=n[r];if(!1!==h[e+g]){var u=i[e],a=h[e+m];if(c(a,u))continue;if("object"==typeof u&&u instanceof cc.ValueType&&((a=p.getDefault(a))&&a.constructor)===u.constructor){var f=b+o(e);this.setValueType(t,a,u,f);continue}this.setObjProp(t,i,e,u)}}},S.instantiateArray=function(t){if(0===t.length)return"[]";var i="a"+ ++this.localVariableId,s=[new n(i,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:s},this.objsToClear_iN$t.push(t);for(var h=0;h<t.length;++h)r(s,i+"["+h+"]=",this.enumerateField(t,h,t[h]));return s},S.enumerateField=function(t,i,s){if("object"==typeof s&&s){var n=s._iN$t;if(n){var r=n.globalVar;if(!r){r=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var e=n.source[0];n.source[0]=h(r+"=",e)}return r}return Array.isArray(s)?this.instantiateArray(s):this.instantiateObj(s)}return"function"==typeof s?this.getFuncModule(s):"string"==typeof s?_(s):("_objFlags"===i&&t instanceof a&&(s&=l),s)},S.setObjProp=function(t,i,s,n){r(t,b+o(s)+"=",this.enumerateField(i,s,n))},S.enumerateObject=function(t,i){var s=i.constructor;if(cc.T._isCCClass(s))this.enumerateCCClass(t,i,s);else for(var n in i)if(i.hasOwnProperty(n)&&(95!==n.charCodeAt(0)||95!==n.charCodeAt(1)||"__type__"===n)){var h=i[n];"object"==typeof h&&h&&h===i._iN$t||this.setObjProp(t,i,n,h)}},S.instantiateObj=function(t){if(t instanceof cc.ValueType)return p.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&f)return null;var i,s=t.constructor;if(cc.T._isCCClass(s)){if(this.parent)if(this.parent instanceof cc.U){if(t instanceof cc._BaseNode||t instanceof cc.U)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.U&&!t.node.isChildOf(this.parent))return this.getObjRef(t);i=new n(b,"new "+this.getFuncModule(s,!0)+"()")}else{if(s!==Object)return this.getObjRef(t);i=new n(b,"{}")}var h=[i];return t._iN$t={globalVar:"",source:h},this.objsToClear_iN$t.push(t),this.enumerateObject(h,t),["(function(){",h,"return o;})();"]},i.exports={compile:function(t){return new u(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:c}},{"./CCClass":172,"./CCObject":178,"./attribute":185,"./js":192}],191:[function(t,i,s){function n(t,i){if(!i){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var s;if(t instanceof c){if(t._instantiate)return cc.game._isCloning=!0,s=t._instantiate(),cc.game._isCloning=!1,s;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,s=h(t),cc.game._isCloning=!1,s}function h(t,i){if(Array.isArray(t))return null;if(f&&f(t))return null;var s;r(t,s=t._iN$t?t._iN$t:new(0,t.constructor),i);for(var n=0,h=l.length;n<h;++n)l[n]._iN$t=null;return l.length=0,s}function r(t,i,s){t._iN$t=i,l.push(t);var n=t.constructor;if(cc.T._isCCClass(n))!function(t,i,s,n){for(var h=t.__props__,r=a.getClassAttrs(t),c=0;c<h.length;c++){var o=h[c];if(!1!==r[o+v]){var u=i[o];s[o]="object"==typeof u&&u?u._iN$t||e(u,n):u}}}(n,t,i,s);else for(var h in t)if(t.hasOwnProperty(h)&&(95!==h.charCodeAt(0)||95!==h.charCodeAt(1)||"__type__"===h)){var r=t[h];if("object"==typeof r&&r){if(r===i)continue;i[h]=r._iN$t||e(r,s)}else i[h]=r}t instanceof c&&(i._objFlags&=u)}function e(t,i){if(t instanceof cc.ValueType)return t.clone();if(t instanceof cc.Asset)return t;var s;if(Array.isArray(t)){var n=t.length;s=new Array(n),t._iN$t=s;for(var h=0;h<n;++h){var c=t[h];s[h]="object"==typeof c&&c?c._iN$t||e(c,i):c}return l.push(t),s}if(t._objFlags&o)return null;var u=t.constructor;if(cc.T._isCCClass(u)){if(i)if(i instanceof cc.U){if(t instanceof cc._BaseNode||t instanceof cc.U)return t}else if(i instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(i))return t}else if(t instanceof cc.U&&!t.node.isChildOf(i))return t}else if(u!==Object)return t;return s=new u,r(t,s,i),s}var c=t("./CCObject"),o=c.Flags.Destroyed,u=c.Flags.PersistentMask,a=t("./attribute"),f=t("./utils").isDomNode,l=[],v=a.DELIMETER+"serializable";n._clone=h,cc.instantiate=n,i.exports=n},{"./CCObject":178,"./attribute":185,"./utils":197}],192:[function(t,i,s){function n(t,i){for(;t;){var s=Object.getOwnPropertyDescriptor(t,i);if(s)return s;t=Object.getPrototypeOf(t)}return null}function h(t,i,s){var h=n(i,t);Object.defineProperty(s,t,h)}function r(t,i){t.splice(i,1)}function e(t,i){var s=t.indexOf(i);return s>=0&&(r(t,s),!0)}function c(t,i){"number"==typeof t&&(i=t,t=null),this.get=null,this.count=0,this._pool=new Array(i),this._cleanup=t}var o=new(t("./id-generater"))("TmpCId."),u={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){"use strict";t=t||{};for(var i=1,s=arguments.length;i<s;i++){var n=arguments[i];if(n){if("object"!=typeof n){cc.errorID(5402,n);continue}for(var r in n)r in t||h(r,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var i=1,s=arguments.length;i<s;i++){var n=arguments[i];if(n){if("object"!=typeof n){cc.errorID(5403,n);continue}for(var r in n)h(r,n,t)}}return t},extend:function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t.prototype=Object.create(i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){var i=t.prototype,s=i&&Object.getPrototypeOf(i);return s&&s.constructor},clear:function(t){for(var i=Object.keys(t),s=0;s<i.length;s++)delete t[i[s]]},getPropertyDescriptor:n},a={value:void 0,enumerable:!1,writable:!1,configurable:!0};u.value=function(t,i,s,n,h){a.value=s,a.writable=n,a.enumerable=h,Object.defineProperty(t,i,a),a.value=void 0};var f={get:null,set:null,enumerable:!1};u.getset=function(t,i,s,n,h){"function"!=typeof n&&(h=n,n=void 0),f.get=s,f.set=n,f.enumerable=h,Object.defineProperty(t,i,f),f.get=null,f.set=null};var l={get:null,enumerable:!1,configurable:!1};u.get=function(t,i,s,n,h){l.get=s,l.enumerable=n,l.configurable=h,Object.defineProperty(t,i,l),l.get=null};var v={set:null,enumerable:!1,configurable:!1};u.set=function(t,i,s,n,h){v.set=s,v.enumerable=n,v.configurable=h,Object.defineProperty(t,i,v),v.set=null},u.getClassName=function(t){if("function"==typeof t){var i=t.prototype;if(i&&i.hasOwnProperty("__classname__")&&i.__classname__)return i.__classname__;var s="";if(t.name&&(s=t.name),t.toString){var n,h=t.toString();(n="["===h.charAt(0)?h.match(/\[\w+\s*(\w+)\]/):h.match(/function\s*(\w+)/))&&2===n.length&&(s=n[1])}return"Object"!==s?s:""}return t&&t.constructor?u.getClassName(t.constructor):""},function(){function t(t,i){return function(s,n){if(n.prototype.hasOwnProperty(t)&&delete i[n.prototype[t]],u.value(n.prototype,t,s),s){var h=i[s];if(h&&h!==n){var r="A Class already exists with the same "+t+' : "'+s+'".';cc.error(r)}else i[s]=n}}}var i={},s={};u._setClassId=t("__cid__",i);var n=t("__classname__",s);u.setClassName=function(t,i){if(n(t,i),!i.prototype.hasOwnProperty("__cid__")){var s=t||o.getNewId();s&&u._setClassId(s,i)}},u.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t].prototype,h=n.__cid__;h&&delete i[h];var r=n.__classname__;r&&delete s[r]}},u._getClassById=function(t){return i[t]},u.getClassByName=function(t){return s[t]},u._getClassId=function(t,i){if(i=void 0===i||i,"function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var s=t.constructor.prototype;if(s&&s.hasOwnProperty("__cid__"))return t.__cid__}return""}}(),u.obsolete=function(t,i,s,n){function h(){return this[s]}var r=/([^.]+)$/.exec(i)[0];n?u.getset(t,r,h,function(t){this[s]=t}):u.get(t,r,h)},u.obsoletes=function(t,i,s,n){for(var h in s){var r=s[h];u.obsolete(t,i+"."+h,r,n)}};var d=/(%d)|(%s)/,p=/%s/;u.formatStr=function(){var t=arguments.length;if(0===t)return"";var i=arguments[0];if(1===t)return""+i;if("string"==typeof i&&d.test(i))for(var s=1;s<t;++s){var n=arguments[s],h="number"==typeof n?d:p;h.test(i)?i=i.replace(h,n):i+=" "+n}else for(var r=1;r<t;++r)i+=" "+arguments[r];return i},u.shiftArguments=function(){for(var t=arguments.length-1,i=new Array(t),s=0;s<t;++s)i[s]=arguments[s+1];return i},u.createMap=function(t){var i=Object.create(null);return t&&(i.__=void 0,delete i.__),i};var g=Array.prototype.indexOf;u.array={remove:e,fastRemove:function(t,i){var s=t.indexOf(i);s>=0&&(t[s]=t[t.length-1],--t.length)},removeAt:r,fastRemoveAt:function(t,i){var s=t.length;i<0||i>=s||(t[i]=t[s-1],t.length=s-1)},contains:function(t,i){return g.call(t,i)>=0},verifyType:function(t,i){if(t&&t.length>0)for(var s=0;s<t.length;s++)if(!(t[s]instanceof i))return cc.logID(1300),!1;return!0},removeArray:function(t,i){for(var s=0,n=i.length;s<n;s++)e(t,i[s])},appendObjectsAt:function(t,i,s){return t.splice.apply(t,[s,0].concat(i)),t},copy:function(t){var i,s=t.length,n=new Array(s);for(i=0;i<s;i+=1)n[i]=t[i];return n},indexOf:g,MutableForwardIterator:t("../utils/mutable-forward-iterator")},c.prototype._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},c.prototype.put=function(t){var i=this._pool;if(this.count<i.length){if(this._cleanup&&!1===this._cleanup(t))return;i[this.count]=t,++this.count}},c.prototype.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},u.Pool=c,cc.js=u,i.exports=u},{"../utils/mutable-forward-iterator":224,"./id-generater":188}],193:[function(t,i,s){switch(cc.$=function(t){var i=this===cc?document:this,s=t instanceof HTMLElement?t:i.querySelector(t);return s&&(s.find=s.find||cc.$,s.hasClass=s.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},s.addClass=s.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},s.removeClass=s.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},s.remove=s.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},s.appendTo=s.appendTo||function(t){return t.appendChild(this),this},s.prependTo=s.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},s.transforms=s.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},s.position=s.position||{x:0,y:0},s.rotation=s.rotation||0,s.scale=s.scale||{x:1,y:1},s.skew=s.skew||{x:0,y:0},s.translates=function(t,i){return this.position.x=t,this.position.y=i,this.transforms(),this},s.rotate=function(t){return this.rotation=t,this.transforms(),this},s.resize=function(t,i){return this.scale.x=t,this.scale.y=i,this.transforms(),this},s.setSkew=function(t,i){return this.skew.x=t,this.skew.y=i,this.transforms(),this}),s},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var i=0,s=0;do{i+=t.offsetLeft,s+=t.offsetTop}while(t=t.offsetParent);return{x:i,y:s}}},{}],194:[function(t,i,s){function n(t,i,s,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var h="_N$"+i;t.get=function(){return this[h]},t.set=function(t){var i=this[h];this[h]=t,s.call(this,i)};var r={};n[h]=r;for(var e in c){var o=c[e];t.hasOwnProperty(e)&&(r[e]=t[e],o.canUsedInGet||delete t[e])}}}function h(t,i,s,n){Array.isArray(n)&&n.length>0&&(n=n[0]),t.type=n}function r(t,i,s,n){if(Array.isArray(i)){if(!(i.length>0))return cc.errorID(5508,s,n);if(cc.RawAsset.isRawAssetType(i[0]))return t.url=i[0],void delete t.type;t.type=i=i[0]}}function e(t,i,s,n){}var c={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},rawType:{}};s.getFullFormOfProperty=function(t){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return{default:[],type:t,_short:!0};if("function"==typeof t){var i=t;return cc.RawAsset.isRawAssetType(i)?{default:"",url:i,_short:!0}:{default:cc.isChildClassOf(i,cc.ValueType)?new i:null,type:i,_short:!0}}return{default:t,_short:!0}}return null},s.preprocessAttrs=function(t,i,c,o){for(var u in t){var a=t[u],f=s.getFullFormOfProperty(a);if(f&&(a=t[u]=f),a){var l=a.notify;l&&n(a,u,l,t),"type"in a&&r(a,a.type,i,u),"url"in a&&h(a,0,0,a.url),"type"in a&&e(0,a.type)}}},s.validateMethodWithProps=function(t,i,s,n,h){return"function"==typeof t||null===t}},{"./CCClass":172}],195:[function(t,i,s){var n=[];cc._RF={push:function(t,i,s){void 0===s&&(s=i,i=""),n.push({uuid:i,script:s,module:t,exports:t.exports,beh:null})},pop:function(){var t=n.pop(),i=t.module,s=i.exports;if(s===t.exports){for(var h in s)return;i.exports=s=t.cls}},peek:function(){return n[n.length-1]}},cc._RFpush=cc._RF.push,cc._RFpop=cc._RF.pop,cc._RFpeek=cc._RF.peek},{}],196:[function(t,i,s){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){return 46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1)),t},raw:function(t){return(t=this.normalize(t)).startsWith("resources/")||cc.errorID(7002,t),this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var i in t){var s=t[i];s=cc.path.stripSep(s)+"/",n[i]=s}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},i.exports=cc.url},{}],197:[function(t,i,s){i.exports={contains:function(t,i){if("function"==typeof t.contains)return t.contains(i);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));var s=i.parentNode;do{if(s===t)return!0;s=s.parentNode}while(null!==s);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,i,s){t&&setTimeout(function(){t(i,s)},0)}}},{}],198:[function(t,i,s){t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./textures"),t("./CCDirector"),t("./CCDirectorWebGL"),t("./CCDirectorCanvas"),t("./platform/CCSAXParser"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager"),t("./renderer")},{"./CCDirector":34,"./CCDirectorCanvas":35,"./CCDirectorWebGL":36,"./CCScheduler":42,"./event":113,"./event-manager":109,"./load-pipeline":134,"./platform/CCInputExtension":175,"./platform/CCInputManager":176,"./platform/CCMacro":177,"./platform/CCSAXParser":179,"./platform/CCScreen":180,"./platform/CCSys":181,"./platform/CCView":182,"./platform/js":192,"./renderer":202,"./textures":215,"./utils":222,"./value-types":236}],199:[function(t,i,s){function n(){var t=o.pop();return t||(t=new e),t}function h(t){o.push(t)}function r(t,i){var s=t._minX<i._minX?t._minX:i._minX,n=t._minY<i._minY?t._minY:i._minY;return((t._maxX>i._maxX?t._maxX:i._maxX)-s)*((t._maxY>i._maxY?t._maxY:i._maxY)-n)}var e=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},c=e.prototype,o=[];c.setTo=function(t,i,s,n){return this._minX=t,this._minY=i,this._maxX=s,this._maxY=n,this.updateArea(),this},c.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},c.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},c.union=function(t){this.isEmpty()?this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),this.updateArea())},c.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},c.isEmpty=function(){return this._width<=0||this._height<=0},c.intersects=function(t){if(this.isEmpty()||t.isEmpty())return!1;var i=this._minX>t._minX?this._minX:t._minX,s=this._maxX<t._maxX?this._maxX:t._maxX;return!(i>s)&&(i=this._minY>t._minY?this._minY:t._minY,s=this._maxY<t._maxY?this._maxY:t._maxY,i<=s)},c.updateRegion=function(t,i){if(0!==t.width&&0!==t.height){var s,n,h,r,e=i,c=e.a,o=e.b,u=e.c,a=e.d,f=e.tx,l=e.ty,v=t.x,d=t.y,p=v+t.width,g=d+t.height;if(1===c&&0===o&&0===u&&1===a)s=v+f-1,n=d+l-1,h=p+f+1,r=g+l+1;else{var m=c*v+u*d+f,w=o*v+a*d+l,_=c*p+u*d+f,C=o*p+a*d+l,b=c*p+u*g+f,y=o*p+a*g+l,T=c*v+u*g+f,S=o*v+a*g+l,A=0;m>_&&(A=m,m=_,_=A),b>T&&(A=b,b=T,T=A),s=(m<b?m:b)-1,h=(_>T?_:T)+1,w>C&&(A=w,w=C,C=A),y>S&&(A=y,y=S,S=A),n=(w<y?w:y)-1,r=(C>S?C:S)+1}this._minX=s,this._minY=n,this._maxX=h,this._maxY=r,this._width=h-s,this._height=r-n,this._area=this._width*this._height}else this.setEmpty()};var u=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},a=u.prototype;a.setClipRect=function(t,i){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(i),this.clipArea=this.clipWidth*this.clipHeight},a.addRegion=function(t){var i=t._minX,s=t._minY,h=t._maxX,r=t._maxY;if(this.hasClipRect&&(i<0&&(i=0),s<0&&(s=0),h>this.clipWidth&&(h=this.clipWidth),r>this.clipHeight&&(r=this.clipHeight)),i>=h||s>=r)return!1;if(this.clipRectChanged)return!0;var e=this.dirtyList,c=n();return e.push(c.setTo(i,s,h,r)),this.mergeDirtyList(e),!0},a.clear=function(){for(var t=this.dirtyList,i=t.length,s=0;s<i;s++)h(t[s]);t.length=0},a.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var i=n();t.push(i.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var s=this.dirtyList.length;if(s>0)for(var h=0;h<s;h++)this.dirtyList[h].intValues();return this.dirtyList},a.mergeDirtyList=function(t){var i=t.length;if(i<2)return!1;for(var s=this.hasClipRect,n=i>3?Number.POSITIVE_INFINITY:0,e=0,c=0,o=0,u=0;u<i-1;u++){var a=t[u];s&&(o+=a.area);for(var f=u+1;f<i;f++){var l=t[f],v=r(a,l)-a.area-l.area;n>v&&(e=u,c=f,n=v)}}if(s&&o/this.clipArea>.95&&(this.clipRectChanged=!0),e!==c){var d=t[c];return t[e].union(d),h(d),t.splice(c,1),!0}return!1},cc.Region=e,cc.DirtyRegion=u},{}],200:[function(t,i,s){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,_:function(){cc.sys.browserType!==cc.sys.BROWSER_TYPE_IE&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC||this.enableDirtyRegion(!1)},getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,i,s=this._renderCmds,n=this._dirtyRegion,h=_ccsg.Node.CanvasRenderCmd.RegionStatus,r=0,e=!0;for(t=0,i=s.length;t<i;t++){var c=s[t],o=c._regionFlag,u=c._oldRegion,a=c._currentRegion;o>h.NotDirty&&(++r>this._dirtyRegionCountThreshold&&(e=!1),e&&(!a.isEmpty()&&n.addRegion(a),c._regionFlag>h.Dirty&&!u.isEmpty()&&n.addRegion(u)),c._regionFlag=h.NotDirty)}return e},_beginDrawDirtyRegion:function(t){var i=t.getContext(),s=this._dirtyRegion.getDirtyRegions();i.save(),t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),i.beginPath();for(var n=0,h=0,r=0,e=0,c=t._scaleX,o=t._scaleY,u=0,a=s.length;u<a;++u){var f=s[u];n=(f._minX*c|0)-1,h=(-f._maxY*c|0)-1,r=2+(f._width*c|0),e=2+(f._height*o|0),i.rect(n,h,r,e)}i.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var i=t.getContext(),s=this._dirtyRegion.getDirtyRegions();t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),i.beginPath();for(var n=0,h=0,r=0,e=0,c=t._scaleX,o=t._scaleY,u=0,a=s.length;u<a;++u){var f=s[u];n=(f._minX*c|0)-1,h=(-f._maxY*c|0)-1,r=2+(f._width*c|0),e=2+(f._height*o|0),i.rect(n,h,r,e)}var l=i.fillStyle;i.fillStyle="green",i.fill(),i.fillStyle=l}},rendering:function(t){var i=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,s=cc._canvas,n=t||cc._renderContext,h=n.getContext(),r=cc.view.getScaleX(),e=cc.view.getScaleY();n.setViewScale(r,e),n.computeRealOffsetY();var c,o,u=this._dirtyRegion.getDirtyRegions(),a=this._renderCmds,f=this._allNeedDraw||!this._enableDirtyRegion;for(f||(f=f||!this._collectDirtyRegion()),f||this._beginDrawDirtyRegion(n),h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,s.width,s.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),h.fillRect(0,0,s.width,s.height)),c=0,o=a.length;c<o;c++){var l=a[c];if(l._needDraw){var v=!1,d=l._currentRegion;if(!d||f)v=!0;else for(var p=0,g=u.length;p<g;++p)if(u[p].intersects(d)){v=!0;break}v&&l.rendering(n,r,e)}}f||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(h)),i.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,i,s,n){t||cc.logID(7600),s=void 0===s?1:s,n=void 0===n?1:n,i=i||this._currentID;var h,r,e=this._cacheToCanvasCmds[i];for(t.computeRealOffsetY(),h=0,r=e.length;h<r;h++)e[h].rendering(t,s,n);this._removeCache(i);var c=this._cacheInstanceIds;0===c.length?this._isCacheToCanvasOn=!1:this._currentID=c[c.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var i=this._cacheToCanvasCmds[t];i&&(i.length=0,delete this._cacheToCanvasCmds[t]);var s=this._cacheInstanceIds;cc.js.array.remove(s,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var i=0,s=t.length;i<s;i++)t[i].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,i){return t._curLevel-i._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.rendering)if(this._isCacheToCanvasOn){var i=this._currentID,s=this._cacheToCanvasCmds[i];-1===s.indexOf(t)&&s.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,i){this._offsetX=t,this._offsetY=i,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,i){this._scaleX=t,this._scaleY=i},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._currentAlpha=this._context.globalAlpha,this._saveCount--},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._context.fillStyle=t},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,i,s){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*i,-t.ty*s)):this._context.setTransform(t.a*i,-t.b*s,-t.c*i,t.d*s,this._offsetX+t.tx*i,this._realOffsetY-t.ty*s)},t._switchToArmatureMode=function(t,i,s,n){t?(this._armatureMode++,this._context.setTransform(i.a,i.c,i.b,i.d,this._offsetX+i.tx*s,this._realOffsetY-i.ty*n),this.save()):(this._armatureMode--,this.restore())}}()},{}],201:[function(t,i,s){var n={texture:null,blendSrc:null,blendDst:null,shader:null},h=!1,r=null,e=null,c=0,o=0,u=0,a=null,f=0,l=null,v=null,d=null,p=0,g=!0,m=!1,w=cc.Enum({QUAD:0,TRIANGLE:1,CUSTOM:2});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:w,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:{r:0,g:0,b:0,a:1},_:function(){var t=cc._renderContext;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),function(t){var i=cc._renderContext;null===r&&(e=i.createBuffer(),r=i.createBuffer()),function(t){var i=cc._renderContext;if(r){var s=6*Math.ceil(t/4);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r),d=new Uint16Array(s);for(var n=0,h=0,o=s;h<o;h+=6)d[h]=n+0,d[h+1]=n+1,d[h+2]=n+2,d[h+3]=n+1,d[h+4]=n+2,d[h+5]=n+3,n+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,d,i.DYNAMIC_DRAW)}if(e){var u=4*(f=6*t);a=new ArrayBuffer(u),l=new Float32Array(a),v=new Uint32Array(a),i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,l,i.DYNAMIC_DRAW)}c=t-200}(t)}(cc.macro.BATCH_VERTEX_COUNT),cc.sys.os===cc.sys.OS_IOS&&(m=!0)},getVertexSize:function(){return c},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var i=this._cacheToBufferCmds[t];i&&(i.length=0,delete this._cacheToBufferCmds[t]);var s=this._cacheInstanceIds;cc.js.array.remove(s,t)},_renderingToBuffer:function(t){t=t||this._currentID;var i=this._cacheToBufferCmds[t],s=cc._renderContext;this.rendering(s,i),this._removeCache(t);var n=this._cacheInstanceIds;0===n.length?this._isCacheToBufferOn=!1:this._currentID=n[n.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);var i,s;for(i=0,s=t.length;i<s;i++)t[i].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,i){return t._curLevel-i._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var i=cc._renderContext;t?(i.clearDepth(1),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var i=this._currentID,s=this._cacheToBufferCmds[i];-1===s.indexOf(t)&&s.push(t)}else this._renderCmds.push(t)},_increaseBatchingSize:function(t,i,s){var n,h;switch(i=i||w.QUAD){case w.QUAD:for(n=0;n<t;n+=4)h=o+n,d[u++]=h+0,d[u++]=h+1,d[u++]=h+2,d[u++]=h+1,d[u++]=h+2,d[u++]=h+3;break;case w.TRIANGLE:for(g=!1,n=0;n<t;n+=3)h=o+n,d[u++]=h+0,d[u++]=h+1,d[u++]=h+2;break;case w.CUSTOM:g=!1;var r=s.length;for(n=0;n<r;n++)d[u++]=o+s[n];break;default:return}o+=t},_updateBatchedInfo:function(t,i,s){return(t!==n.texture||i.src!==n.blendSrc||i.dst!==n.blendDst||s!==n.shader)&&(this._batchRendering(),n.texture=t,n.blendSrc=i.src,n.blendDst=i.dst,n.shader=s,!0)},_breakBatch:function(){h=!0},_uploadBufferData:function(t){o>=c&&this._batchRendering();var i=t._node,s=t._texture||i._texture||i._spriteFrame&&i._spriteFrame._texture,r=i._blendFunc.src,e=i._blendFunc.dst,a=t._shaderProgram;(h||n.texture!==s||n.blendSrc!==r||n.blendDst!==e||n.shader!==a)&&(this._batchRendering(),n.texture=s,n.blendSrc=r,n.blendDst=e,n.shader=a,h=!1);var f=t.uploadData(l,v,6*o);if(f>0){var p,m;switch(t.vertexType||w.QUAD){case w.QUAD:for(p=0;p<f;p+=4)m=o+p,d[u++]=m+0,d[u++]=m+1,d[u++]=m+2,d[u++]=m+1,d[u++]=m+2,d[u++]=m+3;break;case w.TRIANGLE:for(g=!1,p=0;p<f;p+=3)m=o+p,d[u++]=m+0,d[u++]=m+1,d[u++]=m+2;break;case w.CUSTOM:g=!1,t.uploadIndexData&&(u+=t.uploadIndexData(d,u,o));break;default:return}o+=f}},_batchRendering:function(){if(0!==o&&n.texture){var t=cc._renderContext,i=n.texture,s=n.shader,h=o>.5*c;if(s&&(s.use(),s._updateProjectionUniform()),cc.gl.blendFunc(n.blendSrc,n.blendDst),cc.gl.bindTexture2DN(0,i),t.bindBuffer(t.ARRAY_BUFFER,e),h)t.bufferData(t.ARRAY_BUFFER,l,t.DYNAMIC_DRAW);else{var a=l.subarray(0,6*o);t.bufferData(t.ARRAY_BUFFER,a,t.DYNAMIC_DRAW)}t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),(!p||!g||u>p)&&(h?t.bufferData(t.ELEMENT_ARRAY_BUFFER,d,t.DYNAMIC_DRAW):t.bufferData(t.ELEMENT_ARRAY_BUFFER,d.subarray(0,u),t.DYNAMIC_DRAW)),t.drawElements(t.TRIANGLES,u,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,g?p=u:(p=0,g=!0),o=0,u=0}},rendering:function(t,i){var s,h,r,e=i||this._renderCmds,c=t||cc._renderContext;for(c.bindBuffer(c.ARRAY_BUFFER,null),s=0,h=e.length;s<h;++s)(r=e[s])._needDraw&&(r.uploadData?this._uploadBufferData(r):(o>0&&this._batchRendering(),r.rendering(c)));this._batchRendering(),n.texture=null}}},{}],202:[function(t,i,s){t("./RendererCanvas"),t("./RendererWebGL"),t("./DirtyRegion")},{"./DirtyRegion":199,"./RendererCanvas":200,"./RendererWebGL":201}],203:[function(t,i,s){_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}})},{}],204:[function(t,i,s){var n=t("../event/event-target"),h=t("../utils/misc");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_recursiveDirty:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,i,s){_ccsg.Node.prototype.ctor.call(this),n.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(t,i,s)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,i){this.once("load",t,i)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){cc.assertID(t,2606),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var i=cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&t._rotated,s=this.initWithTexture(t.getTexture(),t.getRect(),i);return this.setSpriteFrame(t),s},initWithSpriteFrameName:function(){cc.warnID(2608)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var i=this._rect;i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,i){cc.assertID(t,2610);var s=cc.spriteFrameAnimationCache.getAnimation(t);if(s){var n=s.getFrames()[i];n?this.setSpriteFrame(n.getSpriteFrame()):cc.logID(2603)}else cc.logID(2602)},getTexture:function(){return this._texture},_softInit:function(t,i,s){if(void 0===t)_ccsg.Sprite.prototype._.call(this);else if(cc.js.isString(t))"#"===t[0]?cc.logID(2728,t):_ccsg.Sprite.prototype._.call(this,t,i);else if("object"==typeof t)if(t instanceof cc.Texture2D)this.initWithTexture(t,i,s);else if(t instanceof cc.P)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this.initWithTexture(n)}},getQuad:function(){return null},setBlendFunc:function(t,i){var s=this._blendFunc;void 0===i?(s.src=t.src,s.dst=t.dst):(s.src=t,s.dst=i),this._renderCmd.updateBlendFunc(s)},_:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(this.dirty=this._recursiveDirty=!1,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this.texture=null,this._flippedX=this._flippedY=!1,this.anchorX=.5,this.anchorY=.5,this._offsetPosition.x=0,this._offsetPosition.y=0,this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,i){cc.assertID(t,2609);var s=cc.textureCache.getTextureForKey(t);if(s){if(!i){var n=s.getContentSize();i=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(s,i)}return s=cc.textureCache.addImage(t),this.initWithTexture(s,i||cc.rect(0,0,s._contentSize.width,s._contentSize.height))},initWithTexture:function(t,i,s,n){cc.assertID(0!==arguments.length,2710),s=s||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,i,s,n),this._recursiveDirty=!1,this.dirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition.x=0,this._offsetPosition.y=0;var h=t.isLoaded();return this._textureLoaded=h,h?(i||(i=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,i,s),this.setTexture(t),this.setTextureRect(i,s),this.emit("load"),!0):(this._rectRotated=s,i&&(this._rect.x=i.x,this._rect.y=i.y,this._rect.width=i.width,this._rect.height=i.height),this.texture&&this.texture.off("load",this._renderCmd._textureLoadedCallback,this._renderCmd),t.once("load",this._renderCmd._textureLoadedCallback,this._renderCmd),this.setTexture(t),!0)},setTextureRect:function(t,i,s,n){this._rectRotated=i||!1,this.setContentSize(s||t),this.setVertexRect(t),this._renderCmd._setTextureCoords(t,n);var h=this._unflippedOffsetPositionFromCenter.x,r=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(h=-h),this._flippedY&&(r=-r);var e=this._rect;this._offsetPosition.x=h+(this._contentSize.width-e.width)/2,this._offsetPosition.y=r+(this._contentSize.height-e.height)/2},setSpriteFrame:function(t){var i=this;cc.assertID(t,2712),this.setNodeDirty(!0);var s=t.getOffset();i._unflippedOffsetPositionFromCenter.x=s.x,i._unflippedOffsetPositionFromCenter.y=s.y;var n=t.getTexture();t.textureLoaded()?(i._textureLoaded=!0,n!==i._texture&&(i._setTexture(n),i.setColor(i._realColor)),i.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(i._textureLoaded=!1,t.once("load",function(t){var s=t.currentTarget;i._textureLoaded=!0;var n=s.getTexture();n!==i._texture&&i._setTexture(n),i.setTextureRect(s.getRect(),s.isRotated(),s.getOriginalSize()),i.emit("load"),i.setColor(i._realColor)},i)),this._renderCmd._updateForSetSpriteFrame(n)},setDisplayFrame:function(t){cc.logID(2604),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.P(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var i=cc.js.isString(t);i&&(t=cc.textureCache.addImage(t)),t._textureLoaded?(this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(t),t.once("load",function(s){this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(t,i){this._renderCmd._setTexture(t),i&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var i=t._contentSize,s=cc.rect(0,0,i.width,i.height);this.setTextureRect(s)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),cc.js.addon(_ccsg.Sprite.prototype,n.prototype),h.propertyDefine(_ccsg.Sprite,["opacity","color","texture","quad"],{opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],flippedX:["isFlippedX","setFlippedX"],flippedY:["isFlippedY","setFlippedY"],offsetX:["_getOffsetX"],offsetY:["_getOffsetY"],textureRectRotated:["isTextureRectRotated"]})},{"../event/event-target":111,"../utils/misc":223}],205:[function(t,i,s){_ccsg.Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var n=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=_ccsg.Sprite.CanvasRenderCmd,n.setDirtyRecursively=function(t){},n._setTexture=function(t){var i=this._node;if(i._texture!==t){i._textureLoaded=!!t&&t._textureLoaded,i._texture=t;var s=t._contentSize,n=cc.rect(0,0,s.width,s.height);i.setTextureRect(n),this._updateColor()}},n._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},n.isFrameDisplayed=function(t){var i=this._node;return t.getTexture()===i._texture&&cc.rectEqualToRect(t.getRect(),i._rect)},n.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},n._handleTextureForRotatedTexture=function(t,i,s,n){if(s&&t.isLoaded()){var h=t.getHtmlElementObj();h=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(h,i,n);var r=new cc.Texture2D;r.initWithElement(h),r.handleLoadedTexture(),t=r,i.x=i.y=0,this._node._rect=cc.rect(0,0,i.width,i.height)}return t},n._checkTextureBoundary=function(t,i,s){if(t&&t.url){var n=i.x+i.width,h=i.y+i.height;n>t.width&&cc.errorID(3300,t.url),h>t.height&&cc.errorID(3400,t.url)}},n.rendering=function(t,i,s){var n=this._node,h=this._textureCoord,r=this._displayedOpacity/255,e=this._textureToRender||n._texture;if((!e||0!==h.width&&0!==h.height&&e._textureLoaded)&&0!==r){var c,o=t||cc._renderContext,u=o.getContext(),a=n._offsetPosition.x,f=n._rect.height,l=n._rect.width,v=-n._offsetPosition.y-f;o.setTransform(this._worldTransform,i,s),o.setCompositeOperation(this._blendFuncStr),o.setGlobalAlpha(r),(n._flippedX||n._flippedY)&&o.save(),n._flippedX&&(a=-a-l,u.scale(-1,1)),n._flippedY&&(v=n._offsetPosition.y,u.scale(1,-1));var d,p,g,m,w,_,C,b;if(this._colorized?(d=0,p=0):(d=h.renderX,p=h.renderY),g=h.width,m=h.height,w=a,_=v,C=l,b=f,e&&e._htmlElementObj)c=e._htmlElementObj,""!==e._pattern?(o.setFillStyle(u.createPattern(c,e._pattern)),u.fillRect(w,_,C,b)):u.drawImage(c,d,p,g,m,w,_,C,b);else{var y=n._contentSize;if(h.validRect){var T=this._displayedColor;o.setFillStyle("rgba("+T.r+","+T.g+","+T.b+",1)"),u.fillRect(w,_,y.width,y.height)}}(n._flippedX||n._flippedY)&&o.restore(),cc.g_NumberOfDraws++}},n._updateColor=function(){var t=this._node._texture,i=this._textureCoord,s=this._displayedColor;t&&(255!==s.r||255!==s.g||255!==s.b?(this._textureToRender=t._generateColorTexture(s.r,s.g,s.b,i),this._colorized=!0):t&&(this._textureToRender=t,this._colorized=!1))},n._updateForSetSpriteFrame=function(t,i){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,i=i||t._textureLoaded){var s=this._node.getColor();255===s.r&&255===s.g&&255===s.b||this._updateColor()}},n._spriteFrameLoadedCallback=function(t){var i=this._node,s=t.currentTarget;i.setTextureRect(s.getRect(),s.isRotated(),s.getOriginalSize()),this._updateColor(),i.emit("load")},n._textureLoadedCallback=function(t){var i=this._node,s=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var n=i._rect;n?cc._rectEqualToZero(n)&&(n.width=s.width,n.height=s.height):n=cc.rect(0,0,s.width,s.height),i.texture=s,i.setTextureRect(n,i._rectRotated);var h=this._displayedColor;255===h.r&&255===h.g&&255===h.b||this._updateColor(),i.emit("load")}},n._setTextureCoords=function(t){var i=this._textureCoord;i.renderX=i.x=0|t.x,i.renderY=i.y=0|t.y,i.width=0|t.width,i.height=0|t.height,i.validRect=!(0===i.width||0===i.height||i.x<0||i.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,i,s){if(!t)return null;if(!i)return t;s=null==s||s;var n=document.createElement("canvas");n.width=i.width,n.height=i.height;var h=n.getContext("2d");return h.translate(n.width/2,n.height/2),s?h.rotate(-1.5707963267948966):h.rotate(1.5707963267948966),h.drawImage(t,i.x,i.y,i.height,i.width,-i.height/2,-i.width/2,i.height,i.width),n}},{}],206:[function(t,i,s){var n=cc.macro;_ccsg.Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var h=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);h.constructor=_ccsg.Sprite.WebGLRenderCmd,h.updateBlendFunc=function(t){},h.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},h.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var i,s=this._node._children,n=s?s.length:0,h=0;h<n;h++)(i=s[h])instanceof _ccsg.Sprite&&i._renderCmd.setDirtyRecursively(t)},h._handleTextureForRotatedTexture=function(t){return t},h.isFrameDisplayed=function(t){var i=this._node;return cc.rectEqualToRect(t.getRect(),i._rect)&&t.getTexture().getName()===i._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),i._unflippedOffsetPositionFromCenter)},h._updateForSetSpriteFrame=function(){},h._spriteFrameLoadedCallback=function(t){var i=t.currentTarget;this._node.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._node.emit("load")},h._textureLoadedCallback=function(t){var i=this._node,s=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var n=i._rect;n?cc._rectEqualToZero(n)&&(n.width=s.width,n.height=s.height):n=cc.rect(0,0,s.width,s.height),i.texture=s,i.setTextureRect(n,i._rectRotated),i.emit("load"),cc.renderer.childrenOrderDirty=!0}},h._setTextureCoords=function(t){var i=this._node,s=i._texture,h=this._vertices;if(s){var r,e,c,o,u,a=s.pixelWidth,f=s.pixelHeight;i._rectRotated?(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(e=(r=(2*t.x+1)/(2*a))+(2*t.height-2)/(2*a),o=(c=(2*t.y+1)/(2*f))+(2*t.width-2)/(2*f)):(r=t.x/a,e=(t.x+t.height)/a,c=t.y/f,o=(t.y+t.width)/f),i._flippedX&&(u=c,c=o,o=u),i._flippedY&&(u=r,r=e,e=u),h[0].u=e,h[0].v=c,h[1].u=r,h[1].v=c,h[2].u=e,h[2].v=o,h[3].u=r,h[3].v=o):(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(e=(r=(2*t.x+1)/(2*a))+(2*t.width-2)/(2*a),o=(c=(2*t.y+1)/(2*f))+(2*t.height-2)/(2*f)):(r=t.x/a,e=(t.x+t.width)/a,c=t.y/f,o=(t.y+t.height)/f),i._flippedX&&(u=r,r=e,e=u),i._flippedY&&(u=c,c=o,o=u),h[0].u=r,h[0].v=c,h[1].u=r,h[1].v=o,h[2].u=e,h[2].v=c,h[3].u=e,h[3].v=o)}},h._setColorDirty=function(){},h._updateBlendFunc=function(){var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=n.BLEND_SRC,t._blendFunc.dst=n.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=n.SRC_ALPHA,t._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},h._setTexture=function(t){var i=this._node;i._texture!==t&&(i._textureLoaded=!!t&&t._textureLoaded,i._texture=t,this._updateBlendFunc(),i._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},h._checkTextureBoundary=function(t,i,s){if(t&&t.url){var n,h;s?(n=i.x+i.height,h=i.y+i.width):(n=i.x+i.width,h=i.y+i.height),n>t.width&&cc.errorID(3300,t.url),h>t.height&&cc.errorID(3400,t.url)}},h.transform=function(t,i){this.originTransform(t,i);var s=this._node,n=s._offsetPosition.x,h=n+s._rect.width,r=s._offsetPosition.y,e=r+s._rect.height,c=this._worldTransform,o=this._vertices;o[0].x=n*c.a+e*c.c+c.tx,o[0].y=n*c.b+e*c.d+c.ty,o[1].x=n*c.a+r*c.c+c.tx,o[1].y=n*c.b+r*c.d+c.ty,o[2].x=h*c.a+e*c.c+c.tx,o[2].y=h*c.b+e*c.d+c.ty,o[3].x=h*c.a+r*c.c+c.tx,o[3].y=h*c.b+r*c.d+c.ty},h.needDraw=function(){var t=this._node._texture;return this._needDraw&&t},h.uploadData=function(t,i,s){var n=this._node,h=n._texture;if(!(h&&h._textureLoaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return 0;var r,e=this._displayedOpacity,c=this._displayedColor._val;if(n._opacityModifyRGB){var o=e/255,u=this._displayedColor.r*o,a=this._displayedColor.g*o;r=(e<<24>>>0)+(this._displayedColor.b*o<<16)+(a<<8)+u}else r=(e<<24>>>0)+((65280&c)<<8)+((16711680&c)>>8)+(c>>>24);var f,l,v=n._vertexZ,d=this._vertices,p=d.length,g=s;for(f=0;f<p;++f)l=d[f],t[g]=l.x,t[g+1]=l.y,t[g+2]=v,i[g+3]=r,t[g+4]=l.u,t[g+5]=l.v,g+=6;return p}},{}],207:[function(t,i,s){function n(t,i){return t-i}var h,r,e,c,o,u=t("../event/event-target"),a={_pool:{},_lengths:[],put:function(t){var i=t.length;this._pool[i]?this._pool[i].push(t):(this._pool[i]=[t],this._lengths.push(i),this._lengths.sort(n))},get:function(t){for(var i,s=0;s<this._lengths.length;s++)if(this._lengths[s]>=t){i=this._lengths[s];break}return i?this._pool[i].pop():void 0}},f=cc.macro,l=[],v={_rebuildQuads_base:function(t,i,s,n){var r,e,c,o,u=t._vertices,f=t._renderCmd._worldTransform;if(n)r=0,e=0,c=s.width,o=s.height;else{var v=i._originalSize,d=i._rect,p=i._offset,g=s.width/v.width,m=s.height/v.height,w=p.x+(v.width-d.width)/2,_=p.x-(v.width-d.width)/2,C=p.y+(v.height-d.height)/2,b=p.y-(v.height-d.height)/2;r=w*g,e=C*m,c=s.width+_*g,o=s.height+b*m}if(u.length<8&&(a.put(u),u=a.get(8)||new Float32Array(8),t._vertices=u),h){var y=r*f.a,T=r*f.b,S=c*f.a,A=c*f.b,M=o*f.c+f.tx,x=o*f.d+f.ty,E=e*f.c+f.tx,O=e*f.d+f.ty;u[0]=y+E,u[1]=T+O,u[2]=S+E,u[3]=A+O,u[4]=y+M,u[5]=T+x,u[6]=S+M,u[7]=A+x}else u[0]=r,u[1]=e,u[2]=c,u[3]=e,u[4]=r,u[5]=o,u[6]=c,u[7]=o;l[0]=0,l[1]=2,l[2]=4,l[3]=6,t._uvsDirty&&this._calculateUVs(t,i),t._vertCount=4},_calculateUVs:function(t,i){var s=t._uvs,n=i._texture._pixelWidth,h=i._texture._pixelHeight,r=i._rect;s.length<8&&(a.put(s),s=a.get(8)||new Float32Array(8),t._uvs=s);var e,c,o,u,l=f.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;i._rotated?(e=(r.x+l)/n,c=(r.y+r.width-l)/h,o=(r.x+r.height-l)/n,u=(r.y+l)/h,s[0]=e,s[1]=u,s[2]=e,s[3]=c,s[4]=o,s[5]=u,s[6]=o,s[7]=c):(e=(r.x+l)/n,c=(r.y+r.height-l)/h,o=(r.x+r.width-l)/n,u=(r.y+l)/h,s[0]=e,s[1]=c,s[2]=o,s[3]=c,s[4]=e,s[5]=u,s[6]=o,s[7]=u)}},d={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t,i,s,n,r,e,c){var o,u,f,v,d=t._vertices,p=t._renderCmd._worldTransform,g=i._rect;o=n,u=r,g.width,f=e,v=c,g.height;var m=s,w=m.width-o-u,_=m.height-f-v,C=m.width/(o+u),b=m.height/(f+v);C=isNaN(C)||C>1?1:C,b=isNaN(b)||b>1?1:b,w=w<0?0:w,_=_<0?0:_;var y=this.x,T=this.y;y[0]=0,y[1]=o*C,y[2]=y[1]+w,y[3]=m.width,T[0]=0,T[1]=v*b,T[2]=T[1]+_,T[3]=m.height,d.length<32&&(a.put(d),d=a.get(32)||new Float32Array(32),t._vertices=d);var S,A,M=0;if(h)for(S=0;S<4;S++)for(A=0;A<4;A++)d[M]=y[A]*p.a+T[S]*p.c+p.tx,d[M+1]=y[A]*p.b+T[S]*p.d+p.ty,M+=2;else for(S=0;S<4;S++)for(A=0;A<4;A++)d[M]=y[A],d[M+1]=T[S],M+=2;l[0]=0,l[1]=6,l[2]=24,l[3]=30,t._uvsDirty&&this._calculateUVs(t,i,n,r,e,c)},_calculateUVs:function(t,i,s,n,h,r){var e,c,o,u,l,v,d=t._uvs,p=i._rect,g=i._texture._pixelWidth,m=i._texture._pixelHeight,w=i._rect;e=s,o=n,c=p.width-e-o,u=h,v=r,l=p.height-u-v,d.length<32&&(a.put(d),d=a.get(32)||new Float32Array(32),t._uvs=d);var _,C,b=this.x,y=this.y,T=f.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0,S=0;if(i._rotated)for(b[0]=(w.x+T)/g,b[1]=(v+w.x)/g,b[2]=(v+l+w.x)/g,b[3]=(w.x+w.height-T)/g,y[3]=(w.y+T)/m,y[2]=(e+w.y)/m,y[1]=(e+c+w.y)/m,y[0]=(w.y+w.width-T)/m,_=0;_<4;_++)for(C=0;C<4;C++)d[S]=b[_],d[S+1]=y[3-C],S+=2;else for(b[0]=(w.x+T)/g,b[1]=(e+w.x)/g,b[2]=(e+c+w.x)/g,b[3]=(w.x+w.width-T)/g,y[3]=(w.y+T)/m,y[2]=(u+w.y)/m,y[1]=(u+l+w.y)/m,y[0]=(w.y+w.height-T)/m,_=0;_<4;_++)for(C=0;C<4;C++)d[S]=b[C],d[S+1]=y[_],S+=2}},p={_vertPos:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_vertices:[cc.v2(0,0),cc.v2(0,0)],_uvs:[cc.v2(0,0),cc.v2(0,0)],_intersectPoint_1:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_intersectPoint_2:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(t,i,s,n,h,r){for(var e=t._vertices,c=t._uvs,o=t._rawVerts,u=t._rawUvs,f=t._renderCmd._worldTransform;h>=1;)h-=1;for(;h<0;)h+=1;var v=n.x*s.width,d=n.y*s.height,p=cc.v2(v,d),g=(h*=2*Math.PI)+(r*=2*Math.PI);this.outVerts=e,this.outUvs=c,this.rawVerts=o,this.rawUvs=u,this._calculateVertices(f,i,s),this._calculateUVs(i);var m=this._vertPos,w=this._vertices;m[0].x=m[3].x=w[0].x,m[1].x=m[2].x=w[1].x,m[0].y=m[1].y=w[0].y,m[2].y=m[3].y=w[1].y,p.x>w[1].x&&(p.x=w[1].x),p.x<w[0].x&&(p.x=w[0].x),p.y<w[0].y&&(p.y=w[0].y),p.y>w[1].y&&(p.y=w[1].y),o[0]=o[4]=this._vertices[0].x,o[2]=o[6]=this._vertices[1].x,o[1]=o[3]=this._vertices[0].y,o[5]=o[7]=this._vertices[1].y,i._rotated?(u[0]=u[2]=this._uvs[0].x,u[4]=u[6]=this._uvs[1].x,u[3]=u[7]=this._uvs[0].y,u[1]=u[5]=this._uvs[1].y):(u[0]=u[4]=this._uvs[0].x,u[2]=u[6]=this._uvs[1].x,u[1]=u[3]=this._uvs[0].y,u[5]=u[7]=this._uvs[1].y);var _=[null,null,null,null];p.x!==this._vertices[0].x&&(_[0]=[3,0]),p.x!==this._vertices[1].x&&(_[2]=[1,2]),p.y!==this._vertices[0].y&&(_[1]=[0,1]),p.y!==this._vertices[1].y&&(_[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,p,h,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,p,h+r,this._intersectPoint_2),e.length<30&&(a.put(e),e=a.get(30)||new Float32Array(30),this.outVerts=t._vertices=e),c.length<30&&(a.put(c),c=a.get(30)||new Float32Array(30),this.outUvs=t._uvs=c);for(var C=0,b=0,y=0;y<4;++y){var T=_[y];if(null!==T)if(r>=2*Math.PI)this._generateTriangle(f,C,p,this._vertPos[T[0]],this._vertPos[T[1]]),C+=6,b+=3;else{var S=this._getVertAngle(p,this._vertPos[T[0]]),A=this._getVertAngle(p,this._vertPos[T[1]]);A<S&&(A+=2*Math.PI),S-=2*Math.PI,A-=2*Math.PI;for(var M=0;M<3;++M)S>=g||(S>=h?(A>=g?this._generateTriangle(f,C,p,this._vertPos[T[0]],this._intersectPoint_2[y]):this._generateTriangle(f,C,p,this._vertPos[T[0]],this._vertPos[T[1]]),C+=6,b+=3):A<=h||(A<=g?(this._generateTriangle(f,C,p,this._intersectPoint_1[y],this._vertPos[T[1]]),C+=6,b+=3):(this._generateTriangle(f,C,p,this._intersectPoint_1[y],this._intersectPoint_2[y]),C+=6,b+=3))),S+=2*Math.PI,A+=2*Math.PI}}t._vertCount=b,l[0]=0,l[1]=2,l[2]=4,l[3]=6},_generateTriangle:function(t,i,s,n,r){var e,c,o=this.rawVerts,u=this.rawUvs,a=this.outVerts,f=o[0],l=o[1],v=o[6],d=o[7];h?(a[i]=s.x*t.a+s.y*t.c+t.tx,a[i+1]=s.x*t.b+s.y*t.d+t.ty,a[i+2]=n.x*t.a+n.y*t.c+t.tx,a[i+3]=n.x*t.b+n.y*t.d+t.ty,a[i+4]=r.x*t.a+r.y*t.c+t.tx,a[i+5]=r.x*t.b+r.y*t.d+t.ty):(a[i]=s.x,a[i+1]=s.y,a[i+2]=n.x,a[i+3]=n.y,a[i+4]=r.x,a[i+5]=r.y),e=(s.x-f)/(v-f),c=(s.y-l)/(d-l),this._generateUV(e,c,u,i),e=(n.x-f)/(v-f),c=(n.y-l)/(d-l),this._generateUV(e,c,u,i+2),e=(r.x-f)/(v-f),c=(r.y-l)/(d-l),this._generateUV(e,c,u,i+4)},_generateUV:function(t,i,s,n){var h=this.outUvs,r=s[0]+(s[2]-s[0])*t,e=s[4]+(s[6]-s[4])*t,c=s[1]+(s[3]-s[1])*t,o=s[5]+(s[7]-s[5])*t;h[n]=r+(e-r)*i,h[n+1]=c+(o-c)*i},_isAngleIn:function(t,i,s){for(var n=2*Math.PI;t<i||t>=i+n;)t<i&&(t+=n),t>=i+n&&(t-=n);return t<=i+s},_getVertAngle:function(t,i){var s,n;if(s=i.x-t.x,n=i.y-t.y,0!==s||0!==n){if(0===s)return n>0?.5*Math.PI:1.5*Math.PI;var h=Math.atan(n/s);return s<0&&(h+=Math.PI),h}},_getInsectedPoints:function(t,i,s,n,h,r,e){var c,o,u=Math.sin(r),a=Math.cos(r);if(0!==Math.cos(r)){if(c=u/a,(t-h.x)*a>0){var f=h.y+c*(t-h.x);e[0].x=t,e[0].y=f}if((i-h.x)*a>0){var l=h.y+c*(i-h.x);e[2].x=i,e[2].y=l}}if(0!==Math.sin(r)){if(o=a/u,(n-h.y)*u>0){var v=h.x+o*(n-h.y);e[3].x=v,e[3].y=n}if((s-h.y)*u>0){var d=h.x+o*(s-h.y);e[1].x=d,e[1].y=s}}return[null,null,null,null]},_calculateVertices:function(t,i,s){var n,h;n=s.width,h=s.height,this._vertices[0].x=0,this._vertices[0].y=0,this._vertices[1].x=n,this._vertices[1].y=h},_calculateUVs:function(t){var i,s,n,h,r=t._texture._pixelWidth,e=t._texture._pixelHeight,c=t._rect,o=f.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;t._rotated?(i=(c.x+o)/r,s=(c.x+c.height-o)/r,n=(c.y+o)/e,h=(c.y+c.width-o)/e):(i=(c.x+o)/r,s=(c.x+c.width-o)/r,n=(c.y+o)/e,h=(c.y+c.height-o)/e),this._uvs[0].x=i,this._uvs[0].y=h,this._uvs[1].x=s,this._uvs[1].y=n}};cc.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,_meshPolygonInfo:null,ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._fillCenter=cc.v2(0,0),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=a.get(8)||new Float32Array(8),this._uvs=a.get(8)||new Float32Array(8),"string"==typeof t||t instanceof cc.Texture2D?this.initWithTexture(t):t instanceof cc.P&&this.initWithSpriteFrame(t),void 0===h&&(h=cc._renderType===cc.game.RENDER_TYPE_WEBGL)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var i=new cc.P(t);this.setSpriteFrame(i)},setSpriteFrame:function(t){if(t){this._spriteFrame=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var i=this,s=function(){cc.sizeEqualToSize(i._contentSize,cc.size(0,0))&&i.setContentSize(i._spriteFrame._rect),i._renderCmd._needDraw=!0,i._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};t.textureLoaded()?s():t.once("load",s,this)}},setBlendFunc:function(t,i){void 0===i?(this._blendFunc.src=t.src||cc.macro.BLEND_SRC,this._blendFunc.dst=t.dst||cc.macro.BLEND_DST):(this._blendFunc.src=t||cc.macro.BLEND_SRC,this._blendFunc.dst=i||cc.macro.BLEND_DST),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,i){void 0===i&&(i=t.height,t=t.width),t===this._contentSize.width&&i===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,t,i),this._quadsDirty=!0)},enableTrimmedContentSize:function(t){this._isTrimmedContentSize!==t&&(this._isTrimmedContentSize=t,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){this._fillType!==t&&(this._fillType=t,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(t,i){this._fillCenter=cc.v2(t,i),this._renderingType===m.FILLED&&this._fillType===w.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(t,i){void 0===i&&(i=t.y,t=t.x),this._distortionTiling=this._distortionTiling||cc.v2(0,0),this._distortionTiling.x=t,this._distortionTiling.y=i},setDistortionOffset:function(t,i){void 0===i&&(i=t.y,t=t.x),this._distortionOffset=this._distortionOffset||cc.v2(0,0),this._distortionOffset.x=t,this._distortionOffset.y=i},getFillCenter:function(){return cc.v2(this._fillCenter)},setFillStart:function(t){this._fillStart!==t&&(this._fillStart=t,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(t){this._fillRange!==t&&(this._fillRange=t,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){switch(this._isTriangle=!1,this._renderingType){case m.SIMPLE:v._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case m.SLICED:d._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;case m.TILED:!function(t,i,s){var n,r,e,c,o=t._vertices,u=t._renderCmd._worldTransform,v=t._uvs,d=i._texture._pixelWidth,p=i._texture._pixelHeight,g=i._rect,m=f.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;i._rotated?(n=(g.x+m)/d,e=(g.x+g.height-m)/d,r=(g.y+g.width-m)/p,c=(g.y+m)/p):(n=(g.x+m)/d,e=(g.x+g.width-m)/d,r=(g.y+g.height-m)/p,c=(g.y+m)/p);var w=g.width,_=g.height,C=s.width/w,b=s.height/_,y=Math.ceil(b),T=Math.ceil(C);y*T>16384&&cc.errorID(2625);var S=y*T*4*2;o.length<S&&(a.put(o),o=a.get(S)||new Float32Array(S),t._vertices=o),v.length<S&&(a.put(v),v=a.get(S)||new Float32Array(S),t._uvs=v);var A,M,x,E,O=0;t._vertCount=0;for(var P=0;P<y;++P)for(var R=0;R<T;++R){if(A=w*R,M=_*P,x=w*Math.min(R+1,C),E=_*Math.min(P+1,b),h){var I=A*u.a,L=A*u.b,D=x*u.a,F=x*u.b,N=E*u.c+u.tx,k=E*u.d+u.ty,B=M*u.c+u.tx,G=M*u.d+u.ty;o[O]=I+B,o[O+1]=L+G,o[O+2]=D+B,o[O+3]=F+G,o[O+4]=I+N,o[O+5]=L+k,o[O+6]=D+N,o[O+7]=F+k}else o[O]=A,o[O+1]=M,o[O+2]=x,o[O+3]=M,o[O+4]=A,o[O+5]=E,o[O+6]=x,o[O+7]=E;if(i._rotated?(v[O]=n,v[O+1]=c,v[O+2]=n,v[O+3]=E=c+(r-c)*Math.min(1,C-R),v[O+4]=x=n+(e-n)*Math.min(1,b-P),v[O+5]=c,v[O+6]=x,v[O+7]=E):(v[O]=n,v[O+1]=r,v[O+2]=x=n+(e-n)*Math.min(1,C-R),v[O+3]=r,v[O+4]=n,v[O+5]=E=r+(c-r)*Math.min(1,b-P),v[O+6]=x,v[O+7]=E),O+=8,t._vertCount+=4,O>S)return}l[0]=0,l[1]=8*(T-1)+2,l[2]=(y-1)*T*8+4,l[3]=S-2}(this,this._spriteFrame,this._contentSize);break;case m.FILLED:var t=this._fillStart,i=this._fillRange;i<0&&(t+=i,i=-i),this._fillType!==w.RADIAL?(i=t+i,t=(t=t>1?1:t)<0?0:t,i=(i=i>1?1:i)<0?0:i,i-=t,function(t,i,s,n,r,e){var c,o,u,v,d,p=t._vertices,g=t._renderCmd._worldTransform,m=t._uvs,_=0,C=0,b=s.width,y=s.height,T=i._texture._pixelWidth,S=i._texture._pixelHeight,A=i._rect,M=f.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;i._rotated?(o=(A.x+M)/T,u=(A.y+A.width-M)/S,v=(A.x+A.height-M)/T,d=(A.y+M)/S):(o=(A.x+M)/T,u=(A.y+A.height-M)/S,v=(A.x+A.width-M)/T,d=(A.y+M)/S),p.length<8&&(a.put(p),p=a.get(8)||new Float32Array(8),t._vertices=p),m.length<8&&(a.put(m),m=a.get(8)||new Float32Array(8),t._uvs=m);var x=new Array(8);i._rotated?(x[0]=x[2]=o,x[4]=x[6]=v,x[3]=x[7]=u,x[1]=x[5]=d):(x[0]=x[4]=o,x[2]=x[6]=v,x[1]=x[3]=u,x[5]=x[7]=d),c=(c=(r=(r=r>1?1:r)<0?0:r)+(e=e<0?0:e))>1?1:c;var E;switch(n){case w.HORIZONTAL:E=_+(b-_)*c,_+=(b-_)*r,b=E,m[0]=x[0]+(x[2]-x[0])*r,m[1]=x[1],m[2]=x[0]+(x[2]-x[0])*c,m[3]=x[3],m[4]=x[4]+(x[6]-x[4])*r,m[5]=x[5],m[6]=x[4]+(x[6]-x[4])*c,m[7]=x[7];break;case w.VERTICAL:E=C+(y-C)*c,C+=(y-C)*r,y=E,m[0]=x[0],m[1]=x[1]+(x[5]-x[1])*r,m[2]=x[2],m[3]=x[3]+(x[7]-x[3])*r,m[4]=x[4],m[5]=x[1]+(x[5]-x[1])*c,m[6]=x[6],m[7]=x[3]+(x[7]-x[3])*c;break;default:cc.errorID(2626)}if(h){var O=_*g.a,P=_*g.b,R=b*g.a,I=b*g.b,L=y*g.c+g.tx,D=y*g.d+g.ty,F=C*g.c+g.tx,N=C*g.d+g.ty;p[0]=O+F,p[1]=P+N,p[2]=R+F,p[3]=I+N,p[4]=O+L,p[5]=P+D,p[6]=R+L,p[7]=I+D}else p[0]=_,p[1]=C,p[2]=b,p[3]=C,p[4]=_,p[5]=y,p[6]=b,p[7]=y;t._vertCount=4,l[0]=0,l[1]=2,l[2]=4,l[3]=6}(this,this._spriteFrame,this._contentSize,this._fillType,t,i)):(this._isTriangle=!0,this._rawVerts||(this._rawVerts=a.get(8)||new Float32Array(8),this._rawUvs=a.get(8)||new Float32Array(8)),p._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._fillCenter,t,i));break;case m.MESH:!function(t,i,s){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&s){var n=t._renderCmd._worldTransform,h=s.triangles.verts,r=t._vertices,e=t._uvs,c=h.length,o=2*c;r.length<o&&(a.put(r),r=a.get(o)||new Float32Array(o),t._vertices=r),e.length<o&&(a.put(e),e=a.get(o)||new Float32Array(o),t._uvs=e);for(var u=1/0,f=1/0,v=-1/0,d=-1/0,p=0;p<c;p++){var g=h[p].x*n.a+h[p].y*n.c+n.tx,m=h[p].x*n.b+h[p].y*n.d+n.ty;r[2*p]=g,r[2*p+1]=m,e[2*p]=h[p].u,e[2*p+1]=h[p].v,g<u&&(u=g,l[0]=2*p),g>v&&(v=g,l[1]=2*p),m<f&&(f=m,l[2]=2*p),m>d&&(d=m,l[3]=2*p)}t._vertCount=c}}(this,this._spriteFrame,this._meshPolygonInfo);break;default:return this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,void cc.errorID(2627)}var s=cc.visibleRect;if(h&&this._renderCmd._cameraFlag>0&&(s=cc.Camera.main.visibleRect),r=s.left.x,o=s.right.x,c=s.top.y,e=s.bottom.y,h){var n=this._isTriangle?this._rawVerts:this._vertices,u=n[l[0]],g=n[l[1]],_=n[l[2]],C=n[l[3]],b=n[l[0]+1],y=n[l[1]+1],T=n[l[2]+1],S=n[l[3]+1];this._renderCmd._needDraw=!((u-r&g-r&_-r&C-r)>>31||(o-u&o-g&o-_&o-C)>>31||(b-e&y-e&T-e&S-e)>>31||(c-b&c-y&c-T&c-S)>>31)}else{var A=this._renderCmd._currentRegion,M=A._minX,x=A._maxX,E=A._minY,O=A._maxY;this._renderCmd._needDraw=!(x<r||M>o||O<e||E>c)}this._quadsDirty=!1,this._uvsDirty=!1}else this._renderCmd._needDraw=!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Scale9Sprite.CanvasRenderCmd(this):new cc.Scale9Sprite.WebGLRenderCmd(this)},setMeshPolygonInfo:function(t){this.setRenderingType(m.MESH),this._meshPolygonInfo=t,this._quadsDirty=!0,this._uvsDirty=!0},getMeshPolygonInfo:function(){return this._meshPolygonInfo}});var g=cc.Scale9Sprite.prototype;cc.js.addon(g,u.prototype),cc.defineGetterSetter(g,"insetLeft",g.getInsetLeft,g.setInsetLeft),cc.defineGetterSetter(g,"insetTop",g.getInsetTop,g.setInsetTop),cc.defineGetterSetter(g,"insetRight",g.getInsetRight,g.setInsetRight),cc.defineGetterSetter(g,"insetBottom",g.getInsetBottom,g.setInsetBottom),cc.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var m=cc.Scale9Sprite.RenderingType=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),w=cc.Scale9Sprite.FillType=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2})},{"../event/event-target":111}],208:[function(t,i,s){cc.Scale9Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=cc.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var n=cc.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.Scale9Sprite.CanvasRenderCmd,n.transform=function(t,i){this.originTransform(t,i),this._node._rebuildQuads()},n._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n._syncDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._syncDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},n.rendering=function(t,i,s){var n=this._node,h=this._displayedOpacity,r=h/255,e=null;if(n._spriteFrame&&(e=n._spriteFrame._texture),n.loaded()&&0!==h){if(null===this._textureToRender||this._originalTexture!==e){this._textureToRender=this._originalTexture=e,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture());var c=n.getDisplayedColor();!e||255===c.r&&255===c.g&&255===c.b||(this._textureToRender=this._textureToRender._generateColorTexture(c.r,c.g,c.b))}var o=t||cc._renderContext,u=o.getContext();if(o.setTransform(this._worldTransform,i,s),o.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),o.setGlobalAlpha(r),this._textureToRender){n._quadsDirty&&n._rebuildQuads();var a,f,l,v,d,p,g,m,w=this._textureToRender._pixelWidth,_=this._textureToRender._pixelHeight,C=this._textureToRender._htmlElementObj,b=n._vertices,y=n._uvs,T=0,S=0;if(n._isTriangle){var A=n._rawVerts,M=n._rawUvs;d=A[0],p=A[1],g=A[6]-d,p=-p-(m=A[7]-p),a=M[4]*w,f=M[5]*_,l=(M[6]-M[0])*w,v=(M[1]-M[7])*_,o.save(),u.beginPath();var x=Math.floor(n._vertCount/3);for(T=0,S=0;T<x;T++)u.moveTo(b[S++],-b[S++]),u.lineTo(b[S++],-b[S++]),u.lineTo(b[S++],-b[S++]);u.clip(),""!==this._textureToRender._pattern?(o.setFillStyle(u.createPattern(C,this._textureToRender._pattern)),u.fillRect(d,p,g,m)):l>0&&v>0&&g>0&&m>0&&u.drawImage(C,a,f,l,v,d,p,g,m),o.restore(),cc.g_NumberOfDraws+=x}else if(n._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(var E=0;E<3;++E)for(var O=0;O<3;++O)d=b[S=8*E+2*O],p=b[S+1],g=b[S+10]-d,p=-p-(m=b[S+11]-p),a=y[S]*w,f=y[S+11]*_,l=(y[S+10]-y[S])*w,v=(y[S+1]-y[S+11])*_,l>0&&v>0&&g>0&&m>0&&u.drawImage(C,a,f,l,v,d,p,g,m);cc.g_NumberOfDraws+=9}else{var P=Math.floor(n._vertCount/4);for(T=0,S=0;T<P;T++)d=b[S],p=b[S+1],g=b[S+6]-d,p=-p-(m=b[S+7]-p),a=y[S]*w,f=y[S+7]*_,l=(y[S+6]-y[S])*w,v=(y[S+1]-y[S+7])*_,""!==this._textureToRender._pattern?(o.setFillStyle(u.createPattern(C,this._textureToRender._pattern)),u.fillRect(d,p,g,m)):l>0&&v>0&&g>0&&m>0&&u.drawImage(C,a,f,l,v,d,p,g,m),S+=8;cc.g_NumberOfDraws+=P}}}}},{}],209:[function(t,i,s){cc.gl,cc.Scale9Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=cc.renderer.VertexType.QUAD,this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var n=cc.Scale9Sprite,h=n.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);h.constructor=n.WebGLRenderCmd,h._uploadSliced=function(t,i,s,n,h,r,e){for(var c,o=0;o<3;++o)for(var u=0;u<3;++u)c=8*o+2*u,h[e]=t[c],h[e+1]=t[c+1],h[e+2]=n,r[e+3]=s,h[e+4]=i[c],h[e+5]=i[c+1],h[e+=6]=t[c+2],h[e+1]=t[c+3],h[e+2]=n,r[e+3]=s,h[e+4]=i[c+2],h[e+5]=i[c+3],h[e+=6]=t[c+8],h[e+1]=t[c+9],h[e+2]=n,r[e+3]=s,h[e+4]=i[c+8],h[e+5]=i[c+9],h[e+=6]=t[c+10],h[e+1]=t[c+11],h[e+2]=n,r[e+3]=s,h[e+4]=i[c+10],h[e+5]=i[c+11],e+=6;return 36},h.transform=function(t,i){this.originTransform(t,i),this._node._rebuildQuads()},h.uploadData=function(t,i,s){var h=this._node;if(0===this._displayedOpacity)return 0;h._quadsDirty&&h._rebuildQuads(),h._distortionOffset&&this._shaderProgram===n.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith2f(n.WebGLRenderCmd._distortionOffset,h._distortionOffset.x,h._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(n.WebGLRenderCmd._distortionTiling,h._distortionTiling.x,h._distortionTiling.y),cc.renderer._breakBatch());var r,e=this._displayedOpacity,c=this._displayedColor._val;if(h._opacityModifyRGB){var o=e/255,u=this._displayedColor.r*o,a=this._displayedColor.g*o;r=(e<<24>>>0)+(this._displayedColor.b*o<<16)+(a<<8)+u}else r=(e<<24>>>0)+((65280&c)<<8)+((16711680&c)>>8)+(c>>>24);var f=h._vertexZ,l=h._vertices,v=h._uvs,d=n.RenderingType,p=s,g=0;switch(h._renderingType){case d.SIMPLE:case d.TILED:case d.FILLED:case d.MESH:g=this._node._vertCount;for(var m=0,w=0;m<g;m++,w+=2)t[p]=l[w],t[p+1]=l[w+1],t[p+2]=f,i[p+3]=r,t[p+4]=v[w],t[p+5]=v[w+1],p+=6;break;case d.SLICED:g=this._uploadSliced(l,v,r,f,t,i,p)}return h._renderingType===d.MESH?this.vertexType=cc.renderer.VertexType.CUSTOM:h._renderingType===d.FILLED&&h._fillType===n.FillType.RADIAL?this.vertexType=cc.renderer.VertexType.TRIANGLE:this.vertexType=cc.renderer.VertexType.QUAD,g},h.uploadIndexData=function(t,i,s){var n=this._node._meshPolygonInfo;if(!n)return 0;for(var h=n.triangles.indices,r=h.length,e=0;e<r;e++)t[i+e]=s+h[e];return r},h.setState=function(t){t===n.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===n.state.GRAY?this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===n.state.DISTORTION&&(this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},n.WebGLRenderCmd._grayShaderProgram=null,n.WebGLRenderCmd._getGrayShaderProgram=function(){var t=n.WebGLRenderCmd._grayShaderProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),n.WebGLRenderCmd._grayShaderProgram=t,t)},n.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\nvec4 c = texture2D(CC_Texture0, v_texCoord);\ngl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b);\ngl_FragColor.w = c.w ;\n}",n.WebGLRenderCmd._distortionProgram=null,n.WebGLRenderCmd._getDistortionProgram=function(){var t=n.WebGLRenderCmd._distortionProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,r.fShader),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),n.WebGLRenderCmd._distortionProgram=t,n.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),n.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var r={shaderKey:"cc.Sprite.Shader.Distortion",fShader:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform vec2 u_offset;\nuniform vec2 u_offset_tiling;\nconst float PI = 3.14159265359;\nvoid main()\n{\nfloat halfPI = 0.5 * PI;\nfloat maxFactor = sin(halfPI);\nvec2 uv = v_texCoord;\nvec2 xy = 2.0 * uv.xy - 1.0;\nfloat d = length(xy);\nif (d < (2.0-maxFactor)) {\nd = length(xy * maxFactor);\nfloat z = sqrt(1.0 - d * d);\nfloat r = atan(d, z) / PI;\nfloat phi = atan(xy.y, xy.x);\nuv.x = r * cos(phi) + 0.5;\nuv.y = r * sin(phi) + 0.5;\n} else {\ndiscard;\n}\nuv = uv * u_offset_tiling + u_offset;\nuv = fract(uv);\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);\n}"}},{}],210:[function(t,i,s){cc.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var i;cc.js.isString(t)?(i=cc.textureCache.getTextureForKey(t))||(i=cc.textureCache.addImage(t)):t instanceof cc.Texture2D&&(i=t),i&&this.initWithTexture(i)},addSpriteWithoutQuad:function(t,i,s){return this.addChild(t,i,s),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,i){var s=cc.textureCache.getTextureForKey(t);return s||(s=cc.textureCache.addImage(t)),this.initWithTexture(s,i)},_:function(t,i){var s=cc.textureCache.getTextureForKey(t);return s||(s=cc.textureCache.addImage(t)),this.initWithTexture(s,i)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,i){this.removeChild(this._children[t],i)},rebuildIndexInOrder:function(t,i){return i},highestAtlasIndexInChild:function(t){var i=t.children;return i&&0!==i.length?this.highestAtlasIndexInChild(i[i.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var i=t.children;return i&&0!==i.length?this.lowestAtlasIndexInChild(i[i.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,i){this._blendFunc=void 0===i?t:{src:t,dst:i}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,i){cc.assertID(t,2623),t instanceof _ccsg.Sprite?(t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)):cc.log(2616)},insertQuadFromSprite:function(t,i){this.addChild(t,i)},insertChild:function(t,i){this.addChild(t,i)},appendChild:function(t){this.sortAllChildren(),this._children[this._children.length-1]._localZOrder,this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,i){this.removeChild(t,i)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var i,s=this._children,n=s.length;for(i=0;i<n;++i)s[i].setTexture(t)}else t.addEventListener("load",function(){var i,s=this._children,n=s.length;for(i=0;i<n;++i)s[i].setTexture(t)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var i,s=this._children,n=s.length;for(i=0;i<n;++i)s[i].setShaderProgram(t)},addChild:function(t,i,s){cc.assertID(void 0!==t,2614),this._isValidChild(t)&&(i=void 0===i?t.zIndex:i,s=void 0===s?t.tag:s,_ccsg.Node.prototype.addChild.call(this,t,i,s),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof _ccsg.Sprite?t.texture===this._texture||(cc.logID(2619),!1):(cc.logID(2618),!1)}});var n=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(n,"texture",n.getTexture,n.setTexture),cc.defineGetterSetter(n,"shaderProgram",n.getShaderProgram,n.setShaderProgram)},{}],211:[function(t,i,s){var n=t("../event/event-target");cc.P=cc.T({name:"cc.SpriteFrame",S:t("../assets/CCAsset"),mixins:[n],O:{_textureFilenameSetter:{set:function(t){this._textureFilename=t,t&&this._loadTexture()}}},ctor:function(){var t=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3],h=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,void 0!==t&&this.initWithTexture(t,i,s,n,h)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,i){this.once("load",t,i)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_refreshTexture:function(t){function i(){if(s._texture){s._textureLoaded=!0;var i=t.width,n=t.height;if(s._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var h=t.getHtmlElementObj();h=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(h,s.getRect());var r=new cc.Texture2D;r.initWithElement(h),r.handleLoadedTexture(),s._texture=r,s._rotated=!1,i=s._texture.width,n=s._texture.height,s.setRect(cc.rect(0,0,i,n))}s._rect?s._checkRect(s._texture):s.setRect(cc.rect(0,0,i,n)),s._originalSize||s.setOriginalSize(cc.size(i,n)),s._offset||s.setOffset(cc.v2(0,0)),s.emit("load")}}var s=this;if(s._texture!==t){var n=t.isLoaded();this._textureLoaded=n,this._texture=t,n?i():t.once("load",i)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.P(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,i,s,n,h){i?this.setRect(i):this._rect=null,n?this.setOffset(n):this._offset=null,h?this.setOriginalSize(h):this._originalSize=null,this._rotated=s||!1;var r=t;return cc.js.isString(r)?(this._textureFilename=r,this._loadTexture()):r instanceof cc.Texture2D&&this._refreshTexture(r),!0},_loadTexture:function(){if(this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(t)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},clearTexture:function(){this._textureLoaded=!1,this._texture=null},_checkRect:function(t){var i=this._rect,s=i.x,n=i.y;this._rotated?(s+=i.height,n+=i.width):(s+=i.width,n+=i.height),s>t.getPixelWidth()&&cc.errorID(3300,t.url+"/"+this.name),n>t.getPixelHeight()&&cc.errorID(3400,t.url+"/"+this.name)},_serialize:!1,_deserialize:function(t,i){var s=t.rect;s&&this.setRect(new cc.Rect(s[0],s[1],s[2],s[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var n=t.capInsets;n&&(this.insetLeft=n[0],this.insetTop=n[1],this.insetRight=n[2],this.insetBottom=n[3]);var h=t.texture;if(h){var r=i.customEnv&&i.customEnv.deferredLoadRaw?"_textureFilename":"_textureFilenameSetter";i.result.push(this,r,h)}}});var h=cc.P.prototype;h.copyWithZone=h.clone,h.copy=h.clone,h.initWithTexture=h.setTexture},{"../assets/CCAsset":43,"../event/event-target":111}],212:[function(t,i,s){var n=t("../event/event-target"),h=t("../platform/CCSys"),r=(t("../platform/js"),t("../utils/misc")),e=t("../CCGame");t("../platform/_CCClass"),t("../platform/CCClass");var c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),o=cc.T({name:"cc.Texture2D",S:t("../assets/CCRawAsset"),mixins:[n],statics:{WrapMode:c},ctor:function(){this.url=null,this._textureLoaded=!1,this._htmlElementObj=null,this._contentSize=cc.size(0,0),this._pixelWidth=0,this._pixelHeight=0,cc._renderType===e.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===e.RENDER_TYPE_WEBGL&&(this._pixelFormat=o.defaultPixelFormat,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._webTextureObj=null)},getPixelWidth:function(){return this._pixelWidth},getPixelHeight:function(){return this._pixelHeight},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},_getWidth:function(){return this._contentSize.width},_getHeight:function(){return this._contentSize.height},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._pixelWidth=this._contentSize.width=t.width,this._pixelHeight=this._contentSize.height=t.height,this._textureLoaded=!0)},initWithData:function(t,i,s,n,h){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(this._htmlElementObj&&this._htmlElementObj.width&&this._htmlElementObj.height){var t=this._htmlElementObj;this._pixelWidth=this._contentSize.width=t.width,this._pixelHeight=this._contentSize.height=t.height,this._textureLoaded=!0,this.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.getName()+" | Dimensions = "+this.getPixelWidth()+" x "+this.getPixelHeight()+">"},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj)},getName:function(){return this._webTextureObj||null},getPixelFormat:function(){return this._pixelFormat||null},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha||!1},hasMipmaps:function(){return this._hasMipmaps||!1},setTexParameters:function(t,i,s,n){void 0!==i&&(t={minFilter:t,magFilter:i,wrapS:s,wrapT:n}),t.wrapS!==c.REPEAT||t.wrapT!==c.REPEAT?t.wrapS!==c.REPEAT?t.wrapT!==c.REPEAT?this._pattern="":this._pattern="repeat-y":this._pattern="repeat-x":this._pattern="repeat"},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1}});o.WrapMode=c;var u=o;u.PIXEL_FORMAT_RGBA8888=2,u.PIXEL_FORMAT_RGB888=3,u.PIXEL_FORMAT_RGB565=4,u.PIXEL_FORMAT_A8=5,u.PIXEL_FORMAT_I8=6,u.PIXEL_FORMAT_AI88=7,u.PIXEL_FORMAT_RGBA4444=8,u.PIXEL_FORMAT_RGB5A1=7,u.PIXEL_FORMAT_PVRTC4=9,u.PIXEL_FORMAT_PVRTC2=10,u.PIXEL_FORMAT_DEFAULT=u.PIXEL_FORMAT_RGBA8888,u.defaultPixelFormat=u.PIXEL_FORMAT_DEFAULT;var a=o._M={};a[u.PIXEL_FORMAT_RGBA8888]="RGBA8888",a[u.PIXEL_FORMAT_RGB888]="RGB888",a[u.PIXEL_FORMAT_RGB565]="RGB565",a[u.PIXEL_FORMAT_A8]="A8",a[u.PIXEL_FORMAT_I8]="I8",a[u.PIXEL_FORMAT_AI88]="AI88",a[u.PIXEL_FORMAT_RGBA4444]="RGBA4444",a[u.PIXEL_FORMAT_RGB5A1]="RGB5A1",a[u.PIXEL_FORMAT_PVRTC4]="PVRTC4",a[u.PIXEL_FORMAT_PVRTC2]="PVRTC2";var f=o._B={};f[u.PIXEL_FORMAT_RGBA8888]=32,f[u.PIXEL_FORMAT_RGB888]=24,f[u.PIXEL_FORMAT_RGB565]=16,f[u.PIXEL_FORMAT_A8]=8,f[u.PIXEL_FORMAT_I8]=8,f[u.PIXEL_FORMAT_AI88]=16,f[u.PIXEL_FORMAT_RGBA4444]=16,f[u.PIXEL_FORMAT_RGB5A1]=16,f[u.PIXEL_FORMAT_PVRTC4]=4,f[u.PIXEL_FORMAT_PVRTC2]=3;var l=o.prototype;l.name,cc.defineGetterSetter(l,"name",l.getName),l.pixelFormat,cc.defineGetterSetter(l,"pixelFormat",l.getPixelFormat),l.pixelWidth,cc.defineGetterSetter(l,"pixelWidth",l.getPixelWidth),l.pixelHeight,cc.defineGetterSetter(l,"pixelHeight",l.getPixelHeight),l.width,cc.defineGetterSetter(l,"width",l._getWidth),l.height,cc.defineGetterSetter(l,"height",l._getHeight),e.once(e.EVENT_RENDERER_INITED,function(){if(cc._renderType===e.RENDER_TYPE_CANVAS){var t=function(t,i,s){if(null===t)return null;s=s||document.createElement("canvas"),i=i||cc.rect(0,0,t.width,t.height),s.width=i.width,s.height=i.height;var n=s.getContext("2d");n.drawImage(t,i.x,i.y,i.width,i.height,0,0,i.width,i.height);for(var h=n.getImageData(0,0,i.width,i.height),r=h.data,e=0,c=r.length;e<c;e+=4)r[e]=r[e+1]=r[e+2]=.34*r[e]+.5*r[e+1]+.16*r[e+2];return n.putImageData(h,0,0),s};l._generateTextureCacheForColor=function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return function(t,i){var s=t.width,n=t.height;i[0].width=s,i[0].height=n,i[1].width=s,i[1].height=n,i[2].width=s,i[2].height=n,i[3].width=s,i[3].height=n;var h=i[3].getContext("2d");h.drawImage(t,0,0);for(var r,e=h.getImageData(0,0,s,n).data,c=0;c<4;c++){for(var o=(r=i[c].getContext("2d")).getImageData(0,0,s,n),u=o.data,a=0;a<e.length;a+=4)u[a]=0===c?e[a]:0,u[a+1]=1===c?e[a+1]:0,u[a+2]=2===c?e[a+2]:0,u[a+3]=e[a+3];r.putImageData(o,0,0)}t.onload=null}(this._htmlElementObj,t),this.channelCache=t},l._switchToGray=function(i){this._textureLoaded&&this._isGray!==i&&(this._isGray=i,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=t(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},l._generateGrayTexture=function(){if(!this._textureLoaded)return null;var i=t(this._htmlElementObj),s=new o;return s.initWithElement(i),s.handleLoadedTexture(),s},l._generateColorTexture=h._supportCanvasNewBlendModes?function(t,i,s,n,h){var r=!1;h?r=!0:h=document.createElement("canvas");var e=this._htmlElementObj;if(n||(n=cc.rect(0,0,e.width,e.height)),h.width=n.width,h.height=n.height,n.width&&n.height){var c=h.getContext("2d");c.globalCompositeOperation="source-over",c.fillStyle="rgb("+(0|t)+","+(0|i)+","+(0|s)+")",c.fillRect(0,0,n.width,n.height),c.globalCompositeOperation="multiply",c.drawImage(e,n.x,n.y,n.width,n.height,0,0,n.width,n.height),c.globalCompositeOperation="destination-atop",c.drawImage(e,n.x,n.y,n.width,n.height,0,0,n.width,n.height)}if(r)return h;var u=new o;return u.initWithElement(h),u.handleLoadedTexture(),u}:function(t,i,s,n,h){var r=!1;h?r=!0:h=document.createElement("canvas");var e=this._htmlElementObj;if(n||(n=cc.rect(0,0,e.width,e.height)),h.width=n.width,h.height=n.height,n.width&&n.height){var c=h.getContext("2d");c.drawImage(e,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var u=c.getImageData(0,0,h.width,h.height),a=u.data;t/=255,i/=255,s/=255;for(var f=0;f<a.length;f+=4)a[f]=a[f]*t,a[f+1]=a[f+1]*i,a[f+2]=a[f+2]*s;c.putImageData(u,0,0)}if(r)return h;var l=new o;return l.initWithElement(h),l.handleLoadedTexture(),l}}else cc._renderType===e.RENDER_TYPE_WEBGL&&(l.initWithData=function(t,i,s,n,h){var r=o,e=cc._renderContext,c=e.RGBA,u=e.UNSIGNED_BYTE,a=s*o._B[i]/8;switch(a%8==0?e.pixelStorei(e.UNPACK_ALIGNMENT,8):a%4==0?e.pixelStorei(e.UNPACK_ALIGNMENT,4):a%2==0?e.pixelStorei(e.UNPACK_ALIGNMENT,2):e.pixelStorei(e.UNPACK_ALIGNMENT,1),this._webTextureObj=e.createTexture(),cc.gl.bindTexture2D(this),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i){case r.PIXEL_FORMAT_RGBA8888:c=e.RGBA;break;case r.PIXEL_FORMAT_RGB888:c=e.RGB;break;case r.PIXEL_FORMAT_RGBA4444:u=e.UNSIGNED_SHORT_4_4_4_4;break;case r.PIXEL_FORMAT_RGB5A1:u=e.UNSIGNED_SHORT_5_5_5_1;break;case r.PIXEL_FORMAT_RGB565:u=e.UNSIGNED_SHORT_5_6_5;break;case r.PIXEL_FORMAT_AI88:c=e.LUMINANCE_ALPHA;break;case r.PIXEL_FORMAT_A8:c=e.ALPHA;break;case r.PIXEL_FORMAT_I8:c=e.LUMINANCE;break;default:cc.assertID(0,3113)}return e.texImage2D(e.TEXTURE_2D,0,c,s,n,0,c,u,t),this._contentSize.width=h.width,this._contentSize.height=h.height,this._pixelWidth=s,this._pixelHeight=n,this._pixelFormat=i,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._textureLoaded=!0,!0},l.initWithImage=function(t){if(null==t)return cc.logID(3104),!1;var i=t.getWidth(),s=t.getHeight(),n=cc.configuration.getMaxTextureSize();return i>n||s>n?(cc.logID(3105,i,s,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,i,s))},l.initWithElement=function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0)},l.handleLoadedTexture=function(t){if(t=!!t,e._rendererInitialized&&this._htmlElementObj&&this._htmlElementObj.width&&this._htmlElementObj.height){var i=cc._renderContext;cc.gl.bindTexture2D(this),i.pixelStorei(i.UNPACK_ALIGNMENT,4),t&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._htmlElementObj),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),cc.gl.bindTexture2D(null),t&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var s=this._htmlElementObj.width,n=this._htmlElementObj.height;this._pixelWidth=this._contentSize.width=s,this._pixelHeight=this._contentSize.height=n,this._pixelFormat=o.PIXEL_FORMAT_RGBA8888,this._hasPremultipliedAlpha=t,this._hasMipmaps=!1,this._textureLoaded=!0,cc.view._antiAliasEnabled?this.setAntiAliasTexParameters():this.setAliasTexParameters(),this._htmlElementObj=null,this.emit("load")}},l.setTexParameters=function(t,i,s,n){var h=cc._renderContext;void 0!==i&&(t={minFilter:t,magFilter:i,wrapS:s,wrapT:n}),cc.assertID(this._pixelWidth===r.NextPOT(this._pixelWidth)&&this._pixelHeight===r.NextPOT(this._pixelHeight)||t.wrapS===h.CLAMP_TO_EDGE&&t.wrapT===h.CLAMP_TO_EDGE,3116),cc.gl.bindTexture2D(this),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t.minFilter),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t.magFilter),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,t.wrapS),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,t.wrapT)},l.setAntiAliasTexParameters=function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},l.setAliasTexParameters=function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},l.generateMipmap=function(){cc.assertID(this._pixelWidth===r.NextPOT(this._pixelWidth)&&this._pixelHeight===r.NextPOT(this._pixelHeight),3117),cc.gl.bindTexture2D(this),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),this._hasMipmaps=!0},l.stringForFormat=function(){return o._M[this._pixelFormat]},l.bitsPerPixelForFormat=function(t){t=t||this._pixelFormat;var i=o._B[t];return null!=i?i:(cc.logID(3110,t),-1)},l._initPremultipliedATextureWithImage=function(t,i,s){var n,h=o,r=t.getData(),e=null,c=null,u=t.hasAlpha(),a=cc.size(t.getWidth(),t.getHeight()),f=h.defaultPixelFormat,l=t.getBitsPerComponent();u||(l>=8?f=h.PIXEL_FORMAT_RGB888:(cc.logID(3111),f=h.PIXEL_FORMAT_RGB565));var v=i*s;if(f===h.PIXEL_FORMAT_RGB565)if(u)for(r=new Uint16Array(i*s),e=t.getData(),n=0;n<v;++n)r[n]=(e[n]>>0&255)>>3<<11|(e[n]>>8&255)>>2<<5|(e[n]>>16&255)>>3<<0;else for(r=new Uint16Array(i*s),c=t.getData(),n=0;n<v;++n)r[n]=(255&c[n])>>3<<11|(255&c[n])>>2<<5|(255&c[n])>>3<<0;else if(f===h.PIXEL_FORMAT_RGBA4444)for(r=new Uint16Array(i*s),e=t.getData(),n=0;n<v;++n)r[n]=(e[n]>>0&255)>>4<<12|(e[n]>>8&255)>>4<<8|(e[n]>>16&255)>>4<<4|(e[n]>>24&255)>>4<<0;else if(f===h.PIXEL_FORMAT_RGB5A1)for(r=new Uint16Array(i*s),e=t.getData(),n=0;n<v;++n)r[n]=(e[n]>>0&255)>>3<<11|(e[n]>>8&255)>>3<<6|(e[n]>>16&255)>>3<<1|(e[n]>>24&255)>>7<<0;else if(f===h.PIXEL_FORMAT_A8)for(r=new Uint8Array(i*s),e=t.getData(),n=0;n<v;++n)r[n]=e>>24&255;if(u&&f===h.PIXEL_FORMAT_RGB888)for(e=t.getData(),r=new Uint8Array(i*s*3),n=0;n<v;++n)r[3*n]=e>>0&255,r[3*n+1]=e>>8&255,r[3*n+2]=e>>16&255;return this.initWithData(r,f,i,s,a),r!=t.getData()&&(r=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0})}),cc.Texture2D=i.exports=o},{"../CCGame":39,"../assets/CCRawAsset":49,"../event/event-target":111,"../platform/CCClass":172,"../platform/CCSys":181,"../platform/_CCClass":184,"../platform/js":192,"../utils/misc":223}],213:[function(t,i,s){var n=t("../platform/_CCClass"),h=(t("../platform/js"),t("../CCGame")),r=n.extend({ctor:function(t,i){this.dirty=!1,this.texture=null,this._indices=null,this._buffersVBO=[],this._capacity=0,this._quads=null,this._quadsArrayBuffer=null,this._quadsWebBuffer=null,this._quadsReader=null,cc.js.isString(t)?this.initWithFile(t,i):t instanceof cc.Texture2D&&this.initWithTexture(t,i)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,i){if(t)for(var s=0;s<t.length;s++)this._setQuadToArray(t[s],i+s)},_setQuadToArray:function(t,i){var s=this._quads;s[i]?(s[i].bl=t.bl,s[i].br=t.br,s[i].tl=t.tl,s[i].tr=t.tr):s[i]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,i*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,i=this._capacity,s=0;s<i;s++)cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*s+0]=4*s+0,t[6*s+1]=4*s+0,t[6*s+2]=4*s+2,t[6*s+3]=4*s+1,t[6*s+4]=4*s+3,t[6*s+5]=4*s+3):(t[6*s+0]=4*s+0,t[6*s+1]=4*s+1,t[6*s+2]=4*s+2,t[6*s+3]=4*s+3,t[6*s+4]=4*s+2,t[6*s+5]=4*s+1)},initWithFile:function(t,i){var s=cc.textureCache.addImage(t);return s?this.initWithTexture(s,i):(cc.logID(2900,t),!1)},initWithTexture:function(t,i){cc.assertID(t,2902),i|=0,this._capacity=i,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*i);var s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(s*i),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&i>0)return!1;for(var n=this._quads,h=0;h<i;h++)n[h]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,h*s);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,i){cc.assertID(t,2903),cc.assertID(i>=0&&i<this._capacity,2904),this._totalQuads=Math.max(i+1,this._totalQuads),this._setQuadToArray(t,i),this.dirty=!0},insertQuad:function(t,i){if(cc.assertID(i<this._capacity,2905),++this._totalQuads>this._capacity)cc.logID(2901);else{var s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=i*s,h=(this._totalQuads-1-i)*s;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*s),this._quadsReader.set(this._quadsReader.subarray(n,n+h),n+s),this._setQuadToArray(t,i),this.dirty=!0}},insertQuads:function(t,i,s){s=s||t.length,cc.assertID(i+s<=this._capacity,2906);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=s,this._totalQuads>this._capacity)cc.logID(2901);else{var h,r=i*n,e=(this._totalQuads-1-i-s)*n,c=this._totalQuads-1-s;for(h=0;h<s;h++)this._quads[c+h]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(r,r+e),r+n*s),h=0;h<s;h++)this._setQuadToArray(t[h],i+h);this.dirty=!0}},insertQuadFromIndex:function(t,i){if(t!==i){cc.assertID(i>=0||i<this._totalQuads,2907),cc.assertID(t>=0||t<this._totalQuads,2908);var s,n,h=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._quadsReader,e=r.subarray(t*h,h);t>i?(s=i*h,n=(t-i)*h,r.set(r.subarray(s,s+n),s+h),r.set(e,s)):(s=(t+1)*h,n=(i-t)*h,r.set(r.subarray(s,s+n),s-h),r.set(e,i*h)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assertID(t<this._totalQuads,2909);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var s=(t+1)*i,n=(this._totalQuads-t)*i;this._quadsReader.set(this._quadsReader.subarray(s,s+n),s-i)}this.dirty=!0},removeQuadsAtIndex:function(t,i){if(cc.assertID(t+i<=this._totalQuads,2910),this._totalQuads-=i,t!==this._totalQuads){var s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+i)*s,h=(this._totalQuads-t)*s,r=t*s;this._quadsReader.set(this._quadsReader.subarray(n,n+h),r)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,h=this._capacity,r=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(i*h),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;n<h;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*i);else{var e,c,o=this._quads;if(h>s){for(e=[],c=new ArrayBuffer(i*h),n=0;n<r;n++)e[n]=new cc.V3F_C4B_T2F_Quad(o[n].tl,o[n].bl,o[n].tr,o[n].br,c,n*i);for(;n<h;n++)e[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,c,n*i);this._quadsReader=new Uint8Array(c),this._quads=e,this._quadsArrayBuffer=c}else{var u=Math.max(r,h);for(e=[],c=new ArrayBuffer(i*h),n=0;n<u;n++)e[n]=new cc.V3F_C4B_T2F_Quad(o[n].tl,o[n].bl,o[n].tr,o[n].br,c,n*i);this._quadsReader=new Uint8Array(c),this._quads=e,this._quadsArrayBuffer=c}}if(null===this._indices)this._indices=new Uint16Array(6*h);else if(h>s){var a=new Uint16Array(6*h);a.set(this._indices,0),this._indices=a}else this._indices=this._indices.subarray(0,6*h);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,i,s){if(void 0===s){if(s=i,i=this._totalQuads-t,cc.assertID(s+(this._totalQuads-t)<=this._capacity,2911),0===i)return}else if(cc.assertID(s+i<=this._totalQuads,2912),cc.assertID(t<this._totalQuads,2913),t===s)return;var n,h,r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=t*r,c=i*r,o=this._quadsReader,u=o.subarray(e,e+c),a=s*r;s<t?(n=(t-s)*r,h=s*r,o.set(o.subarray(h,h+n),h+c)):(n=(s-t)*r,h=(t+i)*r,o.set(o.subarray(h,h+n),e)),o.set(u,a),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,i){for(var s=i*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s),h=0;h<s;h++)n[h]=0},_setupVBO:function(){},_mapBuffers:function(){},drawQuads:function(){},drawNumberOfQuads:null,_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),e=r.prototype;e.totalQuads,cc.defineGetterSetter(e,"totalQuads",e.getTotalQuads),e.capacity,cc.defineGetterSetter(e,"capacity",e.getCapacity),e.quads,cc.defineGetterSetter(e,"quads",e.getQuads,e.setQuads),h.once(h.EVENT_RENDERER_INITED,function(){cc._renderType===h.RENDER_TYPE_WEBGL&&(r.prototype._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},r.prototype._mapBuffers=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},r.prototype.drawQuads=function(){this.drawNumberOfQuads(this._totalQuads,0)},r.prototype.drawNumberOfQuads=function(t,i){if(i=i||0,0!==t&&this.texture&&this.texture.isLoaded()){var s=cc._renderContext;cc.gl.bindTexture2D(this.texture),s.bindBuffer(s.ARRAY_BUFFER,this._quadsWebBuffer),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),this.dirty&&(s.bufferData(s.ARRAY_BUFFER,this._quadsArrayBuffer,s.DYNAMIC_DRAW),this.dirty=!1),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,s.FLOAT,!1,24,0),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,s.UNSIGNED_BYTE,!0,24,12),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,24,16),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?s.drawElements(s.TRIANGLE_STRIP,6*t,s.UNSIGNED_SHORT,6*i*this._indices.BYTES_PER_ELEMENT):s.drawElements(s.TRIANGLES,6*t,s.UNSIGNED_SHORT,6*i*this._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}})}),cc.TextureAtlas=i.exports=r},{"../CCGame":39,"../platform/_CCClass":184,"../platform/js":192}],214:[function(t,i,s){var n=t("../CCGame"),h=t("./CCTexture2D"),r={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},handleLoadedTexture:null,_initializingRenderer:function(){var t,i=this._loadedTexturesBefore,s=this._textures;for(t in i){var n=i[t];n.handleLoadedTexture(),s[t]=n}this._loadedTexturesBefore={}},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.logID(3002),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var i in this._textures)if(this._textures[i]===t)return i;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var i=t._htmlElementObj,s=this.getKeyByTexture(i);return s||(s=i instanceof HTMLImageElement?i.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[s]||(this._textureColorsCache[s]=t._generateTextureCacheForColor()),this._textureColorsCache[s]},getAllTextures:function(){var t=[];for(var i in this._textures){var s=this._textures[i];t.push(s)}return t},removeAllTextures:function(){var t=this._textures;for(var i in t)t[i]&&t[i].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var i=this._textures;for(var s in i)i[s]===t&&(i[s].releaseTexture(),delete i[s])}},removeTextureForKey:function(t){if("string"==typeof t){var i=this._textures;i[t]&&(i[t].releaseTexture(),delete i[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,i){if(cc.assertID(t,3009),i instanceof h)this._textures[t]=i;else{var s=new h;s.initWithElement(i),s.handleLoadedTexture(),this._textures[t]=s}},addUIImage:function(t,i){if(cc.assertID(t,3008),i&&this._textures[i])return this._textures[i];var s=new h;return s.initWithImage(t),null!=i?this._textures[i]=s:cc.logID(3004),s},dumpCachedTextureInfo:function(){var t=0,i=0,s=this._textures;for(var n in s){var h=s[n];t++,h.getHtmlElementObj()instanceof HTMLImageElement?cc.logID(3005,n,h.getHtmlElementObj().src,h.getPixelWidth(),h.getPixelHeight()):cc.logID(3006,n,h.getPixelWidth(),h.getPixelHeight()),i+=h.getPixelWidth()*h.getPixelHeight()*4}var r=this._textureColorsCache;for(n in r){var e=r[n];for(var c in e){var o=e[c];t++,cc.logID(3006,n,o.width,o.height),i+=o.width*o.height*4}}cc.logID(3007,t,i/1024,(i/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}};n.once(n.EVENT_RENDERER_INITED,function(){var t=r;cc._renderType===n.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){var i=this._textures,s=i[t];s||(cc.assertID(t,3009),(s=i[t]=new h).url=t),s.handleLoadedTexture()},t.addImage=function(t,i,s){cc.assertID(t,3103);var n=this._textures,e=n[t];return e?e.isLoaded()?(i&&i.call(s,e),e):(e.once("load",function(){i&&i.call(s,e)},s),e):(e=n[t]=new h,e.url=t,cc.loader.load(t,function(n,h){if(n)return i&&i.call(s,n||new Error("Unknown error"));r.handleLoadedTexture(t),i&&i.call(s,e)}),e)},t.addImageAsync=t.addImage):cc._renderType===n.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){var i,s,n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore),(i=n[t])||(cc.assertID(t,3009),(i=n[t]=new h).url=t),s=cc.macro.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(t),i.handleLoadedTexture(s)},t.addImage=function(t,i,s){cc.assertID(t,3112);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var e=n[t];return e?e.isLoaded()?(i&&i.call(s,e),e):(e.once("load",function(){i&&i.call(s,e)},s),e):(e=n[t]=new h,e.url=t,cc.loader.load(t,function(n,h){if(n)return i&&i.call(s,n||new Error("Unknown error"));r.handleLoadedTexture(t),i&&i.call(s,e)}),e)},t.addImageAsync=t.addImage)}),cc.textureCache=i.exports=r},{"../CCGame":39,"./CCTexture2D":212}],215:[function(t,i,s){t("./CCTexture2D"),t("./CCTextureAtlas"),t("./CCTextureCache")},{"./CCTexture2D":212,"./CCTextureAtlas":213,"./CCTextureCache":214}],216:[function(t,i,s){t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,h=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,i="",s=0;s<t;s++)i=(i+(""===i?"":"/")+arguments[s]).replace(/(\/|\\\\)$/,"");return i},extname:function(t){var i=n.exec(t);return i?i[1]:""},mainFileName:function(t){if(t){var i=t.lastIndexOf(".");if(-1!==i)return t.substring(0,i)}return t},basename:function(t,i){var s=t.indexOf("?");s>0&&(t=t.substring(0,s));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,""));if(!n)return null;var h=n[2];return i&&t.substring(t.length-i.length).toLowerCase()===i.toLowerCase()?h.substring(0,h.length-i.length):h},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,i){i=i||"";var s=t.indexOf("?"),n="";return s>0&&(n=t.substring(s),t=t.substring(0,s)),(s=t.lastIndexOf("."))<0?t+i+n:t.substring(0,s)+i+n},changeBasename:function(t,i,s){if(0===i.indexOf("."))return this.changeExtname(t,i);var n=t.indexOf("?"),h="",r=s?this.extname(t):"";return n>0&&(h=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=n<=0?0:n+1,t.substring(0,n)+i+r+h},_normalize:function(t){var i=t=String(t);do{i=t,t=t.replace(h,"")}while(i.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},i.exports=cc.path},{"../platform/CCSys":181}],217:[function(t,i,s){function n(){u("frame").start(),u("logic").start()}function h(){cc.director.isPaused()?u("frame").start():u("logic").end(),u("render").start()}function r(){u("render").end(),u("draws").value=cc.g_NumberOfDraws,u("frame").end(),u("fps").frame(),u().tick()}var e=t("../../../external/pstats/pstats"),c=t("../platform/CCMacro"),o=document.createElement("div");o.id="fps";var u=null,a=!1;cc.profiler=i.exports={isShowingStats:function(){return a},hideStats:function(){a&&(o.parentElement===document.body&&document.body.removeChild(o),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,n),cc.director.off(cc.Director.EVENT_AFTER_VISIT,h),cc.director.off(cc.Director.EVENT_AFTER_DRAW,r),a=!1)},showStats:function(){a||(u||(u=e.new(o,{showGraph:!1,values:{frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}},css:".pstats {left: "+c.DIRECTOR_STATS_POSITION.x+"px; bottom: "+c.DIRECTOR_STATS_POSITION.y+"px;}"})),null===o.parentElement&&document.body.appendChild(o),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,n),cc.director.on(cc.Director.EVENT_AFTER_VISIT,h),cc.director.on(cc.Director.EVENT_AFTER_DRAW,r),a=!0)}}},{"../../../external/pstats/pstats":312,"../platform/CCMacro":177}],218:[function(t,i,s){function n(t){return t?"string"==typeof t?f.getClassByName(t):t:(cc.errorID(3804),null)}function h(t,i){for(var s=0;s<t._components.length;++s){var n=t._components[s];if(n instanceof i)return n}return null}function r(t,i,s){for(var n=0;n<t._components.length;++n){var h=t._components[n];h instanceof i&&s.push(h)}}function e(t,i){for(var s=0;s<t.length;++s){var n=t[s],r=h(n,i);if(r)return r;if(n._children.length>0&&(r=e(n._children,i)))return r}return null}function c(t,i,s){for(var n=0;n<t.length;++n){var h=t[n];r(h,i,s),h._children.length>0&&c(h._children,i,s)}}var o=t("../platform/CCObject").Flags,u=t("./misc"),a=t("../platform/id-generater"),f=cc.js,l=o.Destroying,v=o.DontDestroy,d=new a("Node"),p=cc.T({name:"cc._BaseNode",S:cc.Object,mixins:[cc.EventTarget],O:{_parent:null,_children:[],_tag:cc.macro.NODE_TAG_INVALID,_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&v)>0},set:function(t){t?this._objFlags|=v:this._objFlags&=~v}},name:{get:function(){return this._name},set:function(t){this._name=t}},_id:{default:"",editorOnly:!0},uuid:{get:function(){var t=this._id;return t||(t=this._id=d.getNewId()),t}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var i=this._parent;i&&i._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},getTag:function(){return this._tag},setTag:function(t){this._tag=t},getParent:function(){return this._parent},setParent:function(t){if(this._parent!==t){var i=this._parent;if(this._parent=t||null,this._onSetParent(t),t&&(cc.eventManager._setDirtyForNode(this),t._children.push(this),t.emit("child-added",this)),i){if(!(i._objFlags&l)){var s=i._children.indexOf(this);i._children.splice(s,1),i.emit("child-removed",this),this._onHierarchyChanged(i)}}else t&&this._onHierarchyChanged(null)}},_:function(){return!0},attr:function(t){f.mixin(this,t)},getChildByTag:function(t){var i=this._children;if(null!==i)for(var s=0;s<i.length;s++){var n=i[s];if(n&&n._tag===t)return n}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var i=this._children,s=0,n=i.length;s<n;s++)if(i[s]._id===t)return i[s];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var i=this._children,s=0,n=i.length;s<n;s++)if(i[s]._name===t)return i[s];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,i){t.parent=this,t.setSiblingIndex(i)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var i=this._parent._children;t=-1!==t?t:i.length-1;var s=i.indexOf(this);t!==s&&(i.splice(s,1),t<i.length?i.splice(t,0,this):i.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},cleanup:function(){},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,i){this._children.indexOf(t)>-1&&((i||void 0===i)&&t.cleanup(),t.parent=null)},removeChildByTag:function(t,i){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var s=this.getChildByTag(t);s?this.removeChild(s,i):cc.logID(1610,t)},removeAllChildren:function(t){var i=this._children;void 0===t&&(t=!0);for(var s=i.length-1;s>=0;s--){var n=i[s];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},isChildOf:function(t){var i=this;do{if(i===t)return!0;i=i._parent}while(i);return!1},getComponent:function(t){var i=n(t);return i?h(this,i):null},getComponents:function(t){var i=n(t),s=[];return i&&r(this,i,s),s},getComponentInChildren:function(t){var i=n(t);return i?e(this._children,i):null},getComponentsInChildren:function(t){var i=n(t),s=[];return i&&(r(this,i,s),c(this._children,i,s)),s},_checkMultipleComp:!1,addComponent:function(t){var i;if("string"==typeof t){if(!(i=f.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;i=t}if("function"!=typeof i)return cc.errorID(3809),null;if(!cc.isChildClassOf(i,cc.U))return cc.errorID(3810),null;var s=i._requireComponent;if(s&&!this.getComponent(s)&&!this.addComponent(s))return null;var n=new i;return n.node=this,this._components.push(n),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(n),n},_addComponentAt:!1,removeComponent:function(t){t?(t instanceof cc.U||(t=this.getComponent(t)),t&&t.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){if(t){if(!(this._objFlags&l)){var i=this._components.indexOf(t);-1!==i?this._components.splice(i,1):t.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},_disableChildComps:function(){var t,i=this._components.length;for(t=0;t<i;++t){var s=this._components[t];s._enabled&&cc.director._compScheduler.disableComp(s)}for(t=0,i=this._children.length;t<i;++t){var n=this._children[t];n._active&&n._disableChildComps()}},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._disableChildComps()},destroyAllChildren:function(){for(var t=this._children,i=0;i<t.length;++i)t[i].destroy()},_onSetParent:function(t){},_onPostActivated:function(){},_onHierarchyChanged:function(t){var i=this._parent;!this._persistNode||i instanceof cc.Scene||cc.game.removePersistRootNode(this);var s=this._active&&!(!i||!i._activeInHierarchy);this._activeInHierarchy!==s&&cc.director._nodeActivator.activateNode(this,s)},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&PrefabHelper.syncWithPrefab(this);for(var i=this._children,s=0,n=i.length;s<n;s++)i[s]._onBatchCreated()},_instantiate:function(t){t||(t=cc.instantiate._clone(this,this));var i=this._prefab;return i&&this===i.root&&i.sync&&(t._prefab._synced=i._synced),t._parent=null,t._onBatchCreated(),t},_registerIfAttached:!1,_onPreDestroy:function(){var t,i;this._objFlags|=l;var s=this._parent,n=s&&s._objFlags&l,h=this._children;for(t=0,i=h.length;t<i;++t)h[t]._destroyImmediate();for(t=0,i=this._components.length;t<i;++t)this._components[t]._destroyImmediate();var r=this.__eventTargets;for(t=0,i=r.length;t<i;++t){var e=r[t];e&&e.targetOff(this)}if(r.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!n&&s){var c=s._children.indexOf(this);s._children.splice(c,1),s.emit("child-removed",this)}return n},onRestore:!1});p.prototype._onPreDestroyBase=p.prototype._onPreDestroy,p.prototype._onHierarchyChangedBase=p.prototype._onHierarchyChanged,u.propertyDefine(p,["name","children","childrenCount"],{}),cc._BaseNode=i.exports=p},{"../platform/CCObject":178,"../platform/id-generater":188,"./misc":223}],219:[function(t,i,s){i.exports={binarySearchEpsilon:function(t,i){for(var s=0,n=t.length-1,h=n>>>1;s<=n;h=s+n>>>1){var r=t[h];if(r>i+1e-6)n=h-1;else{if(!(r<i-1e-6))return h;s=h+1}}return~s}}},{}],220:[function(t,i,s){var n=t("./misc").BASE64_VALUES,h="0123456789abcdef".split(""),r=["","","",""],e=r.concat(r,"-",r,"-",r,"-",r,"-",r,r,r),c=e.map(function(t,i){return"-"===t?NaN:i}).filter(isFinite);i.exports=function(t){if(22!==t.length)return t;e[0]=t[0],e[1]=t[1];for(var i=2,s=2;i<22;i+=2){var r=n[t.charCodeAt(i)],o=n[t.charCodeAt(i+1)];e[c[s++]]=h[r>>2],e[c[s++]]=h[(3&r)<<2|o>>4],e[c[s++]]=h[15&o]}return e.join("")}},{"./misc":223}],221:[function(t,i,s){cc.find=i.exports=function(t,i){if(null==t)return cc.errorID(5600),null;if(!i){var s=cc.director.getScene();if(!s)return null;i=s}for(var n=i,h="/"!==t[0]?0:1,r=t.split("/"),e=h;e<r.length;e++){var c=r[e],o=n._children;n=null;for(var u=0,a=o.length;u<a;++u){var f=o[u];if(f.name===c){n=f;break}}if(!n)return null}return n}},{}],222:[function(t,i,s){t("./CCPath"),t("./CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":216,"./CCProfiler":217,"./find":221,"./mutable-forward-iterator":224}],223:[function(t,i,s){var n=t("../platform/js"),h=t("../platform/CCSys"),r=s;r.propertyDefine=function(t,i,s){function n(t,i,s,n){var h=Object.getOwnPropertyDescriptor(t,i);if(h)h.get&&(t[s]=h.get),h.set&&n&&(t[n]=h.set);else{var r=t[s];cc.js.getset(t,i,r,t[n])}}for(var h,r=t.prototype,e=0;e<i.length;e++){var c=(h=i[e])[0].toUpperCase()+h.slice(1);n(r,h,"get"+c,"set"+c)}for(h in s){var o=s[h];n(r,h,o[0],o[1])}},r.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},r.imagePool=new n.Pool(function(t){return t instanceof HTMLImageElement&&(t.src=this._smallImg,!0)},10),r.imagePool.get=function(){return this._get()||new Image},r.imagePool._smallImg="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",h.os!==h.OS_WINDOWS&&h.os!==h.OS_LINUX||h.browser===h.BROWSER_TYPE_CHROME||r.imagePool.resize(0),r.isBuiltinClassId=function(t){return t.startsWith("cc.")||t.startsWith("dragonBones.")||t.startsWith("sp.")||t.startsWith("ccsg.")};for(var e=new Array(123),c=0;c<123;++c)e[c]=64;for(var o=0;o<64;++o)e["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(o)]=o;r.BASE64_VALUES=e},{"../platform/CCSys":181,"../platform/js":192}],224:[function(t,i,s){function n(t){this.i=0,this.array=t}var h=n.prototype;h.remove=function(t){var i=this.array.indexOf(t);i>=0&&this.removeAt(i)},h.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},h.fastRemove=function(t){var i=this.array.indexOf(t);i>=0&&this.fastRemoveAt(i)},h.fastRemoveAt=function(t){var i=this.array;i[t]=i[i.length-1],--i.length,t<=this.i&&--this.i},h.push=function(t){this.array.push(t)},i.exports=n},{}],225:[function(t,i,s){cc._PrefabInfo=cc.T({name:"cc.PrefabInfo",O:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),i.exports={syncWithPrefab:function(t){var i=t._prefab;if(i._synced=!0,!i.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var s=t._objFlags,n=t._parent,h=t._id,r=t._name,e=t._active,c=t._position.x,o=t._position.y,u=t._rotationX,a=t._rotationY,f=t._localZOrder,l=t._globalZOrder;cc.game._isCloning=!0,i.asset._doInstantiate(t),cc.game._isCloning=!1,t._objFlags=s,t._parent=n,t._id=h,t._prefab=i,t._name=r,t._active=e,t._position.x=c,t._position.y=o,t._rotationX=u,t._rotationY=a,t._localZOrder=f,t._globalZOrder=l}}},{}],226:[function(t,i,s){i.exports={removeSgNode:function(){var t=this._sgNode;if(t){var i=t._parent;i&&i.removeChild(t),t.release(),this._sgNode._entity&&(this._sgNode._entity=null)}}}},{}],227:[function(t,i,s){cc.AffineTransform=function(t,i,s,n,h,r){this.a=t,this.b=i,this.c=s,this.d=n,this.tx=h,this.ty=r},cc.affineTransformMake=function(t,i,s,n,h,r){return{a:t,b:i,c:s,d:n,tx:h,ty:r}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,i,s){var n,h;return void 0===s?(s=i,n=t.x,h=t.y):(n=t,h=i),{x:s.a*n+s.c*h+s.tx,y:s.b*n+s.d*h+s.ty}},cc._pointApplyAffineTransformIn=function(t,i,s,n){var h,r,e;void 0===n?(e=i,h=t.x,r=t.y,n=s):(h=t,r=i,e=s),n.x=e.a*h+e.c*r+e.tx,n.y=e.b*h+e.d*r+e.ty},cc._pointApplyAffineTransform=function(t,i,s){return cc.pointApplyAffineTransform(t,i,s)},cc.sizeApplyAffineTransform=function(t,i){return{width:i.a*t.width+i.c*t.height,height:i.b*t.width+i.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,i){var s=t.x,n=t.y,h=s+t.width,r=n+t.height,e=i.a*s+i.c*n+i.tx,c=i.b*s+i.d*n+i.ty,o=i.a*h+i.c*n+i.tx,u=i.b*h+i.d*n+i.ty,a=i.a*s+i.c*r+i.tx,f=i.b*s+i.d*r+i.ty,l=i.a*h+i.c*r+i.tx,v=i.b*h+i.d*r+i.ty,d=Math.min(e,o,a,l),p=Math.max(e,o,a,l),g=Math.min(c,u,f,v),m=Math.max(c,u,f,v);return cc.rect(d,g,p-d,m-g)},cc._rectApplyAffineTransformIn=function(t,i){var s=t.x,n=t.y,h=s+t.width,r=n+t.height,e=i.a*s+i.c*n+i.tx,c=i.b*s+i.d*n+i.ty,o=i.a*h+i.c*n+i.tx,u=i.b*h+i.d*n+i.ty,a=i.a*s+i.c*r+i.tx,f=i.b*s+i.d*r+i.ty,l=i.a*h+i.c*r+i.tx,v=i.b*h+i.d*r+i.ty,d=Math.min(e,o,a,l),p=Math.max(e,o,a,l),g=Math.min(c,u,f,v),m=Math.max(c,u,f,v);return t.x=d,t.y=g,t.width=p-d,t.height=m-g,t},cc.obbApplyAffineTransform=function(t,i,s,n,h,r){var e=t.x,c=t.y,o=t.width,u=t.height,a=i.a*e+i.c*c+i.tx,f=i.b*e+i.d*c+i.ty,l=i.a*o,v=i.b*o,d=i.c*u,p=i.d*u;n.x=a,n.y=f,h.x=l+a,h.y=v+f,s.x=d+a,s.y=p+f,r.x=l+d+a,r.y=v+p+f},cc.affineTransformTranslate=function(t,i,s){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*i+t.c*s,ty:t.ty+t.b*i+t.d*s}},cc.affineTransformScale=function(t,i,s){return{a:t.a*i,b:t.b*i,c:t.c*s,d:t.d*s,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,i){var s=Math.sin(i),n=Math.cos(i);return{a:t.a*n+t.c*s,b:t.b*n+t.d*s,c:t.c*n-t.a*s,d:t.d*n-t.b*s,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,i){return{a:t.a*i.a+t.b*i.c,b:t.a*i.b+t.b*i.d,c:t.c*i.a+t.d*i.c,d:t.c*i.b+t.d*i.d,tx:t.tx*i.a+t.ty*i.c+i.tx,ty:t.tx*i.b+t.ty*i.d+i.ty}},cc.affineTransformConcatIn=function(t,i){var s=t.a,n=t.b,h=t.c,r=t.d,e=t.tx,c=t.ty;return t.a=s*i.a+n*i.c,t.b=s*i.b+n*i.d,t.c=h*i.a+r*i.c,t.d=h*i.b+r*i.d,t.tx=e*i.a+c*i.c+i.tx,t.ty=e*i.b+c*i.d+i.ty,t},cc.affineTransformEqualToTransform=function(t,i){return t.a===i.a&&t.b===i.b&&t.c===i.c&&t.d===i.d&&t.tx===i.tx&&t.ty===i.ty},cc.affineTransformInvert=function(t){var i=1/(t.a*t.d-t.b*t.c);return{a:i*t.d,b:-i*t.b,c:-i*t.c,d:i*t.a,tx:i*(t.c*t.ty-t.d*t.tx),ty:i*(t.b*t.tx-t.a*t.ty)}},cc.affineTransformInvertOut=function(t,i){var s=t.a,n=t.b,h=t.c,r=t.d,e=1/(s*r-n*h);i.a=e*r,i.b=-e*n,i.c=-e*h,i.d=e*s,i.tx=e*(h*t.ty-r*t.tx),i.ty=e*(n*t.tx-s*t.ty)}},{}],228:[function(t,i,s){var n=t("./CCValueType"),h=t("../platform/js"),r=function(){function i(t,i,s,n){"object"==typeof t&&(i=t.g,s=t.b,n=t.a,t=t.r),t=t||0,i=i||0,s=s||0,n="number"==typeof n?n:255,this._val=(~~t<<24>>>0)+(~~i<<16)+(~~s<<8)+~~n}h.extend(i,n),t("../platform/CCClass").fastDefine("cc.Color",i,{r:0,g:0,b:0,a:255});var s={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var r in s)h.get(i,r,function(t){return function(){return new i(t[0],t[1],t[2],t[3])}}(s[r]));var e=i.prototype;return e.clone=function(){var t=new i;return t._val=this._val,t},e.equals=function(t){return t&&this._val===t._val},e.lerp=function(t,s,n){n=n||new i;var h=this.r,r=this.g,e=this.b,c=this.a;return n.r=h+(t.r-h)*s,n.g=r+(t.g-r)*s,n.b=e+(t.b-e)*s,n.a=c+(t.a-c)*s,n},e.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.getR=function(){return(4278190080&this._val)>>>24},e.setR=function(t){return this._val=(16777215&this._val|~~t<<24>>>0)>>>0,this},e.getG=function(){return(16711680&this._val)>>16},e.setG=function(t){return this._val=(4278255615&this._val|~~t<<16)>>>0,this},e.getB=function(){return(65280&this._val)>>8},e.setB=function(t){return this._val=(4294902015&this._val|~~t<<8)>>>0,this},e.getA=function(){return 255&this._val},e.setA=function(t){return this._val=(4294967040&this._val|~~t)>>>0,this},h.getset(e,"r",e.getR,e.setR,!0),h.getset(e,"g",e.getG,e.setG,!0),h.getset(e,"b",e.getB,e.setB,!0),h.getset(e,"a",e.getA,e.setA,!0),e.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},e.clamp=function(){},e.fromHEX=function(t){t.length<8&&(t+="FF");var i=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this._val=(0&this._val|i)>>>0,this},e.toHEX=function(t){var i=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],s=-1;if("#rgb"===t)for(s=0;s<i.length;++s)i[s].length>1&&(i[s]=i[s][0]);else if("#rrggbb"===t)for(s=0;s<i.length;++s)1===i[s].length&&(i[s]="0"+i[s]);return i.join("")},e.toRGBValue=function(){return 16777215&this._val},e.fromHSV=function(t,s,n){var h=i.hsv2rgb(t,s,n);return this._val=(h.r<<24>>>0)+(h.g<<16)+(h.b<<8)+this.a,this},e.toHSV=function(){return i.rgb2hsv(this.r,this.g,this.b)},e.fromColor=function(t){t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)},i}();r.rgb2hsv=function(t,i,s){t/=255,i/=255,s/=255;var n={h:0,s:0,v:0},h=Math.max(t,i,s),r=Math.min(t,i,s),e=0;return n.v=h,n.s=h?(h-r)/h:0,n.s?(e=h-r,n.h=t===h?(i-s)/e:i===h?2+(s-t)/e:4+(t-i)/e,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},r.hsv2rgb=function(t,i,s){var n={r:0,g:0,b:0};if(0===i)n.r=n.g=n.b=s;else if(0===s)n.r=n.g=n.b=0;else{1===t&&(t=0),t*=6,i=i,s=s;var h=Math.floor(t),r=t-h,e=s*(1-i),c=s*(1-i*r),o=s*(1-i*(1-r));switch(h){case 0:n.r=s,n.g=o,n.b=e;break;case 1:n.r=c,n.g=s,n.b=e;break;case 2:n.r=e,n.g=s,n.b=o;break;case 3:n.r=e,n.g=c,n.b=s;break;case 4:n.r=o,n.g=e,n.b=s;break;case 5:n.r=s,n.g=e,n.b=c}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=r,cc.color=function(t,i,s,n){return"string"==typeof t?(new cc.Color).fromHEX(t):"object"==typeof t?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,i,s,n)},cc.colorEqual=function(t,i){return void 0!==t._val&&void 0!==i._val?t._val===i._val:t.r===i.r&&t.g===i.g&&t.b===i.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var i=parseInt(t),s=i>>16,n=(65280&i)>>8,h=255&i;return cc.color(s,n,h)},cc.colorToHex=function(t){var i=t.r.toString(16),s=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+i:i)+(t.g<16?"0"+s:s)+(t.b<16?"0"+n:n)},i.exports=cc.Color},{"../platform/CCClass":172,"../platform/js":192,"./CCValueType":234}],229:[function(t,i,s){var n=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,i){return cc.p(t.x+i.x,t.y+i.y)},cc.pSub=function(t,i){return cc.p(t.x-i.x,t.y-i.y)},cc.pMult=function(t,i){return cc.p(t.x*i,t.y*i)},cc.pMidpoint=function(t,i){return cc.pMult(cc.pAdd(t,i),.5)},cc.pDot=function(t,i){return t.x*i.x+t.y*i.y},cc.pCross=function(t,i){return t.x*i.y-t.y*i.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,i){return cc.pMult(i,cc.pDot(t,i)/cc.pDot(i,i))},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,i){return cc.pLengthSQ(cc.pSub(t,i))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,i){return cc.pLength(cc.pSub(t,i))},cc.pNormalize=function(t){var i=cc.pLength(t);return 0===i?cc.p(t):cc.pMult(t,1/i)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,i,s){if(i>s){var n=i;i=s,s=n}return t<i?i:t<s?t:s},cc.clamp01=function(t){return t<0?0:t<1?t:1},cc.pClamp=function(t,i,s){return cc.p(cc.clampf(t.x,i.x,s.x),cc.clampf(t.y,i.y,s.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,i){return cc.p(i(t.x),i(t.y))},cc.pLerp=function(t,i,s){return cc.pAdd(cc.pMult(t,1-s),cc.pMult(i,s))},cc.pFuzzyEqual=function(t,i,s){return t.x-s<=i.x&&i.x<=t.x+s&&t.y-s<=i.y&&i.y<=t.y+s},cc.pCompMult=function(t,i){return cc.p(t.x*i.x,t.y*i.y)},cc.pAngleSigned=function(t,i){var s=cc.pNormalize(t),h=cc.pNormalize(i),r=Math.atan2(s.x*h.y-s.y*h.x,cc.pDot(s,h));return Math.abs(r)<n?0:r},cc.pAngle=function(t,i){var s=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(i)));return Math.abs(s)<n?0:s},cc.pRotateByAngle=function(t,i,s){var n=cc.pSub(t,i),h=Math.cos(s),r=Math.sin(s),e=n.x;return n.x=e*h-n.y*r+i.x,n.y=e*r+n.y*h+i.y,n},cc.pLineIntersect=function(t,i,s,n,h){if(t.x===i.x&&t.y===i.y||s.x===n.x&&s.y===n.y)return!1;var r=i.x-t.x,e=i.y-t.y,c=n.x-s.x,o=n.y-s.y,u=t.x-s.x,a=t.y-s.y,f=o*r-c*e;return h.x=c*a-o*u,h.y=r*a-e*u,0===f?0===h.x||0===h.y:(h.x=h.x/f,h.y=h.y/f,!0)},cc.pSegmentIntersect=function(t,i,s,n){var h=cc.p(0,0);return!!(cc.pLineIntersect(t,i,s,n,h)&&h.x>=0&&h.x<=1&&h.y>=0&&h.y<=1)},cc.pIntersectPoint=function(t,i,s,n){var h=cc.p(0,0);if(cc.pLineIntersect(t,i,s,n,h)){var r=cc.p(0,0);return r.x=t.x+h.x*(i.x-t.x),r.y=t.y+h.x*(i.y-t.y),r}return cc.p(0,0)},cc.pSameAs=function(t,i){return null!=t&&null!=i&&t.x===i.x&&t.y===i.y},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,i){t.x=i.x,t.y=i.y},cc.pMultIn=function(t,i){t.x*=i,t.y*=i},cc.pSubIn=function(t,i){t.x-=i.x,t.y-=i.y},cc.pAddIn=function(t,i){t.x+=i.x,t.y+=i.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}},{}],230:[function(t,i,s){function n(t,i,s,n){t&&"object"==typeof t&&(i=t.y,s=t.width,n=t.height,t=t.x),this.x=t||0,this.y=i||0,this.width=s||0,this.height=n||0}var h=t("./CCValueType"),r=t("../platform/js");r.extend(n,h),t("../platform/CCClass").fastDefine("cc.Rect",n,{x:0,y:0,width:0,height:0}),n.fromMinMax=function(t,i){var s=Math.min(t.x,i.x),h=Math.min(t.y,i.y);return new n(s,h,Math.max(t.x,i.x)-s,Math.max(t.y,i.y)-h)},n.contain=function(t,i){return t.x<i.x&&t.x+t.width>i.x+i.width&&t.y<i.y&&t.y+t.height>i.y+i.height?1:i.x<t.x&&i.x+i.width>t.x+t.width&&i.y<t.y&&i.y+i.height>t.y+t.height?-1:0};var e=n.prototype;e.clone=function(){return new n(this.x,this.y,this.width,this.height)},e.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},e.lerp=function(t,i,s){s=s||new n;var h=this.x,r=this.y,e=this.width,c=this.height;return s.x=h+(t.x-h)*i,s.y=r+(t.y-r)*i,s.width=e+(t.width-e)*i,s.height=c+(t.height-c)*i,s},e.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},r.getset(e,"xMin",function(){return this.x},function(t){this.width+=this.x-t,this.x=t}),r.getset(e,"yMin",function(){return this.y},function(t){this.height+=this.y-t,this.y=t}),r.getset(e,"xMax",function(){return this.x+this.width},function(t){this.width=t-this.x}),r.getset(e,"yMax",function(){return this.y+this.height},function(t){this.height=t-this.y}),r.getset(e,"center",function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}),r.getset(e,"origin",function(){return new cc.Vec2(this.x,this.y)},function(t){this.x=t.x,this.y=t.y}),r.getset(e,"size",function(){return new cc.Size(this.width,this.height)},function(t){this.width=t.width,this.height=t.height}),e.intersects=function(t){return cc.rectIntersectsRect(this,t)},e.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},e.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},cc.Rect=n,cc.rect=function(t,i,s,h){return new n(t,i,s,h)},cc.rectEqualToRect=function(t,i){return t&&i&&t.x===i.x&&t.y===i.y&&t.width===i.width&&t.height===i.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,i){return!(!t||!i||t.x>=i.x||t.y>=i.y||t.x+t.width<=i.x+i.width||t.y+t.height<=i.y+i.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,i){return i.x>=cc.rectGetMinX(t)&&i.x<=cc.rectGetMaxX(t)&&i.y>=cc.rectGetMinY(t)&&i.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,i){var s=t.x+t.width,n=t.y+t.height,h=i.x+i.width,r=i.y+i.height;return!(s<i.x||h<t.x||n<i.y||r<t.y)},cc.rectOverlapsRect=function(t,i){return!(t.x+t.width<i.x||i.x+i.width<t.x||t.y+t.height<i.y||i.y+i.height<t.y)},cc.rectUnion=function(t,i){var s=cc.rect(0,0,0,0);return s.x=Math.min(t.x,i.x),s.y=Math.min(t.y,i.y),s.width=Math.max(t.x+t.width,i.x+i.width)-s.x,s.height=Math.max(t.y+t.height,i.y+i.height)-s.y,s},cc.rectIntersection=function(t,i){var s=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(i)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(i)),0,0);return s.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(i))-cc.rectGetMinX(s),s.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(i))-cc.rectGetMinY(s),s},i.exports=cc.Rect},{"../platform/CCClass":172,"../platform/js":192,"./CCValueType":234}],231:[function(t,i,s){function n(t,i){t&&"object"==typeof t&&(i=t.height,t=t.width),this.width=t||0,this.height=i||0}var h=t("./CCValueType"),r=t("../platform/js");r.extend(n,h),t("../platform/CCClass").fastDefine("cc.Size",n,{width:0,height:0}),r.get(n,"ZERO",function(){return new n(0,0)});var e=n.prototype;e.clone=function(){return new n(this.width,this.height)},e.equals=function(t){return t&&this.width===t.width&&this.height===t.height},e.lerp=function(t,i,s){s=s||new n;var h=this.width,r=this.height;return s.width=h+(t.width-h)*i,s.height=r+(t.height-r)*i,s},e.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,i){return new n(t,i)},cc.sizeEqualToSize=function(t,i){return t&&i&&t.width===i.width&&t.height===i.height},cc.Size=i.exports=n},{"../platform/CCClass":172,"../platform/js":192,"./CCValueType":234}],232:[function(t,i,s){cc.Acceleration=function(t,i,s,n){this.x=t||0,this.y=i||0,this.z=s||0,this.timestamp=n||0},cc.BlendFunc=function(t,i){this.src=t,this.dst=i};var n=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(n.ONE,n.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE)},cc.BlendFunc.BlendFactor=n,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.FontDefinition=function(t){if(this.fontName="Arial",this.fontSize=12,this.textAlign=cc.TextAlignment.CENTER,this.verticalAlign=cc.VerticalTextAlignment.TOP,this.fillStyle=cc.color(255,255,255,255),this.boundingWidth=0,this.boundingHeight=0,this.strokeEnabled=!1,this.strokeStyle=cc.color(255,255,255,255),this.lineWidth=1,this.lineHeight="normal",this.fontStyle="normal",this.fontWeight="normal",this.shadowEnabled=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowOpacity=1,t&&t instanceof Object)for(var i in t)this[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),cc._Dictionary=cc.T({ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return"key_"+ ++this.__currId},setObject:function(t,i){if(null!=i){var s=this.__getKey();this._keyMapTb[s]=i,this._valueMapTb[s]=t}},objectForKey:function(t){if(null==t)return null;var i=this._keyMapTb;for(var s in i)if(i[s]===t)return this._valueMapTb[s];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var i=this._keyMapTb;for(var s in i)if(i[s]===t)return delete this._valueMapTb[s],void delete i[s]}},removeObjectsForKeys:function(t){if(null!=t)for(var i=0;i<t.length;i++)this.removeObjectForKey(t[i])},allKeys:function(){var t=[],i=this._keyMapTb;for(var s in i)t.push(i[s]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}})},{}],233:[function(t,i,s){cc.WebGLColor=function(t,i,s,n,h,r){this._arrayBuffer=h||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=r||0;var e=this._arrayBuffer,c=this._offset;this._view=new Uint8Array(e,c,4),this._view[0]=t||0,this._view[1]=i||0,this._view[2]=s||0,"number"==typeof n?this._view[3]=n:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4;var n=cc.WebGLColor.prototype;n._getR=function(){return this._view[0]},n._setR=function(t){this._view[0]=t<0?0:t},n._getG=function(){return this._view[1]},n._setG=function(t){this._view[1]=t<0?0:t},n._getB=function(){return this._view[2]},n._setB=function(t){this._view[2]=t<0?0:t},n._getA=function(){return this._view[3]},n._setA=function(t){this._view[3]=t<0?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,i,s,n){this._arrayBuffer=s||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=i||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,(n=cc.Vertex2F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,i,s,n,h){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=h||0;var r=this._arrayBuffer,e=this._offset;this._view=new Float32Array(r,e,3),this._view[0]=t||0,this._view[1]=i||0,this._view[2]=s||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,(n=cc.Vertex3F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},n._getZ=function(){return this._view[2]},n._setZ=function(t){this._view[2]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,i,s,n){this._arrayBuffer=s||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=i||0},cc.Tex2F.BYTES_PER_ELEMENT=8,(n=cc.Tex2F.prototype)._getU=function(){return this._view[0]},n._setU=function(t){this._view[0]=t},n._getV=function(){return this._view[1]},n._setV=function(t){this._view[1]=t},cc.js.getset(n,"u",n._getU,n._setU),cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,i,s,n,h,r){this._arrayBuffer=h||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=r||0;var e=this._arrayBuffer,c=this._offset,o=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,e,c):new cc.Vertex2F(0,0,e,c),c+=o,this._tr=i?new cc.Vertex2F(i.x,i.y,e,c):new cc.Vertex2F(0,0,e,c),c+=o,this._bl=s?new cc.Vertex2F(s.x,s.y,e,c):new cc.Vertex2F(0,0,e,c),c+=o,this._br=n?new cc.Vertex2F(n.x,n.y,e,c):new cc.Vertex2F(0,0,e,c)},cc.Quad2.BYTES_PER_ELEMENT=32,(n=cc.Quad2.prototype)._getTL=function(){return this._tl},n._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,i,s,n,h,r){this._arrayBuffer=h||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=r||0;var e=this._arrayBuffer,c=this._offset,o=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,e,c):new cc.Vertex3F(0,0,0,e,c),c+=o,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,e,c):new cc.Vertex3F(0,0,0,e,c),c+=o,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,e,c):new cc.Vertex3F(0,0,0,e,c),c+=o,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,e,c):new cc.Vertex3F(0,0,0,e,c)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,i,s,n,h){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=h||0;var r=this._arrayBuffer,e=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,r,e):new cc.Vertex3F(0,0,0,r,e),e+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=i?new cc.WebGLColor(i.r,i.g,i.b,i.a,r,e):new cc.WebGLColor(0,0,0,0,r,e),e+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=s?new cc.Tex2F(s.u,s.v,r,e):new cc.Tex2F(0,0,r,e)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,(n=cc.V3F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){var i=this._vertices;i._view[0]=t.x,i._view[1]=t.y,i._view[2]=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var i=this._colors;i._view[0]=t.r,i._view[1]=t.g,i._view[2]=t.b,i._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,i,s,n,h,r){this._arrayBuffer=h||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=r||0;var e=this._arrayBuffer,c=this._offset,o=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,e,c):new cc.V3F_C4B_T2F(null,null,null,e,c),c+=o,this._bl=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,e,c):new cc.V3F_C4B_T2F(null,null,null,e,c),c+=o,this._tr=s?new cc.V3F_C4B_T2F(s.vertices,s.colors,s.texCoords,e,c):new cc.V3F_C4B_T2F(null,null,null,e,c),c+=o,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,e,c):new cc.V3F_C4B_T2F(null,null,null,e,c)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,(n=cc.V3F_C4B_T2F_Quad.prototype)._getTL=function(){return this._tl},n._setTL=function(t){var i=this._tl;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var i=this._bl;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var i=this._tr;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var i=this._br;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var i=t.tl,s=t.bl,n=t.tr,h=t.br;return{tl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},bl:{vertices:{x:s.vertices.x,y:s.vertices.y,z:s.vertices.z},colors:{r:s.colors.r,g:s.colors.g,b:s.colors.b,a:s.colors.a},texCoords:{u:s.texCoords.u,v:s.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:h.vertices.x,y:h.vertices.y,z:h.vertices.z},colors:{r:h.colors.r,g:h.colors.g,b:h.colors.b,a:h.colors.a},texCoords:{u:h.texCoords.u,v:h.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var i=[],s=0;s<t.length;s++)i.push(cc.V3F_C4B_T2F_QuadCopy(t[s]));return i},cc.V2F_C4B_T2F=function(t,i,s,n,h){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=h||0;var r=this._arrayBuffer,e=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,r,e):new cc.Vertex2F(0,0,r,e),e+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=i?new cc.WebGLColor(i.r,i.g,i.b,i.a,r,e):new cc.WebGLColor(0,0,0,0,r,e),e+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=s?new cc.Tex2F(s.u,s.v,r,e):new cc.Tex2F(0,0,r,e)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,(n=cc.V2F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var i=this._colors;i._view[0]=t.r,i._view[1]=t.g,i._view[2]=t.b,i._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,i,s,n,h){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=h||0;var r=this._arrayBuffer,e=this._offset,c=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,r,e):new cc.V2F_C4B_T2F(null,null,null,r,e),e+=c,this._b=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,r,e):new cc.V2F_C4B_T2F(null,null,null,r,e),e+=c,this._c=s?new cc.V2F_C4B_T2F(s.vertices,s.colors,s.texCoords,r,e):new cc.V2F_C4B_T2F(null,null,null,r,e)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,(n=cc.V2F_C4B_T2F_Triangle.prototype)._getA=function(){return this._a},n._setA=function(t){var i=this._a;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var i=this._b;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var i=this._c;i.vertices=t.vertices,i.colors=t.colors,i.texCoords=t.texCoords},cc.js.getset(n,"a",n._getA,n._setA),cc.js.getset(n,"b",n._getB,n._setB),cc.js.getset(n,"c",n._getC,n._setC)},{}],234:[function(t,i,s){function n(){}t("../platform/js").setClassName("cc.ValueType",n),n.prototype.toString=function(){return""+{}},cc.ValueType=n,i.exports=n},{"../platform/js":192}],235:[function(t,i,s){function n(t,i){t&&"object"==typeof t&&(i=t.y,t=t.x),this.x=t||0,this.y=i||0}var h=t("./CCValueType"),r=t("../platform/js"),e=t("../platform/CCClass");r.extend(n,h),e.fastDefine("cc.Vec2",n,{x:0,y:0});var c=n.prototype;c.clone=function(){return new n(this.x,this.y)},c.set=function(t){return this.x=t.x,this.y=t.y,this},c.equals=function(t){return t&&this.x===t.x&&this.y===t.y},c.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},c.lerp=function(t,i,s){s=s||new n;var h=this.x,r=this.y;return s.x=h+(t.x-h)*i,s.y=r+(t.y-r)*i,s},c.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},c.add=function(t,i){return i=i||new n,i.x=this.x+t.x,i.y=this.y+t.y,i},c.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this},c.sub=function(t,i){return i=i||new n,i.x=this.x-t.x,i.y=this.y-t.y,i},c.mulSelf=function(t){return this.x*=t,this.y*=t,this},c.mul=function(t,i){return i=i||new n,i.x=this.x*t,i.y=this.y*t,i},c.scaleSelf=function(t){return this.x*=t.x,this.y*=t.y,this},c.scale=function(t,i){return i=i||new n,i.x=this.x*t.x,i.y=this.y*t.y,i},c.divSelf=function(t){return this.x/=t,this.y/=t,this},c.div=function(t,i){return i=i||new n,i.x=this.x/t,i.y=this.y/t,i},c.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},c.neg=function(t){return t=t||new n,t.x=-this.x,t.y=-this.y,t},c.dot=function(t){return this.x*t.x+this.y*t.y},c.cross=function(t){return this.y*t.x-this.x*t.y},c.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},c.magSqr=function(){return this.x*this.x+this.y*this.y},c.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var i=1/Math.sqrt(t);return this.x*=i,this.y*=i,this},c.normalize=function(t){return t=t||new n,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},c.angle=function(t){var i=this.magSqr(),s=t.magSqr();if(0===i||0===s)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t)/Math.sqrt(i*s);return n=cc.clampf(n,-1,1),Math.acos(n)},c.signAngle=function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},c.rotate=function(t,i){return i=i||new n,i.x=this.x,i.y=this.y,i.rotateSelf(t)},c.rotateSelf=function(t){var i=Math.sin(t),s=Math.cos(t),n=this.x;return this.x=s*n-i*this.y,this.y=i*n+s*this.y,this},r.get(n,"ONE",function(){return new n(1,1)}),r.get(n,"ZERO",function(){return new n(0,0)}),r.get(n,"UP",function(){return new n(0,1)}),r.get(n,"RIGHT",function(){return new n(1,0)}),cc.Vec2=n,cc.v2=function(t,i){return new n(t,i)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,i){return t&&i&&t.x===i.x&&t.y===i.y},i.exports=cc.Vec2},{"../platform/CCClass":172,"../platform/js":192,"./CCValueType":234}],236:[function(t,i,s){t("./CCValueType"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":227,"./CCColor":228,"./CCPointExtension":229,"./CCRect":230,"./CCSize":231,"./CCTypes":232,"./CCTypesWebGL":233,"./CCValueType":234,"./CCVec2":235}],237:[function(t,i,s){var n=t("../platform/utils");_ccsg.VideoPlayer=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._EventList={}},_createRenderCmd:function(){return new _ccsg.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){this._renderCmd.play()},pause:function(){this._renderCmd.pause()},_resume:function(){this._renderCmd.play()},stop:function(){this._renderCmd.stop()},seekTo:function(t){this._renderCmd.seekTo(t)},isPlaying:function(){return this._renderCmd.isPlaying()},duration:function(){return this._renderCmd.duration()},currentTime:function(){return this._renderCmd.currentTime()},createDomElementIfNeeded:function(){this._renderCmd._video||this._renderCmd.createDom()},setKeepAspectRatioEnabled:function(){cc.logID(7700)},isKeepAspectRatioEnabled:function(){return!0},setFullScreenEnabled:function(t){var i=this._renderCmd._video;i&&(t?cc.screen.requestFullScreen(i):cc.screen.exitFullScreen(i))},isFullScreenEnabled:function(){cc.logID(7701)},setEventListener:function(t,i){this._EventList[t]=i},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var i=this._EventList[t];i&&i.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){this._EventList[_ccsg.VideoPlayer.EventType.PLAYING].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,i){void 0!==t.width&&void 0!==t.height&&(i=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,i),this._renderCmd.updateSize(t,i)},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this);var t=_ccsg.VideoPlayer.elements;-1===t.indexOf(this)&&t.push(this)},cleanup:function(){this._super(),this._renderCmd.removeDom()},onExit:function(){_ccsg.Node.prototype.onExit.call(this);var t=_ccsg.VideoPlayer.elements,i=t.indexOf(this);-1!==i&&t.splice(i,1)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.VideoPlayer.elements=[],_ccsg.VideoPlayer.pauseElements=[],cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){for(var t,i=_ccsg.VideoPlayer.elements,s=0;s<i.length;s++)t=i[s],i[s]._playing&&(t.pause(),_ccsg.VideoPlayer.pauseElements.push(t))}),cc.game.on(cc.game.EVENT_SHOW,function(){for(var t=_ccsg.VideoPlayer.pauseElements,i=t.pop();i;)i.play(),i=t.pop()}),_ccsg.VideoPlayer.EventType={PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},function(){var i=document.createElement("video");i.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),i.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),i.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm")}(),cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0),cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0);var i=document.createElement("style");i.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(i)}(_ccsg.VideoPlayer),function(t){_ccsg.VideoPlayer.RenderCmd=function(t){this._rootCtor(t),this._video=null,this._url="",this._played=!1,this._playing=!1,this._ignorePause=!1};var i=_ccsg.VideoPlayer.RenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);i.constructor=_ccsg.VideoPlayer.RenderCmd,i.transform=function(t,i){this.originTransform(t,i),this.updateMatrix()},i.updateMatrix=function(){if(this._video){var i=this._node,s=cc.view._scaleX,n=cc.view._scaleY,h=cc.view._devicePixelRatio,r=this._worldTransform;s/=h,n/=h;var e=cc.game.container,c=r.a*s,o=r.b,u=r.c,a=r.d*n,f=e&&e.style.paddingLeft&&parseInt(e.style.paddingLeft),l=e&&e.style.paddingBottom&&parseInt(e.style.paddingBottom),v=r.tx*s+f,d=r.ty*n+l;t.zoomInvalid&&(this.updateSize(i._contentSize.width*c,i._contentSize.height*a),c=1,a=1);var p="matrix("+c+","+-o+","+-u+","+a+","+v+","+-d+")";this._video.style.transform=p,this._video.style["-webkit-transform"]=p,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px"}},i.updateURL=function(i){cc.loader.md5Pipe&&(i=cc.loader.md5Pipe.transformURL(i));var s,n,h,r=this._node;if(this._url!=i){this._url=i,cc.loader.resPath&&!/^http/.test(i)&&(i=cc.path.join(cc.loader.resPath,i)),this.removeDom(),this.createDom(),this.bindEvent(),n=this._video;var e=function(){1!=this._loaded&&(this._loaded=!0,r.setContentSize(r._contentSize.width,r._contentSize.height),n.currentTime=0,r._dispatchEvent(_ccsg.VideoPlayer.EventType.READY_TO_PLAY),this.updateVisibility(),this.updateMatrix())}.bind(this);n.oncanplay=e,n.style.visibility="hidden",this._loaded=!1,this._played=!1,this._playing=!1,(s=document.createElement("source")).src=i,n.appendChild(s),h=cc.path.extname(i);for(var c=0;c<t.canPlayType.length;c++)h!==t.canPlayType[c]&&((s=document.createElement("source")).src=i.replace(h,t.canPlayType[c]),n.appendChild(s))}},i.bindEvent=function(){var t=this._node,i=this._video,s=this;i.onloadedmetadata=function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.META_LOADED)},i.addEventListener("ended",function(){s._video===i&&(this._playing=!1,t._dispatchEvent(_ccsg.VideoPlayer.EventType.COMPLETED))}.bind(this)),i.addEventListener("play",function(){s._video===i&&t._dispatchEvent(_ccsg.VideoPlayer.EventType.PLAYING)}),i.addEventListener("pause",function(){s._ignorePause||s._video!==i||t._dispatchEvent(_ccsg.VideoPlayer.EventType.PAUSED)}),i.addEventListener("click",function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.CLICKED)})},i.updateVisibility=function(){var t=this._node;if(this._video){var i=this._video;t.visible?i.style.visibility="visible":(i.style.visibility="hidden",i.pause(),this._playing=!1)}},i.createDom=function(){var t=document.createElement("video");t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo",t.setAttribute("preload",!0),t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""),this._video=t,cc.game.container.appendChild(t)},i.removeDom=function(){var t=this._video;t&&n.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._video=null,this._url=""},i.updateSize=function(t,i){var s=this._video;s&&(s.style.width=t+"px",s.style.height=i+"px")},i.play=function(){var t=this._video;if(t&&this._node.isVisible()&&(this._played=!0,!this._playing))if(_ccsg.VideoPlayer._polyfill.autoplayAfterOperation){var i=this;setTimeout(function(){t.play(),i._playing=!0},20)}else t.play(),this._playing=!0},i.pause=function(){var t=this._video;this._playing&&(this._playing=!1,t&&t.pause())},i.stop=function(){var t=this._video;if(t&&this._node.isVisible()){this._ignorePause=!0,t.pause();var i=this._node;setTimeout(function(){i._dispatchEvent(_ccsg.VideoPlayer.EventType.STOPPED),this._ignorePause=!1}.bind(this),0),t.currentTime=0,this._playing=!1}},i.seekTo=function(i){var s=this._video;if(s){if(this._loaded)s.currentTime=i;else{var n=function(){s.currentTime=i,s.removeEventListener(t.event,n)};s.addEventListener(t.event,n)}_ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){s.play()},20)}},i.isPlaying=function(){var t=this._video;return _ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){t.play()},20),this._playing},i.duration=function(){var t=this._video,i=-1;return t?((i=t.duration)<=0&&cc.logID(7702),i):i},i.currentTime=function(){var t=this._video;return t?t.currentTime:-1}}(_ccsg.VideoPlayer._polyfill)},{"../platform/utils":197}],238:[function(t,i,s){var n=t("../platform/utils");_ccsg.WebView=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this.setContentSize(cc.size(300,200)),this._EventList={}},createDomElementIfNeeded:function(){this._renderCmd._div||this._renderCmd.createNativeControl()},setOnJSCallback:function(t){},setJavascriptInterfaceScheme:function(t){},loadData:function(t,i,s,n){},loadHTMLString:function(t,i){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(_ccsg.WebView.EventType.LOADING)},stopLoading:function(){cc.logID(7800)},reload:function(){var t=this._renderCmd._iframe;if(t){var i=t.contentWindow;i&&i.location&&i.location.reload()}},canGoBack:function(){return cc.logID(7801),!0},canGoForward:function(){return cc.logID(7802),!0},goBack:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return cc.logID(7803);var t=this._renderCmd._iframe;if(t){var i=t.contentWindow;i&&i.location&&i.history.back.call(i)}}catch(t){cc.log(t)}},goForward:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return cc.logID(7804);var t=this._renderCmd._iframe;if(t){var i=t.contentWindow;i&&i.location&&i.history.forward.call(i)}}catch(t){cc.log(t)}},evaluateJS:function(t){var i=this._renderCmd._iframe;if(i){var s=i.contentWindow;try{s.eval(t),this._dispatchEvent(_ccsg.WebView.EventType.JS_EVALUATED)}catch(t){console.error(t)}}},setScalesPageToFit:function(){cc.logID(7805)},setEventListener:function(t,i){this._EventList[t]=i},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var i=this._EventList[t];i&&i.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new _ccsg.WebView.RenderCmd(this)},setContentSize:function(t,i){void 0!==t.width&&void 0!==t.height&&(i=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,i),this._renderCmd.updateSize(t,i)},cleanup:function(){this._super(),this._renderCmd.removeDom()},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.WebView.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3},function(){var t=_ccsg.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(t.enableDiv=!0),cc.sys.isMobile?cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):cc.sys.browserType===cc.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){var i;i=cc._renderType===cc.game.RENDER_TYPE_CANVAS?_ccsg.Node.CanvasRenderCmd:_ccsg.Node.WebGLRenderCmd,_ccsg.WebView.RenderCmd=function(t){this._rootCtor(t),this._parent=null,this._div=null,this._iframe=null,this._listener=null};var s=_ccsg.WebView.RenderCmd.prototype=Object.create(i.prototype);s.constructor=_ccsg.WebView.RenderCmd,s.transform=function(t,i){this.originTransform(t,i),this.updateMatrix()},s.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled();var i=_ccsg.Node._dirtyFlags;this._dirtyFlag&i.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(),this._dirtyFlag&=~_ccsg.Node._dirtyFlags.transformDirty)},s.initEvent=function(){var t=this._node;this._iframe.addEventListener("load",function(){t._dispatchEvent(_ccsg.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){t._dispatchEvent(_ccsg.WebView.EventType.ERROR)})},s.resize=function(t){t=t||cc.view;var i=this._node,s=cc.eventManager;if(i._parent&&i._visible)this.updateMatrix();else{var n=s._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();s._removeListenerInVector(n,this._listener),this._listener=null}},s.updateMatrix=function(){if(this._div){this._node;var t=cc.view._scaleX,i=cc.view._scaleY,s=cc.view._devicePixelRatio,n=this._worldTransform;t/=s,i/=s;var h=cc.game.container,r=n.a*t,e=n.b,c=n.c,o=n.d*i,u=h&&h.style.paddingLeft&&parseInt(h.style.paddingLeft),a=h&&h.style.paddingBottom&&parseInt(h.style.paddingBottom),f="matrix("+r+","+-e+","+-c+","+o+","+(n.tx*t+u)+","+-(n.ty*i+a)+")";this._div.style.transform=f,this._div.style["-webkit-transform"]=f,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px"}},s.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},s.updateURL=function(t){var i=this._iframe;i.src=t;var s=this,n=function(){s._loaded=!0,s.updateVisibility(),i.removeEventListener("load",n)};i.addEventListener("load",n)},s.updateSize=function(t,i){var s=this._div;s&&(s.style.width=t+"px",s.style.height=i+"px")},s.createDom=function(){t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF";var i=this._node._contentSize;this._div.style.height=i.height+"px",this._div.style.width=i.width+"px",this._div.style.overflow="scroll",this._iframe.style.border="none",cc.game.container.appendChild(this._div),this.updateVisibility()},s.createNativeControl=function(){this.createDom(),this.initStyle(),this.initEvent()},s.removeDom=function(){var t=this._div;t&&n.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._div=null},s.updateVisibility=function(){var t=this._node;if(this._div){var i=this._div;t.visible?i.style.visibility="visible":i.style.visibility="hidden"}}}(_ccsg.WebView._polyfill)},{"../platform/utils":197}],239:[function(t,i,s){cc.js.obsolete(cc.loader,"cc.loader.loadResAll","loadResDir")},{}],240:[function(t,i,s){t("./core/CCGame"),t("./actions"),t("./core/base-nodes/CCSGNode"),t("./core/base-nodes/CCSGNodeCanvasRenderCmd"),t("./core/base-nodes/CCSGNodeWebGLRenderCmd"),t("./core/scenes/CCSGScene"),t("./core/CCConfiguration"),t("./core/CCDrawingPrimitivesCanvas"),t("./core/CCDrawingPrimitivesWebGL"),t("./core/sprites/CCSGSprite"),t("./core/sprites/CCSGSpriteCanvasRenderCmd"),t("./core/sprites/CCSGSpriteWebGLRenderCmd"),t("./core/sprites/CCScale9Sprite"),t("./core/sprites/CCScale9SpriteCanvasRenderCmd"),t("./core/sprites/CCScale9SpriteWebGLRenderCmd"),t("./core/sprites/CCSpriteBatchNode"),t("./shape-nodes/CCDrawNode"),t("./shape-nodes/CCDrawNodeCanvasRenderCmd"),t("./shape-nodes/CCDrawNodeWebGLRenderCmd"),t("./render-texture/CCRenderTexture"),t("./render-texture/CCRenderTextureCanvasRenderCmd"),t("./render-texture/CCRenderTextureWebGLRenderCmd")},{"./actions":10,"./core/CCConfiguration":33,"./core/CCDrawingPrimitivesCanvas":37,"./core/CCDrawingPrimitivesWebGL":38,"./core/CCGame":39,"./core/base-nodes/CCSGNode":55,"./core/base-nodes/CCSGNodeCanvasRenderCmd":56,"./core/base-nodes/CCSGNodeWebGLRenderCmd":57,"./core/scenes/CCSGScene":203,"./core/sprites/CCSGSprite":204,"./core/sprites/CCSGSpriteCanvasRenderCmd":205,"./core/sprites/CCSGSpriteWebGLRenderCmd":206,"./core/sprites/CCScale9Sprite":207,"./core/sprites/CCScale9SpriteCanvasRenderCmd":208,"./core/sprites/CCScale9SpriteWebGLRenderCmd":209,"./core/sprites/CCSpriteBatchNode":210,"./render-texture/CCRenderTexture":267,"./render-texture/CCRenderTextureCanvasRenderCmd":268,"./render-texture/CCRenderTextureWebGLRenderCmd":269,"./shape-nodes/CCDrawNode":275,"./shape-nodes/CCDrawNodeCanvasRenderCmd":276,"./shape-nodes/CCDrawNodeWebGLRenderCmd":277}],241:[function(t,i,s){cc.math.AABB=function(t,i){this.min=t||new cc.math.Vec3,this.max=i||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,i){return t.x>=i.min.x&&t.x<=i.max.x&&t.y>=i.min.y&&t.y<=i.max.y&&t.z>=i.min.z&&t.z<=i.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,i){return t.min.assignFrom(i.min),t.max.assignFrom(i.max),t}},{}],242:[function(t,i,s){cc.math.Matrix4Stack=function(t,i){this.top=t,this.stack=i||[],this.lastUpdated=0};var n=cc.math.Matrix4Stack.prototype;n.initialize=function(){this.stack.length=0,this.top=null},n.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t),this.update()},n.pop=function(){this.top=this.stack.pop(),this.update()},n.update=function(){this.lastUpdated++},n.release=function(){this.stack=null,this.top=null,this._matrixPool=null},n._getFromPool=function(t){var i=this._matrixPool;if(0===i.length)return new cc.math.Matrix4(t);var s=i.pop();return s.assignFrom(t),s},n._putInPool=function(t){this._matrixPool.push(t)}},{}],243:[function(t,i,s){var n=cc.math;n.KM_GL_MODELVIEW=5888,n.KM_GL_PROJECTION=5889,n.KM_GL_TEXTURE=5890,n.modelview_matrix_stack=new n.Matrix4Stack,n.projection_matrix_stack=new n.Matrix4Stack,n.texture_matrix_stack=new n.Matrix4Stack,cc.current_stack=null;var h=!1;!function(){if(!h){var t=new n.Matrix4;n.modelview_matrix_stack.initialize(),n.projection_matrix_stack.initialize(),n.texture_matrix_stack.initialize(),cc.current_stack=n.modelview_matrix_stack,h=!0,t.identity(),n.modelview_matrix_stack.push(t),n.projection_matrix_stack.push(t),n.texture_matrix_stack.push(t)}}(),n.glFreeAll=function(){n.modelview_matrix_stack.release(),n.modelview_matrix_stack=null,n.projection_matrix_stack.release(),n.projection_matrix_stack=null,n.texture_matrix_stack.release(),n.texture_matrix_stack=null,h=!1,cc.current_stack=null},n.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top)},n.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t},n.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},n.glMatrixMode=function(t){switch(t){case n.KM_GL_MODELVIEW:cc.current_stack=n.modelview_matrix_stack;break;case n.KM_GL_PROJECTION:cc.current_stack=n.projection_matrix_stack;break;case n.KM_GL_TEXTURE:cc.current_stack=n.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},n.glLoadIdentity=function(){cc.current_stack.top.identity(),cc.current_stack.update()},n.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t),cc.current_stack.update()},n.glMultMatrix=function(t){cc.current_stack.top.multiply(t),cc.current_stack.update()};var r=new n.Matrix4;n.glTranslatef=function(t,i,s){var h=n.Matrix4.createByTranslation(t,i,s,r);cc.current_stack.top.multiply(h),cc.current_stack.update()};var e=new n.Vec3;n.glRotatef=function(t,i,s,h){e.fill(i,s,h);var c=n.Matrix4.createByAxisAndAngle(e,cc.degreesToRadians(t),r);cc.current_stack.top.multiply(c),cc.current_stack.update()},n.glScalef=function(t,i,s){var h=n.Matrix4.createByScale(t,i,s,r);cc.current_stack.top.multiply(h),cc.current_stack.update()},n.glGetMatrix=function(t,i){switch(t){case n.KM_GL_MODELVIEW:i.assignFrom(n.modelview_matrix_stack.top);break;case n.KM_GL_PROJECTION:i.assignFrom(n.projection_matrix_stack.top);break;case n.KM_GL_TEXTURE:i.assignFrom(n.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],244:[function(t,i,s){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")},{"./aabb":241,"./gl/mat4stack":242,"./gl/matrix":243,"./mat3":245,"./mat4":246,"./plane":247,"./quaternion":248,"./ray2":249,"./utility":250,"./vec2":251,"./vec3":252,"./vec4":253}],245:[function(t,i,s){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)};var n=cc.math.Matrix3.prototype;n.fill=function(t){var i=this.mat,s=t.mat;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this},n.adjugate=function(){var t=this.mat,i=t[0],s=t[1],n=t[2],h=t[3],r=t[4],e=t[5],c=t[6],o=t[7],u=t[8];return t[0]=r*u-e*o,t[1]=n*o-s*u,t[2]=s*e-n*r,t[3]=e*c-h*u,t[4]=i*u-n*c,t[5]=n*h-i*e,t[6]=h*o-r*c,t[8]=i*r-s*h,this},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var h=new cc.math.Matrix3;n.inverse=function(t){if(0===t)return this;h.assignFrom(this);var i=1/t;return this.adjugate(),this.multiplyScalar(i),this},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},n.transpose=function(){var t=this.mat,i=t[1],s=t[2],n=t[3],h=t[5],r=t[6],e=t[7];return t[1]=n,t[2]=r,t[3]=i,t[5]=e,t[6]=s,t[7]=h,this},n.determinant=function(){var t=this.mat,i=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return i-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},n.multiply=function(t){var i=this.mat,s=t.mat,n=i[0],h=i[1],r=i[2],e=i[3],c=i[4],o=i[5],u=i[6],a=i[7],f=i[8],l=s[0],v=s[1],d=s[2],p=s[3],g=s[4],m=s[5],w=s[6],_=s[7],C=s[8];return i[0]=n*l+e*v+u*d,i[1]=h*l+c*v+a*d,i[2]=r*l+o*v+f*d,i[3]=r*l+o*v+f*d,i[4]=h*p+c*g+a*m,i[5]=r*p+o*g+f*m,i[6]=n*w+e*_+u*C,i[7]=h*w+c*_+a*C,i[8]=r*w+o*_+f*C,this},n.multiplyScalar=function(t){var i=this.mat;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,i){var s=Math.cos(i),n=Math.sin(i),h=new cc.math.Matrix3,r=h.mat;return r[0]=s+t.x*t.x*(1-s),r[1]=t.z*n+t.y*t.x*(1-s),r[2]=-t.y*n+t.z*t.x*(1-s),r[3]=-t.z*n+t.x*t.y*(1-s),r[4]=s+t.y*t.y*(1-s),r[5]=t.x*n+t.z*t.y*(1-s),r[6]=t.y*n+t.x*t.z*(1-s),r[7]=-t.x*n+t.y*t.z*(1-s),r[8]=s+t.z*t.z*(1-s),h},n.assignFrom=function(t){if(this===t)return cc.logID(7900),this;var i=this.mat,s=t.mat;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this},n.equals=function(t){if(this===t)return!0;for(var i=cc.math.EPSILON,s=this.mat,n=t.mat,h=0;h<9;++h)if(!(s[h]+i>n[h]&&s[h]-i<n[h]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var i=new cc.math.Matrix3,s=i.mat;return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=Math.cos(t),s[5]=Math.sin(t),s[6]=0,s[7]=-Math.sin(t),s[8]=Math.cos(t),i},cc.math.Matrix3.createByRotationY=function(t){var i=new cc.math.Matrix3,s=i.mat;return s[0]=Math.cos(t),s[1]=0,s[2]=-Math.sin(t),s[3]=0,s[4]=1,s[5]=0,s[6]=Math.sin(t),s[7]=0,s[8]=Math.cos(t),i},cc.math.Matrix3.createByRotationZ=function(t){var i=new cc.math.Matrix3,s=i.mat;return s[0]=Math.cos(t),s[1]=-Math.sin(t),s[2]=0,s[3]=Math.sin(t),s[4]=Math.cos(t),s[5]=0,s[6]=0,s[7]=0,s[8]=1,i},cc.math.Matrix3.createByRotation=function(t){var i=new cc.math.Matrix3,s=i.mat;return s[0]=Math.cos(t),s[1]=Math.sin(t),s[2]=0,s[3]=-Math.sin(t),s[4]=Math.cos(t),s[5]=0,s[6]=0,s[7]=0,s[8]=1,i},cc.math.Matrix3.createByScale=function(t,i){var s=new cc.math.Matrix3;return s.identity(),s.mat[0]=t,s.mat[4]=i,s},cc.math.Matrix3.createByTranslation=function(t,i){var s=new cc.math.Matrix3;return s.identity(),s.mat[6]=t,s.mat[7]=i,s},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var i=new cc.math.Matrix3,s=i.mat;return s[0]=1-2*(t.y*t.y+t.z*t.z),s[1]=2*(t.x*t.y-t.w*t.z),s[2]=2*(t.x*t.z+t.w*t.y),s[3]=2*(t.x*t.y+t.w*t.z),s[4]=1-2*(t.x*t.x+t.z*t.z),s[5]=2*(t.y*t.z-t.w*t.x),s[6]=2*(t.x*t.z-t.w*t.y),s[7]=2*(t.y*t.z+t.w*t.x),s[8]=1-2*(t.x*t.x+t.y*t.y),i},n.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],246:[function(t,i,s){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var n=cc.math.Matrix4.prototype;n.fill=function(t){for(var i=this.mat,s=0;s<16;s++)i[s]=t[s];return this},cc.math.mat4Identity=function(t){var i=t.mat;return i[1]=i[2]=i[3]=i[4]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[5]=i[10]=i[15]=1,t},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},n.get=function(t,i){return this.mat[t+4*i]},n.set=function(t,i,s){this.mat[t+4*i]=s},n.swap=function(t,i,s,n){var h=this.mat,r=h[t+4*i];h[t+4*i]=h[s+4*n],h[s+4*n]=r},cc.math.Matrix4._gaussj=function(t,i){var s,n,h,r,e,c,o,u,a,f=0,l=0,v=[0,0,0,0],d=[0,0,0,0],p=[0,0,0,0];for(s=0;s<4;s++){for(o=0,n=0;n<4;n++)if(1!==p[n])for(h=0;h<4;h++)0===p[h]&&(c=Math.abs(t.get(n,h)))>=o&&(o=c,l=n,f=h);if(++p[f],l!==f){for(r=0;r<4;r++)t.swap(l,r,f,r);for(r=0;r<4;r++)i.swap(l,r,f,r)}if(d[s]=l,v[s]=f,0===t.get(f,f))return!1;for(a=1/t.get(f,f),t.set(f,f,1),r=0;r<4;r++)t.set(f,r,t.get(f,r)*a);for(r=0;r<4;r++)i.set(f,r,i.get(f,r)*a);for(e=0;e<4;e++)if(e!==f){for(u=t.get(e,f),t.set(e,f,0),r=0;r<4;r++)t.set(e,r,t.get(e,r)-t.get(f,r)*u);for(r=0;r<4;r++)i.set(e,r,t.get(e,r)-i.get(f,r)*u)}}for(r=3;r>=0;r--)if(d[r]!==v[r])for(h=0;h<4;h++)t.swap(h,d[r],h,v[r]);return!0};var h=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,i){var s=new cc.math.Matrix4(i),n=new cc.math.Matrix4(h);return!1===cc.math.Matrix4._gaussj(s,n)?null:(t.assignFrom(s),t)},n.inverse=function(){var t=new cc.math.Matrix4(this),i=new cc.math.Matrix4(h);return!1===cc.math.Matrix4._gaussj(t,i)?null:t},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},n.transpose=function(){var t=this.mat,i=t[1],s=t[2],n=t[3],h=t[4],r=t[6],e=t[7],c=t[8],o=t[9],u=t[11],a=t[12],f=t[13],l=t[14];return t[1]=h,t[2]=c,t[3]=a,t[4]=i,t[6]=o,t[7]=f,t[8]=s,t[9]=r,t[11]=l,t[12]=n,t[13]=e,t[14]=u,this},cc.math.mat4Multiply=function(t,i,s){var n=t.mat,h=i.mat,r=s.mat,e=h[0],c=h[1],o=h[2],u=h[3],a=h[4],f=h[5],l=h[6],v=h[7],d=h[8],p=h[9],g=h[10],m=h[11],w=h[12],_=h[13],C=h[14],b=h[15],y=r[0],T=r[1],S=r[2],A=r[3],M=r[4],x=r[5],E=r[6],O=r[7],P=r[8],R=r[9],I=r[10],L=r[11],D=r[12],F=r[13],N=r[14],k=r[15];return n[0]=y*e+T*a+S*d+A*w,n[1]=y*c+T*f+S*p+A*_,n[2]=y*o+T*l+S*g+A*C,n[3]=y*u+T*v+S*m+A*b,n[4]=M*e+x*a+E*d+O*w,n[5]=M*c+x*f+E*p+O*_,n[6]=M*o+x*l+E*g+O*C,n[7]=M*u+x*v+E*m+O*b,n[8]=P*e+R*a+I*d+L*w,n[9]=P*c+R*f+I*p+L*_,n[10]=P*o+R*l+I*g+L*C,n[11]=P*u+R*v+I*m+L*b,n[12]=D*e+F*a+N*d+k*w,n[13]=D*c+F*f+N*p+k*_,n[14]=D*o+F*l+N*g+k*C,n[15]=D*u+F*v+N*m+k*b,t},n.multiply=function(t){var i=this.mat,s=t.mat,n=i[0],h=i[1],r=i[2],e=i[3],c=i[4],o=i[5],u=i[6],a=i[7],f=i[8],l=i[9],v=i[10],d=i[11],p=i[12],g=i[13],m=i[14],w=i[15],_=s[0],C=s[1],b=s[2],y=s[3],T=s[4],S=s[5],A=s[6],M=s[7],x=s[8],E=s[9],O=s[10],P=s[11],R=s[12],I=s[13],L=s[14],D=s[15];return i[0]=_*n+C*c+b*f+y*p,i[1]=_*h+C*o+b*l+y*g,i[2]=_*r+C*u+b*v+y*m,i[3]=_*e+C*a+b*d+y*w,i[4]=T*n+S*c+A*f+M*p,i[5]=T*h+S*o+A*l+M*g,i[6]=T*r+S*u+A*v+M*m,i[7]=T*e+S*a+A*d+M*w,i[8]=x*n+E*c+O*f+P*p,i[9]=x*h+E*o+O*l+P*g,i[10]=x*r+E*u+O*v+P*m,i[11]=x*e+E*a+O*d+P*w,i[12]=R*n+I*c+L*f+D*p,i[13]=R*h+I*o+L*l+D*g,i[14]=R*r+I*u+L*v+D*m,i[15]=R*e+I*a+L*d+D*w,this},cc.math.getMat4MultiplyValue=function(t,i){var s=t.mat,n=i.mat,h=new Float32Array(16);return h[0]=s[0]*n[0]+s[4]*n[1]+s[8]*n[2]+s[12]*n[3],h[1]=s[1]*n[0]+s[5]*n[1]+s[9]*n[2]+s[13]*n[3],h[2]=s[2]*n[0]+s[6]*n[1]+s[10]*n[2]+s[14]*n[3],h[3]=s[3]*n[0]+s[7]*n[1]+s[11]*n[2]+s[15]*n[3],h[4]=s[0]*n[4]+s[4]*n[5]+s[8]*n[6]+s[12]*n[7],h[5]=s[1]*n[4]+s[5]*n[5]+s[9]*n[6]+s[13]*n[7],h[6]=s[2]*n[4]+s[6]*n[5]+s[10]*n[6]+s[14]*n[7],h[7]=s[3]*n[4]+s[7]*n[5]+s[11]*n[6]+s[15]*n[7],h[8]=s[0]*n[8]+s[4]*n[9]+s[8]*n[10]+s[12]*n[11],h[9]=s[1]*n[8]+s[5]*n[9]+s[9]*n[10]+s[13]*n[11],h[10]=s[2]*n[8]+s[6]*n[9]+s[10]*n[10]+s[14]*n[11],h[11]=s[3]*n[8]+s[7]*n[9]+s[11]*n[10]+s[15]*n[11],h[12]=s[0]*n[12]+s[4]*n[13]+s[8]*n[14]+s[12]*n[15],h[13]=s[1]*n[12]+s[5]*n[13]+s[9]*n[14]+s[13]*n[15],h[14]=s[2]*n[12]+s[6]*n[13]+s[10]*n[14]+s[14]*n[15],h[15]=s[3]*n[12]+s[7]*n[13]+s[11]*n[14]+s[15]*n[15],h},cc.math.mat4Assign=function(t,i){if(t===i)return cc.logID(7901),t;var s=t.mat,n=i.mat;return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],t},n.assignFrom=function(t){if(this===t)return cc.logID(7902),this;var i=this.mat,s=t.mat;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this},n.equals=function(t){if(this===t)return cc.logID(7903),!0;for(var i=this.mat,s=t.mat,n=cc.math.EPSILON,h=0;h<16;h++)if(!(i[h]+n>s[h]&&i[h]-n<s[h]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,i){var s=(i=i||new cc.math.Matrix4).mat;return s[0]=1,s[3]=s[2]=s[1]=0,s[4]=0,s[5]=Math.cos(t),s[6]=Math.sin(t),s[7]=0,s[8]=0,s[9]=-Math.sin(t),s[10]=Math.cos(t),s[11]=0,s[14]=s[13]=s[12]=0,s[15]=1,i},cc.math.Matrix4.createByRotationY=function(t,i){var s=(i=i||new cc.math.Matrix4).mat;return s[0]=Math.cos(t),s[1]=0,s[2]=-Math.sin(t),s[3]=0,s[7]=s[6]=s[4]=0,s[5]=1,s[8]=Math.sin(t),s[9]=0,s[10]=Math.cos(t),s[11]=0,s[14]=s[13]=s[12]=0,s[15]=1,i},cc.math.Matrix4.createByRotationZ=function(t,i){var s=(i=i||new cc.math.Matrix4).mat;return s[0]=Math.cos(t),s[1]=Math.sin(t),s[3]=s[2]=0,s[4]=-Math.sin(t),s[5]=Math.cos(t),s[7]=s[6]=0,s[11]=s[9]=s[8]=0,s[10]=1,s[14]=s[13]=s[12]=0,s[15]=1,i},cc.math.Matrix4.createByPitchYawRoll=function(t,i,s,n){n=n||new cc.math.Matrix4;var h=Math.cos(t),r=Math.sin(t),e=Math.cos(i),c=Math.sin(i),o=Math.cos(s),u=Math.sin(s),a=r*c,f=h*c,l=n.mat;return l[0]=e*o,l[4]=e*u,l[8]=-c,l[1]=a*o-h*u,l[5]=a*u+h*o,l[9]=r*e,l[2]=f*o+r*u,l[6]=f*u-r*o,l[10]=h*e,l[3]=l[7]=l[11]=0,l[15]=1,n},cc.math.Matrix4.createByQuaternion=function(t,i){var s=(i=i||new cc.math.Matrix4).mat;return s[0]=1-2*(t.y*t.y+t.z*t.z),s[1]=2*(t.x*t.y+t.z*t.w),s[2]=2*(t.x*t.z-t.y*t.w),s[3]=0,s[4]=2*(t.x*t.y-t.z*t.w),s[5]=1-2*(t.x*t.x+t.z*t.z),s[6]=2*(t.z*t.y+t.x*t.w),s[7]=0,s[8]=2*(t.x*t.z+t.y*t.w),s[9]=2*(t.y*t.z-t.x*t.w),s[10]=1-2*(t.x*t.x+t.y*t.y),s[11]=0,s[14]=s[13]=s[12]=0,s[15]=1,i},cc.math.Matrix4.createByRotationTranslation=function(t,i,s){var n=(s=s||new cc.math.Matrix4).mat,h=t.mat;return n[0]=h[0],n[1]=h[1],n[2]=h[2],n[3]=0,n[4]=h[3],n[5]=h[4],n[6]=h[5],n[7]=0,n[8]=h[6],n[9]=h[7],n[10]=h[8],n[11]=0,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=1,s},cc.math.Matrix4.createByScale=function(t,i,s,n){var h=(n=n||new cc.math.Matrix4).mat;return h[0]=t,h[5]=i,h[10]=s,h[15]=1,h[1]=h[2]=h[3]=h[4]=h[6]=h[7]=h[8]=h[9]=h[11]=h[12]=h[13]=h[14]=0,n},cc.math.mat4Translation=function(t,i,s,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=i,t.mat[13]=s,t.mat[14]=n,t},cc.math.Matrix4.createByTranslation=function(t,i,s,n){return(n=n||new cc.math.Matrix4).identity(),n.mat[12]=t,n.mat[13]=i,n.mat[14]=s,n},n.getUpVec3=function(){var t=this.mat;return new cc.math.Vec3(t[4],t[5],t[6]).normalize()},n.getRightVec3=function(){var t=this.mat;return new cc.math.Vec3(t[0],t[1],t[2]).normalize()},n.getForwardVec3=function(){var t=this.mat;return new cc.math.Vec3(t[8],t[9],t[10]).normalize()},cc.math.mat4PerspectiveProjection=function(t,i,s,n,h){var r=cc.degreesToRadians(i/2),e=h-n,c=Math.sin(r);if(0===e||0===c||0===s)return null;var o=Math.cos(r)/c;return t.identity(),t.mat[0]=o/s,t.mat[5]=o,t.mat[10]=-(h+n)/e,t.mat[11]=-1,t.mat[14]=-2*n*h/e,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,i,s,n){var h=cc.degreesToRadians(t/2),r=n-s,e=Math.sin(h);if(0===r||0===e||0===i)return null;var c=Math.cos(h)/e,o=new cc.math.Matrix4,u=o.mat;return o.identity(),u[0]=c/i,u[5]=c,u[10]=-(n+s)/r,u[11]=-1,u[14]=-2*s*n/r,u[15]=0,o},cc.math.mat4OrthographicProjection=function(t,i,s,n,h,r,e){return t.identity(),t.mat[0]=2/(s-i),t.mat[5]=2/(h-n),t.mat[10]=-2/(e-r),t.mat[12]=-(s+i)/(s-i),t.mat[13]=-(h+n)/(h-n),t.mat[14]=-(e+r)/(e-r),t},cc.math.Matrix4.createOrthographicProjection=function(t,i,s,n,h,r){var e=new cc.math.Matrix4,c=e.mat;return e.identity(),c[0]=2/(i-t),c[5]=2/(n-s),c[10]=-2/(r-h),c[12]=-(i+t)/(i-t),c[13]=-(n+s)/(n-s),c[14]=-(r+h)/(r-h),e},cc.math.mat4LookAt=function(t,i,s,n){var h=new cc.math.Vec3(s),r=new cc.math.Vec3(n);h.subtract(i),h.normalize(),r.normalize();var e=new cc.math.Vec3(h);e.cross(r),e.normalize();var c=new cc.math.Vec3(e);c.cross(h),e.normalize(),t.identity(),t.mat[0]=e.x,t.mat[4]=e.y,t.mat[8]=e.z,t.mat[1]=c.x,t.mat[5]=c.y,t.mat[9]=c.z,t.mat[2]=-h.x,t.mat[6]=-h.y,t.mat[10]=-h.z;var o=cc.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z);return t.multiply(o),t};var r=new cc.math.Matrix4;n.lookAt=function(t,i,s){var n=new cc.math.Vec3(i),h=new cc.math.Vec3(s),e=this.mat;n.subtract(t),n.normalize(),h.normalize();var c=new cc.math.Vec3(n);c.cross(h),c.normalize();var o=new cc.math.Vec3(c);return o.cross(n),c.normalize(),this.identity(),e[0]=c.x,e[4]=c.y,e[8]=c.z,e[1]=o.x,e[5]=o.y,e[9]=o.z,e[2]=-n.x,e[6]=-n.y,e[10]=-n.z,r=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,r),this.multiply(r),this},cc.math.mat4RotationAxisAngle=function(t,i,s){var n=Math.cos(s),h=Math.sin(s),r=new cc.math.Vec3(i);return r.normalize(),t.mat[0]=n+r.x*r.x*(1-n),t.mat[1]=r.z*h+r.y*r.x*(1-n),t.mat[2]=-r.y*h+r.z*r.x*(1-n),t.mat[3]=0,t.mat[4]=-r.z*h+r.x*r.y*(1-n),t.mat[5]=n+r.y*r.y*(1-n),t.mat[6]=r.x*h+r.z*r.y*(1-n),t.mat[7]=0,t.mat[8]=r.y*h+r.x*r.z*(1-n),t.mat[9]=-r.x*h+r.y*r.z*(1-n),t.mat[10]=n+r.z*r.z*(1-n),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,i,s){s=s||new cc.math.Matrix4;var n=this.mat,h=Math.cos(i),r=Math.sin(i),e=new cc.math.Vec3(t);return e.normalize(),n[0]=h+e.x*e.x*(1-h),n[1]=e.z*r+e.y*e.x*(1-h),n[2]=-e.y*r+e.z*e.x*(1-h),n[3]=0,n[4]=-e.z*r+e.x*e.y*(1-h),n[5]=h+e.y*e.y*(1-h),n[6]=e.x*r+e.z*e.y*(1-h),n[7]=0,n[8]=e.y*r+e.x*e.z*(1-h),n[9]=-e.x*r+e.y*e.z*(1-h),n[10]=h+e.z*e.z*(1-h),n[11]=0,n[12]=n[13]=n[14]=0,n[15]=1,s},n.extractRotation=function(){var t=new cc.math.Matrix3,i=this.mat,s=t.mat;return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],t},n.extractPlane=function(t){var i=new cc.math.Plane,s=this.mat;switch(t){case cc.math.Plane.RIGHT:i.a=s[3]-s[0],i.b=s[7]-s[4],i.c=s[11]-s[8],i.d=s[15]-s[12];break;case cc.math.Plane.LEFT:i.a=s[3]+s[0],i.b=s[7]+s[4],i.c=s[11]+s[8],i.d=s[15]+s[12];break;case cc.math.Plane.BOTTOM:i.a=s[3]+s[1],i.b=s[7]+s[5],i.c=s[11]+s[9],i.d=s[15]+s[13];break;case cc.math.Plane.TOP:i.a=s[3]-s[1],i.b=s[7]-s[5],i.c=s[11]-s[9],i.d=s[15]-s[13];break;case cc.math.Plane.FAR:i.a=s[3]-s[2],i.b=s[7]-s[6],i.c=s[11]-s[10],i.d=s[15]-s[14];break;case cc.math.Plane.NEAR:i.a=s[3]+s[2],i.b=s[7]+s[6],i.c=s[11]+s[10],i.d=s[15]+s[14];break;default:cc.logID(7904)}var n=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c);return i.a/=n,i.b/=n,i.c/=n,i.d/=n,i},n.toAxisAndAngle=function(){var t=this.extractRotation();return cc.math.Quaternion.rotationMatrix(t).toAxisAndAngle()}},{}],247:[function(t,i,s){cc.math.Plane=function(t,i,s,n){t&&void 0===i?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=i||0,this.c=s||0,this.d=n||0)};var n=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,n.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},n.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},n.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,i){return new cc.math.Plane(i.x,i.y,i.z,-i.dot(t))},cc.math.Plane.fromPoints=function(t,i,s){var n=new cc.math.Vec3(i),h=new cc.math.Vec3(s),r=new cc.math.Plane;return n.subtract(t),h.subtract(t),n.cross(h),n.normalize(),r.a=n.x,r.b=n.y,r.c=n.z,r.d=n.scale(-1).dot(t),r},n.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),i=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*i,this},n.classifyPoint=function(t){var i=this.a*t.x+this.b*t.y+this.c*t.z+this.d;return i>.001?cc.math.Plane.POINT_INFRONT_OF_PLANE:i<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}},{}],248:[function(t,i,s){cc.math.Quaternion=function(t,i,s,n){t&&void 0===i?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=s||0,this.w=n||0)};var n=cc.math.Quaternion.prototype;n.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},n.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.exponential=function(){return this},n.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},n.inverse=function(){var t=this.length();return Math.abs(t)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/t),this)},n.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},n.length=function(){return Math.sqrt(this.lengthSq())},n.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.multiply=function(t){var i=this.x,s=this.y,n=this.z,h=this.w;return this.w=h*t.w-i*t.x-s*t.y-n*t.z,this.x=h*t.x+i*t.w+s*t.z-n*t.y,this.y=h*t.y+s*t.w+n*t.x-i*t.z,this.z=h*t.z+n*t.w+i*t.y-s*t.x,this},n.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},n.rotationAxis=function(t,i){var s=.5*i,n=Math.sin(s);return this.w=Math.cos(s),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var i,s,n,h,r=[],e=t.mat,c=0;r[0]=e[0],r[1]=e[3],r[2]=e[6],r[4]=e[1],r[5]=e[4],r[6]=e[7],r[8]=e[2],r[9]=e[5],r[10]=e[8],r[15]=1;var o=r[0],u=o[0]+o[5]+o[10]+1;return u>cc.math.EPSILON?(c=2*Math.sqrt(u),i=(o[9]-o[6])/c,s=(o[2]-o[8])/c,n=(o[4]-o[1])/c,h=.25*c):o[0]>o[5]&&o[0]>o[10]?(i=.25*(c=2*Math.sqrt(1+o[0]-o[5]-o[10])),s=(o[4]+o[1])/c,n=(o[2]+o[8])/c,h=(o[9]-o[6])/c):o[5]>o[10]?(c=2*Math.sqrt(1+o[5]-o[0]-o[10]),i=(o[4]+o[1])/c,s=.25*c,n=(o[9]+o[6])/c,h=(o[2]-o[8])/c):(c=2*Math.sqrt(1+o[10]-o[0]-o[5]),i=(o[2]+o[8])/c,s=(o[9]+o[6])/c,n=.25*c,h=(o[4]-o[1])/c),new cc.math.Quaternion(i,s,n,h)},cc.math.Quaternion.rotationYawPitchRoll=function(t,i,s){var n,h,r,e,c,o,u,a,f,l,v;n=cc.degreesToRadians(i)/2,h=cc.degreesToRadians(t)/2,r=cc.degreesToRadians(s)/2,e=Math.cos(n),c=Math.cos(h),o=Math.cos(r),u=Math.sin(n),l=c*o,v=(a=Math.sin(h))*(f=Math.sin(r));var d=new cc.math.Quaternion;return d.w=e*l+u*v,d.x=u*l-e*v,d.y=e*a*o+u*c*f,d.z=e*c*f-u*a*o,d.normalize(),d},n.slerp=function(t,i){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var s=this.dot(t),n=Math.acos(s),h=Math.sqrt(1-cc.math.square(s)),r=Math.sin(i*n)/h,e=Math.sin((1-i)*n)/h,c=new cc.math.Quaternion(t);return this.scale(e),c.scale(r),this.add(c),this},n.toAxisAndAngle=function(){var t,i,s,n=new cc.math.Vec3;return t=Math.acos(this.w),(i=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)))>-cc.math.EPSILON&&i<cc.math.EPSILON||i<2*Math.PI+cc.math.EPSILON&&i>2*Math.PI-cc.math.EPSILON?(s=0,n.x=0,n.y=0,n.z=1):(s=2*t,n.x=this.x/i,n.y=this.y/i,n.z=this.z/i,n.normalize()),{axis:n,angle:s}},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,i,s){var n=new cc.math.Vec3(t),h=new cc.math.Vec3(i);n.normalize(),h.normalize();var r=n.dot(h),e=new cc.math.Quaternion;if(r>=1)return e.identity(),e;if(r<1e-6-1)if(Math.abs(s.lengthSq())<cc.math.EPSILON)e.rotationAxis(s,Math.PI);else{var c=new cc.math.Vec3(1,0,0);c.cross(t),Math.abs(c.lengthSq())<cc.math.EPSILON&&(c.fill(0,1,0),c.cross(t)),c.normalize(),e.rotationAxis(c,Math.PI)}else{var o=Math.sqrt(2*(1+r)),u=1/o;n.cross(h),e.x=n.x*u,e.y=n.y*u,e.z=n.z*u,e.w=.5*o,e.normalize()}return e},n.multiplyVec3=function(t){var i=this.x,s=this.y,n=this.z,h=new cc.math.Vec3(t),r=new cc.math.Vec3(i,s,n),e=new cc.math.Vec3(i,s,n);return r.cross(t),e.cross(r),r.scale(2*q.w),e.scale(2),h.add(r),h.add(e),h}},{}],249:[function(t,i,s){function n(t,i,s){var n=new cc.math.Vec2(i);n.subtract(t),s.x=-n.y,s.y=n.x,s.normalize()}cc.math.Ray2=function(t,i){this.start=t||new cc.math.Vec2,this.dir=i||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,i,s,n){this.start.x=t,this.start.y=i,this.dir.x=s,this.dir.y=n},cc.math.Ray2.prototype.intersectLineSegment=function(t,i,s){var n,h,r,e=this.start.x,c=this.start.y,o=this.start.x+this.dir.x,u=this.start.y+this.dir.y,a=t.x,f=t.y,l=i.x,v=i.y,d=(v-f)*(o-e)-(l-a)*(u-c);return!(d>-cc.math.EPSILON&&d<cc.math.EPSILON||(n=((l-a)*(c-f)-(v-f)*(e-a))/d,h=e+n*(o-e),r=c+n*(u-c),h<Math.min(t.x,i.x)-cc.math.EPSILON||h>Math.max(t.x,i.x)+cc.math.EPSILON||r<Math.min(t.y,i.y)-cc.math.EPSILON||r>Math.max(t.y,i.y)+cc.math.EPSILON||h<Math.min(e,o)-cc.math.EPSILON||h>Math.max(e,o)+cc.math.EPSILON||r<Math.min(c,u)-cc.math.EPSILON||r>Math.max(c,u)+cc.math.EPSILON||(s.x=h,s.y=r,0)))},cc.math.Ray2.prototype.intersectTriangle=function(t,i,s,h,r){var e,c=new cc.math.Vec2,o=new cc.math.Vec2,u=new cc.math.Vec2,a=1e4,f=!1;return this.intersectLineSegment(t,i,c)&&(f=!0,(e=c.subtract(this.start).length())<a&&(o.x=c.x,o.y=c.y,a=e,n(t,i,u))),this.intersectLineSegment(i,s,c)&&(f=!0,(e=c.subtract(this.start).length())<a&&(o.x=c.x,o.y=c.y,a=e,n(i,s,u))),this.intersectLineSegment(s,t,c)&&(f=!0,(e=c.subtract(this.start).length())<a&&(o.x=c.x,o.y=c.y,a=e,n(s,t,u))),f&&(h.x=o.x,h.y=o.y,r&&(r.x=u.x,r.y=u.y)),f}},{}],250:[function(t,i,s){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,i){return t+cc.math.EPSILON>i&&t-cc.math.EPSILON<i}},{}],251:[function(t,i,s){cc.math.Vec2=function(t,i){void 0===i?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=i||0)};var n=cc.math.Vec2.prototype;n.fill=function(t,i){this.x=t,this.y=i},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,i,s){return t.x=i.x+s.x,t.y=i.y+s.y,t},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,i,s){return t.x=i.x-s.x,t.y=i.y-s.y,t},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.transform=function(t){var i=this.x,s=this.y;return this.x=i*t.mat[0]+s*t.mat[3]+t.mat[6],this.y=i*t.mat[1]+s*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,i,s){return t.x=i.x*s,t.y=i.y*s,t},n.scale=function(t){return this.x*=t,this.y*=t,this},n.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}},{}],252:[function(t,i,s){cc.math.Vec3=cc.math.Vec3=function(t,i,s){t&&void 0===i?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=i||0,this.z=s||0)},cc.math.vec3=function(t,i,s){return new cc.math.Vec3(t,i,s)};var n=cc.math.Vec3.prototype;n.fill=function(t,i,s){return t&&void 0===i?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=i,this.z=s),this},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},n.cross=function(t){var i=this.x,s=this.y,n=this.z;return this.x=s*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-s*t.x,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.transform=function(t){var i=this.x,s=this.y,n=this.z,h=t.mat;return this.x=i*h[0]+s*h[4]+n*h[8]+h[12],this.y=i*h[1]+s*h[5]+n*h[9]+h[13],this.z=i*h[2]+s*h[6]+n*h[10]+h[14],this},n.transformNormal=function(t){var i=this.x,s=this.y,n=this.z,h=t.mat;return this.x=i*h[0]+s*h[4]+n*h[8],this.y=i*h[1]+s*h[5]+n*h[9],this.z=i*h[2]+s*h[6]+n*h[10],this},n.transformCoord=function(t){var i=new cc.math.Vec4(this.x,this.y,this.z,1);return i.transform(t),this.x=i.x/i.w,this.y=i.y/i.w,this.z=i.z/i.w,this},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.equals=function(t){var i=cc.math.EPSILON;return this.x<t.x+i&&this.x>t.x-i&&this.y<t.y+i&&this.y>t.y-i&&this.z<t.z+i&&this.z>t.z-i},n.inverseTransform=function(t){var i=t.mat,s=new cc.math.Vec3(this.x-i[12],this.y-i[13],this.z-i[14]);return this.x=s.x*i[0]+s.y*i[1]+s.z*i[2],this.y=s.x*i[4]+s.y*i[5]+s.z*i[6],this.z=s.x*i[8]+s.y*i[9]+s.z*i[10],this},n.inverseTransformNormal=function(t){var i=this.x,s=this.y,n=this.z,h=t.mat;return this.x=i*h[0]+s*h[1]+n*h[2],this.y=i*h[4]+s*h[5]+n*h[6],this.z=i*h[8]+s*h[9]+n*h[10],this},n.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},n.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}},{}],253:[function(t,i,s){cc.math.Vec4=function(t,i,s,n){t&&void 0===i?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=s||0,this.w=n||0)};var n=cc.math.Vec4.prototype;n.fill=function(t,i,s,n){t&&void 0===i?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=i,this.z=s,this.w=n)},n.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},n.lerp=function(t,i){return this},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},n.transform=function(t){var i=this.x,s=this.y,n=this.z,h=this.w,r=t.mat;return this.x=i*r[0]+s*r[4]+n*r[8]+h*r[12],this.y=i*r[1]+s*r[5]+n*r[9]+h*r[13],this.z=i*r[2]+s*r[6]+n*r[10]+h*r[14],this.w=i*r[3]+s*r[7]+n*r[11]+h*r[15],this},cc.math.Vec4.transformArray=function(t,i){for(var s=[],n=0;n<t.length;n++){var h=new cc.math.Vec4(t[n]);h.transform(i),s.push(h)}return s},n.equals=function(t){var i=cc.math.EPSILON;return this.x<t.x+i&&this.x>t.x-i&&this.y<t.y+i&&this.y>t.y-i&&this.z<t.z+i&&this.z>t.z-i&&this.w<t.w+i&&this.w>t.w-i},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}},{}],254:[function(t,i,s){t("./CCSGMotionStreak"),t("./CCSGMotionStreakWebGLRenderCmd");var n=cc.T({name:"cc.MotionStreak",S:cc.U,editor:!1,ctor:function(){this._root=null,this._motionStreak=null},O:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this._motionStreak&&this._motionStreak.setFadeTime(t)},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t,this._motionStreak&&this._motionStreak.setMinSeg(t)},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t,this._motionStreak&&this._motionStreak.setStroke(t)},animatable:!1,tooltip:!1},_texture:{default:"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._motionStreak&&(t&&cc.js.isString(t)&&(t=cc.textureCache.addImage(t)),this._motionStreak.setTexture(t))},url:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(t){this._color=t,this._motionStreak&&this._motionStreak.tintWithColor(t)},tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t,this._motionStreak&&this._motionStreak.setFastMode(t)},animatable:!1,tooltip:!1}},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._motionStreak.reset()},__preload:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){this._root=new _ccsg.Node;var t=new _ccsg.MotionStreak;t.initWithFade(this._fadeTime,this._minSeg,this._stroke,this.node.color,this._texture||null),t.setFastMode(this._fastMode),this._root.addChild(t);var i=this.node._sgNode;i&&i.addChild(this._root,-10),this._motionStreak=t}else cc.warnID(5900)},onEnable:function(){this.node.on("position-changed",this._onNodePositionChanged,this)},onDisable:function(){this.node.off("position-changed",this._onNodePositionChanged,this)},_onNodePositionChanged:function(){if(this._motionStreak){var t=this.node,i=t.getNodeToWorldTransform(),s=i.tx-(t.width/2+t.anchorX*t.width),n=i.ty-(t.height/2+t.anchorY*t.height);this._root.setPosition(-s,-n),this._motionStreak.setPosition(s,n)}}});cc.MotionStreak=i.exports=n},{"./CCSGMotionStreak":255,"./CCSGMotionStreakWebGLRenderCmd":256}],255:[function(t,i,s){function n(t,i,s,n,h){if(!((h+=n)<=1)){i*=.5;for(var r,e=h-1,c=n;c<h;c++){r=2*c;var o,u=cc.p(t[2*c],t[2*c+1]);if(0===c)o=cc.pPerp(cc.pNormalize(cc.pSub(u,cc.p(t[2*(c+1)],t[2*(c+1)+1]))));else if(c===e)o=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[2*(c-1)],t[2*(c-1)+1]),u)));else{var a=cc.p(t[2*(c-1)],t[2*(c-1)+1]),f=cc.p(t[2*(c+1)],t[2*(c+1)+1]),l=cc.pNormalize(cc.pSub(f,u)),v=cc.pNormalize(cc.pSub(a,u)),d=Math.acos(cc.pDot(l,v));o=d<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(l,v))):d<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(l,v)):cc.pPerp(cc.pNormalize(cc.pSub(f,a)))}o=cc.pMult(o,i),s[2*r]=u.x+o.x,s[2*r+1]=u.y+o.y,s[2*(r+1)]=u.x-o.x,s[2*(r+1)+1]=u.y-o.y}for(c=n=0===n?0:n-1;c<e;c++){var p=2+(r=2*c),g=cc.v2(s[2*r],s[2*r+1]),m=cc.v2(s[2*(r+1)],s[2*(r+1)+1]),w=cc.v2(s[2*p],s[2*p+1]),_=cc.v2(s[2*(p+1)],s[2*(p+1)+1]),C=function(t,i,s,n,h,r,e,c){var o,u,a,f;return t===s&&i===n||h===e&&r===c?{isSuccess:!1,value:0}:(s-=t,n-=i,h-=t,r-=i,e-=t,c-=i,o=Math.sqrt(s*s+n*n),u=s/o,a=n/o,f=h*u+r*a,r=r*u-h*a,h=f,f=e*u+c*a,c=c*u-e*a,e=f,r===c?{isSuccess:!1,value:0}:{isSuccess:!0,value:(e+(h-e)*c/(c-r))/o})}(g.x,g.y,_.x,_.y,m.x,m.y,w.x,w.y),b=!C.isSuccess;b||(C.value<0||C.value>1)&&(b=!0),b&&(s[2*p]=_.x,s[2*p+1]=_.y,s[2*(p+1)]=w.x,s[2*(p+1)+1]=w.y)}}}_ccsg.MotionStreak=_ccsg.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,i,s,n,h){_ccsg.Node.prototype.ctor.call(this),this._positionR=cc.p(0,0),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.fastMode=!1,this.startingPositionInitialized=!1,this.texture=null,this._stroke=0,this._fadeDelta=0,this._minSeg=0,this._maxPoints=0,this._nuPoints=0,this._previousNuPoints=0,this._pointVertexes=null,this._pointState=null,this._vertices=null,this._colorPointer=null,this._texCoords=null,this._verticesBuffer=null,this._colorPointerBuffer=null,this._texCoordsBuffer=null,void 0!==h&&this.initWithFade(t,i,s,n,h)},initWithFade:function(t,i,s,n,h){return cc.js.isString(h)&&(h=cc.textureCache.addImage(h)),this.anchorX=0,this.anchorY=0,this.ignoreAnchor=!0,this.startingPositionInitialized=!1,this.fastMode=!0,this._stroke=s,this.setMinSeg(i),this.setFadeTime(t),this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.setTexture(h),this.color=n,this.scheduleUpdate(),!0},getTexture:function(){return this.texture},setTexture:function(t){this.texture!==t&&(this.texture=t)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,i){void 0===i?this._blendFunc=t:(this._blendFunc.src=t,this._blendFunc.dst=i)},getOpacity:function(){return cc.logID(5901),0},setOpacity:function(t){cc.logID(5902)},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},getFadeTime:function(){return 1/this._fadeDelta},setFadeTime:function(t){this._fadeDelta=1/t;var i=2+(0|60*t);this._maxPoints=i,this._nuPoints=0,this._pointState=new Float32Array(i),this._pointVertexes=new Float32Array(2*i),this._vertices=new Float32Array(4*i),this._texCoords=new Float32Array(4*i),this._colorPointer=new Uint8Array(8*i),this._verticesBuffer=gl.createBuffer(),this._texCoordsBuffer=gl.createBuffer(),this._colorPointerBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW)},getMinSeg:function(){return this._minSeg},setMinSeg:function(t){this._minSeg=-1===t?this._stroke/5:t,this._minSeg*=this._minSeg},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},tintWithColor:function(t){this.color=t;for(var i=this._colorPointer,s=0,n=2*this._nuPoints;s<n;s++)i[4*s]=t.r,i[4*s+1]=t.g,i[4*s+2]=t.b},reset:function(){this._nuPoints=0},setPosition:function(t,i){this.startingPositionInitialized=!0,void 0===i?(this._positionR.x=t.x,this._positionR.y=t.y):(this._positionR.x=t,this._positionR.y=i)},getPositionX:function(){return this._positionR.x},setPositionX:function(t){this._positionR.x=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},update:function(t){if(this.startingPositionInitialized){t*=this._fadeDelta;var i,s,h,r,e=0,c=this._nuPoints,o=this._pointState,u=this._pointVertexes,a=this._vertices,f=this._colorPointer;for(h=0;h<c;h++)if(o[h]-=t,o[h]<=0)e++;else{i=h-e,e>0?(o[i]=o[h],u[2*i]=u[2*h],u[2*i+1]=u[2*h+1],r=2*h,a[2*(s=2*i)]=a[2*r],a[2*s+1]=a[2*r+1],a[2*(s+1)]=a[2*(r+1)],a[2*(s+1)+1]=a[2*(r+1)+1],r*=4,f[0+(s*=4)]=f[r+0],f[s+1]=f[r+1],f[s+2]=f[r+2],f[s+4]=f[r+4],f[s+5]=f[r+5],f[s+6]=f[r+6]):s=8*i;var l=255*o[i];f[s+3]=l,f[s+7]=l}var v=!0;if((c-=e)>=this._maxPoints)v=!1;else if(c>0){var d=cc.p(u[2*(c-1)],u[2*(c-1)+1]),p=cc.pDistanceSQ(d,this._positionR)<this._minSeg,g=cc.p(u[2*(c-2)],u[2*(c-2)+1]),m=1!==c&&cc.pDistanceSQ(g,this._positionR)<2*this._minSeg;(p||m)&&(v=!1)}if(v){u[2*c]=this._positionR.x,u[2*c+1]=this._positionR.y,o[c]=1;var w=8*c,_=this.getDisplayedColor();f[w]=_.r,f[w+1]=_.g,f[w+2]=_.b,f[w+4]=_.r,f[w+5]=_.g,f[w+6]=_.b,f[w+3]=255,f[w+7]=255,c>0&&this.fastMode&&(c>1?n(u,this._stroke,this._vertices,c,1):n(u,this._stroke,this._vertices,0,2)),c++}if(this.fastMode||n(u,this._stroke,this._vertices,0,c),c&&this._previousNuPoints!==c){var C=1/c,b=this._texCoords;for(h=0;h<c;h++)b[4*h]=0,b[4*h+1]=C*h,b[2*(2*h+1)]=1,b[2*(2*h+1)+1]=C*h;this._previousNuPoints=c}this._nuPoints=c}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new _ccsg.MotionStreak.WebGLRenderCmd(this):null}});var h=_ccsg.MotionStreak.prototype;Object.defineProperty(h,"x",{get:h.getPositionX,set:h.setPositionX}),Object.defineProperty(h,"y",{get:h.getPositionY,set:h.setPositionY})},{}],256:[function(t,i,s){_ccsg.MotionStreak.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR)},_ccsg.MotionStreak.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),_ccsg.MotionStreak.WebGLRenderCmd.prototype.constructor=_ccsg.Sprite.WebGLRenderCmd,_ccsg.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var i=this._node;if(!(i._nuPoints<=1)&&i.texture&&i.texture.isLoaded()){t=t||cc._renderContext,this._updateDisplayColor();var s=this._worldTransform,n=this._matrix.mat;n[0]=s.a,n[4]=s.c,n[12]=s.tx,n[1]=s.b,n[5]=s.d,n[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),cc.gl.bindTexture2DN(0,i.texture),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,i._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,i._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i._texCoordsBuffer),t.bufferData(t.ARRAY_BUFFER,i._texCoords,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i._colorPointerBuffer),t.bufferData(t.ARRAY_BUFFER,i._colorPointer,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,2*i._nuPoints),cc.g_NumberOfDraws++}}},{}],257:[function(t,i,s){var n=t("../compression/zlib.min"),h=cc._Class.extend({ctor:function(t){var i,s,n,h,r,e,c,o,u,a,f,l,v,d;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},r=null;;){switch(i=this.readUInt32(),u=function(){var t,i;for(i=[],e=t=0;t<4;e=++t)i.push(String.fromCharCode(this.data[this.pos++]));return i}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(i);break;case"fcTL":r&&this.animation.frames.push(r),this.pos+=4,r={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},h=this.readUInt16(),n=this.readUInt16()||100,r.delay=1e3*h/n,r.disposeOp=this.data[this.pos++],r.blendOp=this.data[this.pos++],r.data=[];break;case"IDAT":case"fdAT":for("fdAT"===u&&(this.pos+=4,i-=4),t=(null!=r?r.data:void 0)||this.imgData,e=l=0;0<=i?l<i:l>i;e=0<=i?++l:--l)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(i),(a=255-this.transparency.indexed.length)>0)for(e=v=0;0<=a?v<a:v>a;e=0<=a?++v:--v)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(i)[0];break;case 2:this.transparency.rgb=this.read(i)}break;case"tEXt":c=(f=this.read(i)).indexOf(0),o=String.fromCharCode.apply(String,f.slice(0,c)),this.text[o]=String.fromCharCode.apply(String,f.slice(c+1));break;case"IEND":return r&&this.animation.frames.push(r),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(d=this.colorType)||6===d,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=i}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var i,s;for(s=[],i=0;0<=t?i<t:i>t;0<=t?++i:--i)s.push(this.data[this.pos++]);return s},readUInt32:function(){var t,i,s,n;return t=this.data[this.pos++]<<24,i=this.data[this.pos++]<<16,s=this.data[this.pos++]<<8,n=this.data[this.pos++],t|i|s|n},readUInt16:function(){var t,i;return t=this.data[this.pos++]<<8,i=this.data[this.pos++],t|i},decodePixels:function(t){var i,s,h,r,e,c,o,u,a,f,l,v,d,p,g,m,w,_,C,b,y,T,S;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);for(t=new n.Inflate(t,{index:0,verify:!1}).decompress(),m=(v=this.pixelBitlength/8)*this.width,d=new Uint8Array(m*this.height),c=t.length,g=0,p=0,s=0;p<c;){switch(t[p++]){case 0:for(r=C=0;C<m;r=C+=1)d[s++]=t[p++];break;case 1:for(r=b=0;b<m;r=b+=1)i=t[p++],e=r<v?0:d[s-v],d[s++]=(i+e)%256;break;case 2:for(r=y=0;y<m;r=y+=1)i=t[p++],h=(r-r%v)/v,w=g&&d[(g-1)*m+h*v+r%v],d[s++]=(w+i)%256;break;case 3:for(r=T=0;T<m;r=T+=1)i=t[p++],h=(r-r%v)/v,e=r<v?0:d[s-v],w=g&&d[(g-1)*m+h*v+r%v],d[s++]=(i+Math.floor((e+w)/2))%256;break;case 4:for(r=S=0;S<m;r=S+=1)i=t[p++],h=(r-r%v)/v,e=r<v?0:d[s-v],0===g?w=_=0:(w=d[(g-1)*m+h*v+r%v],_=h&&d[(g-1)*m+(h-1)*v+r%v]),o=e+w-_,u=Math.abs(o-e),f=Math.abs(o-w),l=Math.abs(o-_),a=u<=f&&u<=l?e:f<=l?w:_,d[s++]=(i+a)%256;break;default:throw new Error("Invalid filter algorithm: "+t[p-1])}g++}return d},copyToImageData:function(t,i){var s,n,h,r,e,c,o,u,a,f,l;if(n=this.colors,a=null,s=this.hasAlphaChannel,this.palette.length&&(a=null!=(l=this._decodedPalette)?l:this._decodedPalette=this.decodePalette(),n=4,s=!0),h=t.data||t,u=h.length,e=a||i,r=c=0,1===n)for(;r<u;)o=a?4*i[r/4]:c,f=e[o++],h[r++]=f,h[r++]=f,h[r++]=f,h[r++]=s?e[o++]:255,c=o;else for(;r<u;)o=a?4*i[r/4]:c,h[r++]=e[o++],h[r++]=e[o++],h[r++]=e[o++],h[r++]=s?e[o++]:255,c=o},decodePalette:function(){var t,i,s,n,h,r,e,c,o;for(s=this.palette,r=this.transparency.indexed||[],h=new Uint8Array((r.length||0)+s.length),n=0,t=0,i=e=0,c=s.length;e<c;i=e+=3)h[n++]=s[i],h[n++]=s[i+1],h[n++]=s[i+2],h[n++]=null!=(o=r[t++])?o:255;return h},render:function(t){var i,s;return t.width=this.width,t.height=this.height,i=t.getContext("2d"),s=i.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),i.putImageData(s,0,0)}});i.exports=h},{"../compression/zlib.min":32}],258:[function(t,i,s){var n=cc.T({name:"cc.ParticleAsset",S:cc.RawAsset});cc.ParticleAsset=i.exports=n},{}],259:[function(t,s,n){cc.ParticleBatchNode=_ccsg.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,i){_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},cc.js.isString(t)?this._(t,i):t instanceof cc.Texture2D&&this.initWithTexture(t,i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ParticleBatchNode.CanvasRenderCmd(this):new cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,i){return this.textureAtlas=new cc.TextureAtlas,this.textureAtlas.initWithTexture(t,i),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,i){var s=cc.textureCache.addImage(t);return this.initWithTexture(s,i)},_:function(t,i){var s=cc.textureCache.addImage(t);return this.initWithTexture(s,i)},visit:function(t){var i=this._renderCmd,s=t?t._renderCmd:null;this._visible?(i.visit(s),cc.renderer.pushRenderCommand(i),i._dirtyFlag=0):i._propagateFlagsDown(s)},addChild:function(t,i,s){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports _ccsg.ParticleSystem as children");if(i=null==i?t.zIndex:i,s=null==s?t.tag:s,t.getTexture()!==this.textureAtlas.texture)throw new Error("_ccsg.ParticleSystem.addChild() : the child is not using the same texture id");var n=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(n);else if(n.src!==this._blendFunc.src||n.dst!==this._blendFunc.dst)return void cc.logID(6002);var h=this._addChildHelper(t,i,s),r=0;if(0!==h){var e=this._children[h-1];r=e.getAtlasIndex()+e.getTotalParticles()}else r=0;this.insertChild(t,r),t.setBatchNode(this)},insertChild:function(t,i){var s=t.getTotalParticles(),n=this.textureAtlas,h=n.totalQuads;t.setAtlasIndex(i),h+s>n.getCapacity()&&(this._increaseAtlasCapacityTo(h+s),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-s,s)),t.getAtlasIndex()+s!==h&&n.moveQuadsFromIndex(i,i+s),n.increaseTotalQuadsWith(s),this._updateAllAtlasIndexes()},removeChild:function(t,i){if(null!=t){if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports _ccsg.ParticleSystem as children");if(-1!==this._children.indexOf(t)){_ccsg.Node.prototype.removeChild.call(this,t,i);var s=this.textureAtlas;s.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),s.fillWithEmptyQuadsFromIndex(s.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}else cc.logID(6003)}},reorderChild:function(t,i){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(-1!==this._children.indexOf(t)){if(i!==t.zIndex){if(this._children.length>1){var s=this._getCurrentIndex(t,i);if(s.oldIndex!==s.newIndex){this._children.splice(s.oldIndex,1),this._children.splice(s.newIndex,0,t);var n=t.getAtlasIndex();this._updateAllAtlasIndexes();for(var h=0,r=this._children,e=0;e<r.length;e++)if(r[e]===t){h=t.getAtlasIndex();break}this.textureAtlas.moveQuadsFromIndex(n,t.getTotalParticles(),h),t.updateWithNoTime()}}t._setLocalZOrder(i)}}else cc.logID(6004)},removeChildAtIndex:function(t,s){this.removeChild(this._children[i],s)},removeAllChildren:function(t){for(var i=this._children,s=0;s<i.length;s++)i[s].setBatchNode(null);_ccsg.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){var i=this.textureAtlas.quads[t];i.br.vertices.x=i.br.vertices.y=i.tr.vertices.x=i.tr.vertices.y=i.tl.vertices.x=i.tl.vertices.y=i.bl.vertices.x=i.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var i=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&i.src===cc.macro.BLEND_SRC&&i.dst===cc.macro.BLEND_DST&&(i.src=cc.macro.SRC_ALPHA,i.dst=cc.macro.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,i){void 0===i?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=i)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,i=this._children,s=0;s<i.length;s++){var n=i[s];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){cc.logID(6006,this.textureAtlas.getCapacity(),t),this.textureAtlas.resizeCapacity(t)||cc.logID(6005)},_searchNewPositionInChildrenForZ:function(t){for(var i=this._children,s=i.length,n=0;n<s;n++)if(i[n].zIndex>t)return n;return s},_getCurrentIndex:function(t,i){for(var s=!1,n=!1,h=0,r=0,e=0,c=this._children,o=c.length,u=0;u<o;u++){var a=c[u];if(a.zIndex>i&&!n&&(h=u,n=!0,s&&n))break;if(t===a&&(r=u,s=!0,n||(e=-1),s&&n))break}return n||(h=o),h+=e,{newIndex:h,oldIndex:r}},_addChildHelper:function(t,i,s){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return cc.logID(6007),null;this._children||(this._children=[]);var n=this._searchNewPositionInChildrenForZ(i);return this._children.splice(n,0,t),t.tag=s,t._setLocalZOrder(i),t.parent=this,this._running&&(t.performRecursive(_ccsg.Node.performType.onEnter),t.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)),n},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.macro.SRC_ALPHA,this._blendFunc.dst=cc.macro.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var h=cc.ParticleBatchNode.prototype;h.texture,cc.defineGetterSetter(h,"texture",h.getTexture,h.setTexture)},{}],260:[function(t,i,s){cc.ParticleBatchNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1};var n=cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.ParticleBatchNode.CanvasRenderCmd,n._initWithTexture=function(){}},{}],261:[function(t,i,s){cc.ParticleBatchNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()};var n=cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=cc.ParticleBatchNode.WebGLRenderCmd,n.rendering=function(t){var i=this._node;if(0!==i.textureAtlas.totalQuads){var s=this._worldTransform,n=this._matrix.mat;n[0]=s.a,n[4]=s.c,n[12]=s.tx,n[1]=s.b,n[5]=s.d,n[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.gl.blendFuncForParticle(i._blendFunc.src,i._blendFunc.dst),i.textureAtlas.drawQuads()}},n._initWithTexture=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR)}},{}],262:[function(t,i,s){t("./CCParticleAsset"),t("./CCSGParticleSystem"),t("./CCSGParticleSystemCanvasRenderCmd"),t("./CCSGParticleSystemWebGLRenderCmd"),t("./CCParticleBatchNode"),t("./CCParticleBatchNodeCanvasRenderCmd"),t("./CCParticleBatchNodeWebGLRenderCmd");var n=cc.BlendFunc.BlendFactor,h=cc.Enum({GRAVITY:0,RADIUS:1}),r=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),e={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,t?this._applyCustoms():this._applyFile())},animatable:!1,tooltip:!1},_file:{default:"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(t,i){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)},animatable:!1,url:cc.ParticleAsset,tooltip:!1},_texture:{default:"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._sgNode.texture=t?cc.textureCache.addImage(t):null,!t&&this._file&&this._applyFile()},url:cc.Texture2D,tooltip:!1},particleCount:{get:function(){return this._sgNode.particleCount},set:function(t){this._sgNode.particleCount=t},visible:!1,tooltip:!1},_srcBlendFactor:n.SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n,tooltip:!1},_dstBlendFactor:n.ONE_MINUS_SRC_ALPHA,dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n,tooltip:!1},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(t){this._autoRemoveOnFinish!==t&&(this._autoRemoveOnFinish=t,this._applyAutoRemove())},animatable:!1,tooltip:!1},active:{get:function(){return!!this._sgNode&&this._sgNode.isActive()},visible:!1}},c=function(){for(var t={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:r.FREE,emitterMode:h.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},i=Object.keys(t),s=0;s<i.length;++s){var n=i[s];!function(t,i){var s="_"+t;e[s]=i;var n=i.constructor,h=e[t]={};cc.isChildClassOf(n,cc.ValueType)?(h.get=function(){return new n(this[s])},h.type=n):h.get=function(){return this[s]},cc.isChildClassOf(n,cc.ValueType)?h.set=function(i){this[s]=new n(i),this._sgNode[t]=i}:h.set=function(i){this[s]=i,this._sgNode[t]=i}}(n,t[n])}return i}();e.positionType.type=r,e.emitterMode.type=h;var o=cc.T({name:"cc.ParticleSystem",S:cc._RendererUnderSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1,this._blendFunc=new cc.BlendFunc(0,0),this._originOnExit=null},O:e,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:h,PositionType:r},__preload:function(){this._super(),this.playOnLoad&&this.resetSystem(),this._applyAutoRemove()},onDestroy:function(){this._autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){return new _ccsg.ParticleSystem},_initSgNode:function(){var t=this._sgNode;this._file?this._custom&&this._texture?this._applyCustoms():this._applyFile():this._custom&&this._applyCustoms(),t.stopSystem()},addParticle:function(){return this._sgNode.addParticle()},stopSystem:function(){this._sgNode.stopSystem()},resetSystem:function(){this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(t){if(t){var i=t.getTexture();i&&(this._texture=i.url),this._sgNode.setDisplayFrame(t)}},setTextureWithRect:function(t,i){t instanceof cc.Texture2D&&(this._texture=t.url),this._sgNode.setTextureWithRect(t,i)},_applyFile:function(){var t=this._file;if(t){var i=this;cc.loader.load(t,function(s,n){if(s||!n)throw s||new Error("Unkown error");if(i.isValid){var h=i._sgNode;h.particleCount=0;var r=h.isActive();h.initWithFile(t),n.textureUuid&&cc.AssetLibrary.queryAssetInfo(n.textureUuid,function(t,s,n){t?cc.error(t):i.texture=s}),n.emissionRate&&(i.emissionRate=n.emissionRate),h.setPosition(0,0),r||h.stopSystem(),i._applyAutoRemove(),i._custom&&i._applyCustoms()}})}},_applyCustoms:function(){for(var t=this._sgNode,i=t.isActive(),s=0;s<c.length;s++){var n=c[s];t[n]=this["_"+n]}this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc),this._texture&&(t.texture=cc.textureCache.addImage(this._texture)),i||t.stopSystem(),this._applyAutoRemove()},_applyAutoRemove:function(){var t=this._sgNode,i=this._autoRemoveOnFinish;if(t.autoRemoveOnFinish=i,i){if(this._originOnExit)return;this._originOnExit=t.onExit;var s=this;t.onExit=function(){s._originOnExit.call(this),s.node.destroy()}}else this._originOnExit&&(t.onExit=this._originOnExit,this._originOnExit=null)}});cc.ParticleSystem=i.exports=o},{"./CCParticleAsset":258,"./CCParticleBatchNode":259,"./CCParticleBatchNodeCanvasRenderCmd":260,"./CCParticleBatchNodeWebGLRenderCmd":261,"./CCSGParticleSystem":263,"./CCSGParticleSystemCanvasRenderCmd":264,"./CCSGParticleSystemWebGLRenderCmd":265}],263:[function(t,i,s){var n=t("./CCPNGReader"),h=t("./CCTIFFReader");t("../compression/ZipUtils"),cc.Particle=function(t,i,s,n,h,r,e,c,o,u,a,f){this.pos=t||cc.v2(0,0),this.startPos=i||cc.v2(0,0),this.color=s||cc.color(0,0,0,255),this.deltaColor=n||{r:0,g:0,b:0,a:255},this.size=h||0,this.deltaSize=r||0,this.rotation=e||0,this.deltaRotation=c||0,this.timeToLive=o||0,this.atlasIndex=u||0,this.modeA=a||new cc.Particle.ModeA,this.modeB=f||new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(t,i,s){this.dir=t||cc.p(0,0),this.radialAccel=i||0,this.tangentialAccel=s||0},cc.Particle.ModeB=function(t,i,s,n){this.angle=t||0,this.degreesPerSecond=i||0,this.radius=s||0,this.deltaRadius=n||0},cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()],_ccsg.ParticleSystem=_ccsg.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.modeA=new _ccsg.ParticleSystem.ModeA,this.modeB=new _ccsg.ParticleSystem.ModeB,this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._particles=[],this._sourcePosition=cc.p(0,0),this._posVar=cc.p(0,0),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._endColorVar=cc.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=cc.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||cc.js.isNumber(t)){var i=t||100;this.setDrawMode(_ccsg.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(i)}else"string"==typeof t?this.initWithFile(t):"object"==typeof t&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.ParticleSystem.CanvasRenderCmd(this):new _ccsg.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition.x=t.x,this._sourcePosition.y=t.y},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar.x=t.x,this._posVar.y=t.y},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){var t=this.modeA.gravity;return cc.p(t.x,t.y)},setGravity:function(t){this.modeA.gravity=t},getSpeed:function(){return this.modeA.speed},setSpeed:function(t){this.modeA.speed=t},getSpeedVar:function(){return this.modeA.speedVar},setSpeedVar:function(t){this.modeA.speedVar=t},getTangentialAccel:function(){return this.modeA.tangentialAccel},setTangentialAccel:function(t){this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.modeA.radialAccel},setRadialAccel:function(t){this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.modeA.rotationIsDir},setRotationIsDir:function(t){this.modeA.rotationIsDir=t},getStartRadius:function(){return this.modeB.startRadius},setStartRadius:function(t){this.modeB.startRadius=t},getStartRadiusVar:function(){return this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.modeB.startRadiusVar=t},getEndRadius:function(){return this.modeB.endRadius},setEndRadius:function(t){this.modeB.endRadius=t},getEndRadiusVar:function(){return this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.modeB.rotatePerSecondVar=t},setScale:function(t,i){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScale.call(this,t,i)},setRotation:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor.fromColor(t)},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar.fromColor(t)},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor.fromColor(t)},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar.fromColor(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.once("load",function(i){this._textureLoaded=!0,this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,i){void 0===i?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):this._blendFunc.src===t&&this._blendFunc.dst===i||(this._blendFunc={src:t,dst:i},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE||this._blendFunc.src===cc.macro.ONE&&this._blendFunc.dst===cc.macro.ONE},setBlendAdditive:function(t){var i=this._blendFunc;t?(i.src=cc.macro.SRC_ALPHA,i.dst=cc.macro.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},_:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var i=cc.loader.getRes(t);return i?this.initWithDictionary(i,""):(cc.logID(6008),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(t,i){var s=!1,r=null,e=this._valueForKey,c=parseInt(e("maxParticles",t));if(this.initWithTotalParticles(c)){this.angle=parseFloat(e("angle",t)),this.angleVar=parseFloat(e("angleVariance",t)),this.duration=parseFloat(e("duration",t)),this._blendFunc.src=parseInt(e("blendFuncSource",t)),this._blendFunc.dst=parseInt(e("blendFuncDestination",t));var o=this._startColor;o.r=255*parseFloat(e("startColorRed",t)),o.g=255*parseFloat(e("startColorGreen",t)),o.b=255*parseFloat(e("startColorBlue",t)),o.a=255*parseFloat(e("startColorAlpha",t));var u=this._startColorVar;u.r=255*parseFloat(e("startColorVarianceRed",t)),u.g=255*parseFloat(e("startColorVarianceGreen",t)),u.b=255*parseFloat(e("startColorVarianceBlue",t)),u.a=255*parseFloat(e("startColorVarianceAlpha",t));var a=this._endColor;a.r=255*parseFloat(e("finishColorRed",t)),a.g=255*parseFloat(e("finishColorGreen",t)),a.b=255*parseFloat(e("finishColorBlue",t)),a.a=255*parseFloat(e("finishColorAlpha",t));var f=this._endColorVar;if(f.r=255*parseFloat(e("finishColorVarianceRed",t)),f.g=255*parseFloat(e("finishColorVarianceGreen",t)),f.b=255*parseFloat(e("finishColorVarianceBlue",t)),f.a=255*parseFloat(e("finishColorVarianceAlpha",t)),this.startSize=parseFloat(e("startParticleSize",t)),this.startSizeVar=parseFloat(e("startParticleSizeVariance",t)),this.endSize=parseFloat(e("finishParticleSize",t)),this.endSizeVar=parseFloat(e("finishParticleSizeVariance",t)),this.setPosition(parseFloat(e("sourcePositionx",t)),parseFloat(e("sourcePositiony",t))),this._posVar.x=parseFloat(e("sourcePositionVariancex",t)),this._posVar.y=parseFloat(e("sourcePositionVariancey",t)),this.startSpin=parseFloat(e("rotationStart",t)),this.startSpinVar=parseFloat(e("rotationStartVariance",t)),this.endSpin=parseFloat(e("rotationEnd",t)),this.endSpinVar=parseFloat(e("rotationEndVariance",t)),this.emitterMode=parseInt(e("emitterType",t)),this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var l=this.modeA;l.gravity.x=parseFloat(e("gravityx",t)),l.gravity.y=parseFloat(e("gravityy",t)),l.speed=parseFloat(e("speed",t)),l.speedVar=parseFloat(e("speedVariance",t));var v=e("radialAcceleration",t);l.radialAccel=v?parseFloat(v):0,v=e("radialAccelVariance",t),l.radialAccelVar=v?parseFloat(v):0,v=e("tangentialAcceleration",t),l.tangentialAccel=v?parseFloat(v):0,v=e("tangentialAccelVariance",t),l.tangentialAccelVar=v?parseFloat(v):0;var d=e("rotationIsDir",t);null!==d?(d=d.toString().toLowerCase(),l.rotationIsDir="true"===d||"1"===d):l.rotationIsDir=!1}else{if(this.emitterMode!==_ccsg.ParticleSystem.Mode.RADIUS)return cc.logID(6009),!1;var p=this.modeB;p.startRadius=parseFloat(e("maxRadius",t)),p.startRadiusVar=parseFloat(e("maxRadiusVariance",t)),p.endRadius=parseFloat(e("minRadius",t)),p.endRadiusVar=0,p.rotatePerSecond=parseFloat(e("rotatePerSecond",t)),p.rotatePerSecondVar=parseFloat(e("rotatePerSecondVariance",t))}if(this.life=parseFloat(e("particleLifespan",t)),this.lifeVar=parseFloat(e("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode){this._opacityModifyRGB=!1;var g=e("textureFileName",t),m=cc.path.changeBasename(this._plistFile,g),w=cc.textureCache.getTextureForKey(m);if(w)this.setTexture(w);else{var _=e("textureImageData",t);if(_&&0!==_.length){if(!(r=cc.Codec.unzipBase64AsArray(_,1)))return cc.logID(6010),!1;var C=cc.getImageFormatByData(r);if(C!==cc.ImageFormat.TIFF&&C!==cc.ImageFormat.PNG)return cc.logID(6011),!1;var b=document.createElement("canvas");C===cc.ImageFormat.PNG?new n(r).render(b):h.parseTIFF(r,b),cc.textureCache.cacheImage(m,b);var y=cc.textureCache.getTextureForKey(m);y||cc.logID(6012),this.setTexture(y)}else{if(!(w=cc.textureCache.addImage(m)))return!1;this.setTexture(w)}}}s=!0}return s},initWithTotalParticles:function(t){this._totalParticles=t;var i,s=this._particles;for(s.length=0,i=0;i<t;i++)s[i]=new cc.Particle;if(!s)return cc.logID(6013),!1;if(this._allocatedParticles=t,this._batchNode)for(i=0;i<this._totalParticles;i++)s[i].atlasIndex=i;return this._isActive=!0,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.autoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var i=cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*i(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*i(),t.pos.y=this._sourcePosition.y+this._posVar.y*i();var s,n,h=this._startColor,r=this._startColorVar,e=this._endColor,c=this._endColorVar;s={r:cc.clampf(h.r+r.r*i(),0,255),g:cc.clampf(h.g+r.g*i(),0,255),b:cc.clampf(h.b+r.b*i(),0,255),a:cc.clampf(h.a+r.a*i(),0,255)},n={r:cc.clampf(e.r+c.r*i(),0,255),g:cc.clampf(e.g+c.g*i(),0,255),b:cc.clampf(e.b+c.b*i(),0,255),a:cc.clampf(e.a+c.a*i(),0,255)},t.color=s;var o=t.deltaColor,u=t.timeToLive;o.r=(n.r-s.r)/u,o.g=(n.g-s.g)/u,o.b=(n.b-s.b)/u,o.a=(n.a-s.a)/u;var a=this.startSize+this.startSizeVar*i();if(a=Math.max(0,a),t.size=a,this.endSize===_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var f=this.endSize+this.endSizeVar*i();f=Math.max(0,f),t.deltaSize=(f-a)/u}var l=this.startSpin+this.startSpinVar*i(),v=this.endSpin+this.endSpinVar*i();t.rotation=l,t.deltaRotation=(v-l)/u,this.positionType===_ccsg.ParticleSystem.Type.FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y);var d=cc.degreesToRadians(this.angle+this.angleVar*i());if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var p=this.modeA,g=t.modeA,m=p.speed+p.speedVar*i();g.dir.x=Math.cos(d),g.dir.y=Math.sin(d),cc.pMultIn(g.dir,m),g.radialAccel=p.radialAccel+p.radialAccelVar*i(),g.tangentialAccel=p.tangentialAccel+p.tangentialAccelVar*i(),p.rotationIsDir&&(t.rotation=-cc.radiansToDegrees(cc.pToAngle(g.dir)))}else{var w=this.modeB,_=t.modeB,C=w.startRadius+w.startRadiusVar*i(),b=w.endRadius+w.endRadiusVar*i();_.radius=C,_.deltaRadius=w.endRadius===_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(b-C)/u,_.angle=d,_.degreesPerSecond=cc.degreesToRadians(w.rotatePerSecond+w.rotatePerSecondVar*i())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,i){this._renderCmd.updateQuadWithParticle(t,i)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty),this._isActive&&this.emissionRate){var i=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>i;)this.addParticle(),this._emitCounter-=i;this._elapsed+=t,-1!==this.duration&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var s=this.getWorldToNodeTransform(),n=cc.Particle.TemporaryPoints[0];if(this.positionType===_ccsg.ParticleSystem.Type.FREE?cc.pIn(n,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(n.x=this._position.x,n.y=this._position.y),this._visible){for(var h=cc.Particle.TemporaryPoints[1],r=cc.Particle.TemporaryPoints[2],e=cc.Particle.TemporaryPoints[3],c=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(h),cc.pZeroIn(r),cc.pZeroIn(e);var o=c[this._particleIdx];if(o.timeToLive-=t,o.timeToLive>0){if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var u=e,a=h,f=r;o.pos.x||o.pos.y?(cc.pIn(a,o.pos),cc.pNormalizeIn(a)):cc.pZeroIn(a),cc.pIn(f,a),cc.pMultIn(a,o.modeA.radialAccel);var l=f.x;f.x=-f.y,f.y=l,cc.pMultIn(f,o.modeA.tangentialAccel),cc.pIn(u,a),cc.pAddIn(u,f),cc.pAddIn(u,this.modeA.gravity),cc.pMultIn(u,t),cc.pAddIn(o.modeA.dir,u),cc.pIn(u,o.modeA.dir),cc.pMultIn(u,t),cc.pAddIn(o.pos,u)}else{var v=o.modeB;v.angle+=v.degreesPerSecond*t,v.radius+=v.deltaRadius*t,o.pos.x=-Math.cos(v.angle)*v.radius,o.pos.y=-Math.sin(v.angle)*v.radius}this._renderCmd._updateDeltaColor(o,t),o.size+=o.deltaSize*t,o.size=Math.max(0,o.size),o.rotation+=o.deltaRotation*t;var d=h;if(this.positionType===_ccsg.ParticleSystem.Type.FREE||this.positionType===_ccsg.ParticleSystem.Type.RELATIVE){var p=r,g=e;cc._pointApplyAffineTransformIn(n,s,p),cc._pointApplyAffineTransformIn(o.startPos,s,g),cc.pSubIn(p,g),cc.pIn(d,o.pos),cc.pSubIn(d,p)}else cc.pIn(d,o.pos);this._batchNode&&(d.x+=this._position.x,d.y+=this._position.y),this._renderCmd.updateParticlePosition(o,d),++this._particleIdx}else{var m=o.atlasIndex;if(this._particleIdx!==this.particleCount-1){var w=c[this._particleIdx];c[this._particleIdx]=c[this.particleCount-1],c[this.particleCount-1]=w}if(this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+m),c[this.particleCount-1].atlasIndex=m),0==--this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),this._parent.removeChild(this,!0),void(this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB())}}this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB(),this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,i){if(i){var s=i[t];return null!=s?s:""}return""},_updateBlendFunc:function(){if(this._batchNode)cc.logID(6014);else{var t=this._texture;if(t&&t instanceof cc.Texture2D){this._opacityModifyRGB=!1;var i=this._blendFunc;i.src===cc.macro.BLEND_SRC&&i.dst===cc.macro.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(i.src=cc.macro.SRC_ALPHA,i.dst=cc.macro.ONE_MINUS_SRC_ALPHA))}}},clone:function(){var t=new _ccsg.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var i=this.getBlendFunc();if(t.setBlendFunc(i.src,i.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(cc.p(this.x,this.y)),t.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===_ccsg.ParticleSystem.Mode.GRAVITY){var s=this.getGravity();t.setGravity(cc.p(s.x,s.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else this.getEmitterMode()===_ccsg.ParticleSystem.Mode.RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar()));if(t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var n=this.getTexture();if(n){var h=n.getContentSize();t.setTextureWithRect(n,cc.rect(0,0,h.width,h.height))}}}return t},setDisplayFrame:function(t){if(t){var i=t.getOffset();0===i.x&&0===i.y||cc.logID(6015);var s=t.getTexture();this._texture!==s&&this.setTexture(s)}},setTextureWithRect:function(t,i){this._texture!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(i)},listenBackToForeground:function(t){}});var r=_ccsg.ParticleSystem.prototype;r.opacityModifyRGB,cc.defineGetterSetter(r,"opacityModifyRGB",r.isOpacityModifyRGB,r.setOpacityModifyRGB),r.batchNode,cc.defineGetterSetter(r,"batchNode",r.getBatchNode,r.setBatchNode),r.drawMode,cc.defineGetterSetter(r,"drawMode",r.getDrawMode,r.setDrawMode),r.shapeType,cc.defineGetterSetter(r,"shapeType",r.getShapeType,r.setShapeType),r.active,cc.defineGetterSetter(r,"active",r.isActive),r.sourcePos,cc.defineGetterSetter(r,"sourcePos",r.getSourcePosition,r.setSourcePosition),r.posVar,cc.defineGetterSetter(r,"posVar",r.getPosVar,r.setPosVar),r.gravity,cc.defineGetterSetter(r,"gravity",r.getGravity,r.setGravity),r.speed,cc.defineGetterSetter(r,"speed",r.getSpeed,r.setSpeed),r.speedVar,cc.defineGetterSetter(r,"speedVar",r.getSpeedVar,r.setSpeedVar),r.tangentialAccel,cc.defineGetterSetter(r,"tangentialAccel",r.getTangentialAccel,r.setTangentialAccel),r.tangentialAccelVar,cc.defineGetterSetter(r,"tangentialAccelVar",r.getTangentialAccelVar,r.setTangentialAccelVar),r.radialAccel,cc.defineGetterSetter(r,"radialAccel",r.getRadialAccel,r.setRadialAccel),r.radialAccelVar,cc.defineGetterSetter(r,"radialAccelVar",r.getRadialAccelVar,r.setRadialAccelVar),r.rotationIsDir,cc.defineGetterSetter(r,"rotationIsDir",r.getRotationIsDir,r.setRotationIsDir),r.startRadius,cc.defineGetterSetter(r,"startRadius",r.getStartRadius,r.setStartRadius),r.startRadiusVar,cc.defineGetterSetter(r,"startRadiusVar",r.getStartRadiusVar,r.setStartRadiusVar),r.endRadius,cc.defineGetterSetter(r,"endRadius",r.getEndRadius,r.setEndRadius),r.endRadiusVar,cc.defineGetterSetter(r,"endRadiusVar",r.getEndRadiusVar,r.setEndRadiusVar),r.rotatePerS,cc.defineGetterSetter(r,"rotatePerS",r.getRotatePerSecond,r.setRotatePerSecond),r.rotatePerSVar,cc.defineGetterSetter(r,"rotatePerSVar",r.getRotatePerSecondVar,r.setRotatePerSecondVar),r.startColor,cc.defineGetterSetter(r,"startColor",r.getStartColor,r.setStartColor),r.startColorVar,cc.defineGetterSetter(r,"startColorVar",r.getStartColorVar,r.setStartColorVar),r.endColor,cc.defineGetterSetter(r,"endColor",r.getEndColor,r.setEndColor),r.endColorVar,cc.defineGetterSetter(r,"endColorVar",r.getEndColorVar,r.setEndColorVar),r.totalParticles,cc.defineGetterSetter(r,"totalParticles",r.getTotalParticles,r.setTotalParticles),r.texture,cc.defineGetterSetter(r,"texture",r.getTexture,r.setTexture),_ccsg.ParticleSystem.ModeA=function(t,i,s,n,h,r,e,c){this.gravity=t||cc.p(0,0),this.speed=i||0,this.speedVar=s||0,this.tangentialAccel=n||0,this.tangentialAccelVar=h||0,this.radialAccel=r||0,this.radialAccelVar=e||0,this.rotationIsDir=c||!1},_ccsg.ParticleSystem.ModeB=function(t,i,s,n,h,r){this.startRadius=t||0,this.startRadiusVar=i||0,this.endRadius=s||0,this.endRadiusVar=n||0,this.rotatePerSecond=h||0,this.rotatePerSecondVar=r||0},_ccsg.ParticleSystem.SHAPE_MODE=0,_ccsg.ParticleSystem.TEXTURE_MODE=1,_ccsg.ParticleSystem.STAR_SHAPE=0,_ccsg.ParticleSystem.BALL_SHAPE=1,_ccsg.ParticleSystem.DURATION_INFINITY=-1,_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,_ccsg.ParticleSystem.Mode=cc.Enum({GRAVITY:0,RADIUS:1}),_ccsg.ParticleSystem.Type=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2})},{"../compression/ZipUtils":29,"./CCPNGReader":257,"./CCTIFFReader":266}],264:[function(t,i,s){_ccsg.ParticleSystem.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._drawMode=_ccsg.ParticleSystem.TEXTURE_MODE,this._shapeType=_ccsg.ParticleSystem.BALL_SHAPE,this._pointRect=cc.rect(0,0,0,0),this._localRegion=new cc.Region,this._tintCache=null};var n=_ccsg.ParticleSystem.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=_ccsg.ParticleSystem.CanvasRenderCmd,n.getDrawMode=function(){return this._drawMode},n.setDrawMode=function(t){this._drawMode=t},n.getShapeType=function(){return this._shapeType},n.setShapeType=function(t){this._shapeType=t},n.setBatchNode=function(t){this._batchNode!==t&&(this._node._batchNode=t)},n.updateQuadWithParticle=function(t,i){},n.updateParticlePosition=function(t,i){cc.pIn(t.drawPos,i)};var h=new cc.Region,r=new cc.Rect;n.updateLocalBB=function(){var t=this._localRegion,i=this._node._particles;t.setEmpty();for(var s=i.length-1;s>=0;--s){var n=i[s],e=n.drawPos,c=1.415*n.size;h.setTo(e.x-c,e.y-c,e.x+c,e.y+c),t.union(h)}r.x=t._minX,r.y=t._minY,r.width=t._maxX-t._minX,r.height=t._maxY-t._minY},n.getLocalBB=function(){return r},n.updateStatus=function(){this.originUpdateStatus(),this._updateCurrentRegions(),this._regionFlag=_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~_ccsg.Node._dirtyFlags.contentDirty},n.rendering=function(t,i,s){var n=t||cc._renderContext,h=n.getContext(),r=this._node,e=this._pointRect;n.setTransform(this._worldTransform,i,s),n.save(),r.isBlendAdditive()?h.globalCompositeOperation="lighter":h.globalCompositeOperation="source-over";var c,o,u,a,f=this._node.particleCount,l=this._node._particles;if(r.drawMode!==_ccsg.ParticleSystem.SHAPE_MODE&&r._texture){if(!r._texture._textureLoaded)return void n.restore();var v=r._texture.getHtmlElementObj();if(!v.width||!v.height)return void n.restore();var d=v;for(c=0;c<f;c++)if(o=l[c],u=0|.5*o.size,0!=(a=o.color.a/255)){h.globalAlpha=a,h.save(),h.translate(0|o.drawPos.x,-(0|o.drawPos.y));var p=4*Math.floor(o.size/4),g=e.width,m=e.height;h.scale(Math.max(1/g*p,1e-6),Math.max(1/m*p,1e-6)),o.rotation&&h.rotate(cc.degreesToRadians(o.rotation)),d=o.isChangeColor?this._changeTextureColor(r._texture,o.color,this._pointRect):v,h.drawImage(d,-(0|g/2),-(0|m/2)),h.restore()}}else{var w=cc._drawingUtil;for(c=0;c<f;c++)u=0|.5*(o=l[c]).size,0!=(a=o.color.a/255)&&(h.globalAlpha=a,h.save(),h.translate(0|o.drawPos.x,-(0|o.drawPos.y)),r.shapeType===_ccsg.ParticleSystem.STAR_SHAPE?(o.rotation&&h.rotate(cc.degreesToRadians(o.rotation)),w.drawStar(n,u,o.color)):w.drawColorBall(n,u,o.color),h.restore())}n.restore(),cc.g_NumberOfDraws++},n._changeTextureColor=function(t,i,s){this._tintCache||(this._tintCache=document.createElement("canvas"));var n=this._tintCache,h=t.getContentSize();return n.width=h.width,n.height=h.height,t._generateColorTexture(i.r,i.g,i.b,s,n)},n.initTexCoordsWithRect=function(t){this._pointRect=t},n.setTotalParticles=function(t){this._node._totalParticles=t<200?t:200},n.addParticle=function(){var t,i=this._node,s=i._particles;return i.particleCount<s.length?t=s[i.particleCount]:(t=new cc.Particle,s.push(t)),t},n._setupVBO=function(){},n._allocMemory=function(){return!0},n.postStep=function(){},n._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=cc.macro.BLEND_SRC,t.dst=cc.macro.BLEND_DST},n._initWithTotalParticles=function(t){},n._updateDeltaColor=function(t,i){this._node._dontTint||(t.color.r+=t.deltaColor.r*i,t.color.g+=t.deltaColor.g*i,t.color.b+=t.deltaColor.b*i,t.color.a+=t.deltaColor.a*i,t.isChangeColor=!0)}},{}],265:[function(t,i,s){_ccsg.ParticleSystem.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var n=_ccsg.ParticleSystem.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=_ccsg.ParticleSystem.WebGLRenderCmd,n.getDrawMode=function(){},n.setDrawMode=function(t){},n.getShapeType=function(){},n.setShapeType=function(t){},n.setBatchNode=function(t){var i=this._node;if(i._batchNode!==t){var s=i._batchNode;if(i._batchNode=t,t)for(var n=i._particles,h=0;h<i._totalParticles;h++)n[h].atlasIndex=h;t?s||(i._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,i.atlasIndex),cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(i._totalParticles),i.setTexture(s.getTexture()),this._setupVBO())}},n.initIndices=function(t){for(var i=this._indices,s=0,n=t;s<n;++s){var h=6*s,r=4*s;i[h+0]=r+0,i[h+1]=r+1,i[h+2]=r+2,i[h+5]=r+1,i[h+4]=r+2,i[h+3]=r+3}},n.isDifferentTexture=function(t,i){return t===i},n.updateParticlePosition=function(t,i){this.updateQuadWithParticle(t,i)},n.updateQuadWithParticle=function(t,i){var s=null,n=this._node;n._batchNode?(s=n._batchNode.textureAtlas.quads[n.atlasIndex+t.atlasIndex],n._batchNode.textureAtlas.dirty=!0):s=this._quads[n._particleIdx];var h,r,e,c;n._opacityModifyRGB?(h=0|t.color.r*t.color.a/255,r=0|t.color.g*t.color.a/255,e=0|t.color.b*t.color.a/255):(h=0|t.color.r,r=0|t.color.g,e=0|t.color.b),c=0|t.color.a;var o=s.bl.colors,u=s.br.colors,a=s.tl.colors,f=s.tr.colors;o.r=u.r=a.r=f.r=h,o.g=u.g=a.g=f.g=r,o.b=u.b=a.b=f.b=e,o.a=u.a=a.a=f.a=c;var l=t.size/2;if(t.rotation){var v=-l,d=-l,p=l,g=l,m=i.x,w=i.y,_=-cc.degreesToRadians(t.rotation),C=Math.cos(_),b=Math.sin(_),y=v*C-d*b+m,T=v*b+d*C+w,S=p*C-d*b+m,A=p*b+d*C+w,M=p*C-g*b+m,x=p*b+g*C+w,E=v*C-g*b+m,O=v*b+g*C+w;s.bl.vertices.x=y,s.bl.vertices.y=T,s.br.vertices.x=S,s.br.vertices.y=A,s.tl.vertices.x=E,s.tl.vertices.y=O,s.tr.vertices.x=M,s.tr.vertices.y=x}else s.bl.vertices.x=i.x-l,s.bl.vertices.y=i.y-l,s.br.vertices.x=i.x+l,s.br.vertices.y=i.y-l,s.tl.vertices.x=i.x-l,s.tl.vertices.y=i.y+l,s.tr.vertices.x=i.x+l,s.tr.vertices.y=i.y+l},n.rendering=function(t){var i=this._node;if(i._texture){var s=t||cc._renderContext,n=this._worldTransform,h=this._matrix.mat;h[0]=n.a,h[4]=n.c,h[12]=n.tx,h[1]=n.b,h[5]=n.d,h[13]=n.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.gl.bindTexture2DN(0,i._texture),cc.gl.blendFuncForParticle(i._blendFunc.src,i._blendFunc.dst),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),s.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),s.bindBuffer(s.ARRAY_BUFFER,this._buffersVBO[0]),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,s.FLOAT,!1,24,0),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,s.UNSIGNED_BYTE,!0,24,12),s.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,24,16),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),s.drawElements(s.TRIANGLES,6*i._particleIdx,s.UNSIGNED_SHORT,0)}},n.initTexCoordsWithRect=function(t){var i=this._node,s=i.texture,n=t.width,h=t.height;s&&(n=s.getPixelWidth(),h=s.getPixelHeight());var r,e,c,o;cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(r=(2*t.x+1)/(2*n),e=(2*t.y+1)/(2*h),c=r+(2*t.width-2)/(2*n),o=e+(2*t.height-2)/(2*h)):(r=t.x/n,e=t.y/h,c=r+t.width/n,o=e+t.height/h);var u=o;o=e,e=u;var a,f=0,l=0;i._batchNode?(a=i._batchNode.textureAtlas.quads,f=i.atlasIndex,l=i.atlasIndex+i._totalParticles):(a=this._quads,f=0,l=i._totalParticles);for(var v=f;v<l;v++){a[v]||(a[v]=cc.V3F_C4B_T2F_QuadZero());var d=a[v];d.bl.texCoords.u=r,d.bl.texCoords.v=e,d.br.texCoords.u=c,d.br.texCoords.v=e,d.tl.texCoords.u=r,d.tl.texCoords.v=o,d.tr.texCoords.u=c,d.tr.texCoords.v=o}},n.setTotalParticles=function(t){var i=this._node;if(t>i._allocatedParticles){var s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var n=new ArrayBuffer(t*s),h=i._particles;h.length=0;var r=this._quads;r.length=0;for(var e=0;e<t;e++)h[e]=new cc.Particle,r[e]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,e*s);if(i._allocatedParticles=t,i._totalParticles=t,i._batchNode)for(var c=0;c<t;c++)h[c].atlasIndex=c;this._quadsArrayBuffer=n,this.initIndices(t),this._setupVBO(),i._texture&&this.initTexCoordsWithRect(cc.rect(0,0,i._texture.width,i._texture.height))}else i._totalParticles=t;i.resetSystem()},n.addParticle=function(){var t=this._node;return t._particles[t.particleCount]},n._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},n._allocMemory=function(){var t=this._node;if(t._batchNode)return cc.logID(6016),!1;var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=t._totalParticles,n=this._quads;n.length=0,this._indices=new Uint16Array(6*s);for(var h=new ArrayBuffer(i*s),r=0;r<s;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,h,r*i);return n&&this._indices?(this._quadsArrayBuffer=h,!0):(cc.logID(6013),!1)},n.postStep=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferSubData(t.ARRAY_BUFFER,0,this._quadsArrayBuffer)},n._setBlendAdditive=function(){var t=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=cc.macro.SRC_ALPHA,t.dst=cc.macro.ONE_MINUS_SRC_ALPHA):(t.src=cc.macro.BLEND_SRC,t.dst=cc.macro.BLEND_DST)},n._initWithTotalParticles=function(t){if(!this._allocMemory())return!1;this.initIndices(t),this._setupVBO(),this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR)},n._updateDeltaColor=function(t,i){t.color.r+=t.deltaColor.r*i,t.color.g+=t.deltaColor.g*i,t.color.b+=t.deltaColor.b*i,t.color.a+=t.deltaColor.a*i,t.isChangeColor=!0}},{}],266:[function(t,i,s){var n={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var i=this._tiffData;return this._littleEndian?i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t]:i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var i=this.fieldTypeNames;return t in i?i[t]:null},getFieldTagName:function(t){var i=this.fieldTagNames;return t in i?i[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,i,s,n){var h=[],r=this.getFieldTypeLength(i);if(r*s<=4)!1===this.littleEndian?h.push(n>>>8*(4-r)):h.push(n);else for(var e=0;e<s;e++){var c=r*e;r>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(i)?(h.push(this.getUint32(n+c)),h.push(this.getUint32(n+c+4))):cc.logID(8e3):h.push(this.getBytes(r,n+c))}return"ASCII"===i&&h.forEach(function(t,i,s){s[i]=String.fromCharCode(t)}),h},getBytes:function(t,i){if(t<=0)cc.logID(8001);else{if(t<=1)return this.getUint8(i);if(t<=2)return this.getUint16(i);if(t<=3)return this.getUint32(i)>>>8;if(t<=4)return this.getUint32(i);cc.logID(8002)}},getBits:function(t,i,s){s=s||0;var n,h,r=i+Math.floor(s/8),e=s+t,c=32-t;return e<=0?console.log("No bits requested"):e<=8?(n=24+s,h=this.getUint8(r)):e<=16?(n=16+s,h=this.getUint16(r)):e<=32?(n=s,h=this.getUint32(r)):console.log("Too many bits requested"),{bits:h<<n>>>c,byteOffset:r+Math.floor(e/8),bitOffset:e%8}},parseFileDirectory:function(t){for(var i=this.getUint16(t),s=[],n=t+2,h=0;h<i;n+=12,h++){var r=this.getUint16(n),e=this.getUint16(n+2),c=this.getUint32(n+4),o=this.getUint32(n+8),u=this.getFieldTagName(r),a=this.getFieldTypeName(e),f=this.getFieldValues(u,a,c,o);s[u]={type:a,values:f}}this._fileDirectories.push(s);var l=this.getUint32(n);0!==l&&this.parseFileDirectory(l)},clampColorSample:function(t,i){var s=Math.pow(2,8-i);return Math.floor(t*s+(s-1))},parseTIFF:function(t,i){if(i=i||document.createElement("canvas"),this._tiffData=t,this.canvas=i,this.checkLittleEndian(),this.hasTowel()){var s=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(s);var n=this._fileDirectories[0],h=n.ImageWidth.values[0],r=n.ImageLength.values[0];this.canvas.width=h,this.canvas.height=r;var e=[],c=n.Compression?n.Compression.values[0]:1,o=n.SamplesPerPixel.values[0],u=[],a=0,f=!1;if(n.BitsPerSample.values.forEach(function(t,i,s){u[i]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[i].hasBytesPerSample=!0,u[i].bytesPerSample=t/8),a+=t},this),a%8==0){f=!0;var l=a/8}var v=n.StripOffsets.values,d=v.length;if(n.StripByteCounts)p=n.StripByteCounts.values;else{if(cc.logID(8003),1!==d)throw Error("Cannot recover from missing StripByteCounts");var p=[Math.ceil(h*r*a/8)]}for(H=0;H<d;H++){var g=v[H];e[H]=[];for(var m=p[H],w=0,_=0,C=1,b=!0,y=[],T=0,S=0,A=0;w<m;w+=C)switch(c){case 1:var M=0;for(y=[];M<o;M++){if(!u[M].hasBytesPerSample){var x=this.getBits(u[M].bitsPerSample,g+w,_);throw y.push(x.bits),w=x.byteOffset-g,_=x.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var E=u[M].bytesPerSample*M;y.push(this.getBytes(u[M].bytesPerSample,g+w+E))}if(e[H].push(y),!f)throw C=0,RangeError("Cannot handle sub-byte bits per pixel");C=l;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(b){b=!1;var O=1,P=1,R=this.getInt8(g+w);R>=0&&R<=127?O=R+1:R>=-127&&R<=-1?P=1-R:b=!0}else{var I=this.getUint8(g+w);for(M=0;M<P;M++){if(!u[S].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");A=A<<8*T|I,++T===u[S].bytesPerSample&&(y.push(A),A=T=0,S++),S===o&&(e[H].push(y),y=[],S=0)}0==--O&&(b=!0)}C=1}}if(i.getContext){var L=this.canvas.getContext("2d");L.fillStyle="rgba(255, 255, 255, 0)";var D=n.RowsPerStrip?n.RowsPerStrip.values[0]:r,F=e.length,N=r%D,k=0===N?D:N,B=D,G=0,z=n.PhotometricInterpretation.values[0],j=[],V=0;if(n.ExtraSamples&&(V=(j=n.ExtraSamples.values).length),n.ColorMap)var U=n.ColorMap.values,W=Math.pow(2,u[0].bitsPerSample);for(var H=0;H<F;H++){H+1===F&&(B=k);for(var X=e[H].length,J=G*H,Y=0,q=0;q<X;Y++)for(var Z=0;Z<h;Z++,q++){var Q=e[H][q],K=0,$=0,tt=0,it=1;if(V>0)for(var st=0;st<V;st++)if(1===j[st]||2===j[st]){it=Q[3+st]/256;break}switch(z){case 0:if(u[0].hasBytesPerSample)var nt=Math.pow(16,2*u[0].bytesPerSample);Q.forEach(function(t,i,s){s[i]=nt-t});case 1:K=$=tt=this.clampColorSample(Q[0],u[0].bitsPerSample);break;case 2:K=this.clampColorSample(Q[0],u[0].bitsPerSample),$=this.clampColorSample(Q[1],u[1].bitsPerSample),tt=this.clampColorSample(Q[2],u[2].bitsPerSample);break;case 3:if(void 0===U)throw Error("Palette image missing color map");var ht=Q[0];K=this.clampColorSample(U[ht],16),$=this.clampColorSample(U[W+ht],16),tt=this.clampColorSample(U[2*W+ht],16);break;default:throw RangeError("Unknown Photometric Interpretation:",z)}L.fillStyle="rgba("+K+", "+$+", "+tt+", "+it+")",L.fillRect(Z,J+Y,1,1)}G=B}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};i.exports=n},{}],267:[function(t,i,s){cc.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,i,s,n){_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==i&&(s=s||cc.Texture2D.PIXEL_FORMAT_RGBA8888,n=n||0,this.initWithWidthAndHeight(t,i,s,n)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},visit:function(t){var i=this._renderCmd,s=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;i.visit(s),n.pushRenderCommand(i),this.sprite.visit(this),i._dirtyFlag=0}else i._propagateFlagsDown(s)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,i,s){this._renderCmd.setVirtualViewport(t,i,s)},initWithWidthAndHeight:function(t,i,s,n){return this._renderCmd.initWithWidthAndHeight(t,i,s,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,i,s,n,h,r){var e=cc._renderContext;h=h||e.COLOR_BUFFER_BIT,r=r||e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT,this._beginWithClear(t,i,s,n,h,r,e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,i,s,n,h,r,e){this.begin(),this._renderCmd._beginWithClear(t,i,s,n,h,r,e)},end:function(){this._renderCmd.end()},clear:function(t,i,s,n){this.beginWithClear(t,i,s,n),this.end()},clearRect:function(t,i,s,n){this._renderCmd.clearRect(t,i,s,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var i=this._clearColor;i.r=t.r,i.g=t.g,i.b=t.b,i.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,i){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var n=cc.RenderTexture.prototype;n.clearColorVal,cc.defineGetterSetter(n,"clearColorVal",n.getClearColor,n.setClearColor),cc.RenderTexture.create=function(t,i,s,n){return new cc.RenderTexture(t,i,s,n)}},{}],268:[function(t,i,s){cc.RenderTexture.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var n=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.RenderTexture.CanvasRenderCmd,n.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},n.clearStencil=function(t){},n.setVirtualViewport=function(t,i,s){},n.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},n.initWithWidthAndHeight=function(t,i,s,n){var h=this._node,r=this._cacheCanvas;r.width=0|t,r.height=0|i;var e=new cc.Texture2D;e.initWithElement(r),e.handleLoadedTexture();var c=h.sprite=new _ccsg.Sprite(e);return c.setBlendFunc(cc.macro.ONE,cc.macro.ONE_MINUS_SRC_ALPHA),h.autoDraw=!1,h.addChild(c),!0},n.begin=function(){},n._beginWithClear=function(t,i,s,n,h,r,e){t=t||0,i=i||0,s=s||0,n=isNaN(n)?255:n;var c=this._cacheContext.getContext(),o=this._cacheCanvas;c.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|i)+","+(0|s)+","+n/255+")"),c.clearRect(0,0,o.width,o.height),c.fillRect(0,0,o.width,o.height)},n.end=function(){var t=this._node;cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId);var i=t.sprite._renderCmd;i._notifyRegionStatus&&i._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)},n.clearRect=function(t,i,s,n){this._cacheContext.clearRect(t,i,s,-n)},n.clearDepth=function(t){cc.log("clearDepth isn't supported on Cocos2d-Html5")}},{}],269:[function(t,i,s){var n=t("../core/utils/misc");cc.RenderTexture.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var h=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);h.constructor=cc.RenderTexture.WebGLRenderCmd,h.setVirtualViewport=function(t,i,s){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=i,this._fullViewport=s},h.needDraw=function(){return this._needDraw&&this._node.autoDraw},h.rendering=function(t){var i=t||cc._renderContext,s=this._node;if(s.autoDraw){s.begin();var n=s.clearFlags;if(n){var h=[0,0,0,0],r=0,e=0;n&i.COLOR_BUFFER_BIT&&(h=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor(s._clearColor.r/255,s._clearColor.g/255,s._clearColor.b/255,s._clearColor.a/255)),n&i.DEPTH_BUFFER_BIT&&(r=i.getParameter(i.DEPTH_CLEAR_VALUE),i.clearDepth(s.clearDepthVal)),n&i.STENCIL_BUFFER_BIT&&(e=i.getParameter(i.STENCIL_CLEAR_VALUE),i.clearStencil(s.clearStencilVal)),i.clear(n),n&i.COLOR_BUFFER_BIT&&i.clearColor(h[0],h[1],h[2],h[3]),n&i.DEPTH_BUFFER_BIT&&i.clearDepth(r),n&i.STENCIL_BUFFER_BIT&&i.clearStencil(e)}s.sortAllChildren();for(var c=s._children,o=0;o<c.length;o++){var u=c[o];u!==s.sprite&&u.visit(s.sprite)}s.end()}},h.clearStencil=function(t){var i=cc._renderContext,s=i.getParameter(i.STENCIL_CLEAR_VALUE);i.clearStencil(t),i.clear(i.STENCIL_BUFFER_BIT),i.clearStencil(s)},h.cleanup=function(){this._node,this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},h.updateClearColor=function(t){},h.initWithWidthAndHeight=function(t,i,s,h){var r=this._node;s===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var e=cc._renderContext;this._fullRect=new cc.Rect(0,0,t,i),this._fullViewport=new cc.Rect(0,0,t,i),t|=0,i|=0,this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING);var c,o;cc.configuration.supportsNPOT()?(c=t,o=i):(c=n.NextPOT(t),o=n.NextPOT(i));for(var u=c*o*4,a=new Uint8Array(u),f=0;f<c*o*4;f++)a[f]=0;this._pixelFormat=s;var l=r._texture=new cc.Texture2D;if(!r._texture)return!1;l.initWithData(a,r._pixelFormat,c,o,cc.size(t,i));var v=e.getParameter(e.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(a,r._pixelFormat,c,o,cc.size(t,i))}this._fBO=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l._webTextureObj,0),0!==h&&(this._depthRenderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._depthRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,h,c,o),h===e.DEPTH_STENCIL?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer):h===e.STENCIL_INDEX||h===e.STENCIL_INDEX8?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer):h===e.DEPTH_COMPONENT16&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer)),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),l.setAliasTexParameters();var d=r.sprite=new _ccsg.Sprite(l);return d.scaleY=-1,d.setBlendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.bindRenderbuffer(e.RENDERBUFFER,v),e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),r.autoDraw=!1,r.addChild(d),!0},h.begin=function(){var t=this._node;cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPushMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPushMatrix();var i=cc._renderContext,s=cc.director;s.setProjection(s.getProjection());var n=t._texture.getContentSizeInPixels(),h=cc.director.getWinSizeInPixels(),r=h.width/n.width,e=h.height/n.height,c=cc.math.Matrix4.createOrthographicProjection(-1/r,1/r,-1/e,1/e,-1,1);cc.math.glMultMatrix(c);var o=new cc.Rect(0,0,0,0);o.width=this._fullViewport.width,o.height=this._fullViewport.height;var u=o.width/this._fullRect.width,a=o.height/this._fullRect.height;o.x=(this._fullRect.x-this._rtTextureRect.x)*u,o.y=(this._fullRect.y-this._rtTextureRect.y)*a,i.viewport(o.x,o.y,o.width,o.height),this._oldFBO=i.getParameter(i.FRAMEBUFFER_BINDING),i.bindFramebuffer(i.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._textureCopy._webTextureObj,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t._texture._webTextureObj,0))},h._beginWithClear=function(t,i,s,n,h,r,e){t/=255,i/=255,s/=255,n/=255;var c=cc._renderContext,o=[0,0,0,0],u=0,a=0;e&c.COLOR_BUFFER_BIT&&(o=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(t,i,s,n)),e&c.DEPTH_BUFFER_BIT&&(u=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(h)),e&c.STENCIL_BUFFER_BIT&&(a=c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(r)),c.clear(e),e&c.COLOR_BUFFER_BIT&&c.clearColor(o[0],o[1],o[2],o[3]),e&c.DEPTH_BUFFER_BIT&&c.clearDepth(u),e&c.STENCIL_BUFFER_BIT&&c.clearStencil(a)},h.end=function(){var t=this._node;cc.renderer._renderingToBuffer(t.__instanceId);var i=cc._renderContext,s=cc.director;i.bindFramebuffer(i.FRAMEBUFFER,this._oldFBO),s.setViewport(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPopMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPopMatrix()},h.clearRect=function(t,i,s,n){},h.clearDepth=function(t){var i=this._node;i.begin();var s=cc._renderContext,n=s.getParameter(s.DEPTH_CLEAR_VALUE);s.clearDepth(t),s.clear(s.DEPTH_BUFFER_BIT),s.clearDepth(n),i.end()}},{"../core/utils/misc":223}],270:[function(t,i,s){var n=cc.macro,h=cc.math;cc.GLProgram=cc._Class.extend({_updateUniformLocation:function(t){if(!t)return!1;var i,s=this._hashForUniforms[t];if(s){i=!1;for(var n=arguments.length-1,h=0;h<n;++h)arguments[h+1]!==s[h]&&(s[h]=arguments[h+1],i=!0)}else s=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=s,i=!0;return i},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,i,s){if(!s||!t)return!1;s=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;\nuniform mat4 CC_MVMatrix;\nuniform mat4 CC_MVPMatrix;\nuniform vec4 CC_Time;\nuniform vec4 CC_SinTime;\nuniform vec4 CC_CosTime;\nuniform vec4 CC_Random01;\nuniform sampler2D CC_Texture0;\n//CC INCLUDES END\n"+s,this._glContext.shaderSource(t,s),this._glContext.compileShader(t);var n=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return n||(cc.logID(8100,this._glContext.getShaderSource(t)),i===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),!0===n},ctor:function(t,i,s){this._uniforms={},this._hashForUniforms={},this._glContext=s||cc._renderContext,this._programObj=null,this._vertShader=null,this._fragShader=null,this._usesTime=!1,this._projectionUpdated=-1,t&&i&&this._(t,i)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,i){var s=this._glContext;this._programObj=s.createProgram(),this._projectionUpdated=-1,this._vertShader=null,this._fragShader=null,t&&(this._vertShader=s.createShader(s.VERTEX_SHADER),this._compileShader(this._vertShader,s.VERTEX_SHADER,t)||cc.logID(8101)),i&&(this._fragShader=s.createShader(s.FRAGMENT_SHADER),this._compileShader(this._fragShader,s.FRAGMENT_SHADER,i)||cc.logID(8102)),this._vertShader&&s.attachShader(this._programObj,this._vertShader),this._fragShader&&s.attachShader(this._programObj,this._fragShader);for(var n in this._hashForUniforms)delete this._hashForUniforms[n];return!0},initWithString:function(t,i){return this.initWithVertexShaderByteArray(t,i)},initWithVertexShaderFilename:function(t,i){var s=cc.loader.getRes(t);if(!s)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(i);if(!n)throw new Error("Please load the resource firset : "+i);return this.initWithVertexShaderByteArray(s,n)},_:function(t,i){return this.initWithVertexShaderFilename(t,i)},addAttribute:function(t,i){this._glContext.bindAttribLocation(this._programObj,i,t)},link:function(){return this._programObj?(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,!(cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)&&(cc.logID(8104,this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,1))):(cc.logID(8103),!1)},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[n.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_PMATRIX_S),this._uniforms[n.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVMATRIX_S),this._uniforms[n.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVPMATRIX_S),this._uniforms[n.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_TIME_S),this._uniforms[n.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SINTIME_S),this._uniforms[n.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[n.UNIFORM_TIME]||null!=this._uniforms[n.UNIFORM_SINTIME]||null!=this._uniforms[n.UNIFORM_COSTIME],this._uniforms[n.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_RANDOM01_S),this._uniforms[n.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[n.UNIFORM_SAMPLER],0)},_addUniformLocation:function(t){var i=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=i},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[n.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[n.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,i){var s=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i)){var n=this.getUniformLocationForName(t);s.uniform1i(n,i)}}else s.uniform1i(t,i)},setUniformLocationWith2i:function(t,i,s){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s)){var h=this.getUniformLocationForName(t);n.uniform2i(h,i,s)}}else n.uniform2i(t,i,s)},setUniformLocationWith3i:function(t,i,s,n){var h=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s,n)){var r=this.getUniformLocationForName(t);h.uniform3i(r,i,s,n)}}else h.uniform3i(t,i,s,n)},setUniformLocationWith4i:function(t,i,s,n,h){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s,n,h)){var e=this.getUniformLocationForName(t);r.uniform4i(e,i,s,n,h)}}else r.uniform4i(t,i,s,n,h)},setUniformLocationWith2iv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(s,i)},setUniformLocationWith3iv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(s,i)},setUniformLocationWith4iv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(s,i)},setUniformLocationI32:function(t,i){this.setUniformLocationWith1i(t,i)},setUniformLocationWith1f:function(t,i){var s=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i)){var n=this.getUniformLocationForName(t);s.uniform1f(n,i)}}else s.uniform1f(t,i)},setUniformLocationWith2f:function(t,i,s){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s)){var h=this.getUniformLocationForName(t);n.uniform2f(h,i,s)}}else n.uniform2f(t,i,s)},setUniformLocationWith3f:function(t,i,s,n){var h=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s,n)){var r=this.getUniformLocationForName(t);h.uniform3f(r,i,s,n)}}else h.uniform3f(t,i,s,n)},setUniformLocationWith4f:function(t,i,s,n,h){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,i,s,n,h)){var e=this.getUniformLocationForName(t);r.uniform4f(e,i,s,n,h)}}else r.uniform4f(t,i,s,n,h)},setUniformLocationWith2fv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(s,i)},setUniformLocationWith3fv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(s,i)},setUniformLocationWith4fv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(s,i)},setUniformLocationWithMatrix3fv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix3fv(s,!1,i)},setUniformLocationWithMatrix4fv:function(t,i){var s="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(s,!1,i)},setUniformLocationF32:function(t,i,s,n,h){"use strict";switch(arguments.length){case 0:case 1:return;case 2:this.setUniformLocationWith1f(t,i);break;case 3:this.setUniformLocationWith2f(t,i,s);break;case 4:this.setUniformLocationWith3f(t,i,s,n);break;case 5:this.setUniformLocationWith4f(t,i,s,n,h)}},setUniformsForBuiltins:function(){var t=new h.Matrix4,i=new h.Matrix4,s=new h.Matrix4;if(h.glGetMatrix(h.KM_GL_PROJECTION,t),h.glGetMatrix(h.KM_GL_MODELVIEW,i),h.mat4Multiply(s,t,i),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],i.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],s.mat,1),this._usesTime){var r=cc.director,e=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],e/10,e,2*e,4*e),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],e/8,e/4,e/2,Math.sin(e)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],e/8,e/4,e/2,Math.cos(e))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var i=new h.Matrix4,s=new h.Matrix4;if(h.glGetMatrix(h.KM_GL_PROJECTION,i),h.mat4Multiply(s,i,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],i.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],s.mat,1),this._usesTime){var r=cc.director,e=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],e/10,e,2*e,4*e),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],e/8,e/4,e/2,Math.sin(e)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],e/8,e/4,e/2,Math.cos(e))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,h.getMat4MultiplyValue(h.projection_matrix_stack.top,h.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){h.mat4Multiply(t,h.projection_matrix_stack.top,h.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,h.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,h.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,h.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var t=h.projection_matrix_stack;t.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,t.top.mat),this._projectionUpdated=t.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var t=cc._renderContext;if(t.getShaderPrecisionFormat&&null==cc.GLProgram._highpSupported){var i=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==i.precision}return cc.GLProgram._highpSupported}},{}],271:[function(t,i,s){var n=-1,h=cc.macro,r=h.ENABLE_GL_STATE_CACHE,e=0,c=0,o=null,u=0,a=0,f=0,l=0;r&&(e=16,c=-1,o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],u=-1,a=-1,f=0,h.TEXTURE_ATLAS_USE_VAO&&(l=0)),cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),n=-1,r){c=-1;for(var t=0;t<e;t++)o[t]=-1;u=-1,a=-1,f=0}},cc.gl.useProgram=r?function(t){t!==c&&(c=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){r&&t===c&&(c=-1),gl.deleteProgram(t)},cc.gl.setBlending=function(t,i){var s=cc._renderContext;t===s.ONE&&i===s.ZERO?s.disable(s.BLEND):(s.enable(s.BLEND),s.blendFunc(t,i))},cc.gl.blendFunc=r?function(t,i){t===u&&i===a||(u=t,a=i,cc.gl.setBlending(t,i))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(t,i){if(t!==u||i!==a){u=t,a=i;var s=cc._renderContext;t===s.ONE&&i===s.ZERO?s.disable(s.BLEND):(s.enable(s.BLEND),s.blendFuncSeparate(s.SRC_ALPHA,i,t,i))}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),r?cc.gl.setBlending(u,a):cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){n=-1},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=r?function(t,i){if(o[t]!==i){o[t]=i;var s=cc._renderContext;s.activeTexture(s.TEXTURE0+t),i?s.bindTexture(s.TEXTURE_2D,i._webTextureObj):s.bindTexture(s.TEXTURE_2D,null)}}:function(t,i){var s=cc._renderContext;s.activeTexture(s.TEXTURE0+t),i?s.bindTexture(s.TEXTURE_2D,i._webTextureObj):s.bindTexture(s.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,i){r&&i===o[t]&&(o[t]=-1),cc._renderContext.deleteTexture(i._webTextureObj)},cc.gl.bindVAO=function(t){h.TEXTURE_ATLAS_USE_VAO&&r&&l!==t&&(l=t)},cc.gl.enable=function(t){}},{}],272:[function(t,i,s){var n=cc.PresetShaders,h=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,i){switch(i){case h.SHADER_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_POSITION_COLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR);break;case h.SHADER_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR);break;case h.SHADER_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_VERT,n.POSITION_TEXTURE_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_UCOLOR_VERT,n.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_POSITION_TEXTUREA8COLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_A8COLOR_VERT,n.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS);break;case h.SHADER_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_UCOLOR_VERT,n.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",h.VERTEX_ATTRIB_POSITION);break;case h.SHADER_POSITION_LENGTHTEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_LENGTH_TEXTURE_VERT,n.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(h.ATTRIBUTE_NAME_POSITION,h.VERTEX_ATTRIB_POSITION),t.addAttribute(h.ATTRIBUTE_NAME_TEX_COORD,h.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(h.ATTRIBUTE_NAME_COLOR,h.VERTEX_ATTRIB_COLOR);break;default:return void cc.logID(8105)}t.link(),t.updateUniforms()},_reloadShader:function(t){var i=this.programForKey(t);i.reset(),this._loadDefaultShader(i,t)},loadDefaultShaders:function(){},reloadDefaultShaders:function(){this._reloadShader(h.SHADER_POSITION_TEXTURECOLOR),this._reloadShader(h.SHADER_SPRITE_POSITION_TEXTURECOLOR),this._reloadShader(h.SHADER_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(h.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(h.SHADER_POSITION_COLOR),this._reloadShader(h.SHADER_POSITION_TEXTURE),this._reloadShader(h.SHADER_POSITION_TEXTURE_UCOLOR),this._reloadShader(h.SHADER_POSITION_TEXTUREA8COLOR),this._reloadShader(h.SHADER_POSITION_UCOLOR)},programForKey:function(t){if(!this._programs[t]){var i=new cc.GLProgram;this._loadDefaultShader(i,t),this._programs[t]=i}return this._programs[t]},getProgram:function(t){return this.programForKey(t)},addProgram:function(t,i){this._programs[i]=t}}},{}],273:[function(t,i,s){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor;\nvoid main(void)\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\ngl_PointSize = u_pointSize;\nv_fragmentColor = u_color;\n}",POSITION_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\n}",SPRITE_POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"//#extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\n//#if defined GL_OES_standard_derivatives\n//gl_FragColor=v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0-length(v_texcoord));\n//#else\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));\n//#endif\n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position;\nattribute mediump vec2 a_texcoord;\nattribute mediump vec4 a_color;\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\nv_color = a_color;\nv_texcoord = a_texcoord;\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\n}",POSITION_TEXTURE_FRAG:"precision lowp float;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor=texture2D(CC_Texture0, v_texCoord) * u_color;\n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = vec4(v_fragmentColor.rgb,\nv_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a);\n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",SPRITE_POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform float CC_alpha_value;\nvoid main()\n{\nvec4 texColor=texture2D(CC_Texture0, v_texCoord);\nif(texColor.a <= CC_alpha_value)\n discard; \ngl_FragColor=texColor*v_fragmentColor;\n}",EX_SWITCHMASK_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform sampler2D u_texture;\nuniform sampler2D u_mask;\nvoid main()\n{\nvec4 texColorc=texture2D(u_texture, v_texCoord);\nvec4 maskColor=texture2D(u_mask, v_texCoord);\nvec4 finalColor=vec4(texColor.r, texColor.g, texColor.b, maskColor.a*texColor.a);\ngl_FragColor=v_fragmentColor*finalColor;\n}"}},{}],274:[function(t,i,s){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")},{"./CCGLProgram":270,"./CCGLStateCache":271,"./CCShaderCache":272,"./CCShaders":273}],275:[function(t,i,s){var n=function(t){return{u:t.x,v:t.y}};cc.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,i){void 0===i?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=i)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var i=this._drawColor;i.r=t.r,i.g=t.g,i.b=t.b,i.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){var t=cc.DrawNode.prototype;cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(t,i,s,n,h,r,e,c,o){this.type=t,this.verts=i||null,this.fillColor=s||null,this.lineWidth=n||0,this.lineColor=h||null,this.lineCap=r||"butt",this.isClosePolygon=e||!1,this.isFill=c||!1,this.isStroke=o||!1},t._className="DrawNodeCanvas",t.ctor=function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this._()},t.drawRect=function(t,i,s,n,h){n=null==n?this._lineWidth:n,null==(h=h||this.getDrawColor()).a&&(h.a=255);var r=[t,cc.p(i.x,t.y),i,cc.p(t.x,i.y)],e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=r,e.lineWidth=n,e.lineColor=h,e.isClosePolygon=!0,e.isStroke=!0,e.lineCap="butt",e.fillColor=s,s&&(null==s.a&&(s.a=255),e.isFill=!0),this._buffer.push(e)},t.drawCircle=function(t,i,s,n,h,r,e){r=r||this._lineWidth,null==(e=e||this.getDrawColor()).a&&(e.a=255);for(var c=2*Math.PI/n,o=[],u=0;u<=n;u++){var a=u*c,f=i*Math.cos(a+s)+t.x,l=i*Math.sin(a+s)+t.y;o.push(cc.p(f,l))}h&&o.push(cc.p(t.x,t.y));var v=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);v.verts=o,v.lineWidth=r,v.lineColor=e,v.isClosePolygon=!0,v.isStroke=!0,this._buffer.push(v)},t.drawQuadBezier=function(t,i,s,n,h,r){h=h||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var e=[],c=0,o=0;o<n;o++){var u=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*s.x,a=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*s.y;e.push(cc.p(u,a)),c+=1/n}e.push(cc.p(s.x,s.y));var f=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);f.verts=e,f.lineWidth=h,f.lineColor=r,f.isStroke=!0,f.lineCap="round",this._buffer.push(f)},t.drawCubicBezier=function(t,i,s,n,h,r,e){r=r||this._lineWidth,null==(e=e||this.getDrawColor()).a&&(e.a=255);for(var c=[],o=0,u=0;u<h;u++){var a=Math.pow(1-o,3)*t.x+3*Math.pow(1-o,2)*o*i.x+3*(1-o)*o*o*s.x+o*o*o*n.x,f=Math.pow(1-o,3)*t.y+3*Math.pow(1-o,2)*o*i.y+3*(1-o)*o*o*s.y+o*o*o*n.y;c.push(cc.p(a,f)),o+=1/h}c.push(cc.p(n.x,n.y));var l=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);l.verts=c,l.lineWidth=r,l.lineColor=e,l.isStroke=!0,l.lineCap="round",this._buffer.push(l)},t.drawCatmullRom=function(t,i,s,n){this.drawCardinalSpline(t,.5,i,s,n)},t.drawCardinalSpline=function(t,i,s,n,h){n=n||this._lineWidth,null==(h=h||this.getDrawColor()).a&&(h.a=255);for(var r,e,c=[],o=1/t.length,u=0;u<s+1;u++){var a=u/s;1===a?(r=t.length-1,e=1):e=(a-o*(r=0|a/o))/o;var f=cc.cardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),i,e);c.push(f)}var l=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);l.verts=c,l.lineWidth=n,l.lineColor=h,l.isStroke=!0,l.lineCap="round",this._buffer.push(l)},t.drawDot=function(t,i,s){null==(s=s||this.getDrawColor()).a&&(s.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=i,n.fillColor=s,this._buffer.push(n)},t.drawDots=function(t,i,s){if(t&&0!=t.length){null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var n=0,h=t.length;n<h;n++)this.drawDot(t[n],i,s)}},t.drawSegment=function(t,i,s,n){s=s||this._lineWidth,null==(n=n||this.getDrawColor()).a&&(n.a=255);var h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=[t,i],h.lineWidth=2*s,h.lineColor=n,h.isStroke=!0,h.lineCap="round",this._buffer.push(h)},t.drawPoly_=function(t,i,s,n,h){s=null==s?this._lineWidth:s,null==(n=n||this.getDrawColor()).a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=t,r.fillColor=i,r.lineWidth=s,r.lineColor=n,r.isClosePolygon=!h,r.isStroke=!0,r.lineCap="round",i&&(r.isFill=!0),this._buffer.push(r)},t.drawPoly=function(t,i,s,n,h){for(var r=[],e=0;e<t.length;e++)r.push(cc.p(t[e].x,t[e].y));return this.drawPoly_(r,i,s,n,h)},t.clear=function(){this._buffer.length=0},t._createRenderCmd=function(){return new cc.DrawNode.CanvasRenderCmd(this)}):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(t._bufferCapacity=0,t._trianglesArrayBuffer=null,t._trianglesWebBuffer=null,t._trianglesReader=null,t._dirty=!1,t._className="DrawNodeWebGL",t.ctor=function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this._()},t._=function(){return!!_ccsg.Node.prototype._.call(this)&&(this.shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0,!0)},t.drawRect=function(t,i,s,n,h){n=null==n?this._lineWidth:n,null==(h=h||this.getDrawColor()).a&&(h.a=255);var r=[t,cc.p(i.x,t.y),i,cc.p(t.x,i.y)];null==s?this._drawSegments(r,n,h,!0):this.drawPoly(r,s,n,h)},t.drawCircle=function(t,i,s,n,h,r,e){r=r||this._lineWidth,null==(e=e||this.getDrawColor()).a&&(e.a=255);var c,o,u=2*Math.PI/n,a=[];for(c=0;c<=n;c++){var f=c*u,l=i*Math.cos(f+s)+t.x,v=i*Math.sin(f+s)+t.y;a.push(cc.p(l,v))}for(h&&a.push(cc.p(t.x,t.y)),r*=.5,c=0,o=a.length;c<o-1;c++)this.drawSegment(a[c],a[c+1],r,e)},t.drawQuadBezier=function(t,i,s,n,h,r){h=h||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var e=[],c=0,o=0;o<n;o++){var u=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*s.x,a=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*s.y;e.push(cc.p(u,a)),c+=1/n}e.push(cc.p(s.x,s.y)),this._drawSegments(e,h,r,!1)},t.drawCubicBezier=function(t,i,s,n,h,r,e){r=r||this._lineWidth,null==(e=e||this.getDrawColor()).a&&(e.a=255);for(var c=[],o=0,u=0;u<h;u++){var a=Math.pow(1-o,3)*t.x+3*Math.pow(1-o,2)*o*i.x+3*(1-o)*o*o*s.x+o*o*o*n.x,f=Math.pow(1-o,3)*t.y+3*Math.pow(1-o,2)*o*i.y+3*(1-o)*o*o*s.y+o*o*o*n.y;c.push(cc.p(a,f)),o+=1/h}c.push(cc.p(n.x,n.y)),this._drawSegments(c,r,e,!1)},t.drawCatmullRom=function(t,i,s,n){this.drawCardinalSpline(t,.5,i,s,n)},t.drawCardinalSpline=function(t,i,s,n,h){n=n||this._lineWidth,null==(h=h||this.getDrawColor()).a&&(h.a=255);for(var r,e,c=[],o=1/t.length,u=0;u<s+1;u++){var a=u/s;1===a?(r=t.length-1,e=1):e=(a-o*(r=0|a/o))/o;var f=cc.cardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),i,e);c.push(f)}n*=.5;for(var l=0,v=c.length;l<v-1;l++)this.drawSegment(c[l],c[l+1],n,h)},t._render=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var i=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,i,8),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,i,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},t._ensureCapacity=function(t){var i=this._buffer;if(i.length+t>this._bufferCapacity){var s=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(this._bufferCapacity+=Math.max(this._bufferCapacity,t),null==i||0===i.length)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(s*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{for(var n=[],h=new ArrayBuffer(s*this._bufferCapacity),r=0;r<i.length;r++)n[r]=new cc.V2F_C4B_T2F_Triangle(i[r].a,i[r].b,i[r].c,h,r*s);this._trianglesReader=new Uint8Array(h),this._trianglesArrayBuffer=h,this._buffer=n}}},t.drawDot=function(t,i,s){null==(s=s||this.getDrawColor()).a&&(s.a=255);var n={r:0|s.r,g:0|s.g,b:0|s.b,a:0|s.a},h={vertices:{x:t.x-i,y:t.y-i},colors:n,texCoords:{u:-1,v:-1}},r={vertices:{x:t.x-i,y:t.y+i},colors:n,texCoords:{u:-1,v:1}},e={vertices:{x:t.x+i,y:t.y+i},colors:n,texCoords:{u:1,v:1}},c={vertices:{x:t.x+i,y:t.y-i},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(h,r,e,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(h,e,c,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},t.drawDots=function(t,i,s){if(t&&0!==t.length){null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var n=0,h=t.length;n<h;n++)this.drawDot(t[n],i,s)}},t.drawSegment=function(t,i,s,h){null==(h=h||this.getDrawColor()).a&&(h.a=255),s=s||.5*this._lineWidth,this._ensureCapacity(18);var r={r:0|h.r,g:0|h.g,b:0|h.b,a:0|h.a},e=cc.v2(t),c=cc.v2(i),o=cc.pNormalize(cc.pPerp(cc.pSub(c,e))),u=cc.pPerp(o),a=cc.pMult(o,s),f=cc.pMult(u,s),l=cc.pSub(c,cc.pAdd(a,f)),v=cc.pAdd(c,cc.pSub(a,f)),d=cc.pSub(c,a),p=cc.pAdd(c,a),g=cc.pSub(e,a),m=cc.pAdd(e,a),w=cc.pSub(e,cc.pSub(a,f)),_=cc.pAdd(e,cc.pAdd(a,f)),C=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,b=this._trianglesArrayBuffer,y=this._buffer;y.push(new cc.V2F_C4B_T2F_Triangle({vertices:l,colors:r,texCoords:n(cc.pNeg(cc.pAdd(o,u)))},{vertices:v,colors:r,texCoords:n(cc.pSub(o,u))},{vertices:d,colors:r,texCoords:n(cc.pNeg(o))},b,y.length*C)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:r,texCoords:n(o)},{vertices:v,colors:r,texCoords:n(cc.pSub(o,u))},{vertices:d,colors:r,texCoords:n(cc.pNeg(o))},b,y.length*C)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:r,texCoords:n(o)},{vertices:g,colors:r,texCoords:n(cc.pNeg(o))},{vertices:d,colors:r,texCoords:n(cc.pNeg(o))},b,y.length*C)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:r,texCoords:n(o)},{vertices:g,colors:r,texCoords:n(cc.pNeg(o))},{vertices:m,colors:r,texCoords:n(o)},b,y.length*C)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:w,colors:r,texCoords:n(cc.pSub(u,o))},{vertices:g,colors:r,texCoords:n(cc.pNeg(o))},{vertices:m,colors:r,texCoords:n(o)},b,y.length*C)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:w,colors:r,texCoords:n(cc.pSub(u,o))},{vertices:_,colors:r,texCoords:n(cc.pAdd(o,u))},{vertices:m,colors:r,texCoords:n(o)},b,y.length*C)),this._dirty=!0},t.drawPoly=function(t,i,s,h,r){if(null!=i){null==i.a&&(i.a=255),null==h.a&&(h.a=255),s=null==s?this._lineWidth:s,s*=.5;var e,c,o,u,a={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},f={r:0|h.r,g:0|h.g,b:0|h.b,a:0|h.a},l=[],v=t.length;for(e=0;e<v;e++){c=cc.v2(t[(e-1+v)%v]),o=cc.v2(t[e]),u=cc.v2(t[(e+1)%v]);var d=cc.pNormalize(cc.pPerp(cc.pSub(o,c))),p=cc.pNormalize(cc.pPerp(cc.pSub(u,o))),g=cc.pMult(cc.pAdd(d,p),1/(cc.pDot(d,p)+1));l[e]={offset:g,n:p}}var m=s>0,w=3*(3*v-2);this._ensureCapacity(w);var _=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,b=this._buffer,y=0==m?.5:0;for(e=0;e<v-2;e++)c=cc.pSub(cc.v2(t[0]),cc.pMult(l[0].offset,y)),o=cc.pSub(cc.v2(t[e+1]),cc.pMult(l[e+1].offset,y)),u=cc.pSub(cc.v2(t[e+2]),cc.pMult(l[e+2].offset,y)),b.push(new cc.V2F_C4B_T2F_Triangle({vertices:c,colors:a,texCoords:n(cc.v2())},{vertices:o,colors:a,texCoords:n(cc.v2())},{vertices:u,colors:a,texCoords:n(cc.v2())},C,b.length*_));for(e=0;e<v;e++){var T=(e+1)%v;c=cc.v2(t[e]),o=cc.v2(t[T]);var S=l[e].n,A=l[e].offset,M=l[T].offset,x=m?cc.pSub(c,cc.pMult(A,s)):cc.pSub(c,cc.pMult(A,.5)),E=m?cc.pSub(o,cc.pMult(M,s)):cc.pSub(o,cc.pMult(M,.5)),O=m?cc.pAdd(c,cc.pMult(A,s)):cc.pAdd(c,cc.pMult(A,.5)),P=m?cc.pAdd(o,cc.pMult(M,s)):cc.pAdd(o,cc.pMult(M,.5));m?(b.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:f,texCoords:n(cc.pNeg(S))},{vertices:E,colors:f,texCoords:n(cc.pNeg(S))},{vertices:P,colors:f,texCoords:n(S)},C,b.length*_)),b.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:f,texCoords:n(cc.pNeg(S))},{vertices:O,colors:f,texCoords:n(S)},{vertices:P,colors:f,texCoords:n(S)},C,b.length*_))):(b.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:a,texCoords:n(cc.v2())},{vertices:E,colors:a,texCoords:n(cc.v2())},{vertices:P,colors:a,texCoords:n(S)},C,b.length*_)),b.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:a,texCoords:n(cc.v2())},{vertices:O,colors:a,texCoords:n(S)},{vertices:P,colors:a,texCoords:n(S)},C,b.length*_)))}l=null,this._dirty=!0}else this._drawSegments(t,s,h,!r)},t._drawSegments=function(t,i,s,h){if(i=null==i?this._lineWidth:i,null==(s=s||this._drawColor).a&&(s.a=255),!((i*=.5)<=0)){var r,e,c,o,u={r:0|s.r,g:0|s.g,b:0|s.b,a:0|s.a},a=[],f=t.length;for(r=0;r<f;r++){e=cc.v2(t[(r-1+f)%f]),c=cc.v2(t[r]),o=cc.v2(t[(r+1)%f]);var l=cc.pNormalize(cc.pPerp(cc.pSub(c,e))),v=cc.pNormalize(cc.pPerp(cc.pSub(o,c))),d=cc.pMult(cc.pAdd(l,v),1/(cc.pDot(l,v)+1));a[r]={offset:d,n:v}}var p=3*(3*f-2);this._ensureCapacity(p);var g=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,m=this._trianglesArrayBuffer,w=this._buffer,_=h?f:f-1;for(r=0;r<_;r++){var C=(r+1)%f;e=cc.v2(t[r]),c=cc.v2(t[C]);var b=a[r].n,y=a[r].offset,T=a[C].offset,S=cc.pSub(e,cc.pMult(y,i)),A=cc.pSub(c,cc.pMult(T,i)),M=cc.pAdd(e,cc.pMult(y,i)),x=cc.pAdd(c,cc.pMult(T,i));w.push(new cc.V2F_C4B_T2F_Triangle({vertices:S,colors:u,texCoords:n(cc.pNeg(b))},{vertices:A,colors:u,texCoords:n(cc.pNeg(b))},{vertices:x,colors:u,texCoords:n(b)},m,w.length*g)),w.push(new cc.V2F_C4B_T2F_Triangle({vertices:S,colors:u,texCoords:n(cc.pNeg(b))},{vertices:M,colors:u,texCoords:n(b)},{vertices:x,colors:u,texCoords:n(b)},m,w.length*g))}a=null,this._dirty=!0}},t.clear=function(){this._buffer.length=0,this._dirty=!0},t._createRenderCmd=function(){return new cc.DrawNode.WebGLRenderCmd(this)})})},{}],276:[function(t,i,s){cc.DrawNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null};var n=cc.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.DrawNode.CanvasRenderCmd,n.rendering=function(t,i,s){var n=t||cc._renderContext,h=(n.getContext(),this._node._displayedOpacity/255);if(0!==h){n.setTransform(this._worldTransform,i,s),n.setGlobalAlpha(h),this._blendFunc&&this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE&&n.setCompositeOperation("lighter");for(var r=this._buffer,e=0,c=r.length;e<c;e++){var o=r[e];switch(o.type){case cc.DrawNode.TYPE_DOT:this._drawDot(n,o,i,s);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,o,i,s);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(n,o,i,s)}}}},n._drawDot=function(t,i,s,n){var h=i.fillColor,r=i.verts[0],e=i.lineWidth,c=t.getContext();t.setFillStyle("rgba("+(0|h.r)+","+(0|h.g)+","+(0|h.b)+","+h.a/255+")"),c.beginPath(),c.arc(r.x,-r.y,e,0,2*Math.PI,!1),c.closePath(),c.fill()},n._drawSegment=function(t,i,s,n){var h=i.lineColor,r=i.verts[0],e=i.verts[1],c=i.lineWidth,o=i.lineCap,u=t.getContext();t.setStrokeStyle("rgba("+(0|h.r)+","+(0|h.g)+","+(0|h.b)+","+h.a/255+")"),u.lineWidth=c*s,u.beginPath(),u.lineCap=o,u.moveTo(r.x,-r.y),u.lineTo(e.x,-e.y),u.stroke()},n._drawPoly=function(t,i,s,n){var h=i.verts,r=i.lineCap;if(null!=h){var e=i.fillColor,c=i.lineWidth,o=i.lineColor,u=i.isClosePolygon,a=i.isFill,f=i.isStroke,l=t.getContext(),v=h[0];l.lineCap=r,e&&t.setFillStyle("rgba("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+","+e.a/255+")"),c&&(l.lineWidth=c*s),o&&t.setStrokeStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),l.beginPath(),l.moveTo(v.x,-v.y);for(var d=1,p=h.length;d<p;d++)l.lineTo(h[d].x,-h[d].y);u&&l.closePath(),a&&l.fill(),f&&l.stroke()}}},{}],277:[function(t,i,s){cc.DrawNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var i=this._node;if(i._buffer.length>0){var s=this._worldTransform,n=this._matrix.mat;n[0]=s.a,n[4]=s.c,n[12]=s.tx,n[1]=s.b,n[5]=s.d,n[13]=s.ty,cc.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),i._render()}}},{}],278:[function(t,i,s){_ccsg.TMXLayer=_ccsg.Node.extend({tiles:null,tileset:null,layerOrientation:null,O:null,layerName:"",_texture:null,_textures:null,_texGrids:null,_spriteTiles:null,_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_staggerAxis:null,_staggerIndex:null,_hexSideLength:0,_className:"TMXLayer",ctor:function(t,i,s){cc.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=cc.size(0,0),this._mapTileSize=cc.size(0,0),this._spriteTiles={},this._staggerAxis=cc.TiledMap.StaggerAxis.STAGGERAXIS_Y,this._staggerIndex=cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN,void 0!==s&&this.initWithTilesetInfo(t,i,s)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.TMXLayer.CanvasRenderCmd(this):new _ccsg.TMXLayer.WebGLRenderCmd(this)},_fillTextureGrids:function(t,i){var s=this._textures[i];if(s.isLoaded()){t.imageSize.width&&t.imageSize.height||(t.imageSize.width=s.width,t.imageSize.height=s.height);for(var n=t._tileSize.width,h=t._tileSize.height,r=s._contentSize.width,e=s._contentSize.height,c=t.spacing,o=t.margin,u=Math.floor((r-2*o+c)/(n+c)),a=Math.floor((e-2*o+c)/(h+c))*u,f=t.firstGid,l=t.firstGid+a,v=this._texGrids,d=null,p=!!v[f],g=cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;f<l&&(p&&!v[f]&&(p=!1),p||!v[f]);++f)d={texId:i,x:0,y:0,width:n,height:h,t:0,l:0,r:0,b:0},t.rectForGID(f,d),d.x+=g,d.y+=g,d.width-=2*g,d.height-=2*g,d.t=d.y/e,d.l=d.x/r,d.r=(d.x+d.width)/r,d.b=(d.y+d.height)/e,v[f]=d}else s.once("load",function(){this._fillTextureGrids(t,i)},this)},initWithTilesetInfo:function(t,i,s){var n=i._layerSize;this.layerName=i.name,this.tiles=i._tiles,this.O=i.O,this._layerSize=n,this._minGID=i._minGID,this._maxGID=i._maxGID,this._opacity=i._opacity,this._staggerAxis=s.getStaggerAxis(),this._staggerIndex=s.getStaggerIndex(),this._hexSideLength=s.getHexSideLength(),this.tileset=t,this.layerOrientation=s.orientation,this._mapTileSize=s.getTileSize();var h=s._tilesets;if(h){var r,e,c,o=h.length;for(this._textures=new Array(o),this._texGrids=[],r=0;r<o;++r)e=h[r],(c=cc.textureCache.addImage(e.sourceImage)).setAliasTexParameters(),this._textures[r]=c,this._fillTextureGrids(e,r),e===t&&(this._texture=c)}var u=this._calculateLayerOffset(i.offset);if(this.setPosition(u),this._parseInternalProperties(),this.layerOrientation===cc.TiledMap.Orientation.HEX){var a=0,f=0;this._staggerAxis===cc.TiledMap.StaggerAxis.STAGGERAXIS_X?(f=s._tileSize.height*(this._layerSize.height+.5),a=(s._tileSize.width+this._hexSideLength)*Math.floor(this._layerSize.width/2)+s._tileSize.width*(this._layerSize.width%2)):(a=s._tileSize.width*(this._layerSize.width+.5),f=(s._tileSize.height+this._hexSideLength)*Math.floor(this._layerSize.height/2)+s._tileSize.height*(this._layerSize.height%2)),this.setContentSize(a,f)}else this.setContentSize(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height);return this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0},visit:function(t){var i=this._renderCmd,s=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;i.visit(s);var h,r,e=this._children,c=e.length,o=cc._renderType===cc.game.RENDER_TYPE_CANVAS,u=this._spriteTiles;if(c>0){for(this._reorderChildDirty&&this.sortAllChildren(),h=0;h<c&&(r=e[h])._localZOrder<0;h++)r.visit(this);for(n.pushRenderCommand(i);h<c;h++)r=e[h],o&&0===r._localZOrder&&u[r.tag]?(isNaN(r._customZ)&&(r._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep),r._renderCmd.updateStatus()):r.visit(this)}else n.pushRenderCommand(i);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&n.pushRenderCommand(this._renderCmd._disableDepthTestCmd),i._dirtyFlag=0}else i._propagateFlagsDown(s)},getLayerSize:function(){return cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileSet:function(){return this.tileset},setTileSet:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.O},setProperties:function(t){this.O=t},getProperty:function(t){return this.O[t]},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},releaseMap:function(){this._spriteTiles={}},getTileAt:function(t,i){if(void 0===t)throw new Error("_ccsg.TMXLayer.getTileAt(): pos should be non-null");var s=t;if(void 0===i&&(s=t.x,i=t.y),s>=this._layerSize.width||i>=this._layerSize.height||s<0||i<0)throw new Error("_ccsg.TMXLayer.getTileAt(): invalid position");if(!this.tiles)return cc.logID(7204),null;var n=null,h=this.getTileGIDAt(s,i);if(0===h)return n;var r=Math.floor(s)+Math.floor(i)*this._layerSize.width;if(!(n=this._spriteTiles[r])){var e=this._texGrids[h],c=this._textures[e.texId];(n=new _ccsg.Sprite(c,e)).setPosition(this.getPositionAt(s,i));var o=this._vertexZForPos(s,i);n.setVertexZ(o),n.setAnchorPoint(0,0),n.setOpacity(this._opacity),this.addChild(n,o,r)}return n},getTileGIDAt:function(t,i){if(void 0===t)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): pos should be non-null");var s=t;if(void 0===i&&(s=t.x,i=t.y),s>=this._layerSize.width||i>=this._layerSize.height||s<0||i<0)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles)return cc.logID(7205),null;var n=Math.floor(s)+Math.floor(i)*this._layerSize.width;return(this.tiles[n]&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0},setTileGID:function(t,i,s,n){if(void 0===i)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var h;if(void 0===n&&i instanceof cc.Vec2?(h=i,n=s):h=cc.p(i,s),h.x=Math.floor(h.x),h.y=Math.floor(h.y),h.x>=this._layerSize.width||h.y>=this._layerSize.height||h.x<0||h.y<0)throw new Error("_ccsg.TMXLayer.setTileGID(): invalid position");if(this.tiles)if(0!==t&&t<this.tileset.firstGid)cc.logID(7207,t);else{n=n||0;var r=this.getTileFlagsAt(h),e=this.getTileGIDAt(h);if(e!==t||r!==n){var c=(t|n)>>>0;if(0===t)this.removeTileAt(h);else if(0===e)this._updateTileForGID(c,h);else{var o=h.x+h.y*this._layerSize.width,u=this.getChildByTag(o);if(u){var a=this._texGrids[t],f=this._textures[a.texId];u.setTexture(f),u.setTextureRect(a,!1),null!=n&&this._setupTileSprite(u,h,c),this.tiles[o]=c}else this._updateTileForGID(c,h)}}}else cc.logID(7206)},addChild:function(t,i,s){_ccsg.Node.prototype.addChild.call(this,t,i,s),void 0!==s&&(this._spriteTiles[s]=t,t._vertexZ=this._vertexZ+cc.renderer.assignedZStep*s/this.tiles.length)},removeChild:function(t,i){this._spriteTiles[t.tag]&&(this._spriteTiles[t.tag]=null),_ccsg.Node.prototype.removeChild.call(this,t,i)},getTileFlagsAt:function(t,i){if(!t)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): pos should be non-null");if(void 0!==i&&(t=cc.p(t,i)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles)return cc.logID(7208),null;var s=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;return(this.tiles[s]&cc.TiledMap.TileFlag.FLIPPED_ALL)>>>0},removeTileAt:function(t,i){if(!t)throw new Error("_ccsg.TMXLayer.removeTileAt(): pos should be non-null");if(void 0!==i&&(t=cc.p(t,i)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.removeTileAt(): invalid position");if(this.tiles){if(0!==this.getTileGIDAt(t)){var s=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;this.tiles[s]=0;var n=this._spriteTiles[s];n&&this.removeChild(n,!0)}}else cc.logID(7209)},getPositionAt:function(t,i){void 0!==i&&(t=cc.p(t,i)),t.x=Math.floor(t.x),t.y=Math.floor(t.y);var s=cc.p(0,0);switch(this.layerOrientation){case cc.TiledMap.Orientation.ORTHO:s=this._positionForOrthoAt(t);break;case cc.TiledMap.Orientation.ISO:s=this._positionForIsoAt(t);break;case cc.TiledMap.Orientation.HEX:s=this._positionForHexAt(t)}return s},_positionForIsoAt:function(t){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-t.x-t.y-2))},_positionForOrthoAt:function(t){return cc.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var i=cc.p(0,0),s=this.tileset.tileOffset,n=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1;switch(this._staggerAxis){case cc.TiledMap.StaggerAxis.STAGGERAXIS_Y:var h=0;t.y%2==1&&(h=this._mapTileSize.width/2*n),i=cc.p(t.x*this._mapTileSize.width+h+s.x,(this._layerSize.height-t.y-1)*(this._mapTileSize.height-(this._mapTileSize.height-this._hexSideLength)/2)-s.y);break;case cc.TiledMap.StaggerAxis.STAGGERAXIS_X:var r=0;t.x%2==1&&(r=this._mapTileSize.height/2*-n),i=cc.p(t.x*(this._mapTileSize.width-(this._mapTileSize.width-this._hexSideLength)/2)+s.x,(this._layerSize.height-t.y-1)*this._mapTileSize.height+r-s.y)}return i},_calculateLayerOffset:function(t){var i=cc.p(0,0);switch(this.layerOrientation){case cc.TiledMap.Orientation.ORTHO:i=cc.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case cc.TiledMap.Orientation.ISO:i=cc.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case cc.TiledMap.Orientation.HEX:if(this._staggerAxis===cc.TiledMap.StaggerAxis.STAGGERAXIS_Y){var s=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN?this._mapTileSize.width/2:0;i=cc.p(t.x*this._mapTileSize.width+s,-t.y*(this._mapTileSize.height-(this._mapTileSize.width-this._hexSideLength)/2))}else if(this._staggerAxis===cc.TiledMap.StaggerAxis.STAGGERAXIS_X){var n=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?this._mapTileSize.height/2:0;i=cc.p(t.x*(this._mapTileSize.width-(this._mapTileSize.width-this._hexSideLength)/2),-t.y*this._mapTileSize.height+n)}}return i},_updateTileForGID:function(t,i){if(this._texGrids[t]){var s=0|i.x+i.y*this._layerSize.width;s<this.tiles.length&&(this.tiles[s]=t)}},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if("automatic"===t){this._useAutomaticVertexZ=!0;var i=this.getProperty("cc_alpha_func"),s=0;i&&(s=parseFloat(i)),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this.shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,s))}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,i,s){var n=this.getPositionAt(i);if(t.setPosition(n),t.setVertexZ(this._vertexZForPos(i)),t.setAnchorPoint(0,0),t.setOpacity(this._opacity),t.setFlippedX(!1),t.setFlippedY(!1),t.setRotation(0),(s&cc.TiledMap.TileFlag.DIAGONAL)>>>0){t.setAnchorPoint(.5,.5),t.setPosition(n.x+t.width/2,n.y+t.height/2);var h=(s&(cc.TiledMap.TileFlag.HORIZONTAL|cc.TiledMap.TileFlag.VERTICAL)>>>0)>>>0;h===cc.TiledMap.TileFlag.HORIZONTAL?t.setRotation(90):h===cc.TiledMap.TileFlag.VERTICAL?t.setRotation(270):h===(cc.TiledMap.TileFlag.VERTICAL|cc.TiledMap.TileFlag.HORIZONTAL)>>>0?(t.setRotation(90),t.setFlippedX(!0)):(t.setRotation(270),t.setFlippedX(!0))}else(s&cc.TiledMap.TileFlag.HORIZONTAL)>>>0&&t.setFlippedX(!0),(s&cc.TiledMap.TileFlag.VERTICAL)>>>0&&t.setFlippedY(!0)},_vertexZForPos:function(t,i){void 0===i&&(i=t.y,t=t.x);var s=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case cc.TiledMap.Orientation.ISO:s=-(this._layerSize.width+this._layerSize.height-(t+i));break;case cc.TiledMap.Orientation.ORTHO:s=-(this._layerSize.height-i);break;case cc.TiledMap.Orientation.HEX:cc.logID(7210);break;default:cc.logID(7211)}else s=this._vertexZvalue;return s}})},{}],279:[function(t,i,s){_ccsg.TMXObject=cc.T({O:{sgNode:null,offset:cc.p(0,0),gid:0,name:"",type:null,id:0,objectVisible:!0,objectSize:cc.size(0,0),objectRotation:0,_properties:null,_groupSize:cc.size(0,0)},initWithInfo:function(t,i,s,n){this.setProperties(t),this.setObjectName(t.name),this.id=t.id,this.gid=t.gid,this.type=t.type,this.offset=cc.p(t.x,t.y),this.objectSize=cc.size(t.width,t.height),this.objectVisible=t.visible,this.objectRotation=t.rotation,this._groupSize=s,this.type===cc.TiledMap.TMXObjectType.IMAGE?this.sgNode=new _ccsg.TMXObjectImage(this,i):this.sgNode=new _ccsg.TMXObjectShape(this,i,n)},getObjectName:function(){return this.name},getProperty:function(t){return this._properties[t]},getProperties:function(){return this._properties},setObjectName:function(t){this.name=t},setProperties:function(t){this._properties=t}}),_ccsg.TMXObjectImage=_ccsg.Sprite.extend({_container:null,ctor:function(t,i){_ccsg.Sprite.prototype.ctor.call(this),this._container=t,this.initWithMapInfo(i)},initWithMapInfo:function(t){if(!this._container.gid)return!1;for(var i,s=t.getTilesets(),n=s.length-1;n>=0;n--){var h=s[n];if((this._container.gid&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0>=h.firstGid){i=h;break}}if(!i)return!1;this.setVisible(this._container.objectVisible);var r=cc.textureCache.addImage(cc.path._normalize(h.sourceImage));return this._initWithTileset(r,i),this._initPosWithMapInfo(t),this.setRotation(this._container.objectRotation),(this._container.gid&cc.TiledMap.TileFlag.HORIZONTAL)>>>0&&this.setFlippedX(!0),(this._container.gid&cc.TiledMap.TileFlag.VERTICAL)>>>0&&this.setFlippedY(!0),!0},_initWithTileset:function(t,i){if(t.isLoaded()){i.imageSize.width=t.width,i.imageSize.height=t.height;var s=i.rectForGID(this._container.gid);this.initWithTexture(t,s),this.setScaleX(this._container.objectSize.width/s.size.width),this.setScaleY(this._container.objectSize.height/s.size.height)}else t.once("load",function(){this._initWithTileset(t,i)},this)},_initPosWithMapInfo:function(t){switch(t.getOrientation()){case cc.TiledMap.Orientation.ORTHO:case cc.TiledMap.Orientation.HEX:this.setAnchorPoint(cc.p(0,0)),this.setPosition(this._container.offset.x,this._container._groupSize.height-this._container.offset.y);break;case cc.TiledMap.Orientation.ISO:this.setAnchorPoint(cc.p(.5,0));var i=cc.p(this._container.offset.x/t._tileSize.height,this._container.offset.y/t._tileSize.height),s=cc.p(t._tileSize.width/2*(t._mapSize.width+i.x-i.y),t._tileSize.height/2*(2*t._mapSize.height-i.x-i.y));this.setPosition(s)}}}),_ccsg.TMXObjectShape=cc.DrawNode.extend({_container:null,_color:cc.Color.WHITE,_mapOrientation:0,_mapInfo:null,ctor:function(t,i,s){cc.DrawNode.prototype.ctor.call(this),this.setLineWidth(1),this._container=t,this._color=s,this._mapInfo=i,this._mapOrientation=i.getOrientation(),this._initShape()},_initShape:function(){var t;if(cc.TiledMap.Orientation.ISO!==this._mapOrientation){var i=cc.p(0,this._container._groupSize.height);t=cc.p(i.x+this._container.offset.x,i.y-this._container.offset.y)}else t=this._getPosByOffset(cc.p(0,0));switch(this.setPosition(t),this.setRotation(this._container.objectRotation),this._container.type){case cc.TiledMap.TMXObjectType.RECT:this._drawRect();break;case cc.TiledMap.TMXObjectType.ELLIPSE:this._drawEllipse();break;case cc.TiledMap.TMXObjectType.POLYGON:this._drawPoly(t,!0);break;case cc.TiledMap.TMXObjectType.POLYLINE:this._drawPoly(t,!1)}this.setVisible(this._container.objectVisible)},_getPosByOffset:function(t){var i=this._mapInfo.getMapSize(),s=this._mapInfo.getTileSize(),n=cc.p((this._container.offset.x+t.x)/s.width*2,(this._container.offset.y+t.y)/s.height);return cc.p(s.width/2*(i.width+n.x-n.y),s.height/2*(2*i.height-n.x-n.y))},_drawRect:function(){if(cc.TiledMap.Orientation.ISO!==this._mapOrientation){var t=this._container.objectSize;t.equals(cc.Size.ZERO)?(t=cc.size(20,20),this.setAnchorPoint(cc.p(.5,.5))):this.setAnchorPoint(cc.p(0,1));var i=cc.p(0,0),s=cc.p(t.width,t.height);this.drawRect(i,s,null,this.getLineWidth(),this._color),this.setContentSize(t)}else{if(this._container.objectSize.equals(cc.Size.ZERO))return;var n=this._getPosByOffset(cc.p(0,0)),h=this._getPosByOffset(cc.p(this._container.objectSize.width,0)),r=this._getPosByOffset(cc.p(this._container.objectSize.width,this._container.objectSize.height)),e=this._getPosByOffset(cc.p(0,this._container.objectSize.height)),c=h.x-e.x,o=n.y-r.y;this.setContentSize(cc.size(c,o)),this.setAnchorPoint(cc.p((n.x-e.x)/c,1));var u=cc.p(e.x,r.y);n.subSelf(u),h.subSelf(u),r.subSelf(u),e.subSelf(u),this._container.objectSize.width>0&&(this.drawSegment(n,h,this.getLineWidth(),this._color),this.drawSegment(r,e,this.getLineWidth(),this._color)),this._container.objectSize.height>0&&(this.drawSegment(n,e,this.getLineWidth(),this._color),this.drawSegment(r,h,this.getLineWidth(),this._color))}},_drawEllipse:function(){var t=1,i=1,s=0,n=cc.p(0,0),h=null;if(cc.TiledMap.Orientation.ISO!==this._mapOrientation){var r=this._container.objectSize;r.equals(cc.Size.ZERO)?(r=cc.size(20,20),this.setAnchorPoint(cc.p(.5,.5))):this.setAnchorPoint(cc.p(0,1)),n=cc.p(r.width/2,r.height/2),r.width>r.height?(t=r.width/r.height,s=r.height/2):(i=r.height/r.width,s=r.width/2),h=this,this.setContentSize(r)}else{if(this._container.objectSize.equals(cc.Size.ZERO))return;var e=this._getPosByOffset(cc.p(0,0)),c=this._getPosByOffset(cc.p(this._container.objectSize.width,0)),o=this._getPosByOffset(cc.p(this._container.objectSize.width,this._container.objectSize.height)),u=this._getPosByOffset(cc.p(0,this._container.objectSize.height)),a=c.x-u.x,f=e.y-o.y;this.setContentSize(cc.size(a,f)),this.setAnchorPoint(cc.p((e.x-u.x)/a,1));var l=cc.p(u.x,o.y);e.subSelf(l),c.subSelf(l),o.subSelf(l),u.subSelf(l),this._container.objectSize.width>0&&(this.drawSegment(e,c,this.getLineWidth(),this._color),this.drawSegment(o,u,this.getLineWidth(),this._color)),this._container.objectSize.height>0&&(this.drawSegment(e,u,this.getLineWidth(),this._color),this.drawSegment(o,c,this.getLineWidth(),this._color)),(n=this._getPosByOffset(cc.p(this._container.objectSize.width/2,this._container.objectSize.height/2))).subSelf(l),(h=new cc.DrawNode).setLineWidth(this.getLineWidth()),h.setContentSize(cc.size(a,f)),h.setAnchorPoint(cc.p(.5,.5)),h.setPosition(n),this.addChild(h),this._container.objectSize.width>this._container.objectSize.height?(t=this._container.objectSize.width/this._container.objectSize.height,s=this._container.objectSize.height/2):(i=this._container.objectSize.height/this._container.objectSize.width,s=this._container.objectSize.width/2);var v=this._mapInfo.getTileSize(),d=Math.atan(v.width/v.height);s/=Math.sin(d),h.setRotationX(cc.radiansToDegrees(d)),h.setRotationY(90-cc.radiansToDegrees(d))}h.drawCircle(n,s,0,50,!1,this.getLineWidth(),this._color),h.setScaleX(t),h.setScaleY(i)},_drawPoly:function(t,i){for(var s,n=this._container.getProperties(),h=[],r=0,e=0,c=0,o=0,u=0,a=(s=i?n.points:n.polylinePoints).length;u<a;u++){var f=s[u];h.push(cc.p(f.x,f.y)),r=Math.min(r,f.x),e=Math.min(e,f.y),c=Math.max(c,f.x),o=Math.max(o,f.y)}var l=0,v=0;if(cc.TiledMap.Orientation.ISO!==this._mapOrientation){l=c-r,v=o-e,this.setAnchorPoint(cc.p(-r/l,o/v));for(var d=0;d<h.length;d++)h[d]=cc.p(h[d].x-r,-h[d].y+o)}else{var p=this._getPosByOffset(cc.p(r,o)),g=this._getPosByOffset(cc.p(c,e)),m=this._getPosByOffset(cc.p(0,0));l=g.x-p.x,v=g.y-p.y,this.setAnchorPoint(cc.p((m.x-p.x)/l,(m.y-p.y)/v));for(var w=0;w<h.length;w++){var _=this._getPosByOffset(h[w]);h[w]=cc.p(_.x-p.x,_.y-p.y)}}this.setContentSize(cc.size(l,v)),this.drawPoly(h,null,this.getLineWidth(),this._color,!i)}})},{}],280:[function(t,i,s){_ccsg.TMXObjectGroup=_ccsg.Node.extend({O:null,groupName:"",_positionOffset:null,_mapInfo:null,_objects:[],ctor:function(t,i){_ccsg.Node.prototype.ctor.call(this),this._initGroup(t,i)},_initGroup:function(t,i){this.groupName=t.name,this._positionOffset=t.offset,this._mapInfo=i,this.O=t.getProperties();var s=i._mapSize,n=i._tileSize;if(i.orientation===cc.TiledMap.Orientation.HEX){var h=0,r=0;i.getStaggerAxis()===cc.TiledMap.StaggerAxis.STAGGERAXIS_X?(r=n.height*(s.height+.5),h=(n.width+i.getHexSideLength())*Math.floor(s.width/2)+n.width*(s.width%2)):(h=n.width*(s.width+.5),r=(n.height+i.getHexSideLength())*Math.floor(s.height/2)+n.height*(s.height%2)),this.setContentSize(h,r)}else this.setContentSize(s.width*n.width,s.height*n.height);this.setAnchorPoint(cc.p(0,0)),this.setPosition(this._positionOffset.x,-this._positionOffset.y),this.setVisible(t.visible);var e=[];t._objects instanceof Array&&(e=t._objects),this._objects=[];for(var c=0,o=e.length;c<o;c++){var u=e[c],a=new _ccsg.TMXObject;a.initWithInfo(u,i,this.getContentSize(),t._color),this._objects.push(a),a.sgNode&&(a.sgNode.setOpacity(t._opacity),this.addChild(a.sgNode,c,c))}},getPositionOffset:function(){return cc.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.O},setProperties:function(t){this.O=t},getGroupName:function(){return this.groupName},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.O[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){for(var i=0,s=this._objects.length;i<s;i++){var n=this._objects[i];if(n&&n.getObjectName()===t)return n}return null},getObjects:function(){return this._objects}})},{}],281:[function(t,i,s){t("./CCSGTMXObject"),t("./CCTMXXMLParser"),_ccsg.TMXTiledMap=_ccsg.Node.extend({O:null,mapOrientation:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,i){_ccsg.Node.prototype.ctor.call(this),this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),void 0!==i?this.initWithXML(t,i):void 0!==t&&this.initWithTMXFile(t)},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){for(var t=[],i=this._children,s=0,n=i.length;s<n;s++){var h=i[s];h&&h instanceof _ccsg.TMXObjectGroup&&t.push(h)}return t},getProperties:function(){return this.O},setProperties:function(t){this.O=t},initWithTMXFile:function(t){if(!t||0===t.length)return!1;this.width=0,this.height=0;var i=new cc.TMXMapInfo(t);if(!i)return!1;var s=i.getTilesets();return s&&0!==s.length||cc.logID(7212),this._buildWithMapInfo(i),!0},initWithXML:function(t,i){this.width=0,this.height=0;var s=new cc.TMXMapInfo(t,i),n=s.getTilesets();return n&&0!==n.length||cc.logID(7213),this._buildWithMapInfo(s),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.O=t.O,this._tileProperties=t.getTileProperties();for(var i=this._children,s=i.length-1;s>=0;s--){var n=i[s];n&&(n instanceof _ccsg.TMXLayer||n instanceof _ccsg.TMXObjectGroup)&&this.removeChild(n)}var h=0,r=t.getAllChildren();if(r&&r.length>0)for(var e=0,c=r.length;e<c;e++){var o,u=r[e];u instanceof cc.TMXLayerInfo&&u.visible&&(o=this._parseLayer(u,t),this.addChild(o,h,h),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),h++),u instanceof cc.TMXObjectGroupInfo&&(o=new _ccsg.TMXObjectGroup(u,t),this.addChild(o,h,h),h++)}},allLayers:function(){for(var t=[],i=this._children,s=0,n=i.length;s<n;s++){var h=i[s];h&&h instanceof _ccsg.TMXLayer&&t.push(h)}return t},getLayer:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var i=this._children,s=0;s<i.length;s++){var n=i[s];if(n&&n instanceof _ccsg.TMXLayer&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");for(var i=this._children,s=0;s<i.length;s++){var n=i[s];if(n&&n instanceof _ccsg.TMXObjectGroup&&n.groupName===t)return n}return null},getProperty:function(t){return this.O[t.toString()]},propertiesForGID:function(t){return cc.logID(7214),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,i){var s=this._tilesetForLayer(t,i),n=new _ccsg.TMXLayer(s,t,i);return t.ownTiles=!1,n},_tilesetForLayer:function(t,i){var s=t._layerSize,n=i.getTilesets();if(n)for(var h=n.length-1;h>=0;h--){var r=n[h];if(r)for(var e=0;e<s.height;e++)for(var c=0;c<s.width;c++){var o=c+s.width*e,u=t._tiles[o];if(0!==u&&(u&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0>=r.firstGid)return r}}return cc.logID(7215,t.name),null}});var n=_ccsg.TMXTiledMap.prototype;n.mapWidth,cc.defineGetterSetter(n,"mapWidth",n._getMapWidth,n._setMapWidth),n.mapHeight,cc.defineGetterSetter(n,"mapHeight",n._getMapHeight,n._setMapHeight),n.tileWidth,cc.defineGetterSetter(n,"tileWidth",n._getTileWidth,n._setTileWidth),n.tileHeight,cc.defineGetterSetter(n,"tileHeight",n._getTileHeight,n._setTileHeight)},{"./CCSGTMXObject":279,"./CCTMXXMLParser":284}],282:[function(t,i,s){var n=null,h=null,r=null,e=null,c=null;_ccsg.TMXLayer.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,n||(n=cc.TiledMap.Orientation,h=cc.TiledMap.TileFlag,r=h.FLIPPED_MASK,e=cc.TiledMap.StaggerAxis,c=cc.TiledMap.StaggerIndex)};var o=_ccsg.TMXLayer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=_ccsg.TMXLayer.CanvasRenderCmd,o.rendering=function(t,i,s){var o=this._node,u=o._rotationX||o._rotationY,a=o.layerOrientation,f=o.tiles,l=o._opacity/255;if(f&&!(l<=0)){var v=o._mapTileSize.width,d=o._mapTileSize.height,p=o.tileset._tileSize.width/cc.director._contentScaleFactor,g=o.tileset._tileSize.height/cc.director._contentScaleFactor,m=p-v,w=g-d,_=cc.winSize.width,C=cc.winSize.height,b=o._layerSize.height,y=o._layerSize.width,T=o._texGrids,S=o._spriteTiles,A=this._worldTransform,M=o._position.x,x=o._position.y,E=A.a,O=A.b,P=A.c,R=A.d,I=M*E+x*P+A.tx,L=M*O+x*R+A.ty,D=t||cc._renderContext,F=D.getContext(),N=0,k=0,B=y,G=b;cc.macro.ENABLE_TILEDMAP_CULLING&&(u||a!==n.ORTHO||(N=Math.floor(-(I-m*E)/(v*E)),k=Math.floor((L-w*R+d*b*R-C)/(d*R)),B=Math.ceil((_-I+m*E)/(v*E)),G=b-Math.floor(-(L+w*R)/(d*R)),N<0&&(N=0),k<0&&(k=0),B>y&&(B=y),G>b&&(G=b)));var z,j,V,U,W,H,X,J,Y,q,Z,Q,K,$,tt,it,st=k*y,nt=p,ht=g,rt=p*E,et=g*R,ct=!1,ot=!1;U=st+N;for(z in S)if(z<U&&S[z])J=S[z]._renderCmd,0===S[z]._localZOrder&&J.rendering&&S[z]._visible&&J.rendering(t,i,s);else if(z>=U)break;D.setTransform(A,i,s),D.setGlobalAlpha(l);var ut,at,ft,lt,vt;if(a===n.HEX){var dt=o._staggerIndex,pt=o._hexSideLength;ut=o._staggerAxis,at=o.tileset.tileOffset,ft=dt===c.STAGGERINDEX_ODD?1:-1,lt=ut===e.STAGGERAXIS_X?(v-pt)/2:0,vt=ut===e.STAGGERAXIS_Y?(d-pt)/2:0}for(j=k;j<G;++j){for(V=N;V<B;++V)if(U=st+V,S[U])J=S[U]._renderCmd,0===S[U]._localZOrder&&J.rendering&&S[U]._visible&&(J.rendering(t,i,s),D.setTransform(A,i,s),D.setGlobalAlpha(l));else if(W=o.tiles[U],(H=T[(W&r)>>>0])&&(X=o._textures[H.texId])&&X._htmlElementObj){switch(a){case n.ORTHO:q=V*v,Z=-(b-j-1)*d;break;case n.ISO:q=v/2*(y+V-j-1),Z=-d/2*(2*b-V-j-2);break;case n.HEX:q=V*(v-lt)+(ut===e.STAGGERAXIS_Y&&j%2==1?v/2*ft:0)+at.x,Z=-(b-j-1)*(d-vt)-(ut===e.STAGGERAXIS_X&&V%2==1?d/2*-ft:0)+at.y}if(Q=q+p,Y=Z-g,!u&&a===n.ISO){if((tt=Z*R-L)<-C-et){V+=Math.floor(2*(-C-tt)/et)-1;continue}if((it=I+Q*E)<-rt){V+=Math.floor(2*-it/rt)-1;continue}if($=I+q*E,K=Y*R-L,$>_||K>0){V=B;continue}}W>h.DIAGONAL&&(ct=(W&h.HORIZONTAL)>>>0,ot=(W&h.VERTICAL)>>>0),ct&&(q=-Q,F.scale(-1,1)),ot&&(Y=-Z,F.scale(1,-1)),F.drawImage(X._htmlElementObj,H.x,H.y,H.width,H.height,q,Y,nt,ht),ct&&F.scale(-1,1),ot&&F.scale(1,-1),cc.g_NumberOfDraws++}st+=y}for(z in S)z>U&&S[z]&&(J=S[z]._renderCmd,0===S[z]._localZOrder&&J.rendering&&S[z]._visible&&J.rendering(t,i,s))}}},{}],283:[function(t,i,s){function n(){cc.renderer.setDepthTest(!1)}var h=null,r=null,e=null,c=null,o=null;_ccsg.TMXLayer.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._vertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._color=new Uint32Array(1),this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);var i=90*Math.PI/180;this._sin90=Math.sin(i),this._cos90=Math.cos(i),i*=3,this._sin270=Math.sin(i),this._cos270=Math.cos(i),h||(h=cc.TiledMap.Orientation,r=cc.TiledMap.TileFlag,e=r.FLIPPED_MASK,c=cc.TiledMap.StaggerAxis,o=cc.TiledMap.StaggerIndex),this._disableDepthTestCmd=new cc.CustomRenderCmd(this,n)};var u=_ccsg.TMXLayer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);u.constructor=_ccsg.TMXLayer.WebGLRenderCmd,u.uploadData=function(t,i,s){cc.renderer.setDepthTest(!0);var n=this._node,u=n._rotationX||n._rotationY,a=n.layerOrientation,f=n.tiles;if(!f)return 0;var l=n._mapTileSize.width,v=n._mapTileSize.height,d=n.tileset._tileSize.width/cc.director._contentScaleFactor,p=n.tileset._tileSize.height/cc.director._contentScaleFactor,g=d-l,m=p-v,w=cc.winSize.width,_=cc.winSize.height,C=n._layerSize.height,b=n._layerSize.width,y=n._texGrids,T=n._spriteTiles,S=this._worldTransform,A=S.a,M=S.b,x=S.c,E=S.d,O=S.tx,P=S.ty,R=n._position.x,I=n._position.y,L=R*A+I*x+O,D=R*M+I*E+P,F=d*A,N=p*E,k=n._opacity,B=this._displayedColor.r,G=this._displayedColor.g,z=this._displayedColor.b;if(n._opacityModifyRGB){var j=k/255;B*=j,G*=j,z*=j}this._color[0]=k<<24|z<<16|G<<8|B;var V=0,U=0,W=b,H=C,X=A,J=E,Y=L,q=D,Z=F,Q=N,K=cc.macro.ENABLE_TILEDMAP_CULLING;if(K){if(this._cameraFlag>0){var $=cc.affineTransformConcat(cc.Camera.main.viewMatrix,S);X=$.a,J=$.d,Y=R*X+I*$.c+$.tx,q=R*$.b+I*J+$.ty,Z=d*X,Q=p*J}u||a!==h.ORTHO||(V=Math.floor(-(Y-g*X)/(l*X)),U=Math.floor((q-m*J+v*C*J-_)/(v*J)),W=Math.ceil((w-Y+g*X)/(l*X)),H=C-Math.floor(-(q+m*J)/(v*J)),V<0&&(V=0),U<0&&(U=0),W>b&&(W=b),H>C&&(H=C))}var tt,it,st,nt,ht,rt,et,ct,ot,ut,at,ft,lt,vt,dt,pt,gt,mt,wt,_t=s,Ct=U*b,bt=A,yt=M,Tt=x,St=E,At=O,Mt=P,xt=!1,Et=!1,Ot=!1,Pt=this._vertices;if(a===h.HEX){var Rt=n._staggerIndex,It=n._hexSideLength;dt=n._staggerAxis,pt=n.tileset.tileOffset,wt=Rt===o.STAGGERINDEX_ODD?1:-1,gt=dt===c.STAGGERAXIS_X?(l-It)/2:0,mt=dt===c.STAGGERAXIS_Y?(v-It)/2:0}for(tt=U;tt<H;++tt){for(it=V;it<W;++it)if(_t+24>t.length&&(cc.renderer._increaseBatchingSize((_t-s)/6,cc.renderer.VertexType.QUAD),cc.renderer._batchRendering(),s=0,_t=0),st=Ct+it,T[st])T[st]._vertexZ=n._vertexZ+cc.renderer.assignedZStep*st/f.length;else if(nt=n.tiles[st],ht=y[(nt&e)>>>0]){switch(a){case h.ORTHO:ct=it*l,ot=(C-tt-1)*v,st=n._vertexZ+cc.renderer.assignedZStep*st/f.length;break;case h.ISO:ct=l/2*(b+it-tt-1),ot=v/2*(2*C-it-tt-2),st=n._vertexZ+cc.renderer.assignedZStep*(n.height-ot)/n.height;break;case h.HEX:ct=it*(l-gt)+(dt===c.STAGGERAXIS_Y&&tt%2==1?l/2*wt:0)+pt.x,ot=(C-tt-1)*(v-mt)+(dt===c.STAGGERAXIS_X&&it%2==1?v/2*-wt:0)-pt.y,st=n._vertexZ+cc.renderer.assignedZStep*(n.height-ot)/n.height}if(ut=ct+d,et=ot+p,K&&!u&&a===h.ISO){if((lt=q+ot*J)>_+Q){it+=Math.floor(2*(lt-_)/Q)-1;continue}if((vt=Y+ut*X)<-Z){it+=Math.floor(2*-vt/Z)-1;continue}if(ft=Y+ct*X,at=q+et*J,ft>w||at<0){it=W;continue}}for(nt>r.DIAGONAL&&(xt=!0,Et=(nt&r.HORIZONTAL)>>>0,Ot=(nt&r.VERTICAL)>>>0),Pt[0].x=ct*bt+et*Tt+At,Pt[0].y=ct*yt+et*St+Mt,Pt[1].x=ct*bt+ot*Tt+At,Pt[1].y=ct*yt+ot*St+Mt,Pt[2].x=ut*bt+et*Tt+At,Pt[2].y=ut*yt+et*St+Mt,Pt[3].x=ut*bt+ot*Tt+At,Pt[3].y=ut*yt+ot*St+Mt,rt=0;rt<4;++rt){switch(t[_t]=Pt[rt].x,t[_t+1]=Pt[rt].y,t[_t+2]=st,i[_t+3]=this._color[0],rt){case 0:t[_t+4]=Et?ht.r:ht.l,t[_t+5]=Ot?ht.b:ht.t;break;case 1:t[_t+4]=Et?ht.r:ht.l,t[_t+5]=Ot?ht.t:ht.b;break;case 2:t[_t+4]=Et?ht.l:ht.r,t[_t+5]=Ot?ht.b:ht.t;break;case 3:t[_t+4]=Et?ht.l:ht.r,t[_t+5]=Ot?ht.t:ht.b}_t+=6}xt&&(bt=A,yt=M,Tt=x,St=E,At=O,Mt=P,Et=!1,Ot=!1,xt=!1)}Ct+=b}return(_t-s)/6}},{}],284:[function(t,i,s){t("../compression/ZipUtils");var n=t("../compression/zlib.min");cc.TMXLayerInfo=cc._Class.extend({ctor:function(){this.O={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.p(0,0)},getProperties:function(){return this.O},setProperties:function(t){this.O=t}}),cc.TMXObjectGroupInfo=cc._Class.extend({ctor:function(){this.O={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new cc.Color(255,255,255,255),this.offset=cc.p(0,0),this._draworder="topdown"},getProperties:function(){return this.O},setProperties:function(t){this.O=t}}),cc.TMXTilesetInfo=cc._Class.extend({ctor:function(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage="",this.imageSize=cc.size(0,0),this.tileOffset=cc.p(0,0),this._tileSize=cc.size(0,0)},rectForGID:function(t,i){var s=i||cc.rect(0,0,0,0);s.width=this._tileSize.width,s.height=this._tileSize.height,t&=cc.TiledMap.TileFlag.FLIPPED_MASK,t-=parseInt(this.firstGid,10);var n=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return s.x=parseInt(t%n*(this._tileSize.width+this.spacing)+this.margin,10),s.y=parseInt(parseInt(t/n,10)*(this._tileSize.height+this.spacing)+this.margin,10),s}}),cc.TMXMapInfo=cc.SAXParser.extend({O:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_allChildren:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_staggerAxis:null,_staggerIndex:null,_hexSideLength:0,ctor:function(t,i){cc.SAXParser.prototype.ctor.apply(this),this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this._allChildren=[],this.O=[],this._tileProperties={},void 0!==i?this.initWithXML(t,i):void 0!==t&&this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getStaggerAxis:function(){return this._staggerAxis},setStaggerAxis:function(t){this._staggerAxis=t},getStaggerIndex:function(){return this._staggerIndex},setStaggerIndex:function(t){this._staggerIndex=t},getHexSideLength:function(){return this._hexSideLength},setHexSideLength:function(t){this._hexSideLength=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._allChildren.push(t),this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t)},getAllChildren:function(){return this._allChildren},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.O},setProperties:function(t){this.O=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,i){return this._internalInit(null,i),this.parseXMLString(t)},parseXMLFile:function(t,i,s){var n=(i=i||!1)?t:cc.loader.getRes(t);if(!n)throw new Error("Please load the resource first : "+t);var h,r,e=this._parseXML(n).documentElement,c=e.getAttribute("version"),o=e.getAttribute("orientation"),u=e.getAttribute("staggeraxis"),a=e.getAttribute("staggerindex"),f=e.getAttribute("hexsidelength");if("map"===e.nodeName){"1.0"!==c&&null!==c&&cc.logID(7216,c),"orthogonal"===o?this.orientation=cc.TiledMap.Orientation.ORTHO:"isometric"===o?this.orientation=cc.TiledMap.Orientation.ISO:"hexagonal"===o?this.orientation=cc.TiledMap.Orientation.HEX:null!==o&&cc.logID(7217,o),"x"===u?this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===u&&this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===a?this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===a&&this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),f&&this.setHexSideLength(parseFloat(f));var l=cc.size(0,0);l.width=parseFloat(e.getAttribute("width")),l.height=parseFloat(e.getAttribute("height")),this.setMapSize(l),(l=cc.size(0,0)).width=parseFloat(e.getAttribute("tilewidth")),l.height=parseFloat(e.getAttribute("tileheight")),this.setTileSize(l);var v=e.querySelectorAll("map > properties >  property");if(v){var d={};for(h=0;h<v.length;h++)d[v[h].getAttribute("name")]=v[h].getAttribute("value");this.O=d}}var p=e.getElementsByTagName("tileset");for("map"!==e.nodeName&&(p=[]).push(e),h=0;h<p.length;h++){var g=p[h],m=g.getAttribute("source");if(m){var w=parseInt(g.getAttribute("firstgid")),_=i?cc.path.join(this._resources,m):cc.path.changeBasename(t,m);this.parseXMLFile(_,!1,w)}else{var C=new cc.TMXTilesetInfo;C.name=g.getAttribute("name")||"",C.firstGid=s||parseInt(g.getAttribute("firstgid"))||0,C.spacing=parseInt(g.getAttribute("spacing"))||0,C.margin=parseInt(g.getAttribute("margin"))||0;var b=cc.size(0,0);b.width=parseFloat(g.getAttribute("tilewidth")),b.height=parseFloat(g.getAttribute("tileheight")),C._tileSize=b;var y=g.getElementsByTagName("image")[0].getAttribute("source"),T=-1;if(this.tmxFileName&&(T=this.tmxFileName.lastIndexOf("/")),-1!==T){var S=this.tmxFileName.substr(0,T+1);C.sourceImage=S+y}else C.sourceImage=this._resources+(this._resources?"/":"")+y;this.setTilesets(C);var A=g.getElementsByTagName("tileoffset")[0];if(A){var M=parseFloat(A.getAttribute("x")),x=parseFloat(A.getAttribute("y"));C.tileOffset=cc.p(M,x)}var E=g.getElementsByTagName("tile");if(E)for(var O=0;O<E.length;O++){var P=E[O];this.parentGID=parseInt(C.firstGid)+parseInt(P.getAttribute("id")||0);var R=P.querySelectorAll("properties > property");if(R){var I={};for(r=0;r<R.length;r++)I[R[r].getAttribute("name")]=R[r].getAttribute("value");this._tileProperties[this.parentGID]=I}}}}var L=e.childNodes;for(h=0;h<L.length;h++){var D=L[h];if(!this._shouldIgnoreNode(D)){if("layer"===D.nodeName){var F=this._parseLayer(D);this.setLayers(F)}if("objectgroup"===D.nodeName){var N=this._parseObjectGroup(D);this.setObjectGroups(N)}}}return e},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},_parseLayer:function(t){var i=t.getElementsByTagName("data")[0],s=new cc.TMXLayerInfo;s.name=t.getAttribute("name");var h=cc.size(0,0);h.width=parseFloat(t.getAttribute("width")),h.height=parseFloat(t.getAttribute("height")),s._layerSize=h;var r=t.getAttribute("visible");s.visible=!("0"==r);var e=t.getAttribute("opacity")||1;s._opacity=e?parseInt(255*parseFloat(e)):255,s.offset=cc.p(parseFloat(t.getAttribute("x"))||0,parseFloat(t.getAttribute("y"))||0);for(var c="",o=0;o<i.childNodes.length;o++)c+=i.childNodes[o].nodeValue;c=c.trim();var u=i.getAttribute("compression"),a=i.getAttribute("encoding");if(u&&"gzip"!==u&&"zlib"!==u)return cc.logID(7218),null;var f;switch(u){case"gzip":f=cc.Codec.unzipBase64AsArray(c,4);break;case"zlib":f=function(t){if(t.length%4!=0)return null;for(var i=t.length/4,s=window.Uint32Array?new Uint32Array(i):[],n=0;n<i;n++){var h=4*n;s[n]=t[h]+256*t[h+1]+65536*t[h+2]+t[h+3]*(1<<24)}return s}(new n.Inflate(cc.Codec.Base64.decodeAsArray(c,1)).decompress());break;case null:case"":if("base64"===a)f=cc.Codec.Base64.decodeAsArray(c,4);else if("csv"===a){f=[];for(var l=c.split(","),v=0;v<l.length;v++)f.push(parseInt(l[v]))}else{var d=i.getElementsByTagName("tile");f=[];for(var p=0;p<d.length;p++)f.push(parseInt(d[p].getAttribute("gid")))}break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.logID(7219)}f&&(s._tiles=new Uint32Array(f));var g=t.querySelectorAll("properties > property");if(g){for(var m={},w=0;w<g.length;w++)m[g[w].getAttribute("name")]=g[w].getAttribute("value");s.O=m}return s},_parseObjectGroup:function(t){var i=new cc.TMXObjectGroupInfo;i.name=t.getAttribute("name")||"",i.offset=cc.p(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var s=t.getAttribute("opacity")||1;i._opacity=s?parseInt(255*parseFloat(s)):255;var n=t.getAttribute("visible");n&&0===parseInt(n)&&(i.visible=!1);var h=t.getAttribute("color");h&&(i._color=cc.hexToColor(h));var r=t.getAttribute("draworder");r&&(i._draworder=r);var e=t.querySelectorAll("objectgroup > properties > property");if(e){for(var c={},o=0;o<e.length;o++)c[e[o].getAttribute("name")]=e[o].getAttribute("value");i.setProperties(c)}var u=t.querySelectorAll("object"),a=cc.director.getContentScaleFactor();if(u)for(var f=0;f<u.length;f++){var l=u[f],v={};v.id=l.getAttribute("id")||0,v.name=l.getAttribute("name")||"",v.width=parseFloat(l.getAttribute("width"))||0,v.height=parseFloat(l.getAttribute("height"))||0,v.x=(l.getAttribute("x")||0)/a,v.y=(l.getAttribute("y")||0)/a,v.rotation=parseFloat(l.getAttribute("rotation"))||0;var d=l.querySelectorAll("properties > property");if(d)for(var p=0;p<d.length;p++)v[d[p].getAttribute("name")]=d[p].getAttribute("value");var g=l.getAttribute("visible");v.visible=!(g&&0===parseInt(g));var m=l.getAttribute("gid");m&&(v.gid=parseInt(m),v.type=cc.TiledMap.TMXObjectType.IMAGE);var w=l.querySelectorAll("ellipse");w&&w.length>0&&(v.type=cc.TiledMap.TMXObjectType.ELLIPSE);var _=l.querySelectorAll("polygon");if(_&&_.length>0){v.type=cc.TiledMap.TMXObjectType.POLYGON;var C=_[0].getAttribute("points");C&&(v.points=this._parsePointsString(C))}var b=l.querySelectorAll("polyline");if(b&&b.length>0){v.type=cc.TiledMap.TMXObjectType.POLYLINE;var y=b[0].getAttribute("points");y&&(v.polylinePoints=this._parsePointsString(y))}v.type||(v.type=cc.TiledMap.TMXObjectType.RECT),i._objects.push(v)}return i},_parsePointsString:function(t){if(!t)return null;for(var i=[],s=t.split(" "),n=0;n<s.length;n++){var h=s[n].split(",");i.push({x:parseFloat(h[0]),y:parseFloat(h[1])})}return i},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,i){this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,i&&(this._resources=i),this._objectGroups.length=0,this._allChildren.length=0,this.O.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TiledMap.NONE}});var h=cc.TMXMapInfo.prototype;h.mapWidth,cc.defineGetterSetter(h,"mapWidth",h._getMapWidth,h._setMapWidth),h.mapHeight,cc.defineGetterSetter(h,"mapHeight",h._getMapHeight,h._setMapHeight),h.tileWidth,cc.defineGetterSetter(h,"tileWidth",h._getTileWidth,h._setTileWidth),h.tileHeight,cc.defineGetterSetter(h,"tileHeight",h._getTileHeight,h._setTileHeight),cc.TMXMapInfo.create=function(t,i){return new cc.TMXMapInfo(t,i)},cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8},{"../compression/ZipUtils":29,"../compression/zlib.min":32}],285:[function(t,i,s){t("./CCSGTMXLayer"),t("./CCTMXLayerCanvasRenderCmd"),t("./CCTMXLayerWebGLRenderCmd");var n=cc.T({name:"cc.TiledLayer",S:cc._SGComponent,onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null)},_initSgNode:function(){var t=this._sgNode;if(t){this.enabledInHierarchy||t.setVisible(!1),this._registSizeProvider();var i=this.node;t.setAnchorPoint(i.getAnchorPoint())}},_replaceSgNode:function(t){t!==this._sgNode&&(this._removeSgNode(),this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),t&&t instanceof _ccsg.TMXLayer?(this._sgNode=t,this._initSgNode()):this._sgNode=null)},getLayerName:function(){return this._sgNode?this._sgNode.getLayerName():""},setLayerName:function(t){this._sgNode&&this._sgNode.setLayerName(t)},getProperty:function(t){return this._sgNode?this._sgNode.getProperty(t):null},getPositionAt:function(t,i){return this._sgNode?(void 0!==i&&(t=cc.p(t,i)),this._sgNode.getPositionAt(t)):null},removeTileAt:function(t,i){this._sgNode&&(void 0!==i&&(t=cc.p(t,i)),this._sgNode.removeTileAt(t))},setTileGID:function(t,i,s,n){if(this._sgNode){if(void 0===i)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var h;void 0===n&&i instanceof cc.Vec2?(h=i,n=s):h=cc.p(i,s),this._sgNode.setTileGID(t,h,n)}},getTileGIDAt:function(t,i){return this._sgNode?(void 0!==i&&(t=cc.p(t,i)),this._sgNode.getTileGIDAt(t)):0},getTileAt:function(t,i){return this._sgNode?(void 0!==i&&(t=cc.p(t,i)),this._sgNode.getTileAt(t)):null},releaseMap:function(){this._sgNode&&this._sgNode.releaseMap()},setContentSize:function(t,i){this._sgNode&&(void 0!==i&&(t=cc.size(t,i)),this._sgNode.setContentSize(t))},getTexture:function(){return this._sgNode?this._sgNode.getTexture():null},setTexture:function(t){this._sgNode&&this._sgNode.setTexture(t)},setTileOpacity:function(t){this._sgNode&&(this._sgNode._opacity=t)},getLayerSize:function(){return this._sgNode?this._sgNode.getLayerSize():cc.size(0,0)},setLayerSize:function(t){this._sgNode&&this._sgNode.setLayerSize(t)},getMapTileSize:function(){return this._sgNode?this._sgNode.getMapTileSize():cc.size(0,0)},setMapTileSize:function(t){this._sgNode&&this._sgNode.setMapTileSize(t)},getTiles:function(){return this._sgNode?this._sgNode.getTiles():null},setTiles:function(t){this._sgNode&&this._sgNode.setTiles(t)},getTileSet:function(){return this._sgNode?this._sgNode.getTileSet():null},setTileSet:function(t){this._sgNode&&this._sgNode.setTileSet(t)},getLayerOrientation:function(){return this._sgNode?this._sgNode.getLayerOrientation():0},setLayerOrientation:function(t){this._sgNode&&this._sgNode.setLayerOrientation(t)},getProperties:function(){return this._sgNode?this._sgNode.getProperties():null},setProperties:function(t){this._sgNode&&this._sgNode.setProperties(t)},_tryRemoveNode:function(){this.node.removeComponent(cc.TiledLayer),1===this.node._components.length&&0===this.node.getChildren().length&&this.node.removeFromParent()}});cc.TiledLayer=i.exports=n},{"./CCSGTMXLayer":278,"./CCTMXLayerCanvasRenderCmd":282,"./CCTMXLayerWebGLRenderCmd":283}],286:[function(t,i,s){t("./CCTiledMapAsset"),t("./CCTiledLayer"),t("./CCTiledObjectGroup"),t("./CCSGTMXTiledMap");var n=cc.Enum({ORTHO:0,HEX:1,ISO:2}),h=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),r=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:3758096384,FLIPPED_MASK:536870911}),e=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1}),c=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1}),o=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4}),u=cc.T({name:"cc.TiledMap",S:cc._RendererInSG,editor:!1,statics:{Orientation:n,Property:h,TileFlag:r,StaggerAxis:e,StaggerIndex:c,TMXObjectType:o},O:{_detachedChildren:{default:[],serializable:!1},_tmxFile:{default:null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile},set:function(t,i){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile())},type:cc.TiledMapAsset}},getMapSize:function(){return this._sgNode.getMapSize()},setMapSize:function(t){this._sgNode.setMapSize(t)},getTileSize:function(){return this._sgNode.getTileSize()},setTileSize:function(t){this._sgNode.setTileSize(t)},getMapOrientation:function(){return this._sgNode.getMapOrientation()},setMapOrientation:function(t){this._sgNode.setMapOrientation(t)},getObjectGroups:function(){for(var t=this.node.children,i=[],s=0,n=t.length;s<n;s++){var h=t[s].getComponent(cc.TiledObjectGroup);h&&i.push(h)}return i},getProperties:function(){return this._sgNode.getProperties()},setProperties:function(t){this._sgNode.setProperties(t)},initWithTMXFile:function(t){cc.errorID(7200)},initWithXML:function(t,i){cc.errorID(7201)},allLayers:function(){for(var t=this.node.children,i=[],s=0,n=t.length;s<n;s++){var h=t[s].getComponent(cc.TiledLayer);h&&i.push(h)}return i},getLayer:function(t){for(var i=this.node.children,s=0,n=i.length;s<n;s++){var h=i[s].getComponent(cc.TiledLayer);if(h&&h.getLayerName()===t)return h}return null},getObjectGroup:function(t){for(var i=this.node.children,s=0,n=i.length;s<n;s++){var h=i[s].getComponent(cc.TiledObjectGroup);if(h&&h.getGroupName()===t)return h}return null},getProperty:function(t){return this._sgNode.getProperty(t)},getPropertiesForGID:function(t){return this._sgNode.getPropertiesForGID(t)},onEnable:function(){0===this._detachedChildren.length&&this._moveLayersInSgNode(this._sgNode),this._super(),this._tmxFile&&this._refreshLayerEntities(),this.node.on("anchor-changed",this._anchorChanged,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-reorder",this._syncChildrenOrder,this)},onDisable:function(){this._super(),this._setLayersEnabled(!1);var t=this._plainNode;this._moveLayersInSgNode(t),this.node.off("anchor-changed",this._anchorChanged,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-reorder",this._syncChildrenOrder,this)},onDestroy:function(){this._super(),this._removeLayerEntities()},_createSgNode:function(){return new _ccsg.TMXTiledMap},_initSgNode:function(){this._applyFile()},_resetSgSize:function(){this.node.setContentSize(this._sgNode.getContentSize()),this._sgNode.setContentSize(0,0)},_onMapLoaded:function(){this._refreshLayerEntities(),this._enabled?this._anchorChanged():this._moveLayersInSgNode(this._sgNode),this._setLayersEnabled(this._enabled),this._resetSgSize()},_setLayersEnabled:function(t){for(var i=this.node.getChildren(),s=i.length-1;s>=0;s--){var n=i[s].getComponent(cc.TiledLayer);n&&(n.enabled=t)}},_moveLayersInSgNode:function(t){this._detachedChildren.length=0;for(var i=t.getChildren(),s=i.length-1;s>=0;s--){var n=i[s];if(n instanceof _ccsg.TMXLayer||n instanceof _ccsg.TMXObjectGroup){t.removeChild(n);var h=n.getLocalZOrder();this._detachedChildren.push({sgNode:n,zorder:h})}}},_removeLayerEntities:function(){for(var t=this.node.getChildren(),i=t.length-1;i>=0;i--){var s=t[i];if(s.isValid){var n=s.getComponent(cc.TiledLayer);n&&n._tryRemoveNode();var h=s.getComponent(cc.TiledObjectGroup);h&&h._tryRemoveNode()}}},_refreshLayerEntities:function(){var t,i,s=this.node.getChildren(),n=[],h=[],r=[];for(t=0;t<this._detachedChildren.length;t++){var e=this._detachedChildren[t];this._sgNode.addChild(e.sgNode,e.zorder,e.zorder)}this._detachedChildren.length=0;var c=this._sgNode.allLayers().map(function(t){return t.getLayerName()}),o=this._sgNode.getObjectGroups().map(function(t){return t.getGroupName()});for(t=s.length-1;t>=0;t--){var u=s[t],a=u.getComponent(cc.TiledLayer),f=u.getComponent(cc.TiledObjectGroup);if(a){var l=a.getLayerName();if(l||(l=u._name),c.indexOf(l)<0)a._tryRemoveNode();else{n.push(u);var v=this._sgNode.getLayer(l);a._replaceSgNode(v),a.enabled=!0}}else if(f){var d=f.getGroupName();if(d||(d=u._name),o.indexOf(d)<0)f._tryRemoveNode();else{h.push(u);var p=this._sgNode.getObjectGroup(d);f._replaceSgNode(p),f.enabled=p.isVisible()}}else r.push({child:u,index:u.getSiblingIndex()})}var g=n.map(function(t){return t.getComponent(cc.TiledLayer).getLayerName()});for(t=0,i=c.length;t<i;t++){var m=c[t],w=this._sgNode.getLayer(m),_=g.indexOf(m);if(_<0){var C=this.node.getChildByName(m),b=null;C&&!C.getComponent(cc._SGComponent)?b=C.addComponent(cc.TiledLayer):(C=new cc.Node(m),this.node.addChild(C),b=C.addComponent(cc.TiledLayer)),C&&b||cc.errorID(7202),b._replaceSgNode(w),C.setSiblingIndex(w.getLocalZOrder()),C.setAnchorPoint(this.node.getAnchorPoint())}}var y=h.map(function(t){return t.getComponent(cc.TiledObjectGroup).getGroupName()});for(t=0,i=o.length;t<i;t++){m=o[t];var T=this._sgNode.getObjectGroup(m);if((_=y.indexOf(m))<0){var S=null;(C=this.node.getChildByName(m))&&!C.getComponent(cc._SGComponent)?S=C.addComponent(cc.TiledObjectGroup):(C=new cc.Node(m),this.node.addChild(C),S=C.addComponent(cc.TiledObjectGroup)),C&&S||cc.errorID(7202),S._replaceSgNode(T),C.setSiblingIndex(T.getLocalZOrder()),C.setAnchorPoint(this.node.getAnchorPoint()),S.enabled=T.isVisible()}}var A=this.node.getChildren(),M=[];for(t=0,i=A.length;t<i;t++)a=(u=A[t]).getComponent(cc.TiledLayer),f=u.getComponent(cc.TiledObjectGroup),(a||f)&&M.push(u._name);var x=[],E=[],O=this._sgNode.getChildren();for(t=0,i=O.length;t<i;t++)(u=O[t])instanceof _ccsg.TMXLayer?(x.push(u.getLayerName()),E.push(u)):u instanceof _ccsg.TMXObjectGroup&&(x.push(u.getGroupName()),E.push(u));for(t=x.length-1;t>=0;t--){var P=x[t];t!==M.indexOf(P)&&this.node.getChildByName(P).setSiblingIndex(E[t].getLocalZOrder())}for(t=0,i=r.length;t<i;t++)(e=r[t]).child.setSiblingIndex(e.index);this._syncChildrenOrder()},_anchorChanged:function(){for(var t=this.node.children,i=this.node.getAnchorPoint(),s=0,n=t.length;s<n;s++){var h=t[s];h.getComponent(cc.TiledLayer)&&h.setAnchorPoint(i)}},_childAdded:function(t){var i=t.detail;if(i){var s=i.getComponent(cc.TiledLayer),n=i.getComponent(cc.TiledObjectGroup);if(!s&&!n){var h=this.node.getChildrenCount();i.setSiblingIndex(h),i._sgNode&&i._sgNode.setLocalZOrder(h)}}},_syncChildrenOrder:function(){for(var t=this.node.children,i=0,s=t.length;i<s;i++){var n=t[i],h=n.getComponent(cc.TiledLayer),r=n.getComponent(cc.TiledObjectGroup),e=n.getSiblingIndex();h&&h._sgNode&&h._sgNode.setLocalZOrder(e),r&&r._sgNode&&r._sgNode.setLocalZOrder(e),n._sgNode&&n._sgNode.setLocalZOrder(e)}},_applyFile:function(){var t=this._sgNode,i=this._tmxFile;if(i){var s=cc.url._rawAssets+i.tmxFolderPath;s=cc.path.stripSep(s),t.initWithXML(i.tmxXmlStr,s)&&(this._detachedChildren.length=0,this._onMapLoaded())}else{for(var n=t.allLayers(),h=0,r=n.length;h<r;h++)t.removeChild(n[h]);var e=t.getObjectGroups();for(h=0,r=e.length;h<r;h++)t.removeChild(e[h]);this._detachedChildren.length=0,this._removeLayerEntities()}}});cc.TiledMap=i.exports=u,cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",function(){return cc.errorID(7203),[]},!1)},{"./CCSGTMXTiledMap":281,"./CCTiledLayer":285,"./CCTiledMapAsset":287,"./CCTiledObjectGroup":288}],287:[function(t,i,s){var n=cc.T({name:"cc.TiledMapAsset",S:cc.Asset,O:{tmxXmlStr:{default:""},tmxFolderPath:{default:""},textures:{default:[],url:[cc.Texture2D]},tsxFiles:{default:[],url:[cc.RawAsset]}},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=n,i.exports=n},{}],288:[function(t,i,s){t("./CCSGTMXObjectGroup");var n=cc.T({name:"cc.TiledObjectGroup",S:cc._SGComponent,onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null)},_initSgNode:function(){var t=this._sgNode;t&&(this._registSizeProvider(),t.setAnchorPoint(this.node.getAnchorPoint()))},_replaceSgNode:function(t){t!==this._sgNode&&(this._removeSgNode(),this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),t&&t instanceof _ccsg.TMXObjectGroup?(this._sgNode=t,this._initSgNode()):this._sgNode=null)},getPositionOffset:function(){return this._sgNode?this._sgNode.getPositionOffset():cc.p(0,0)},setPositionOffset:function(t){this._sgNode&&this._sgNode.setPositionOffset(t)},getProperties:function(){return this._sgNode?this._sgNode.getProperties():null},setProperties:function(t){this._sgNode&&this._sgNode.setProperties(t)},getGroupName:function(){return this._sgNode?this._sgNode.getGroupName():""},setGroupName:function(t){this._sgNode&&this._sgNode.setGroupName(t)},getProperty:function(t){return this._sgNode?this._sgNode.propertyNamed(t):null},getObject:function(t){return this._sgNode?this._sgNode.getObject(t):null},getObjects:function(){return this._sgNode?this._sgNode.getObjects():[]},_tryRemoveNode:function(){this.node.removeComponent(cc.TiledObjectGroup),1===this.node._components.length&&0===this.node.getChildren().length&&this.node.removeFromParent()}});cc.TiledObjectGroup=i.exports=n},{"./CCSGTMXObjectGroup":280}],289:[function(t,i,s){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleSystem"),t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/motion-streak/CCMotionStreak"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./extensions/ccpool/CCPool"),t("./cocos2d/actions"),t("./external/chipmunk/chipmunk"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")},{"./cocos2d/actions":10,"./cocos2d/animation":19,"./cocos2d/core":122,"./cocos2d/core/components/CCStudioComponent":94,"./cocos2d/deprecated":239,"./cocos2d/motion-streak/CCMotionStreak":254,"./cocos2d/particle/CCParticleAsset":258,"./cocos2d/particle/CCParticleSystem":262,"./cocos2d/tilemap/CCTiledMap":286,"./cocos2d/tilemap/CCTiledMapAsset":287,"./extensions/ccpool/CCNodePool":290,"./extensions/ccpool/CCPool":291,"./extensions/dragonbones":299,"./extensions/spine":308,"./external/chipmunk/chipmunk":311}],290:[function(t,i,s){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,i=0;i<t;++i)this._pool[i].destroy();this._pool.length=0},put:function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent(!1);var i=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;i&&i.unuse&&i.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var i=this._pool[t];this._pool.length=t;var s=this.poolHandlerComp?i.getComponent(this.poolHandlerComp):null;return s&&s.reuse&&s.reuse.apply(s,arguments),i}},i.exports=cc.NodePool},{}],291:[function(t,i,s){var n=[];cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var i=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,i)},putInPool:function(t){var i=cc.js._getClassId(t.constructor);i&&(this._pool[i]||(this._pool[i]=[]),t.unuse&&t.unuse(),this._pool[i].push(t))},hasObject:function(t){var i=cc.js._getClassId(t),s=this._pool[i];return!(!s||0===s.length)},removeObject:function(t){var i=cc.js._getClassId(t.constructor);if(i){var s=this._pool[i];if(s)for(var n=0;n<s.length;n++)t===s[n]&&s.splice(n,1)}},getFromPool:function(t){if(this.hasObject(t)){var i=cc.js._getClassId(t),s=this._pool[i];n.length=arguments.length-1;for(var h=0;h<n.length;h++)n[h]=arguments[h+1];var r=s.pop();return r.reuse&&r.reuse.apply(r,n),n.length=0,r}},drainAllPools:function(){this._pool={}}}},{}],292:[function(t,i,s){var n=cc.Enum({default:-1}),h=cc.Enum({"<None>":0});dragonBones.ArmatureDisplay=cc.T({name:"dragonBones.ArmatureDisplay",S:cc._RendererUnderSG,editor:!1,O:{_factory:{default:null,type:dragonBones.CCFactory,serializable:!1},_dragonBonesData:{default:null,type:dragonBones.DragonBonesData,serializable:!1},dragonAsset:{default:null,type:dragonBones.DragonBonesAsset,notify:function(){this._parseDragonAsset(),this._refresh()},tooltip:!1},dragonAtlasAsset:{default:null,type:dragonBones.DragonBonesAtlasAsset,notify:function(){this._parseDragonAtlasAsset(),this._refreshSgNode()},tooltip:!1},_armatureName:"",armatureName:{get:function(){return this._armatureName},set:function(t){this._armatureName=t;var i=this.getAnimationNames(this._armatureName);(!this.animationName||i.indexOf(this.animationName)<0)&&(this.animationName=""),this._refresh()},visible:!1},_animationName:"",animationName:{get:function(){return this._animationName},set:function(t){this._animationName=t},visible:!1},_defaultArmatureIndex:{default:0,notify:function(){var t="";if(this.dragonAsset){var i;if(this.dragonAsset&&(i=this.dragonAsset.getArmatureEnum()),!i)return cc.errorID(7400,this.name);t=i[this._defaultArmatureIndex]}void 0!==t?this.armatureName=t:cc.errorID(7401,this.name)},type:n,visible:!0,editorOnly:!0,displayName:"Armature",tooltip:!1},_animationIndex:{default:0,notify:function(){if(0!==this._animationIndex){var t;if(this.dragonAsset&&(t=this.dragonAsset.getAnimsEnum(this.armatureName)),t){var i=t[this._animationIndex];void 0!==i?this.animationName=i:cc.errorID(7402,this.name)}}else this.animationName=""},type:h,visible:!0,editorOnly:!0,displayName:"Animation",tooltip:!1},timeScale:{default:1,notify:function(){this._sgNode&&(this._sgNode.animation().timeScale=this.timeScale)},tooltip:!1},playTimes:{default:-1,tooltip:!1},debugBones:{default:!1,notify:function(){this._sgNode&&this._sgNode.setDebugBones(this.debugBones)},editorOnly:!0,tooltip:!1}},ctor:function(){this._factory=dragonBones.CCFactory.getFactory()},__preload:function(){this._parseDragonAsset(),this._parseDragonAtlasAsset(),this._refresh()},_createSgNode:function(){return this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName?this._factory.buildArmatureDisplay(this.armatureName,this._dragonBonesData.name):null},_initSgNode:function(){this._sgNode.animation().timeScale=this.timeScale,this.animationName&&this.playAnimation(this.animationName,this.playTimes)},_parseDragonAsset:function(){if(this.dragonAsset){var t=JSON.parse(this.dragonAsset.dragonBonesJson),i=this._factory.getDragonBonesData(t.name);if(i)return void(this._dragonBonesData=i);this._dragonBonesData=this._factory.parseDragonBonesData(t)}},_parseDragonAtlasAsset:function(){if(this.dragonAtlasAsset){var t=JSON.parse(this.dragonAtlasAsset.atlasJson),i=t.name,s=null,n=this._factory.getTextureAtlasData(i),h=this.dragonAtlasAsset.texture;if(n&&n.length>0)for(var r in n){var e=n[r];if(e&&e.texture&&e.texture.url===h){s=e;break}}var c=cc.textureCache.getTextureForKey(h);s?s.texture=c:this._factory.parseTextureAtlasData(t,c)}},_refreshSgNode:function(){var t=null;this._sgNode&&(t=this._sgNode._bubblingListeners,this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode(),this._sgNode=null);var i=this._sgNode=this._createSgNode();i&&(this.enabledInHierarchy||i.setVisible(!1),t&&(i._bubblingListeners=t),this._initSgNode(),this._appendSgNode(i),this._registSizeProvider())},_refresh:function(){this._refreshSgNode()},_updateAnimEnum:!1,_updateArmatureEnum:!1,playAnimation:function(t,i){return this._sgNode?(this.playTimes=void 0===i?-1:i,this.animationName=t,this._sgNode.animation().play(t,this.playTimes)):null},getArmatureNames:function(){return this._dragonBonesData?this._dragonBonesData.armatureNames:[]},getAnimationNames:function(t){var i=[];if(this._dragonBonesData){var s=this._dragonBonesData.getArmature(t);if(s)for(var n in s.animations)s.animations.hasOwnProperty(n)&&i.push(n)}return i},addEventListener:function(t,i,s){this._sgNode&&this._sgNode.addEvent(t,i,s)},removeEventListener:function(t,i,s){this._sgNode&&this._sgNode.removeEvent(t,i,s)},buildArmature:function(t){return this._factory?this._factory.buildArmature(t):null},armature:function(){return this._sgNode?this._sgNode.armature():null}})},{}],293:[function(t,i,s){var n=t("../../cocos2d/core/event/event-target");dragonBones.CCArmatureDisplay=cc.T({name:"dragonBones.CCArmatureDisplay",S:_ccsg.Node,mixins:[n],_armature:null,_debugDrawer:null,_onClear:function(){this._armature=null},_dispatchEvent:function(t){this.emit(t.type,t)},_debugDraw:function(){if(this._armature){this._debugDrawer||(this._debugDrawer=new cc.DrawNode,this.addChild(this._debugDrawer),this._debugDrawer.setDrawColor(cc.color(255,0,0,255)),this._debugDrawer.setLineWidth(1)),this._debugDrawer.clear();for(var t=this._armature.getBones(),i=0,s=t.length;i<s;++i){var n=t[i],h=Math.max(n.length,5),r=n.globalTransformMatrix.tx,e=-n.globalTransformMatrix.ty,c=r+n.globalTransformMatrix.a*h,o=e-n.globalTransformMatrix.b*h;this._debugDrawer.drawSegment(cc.p(r,e),cc.p(c,o))}}},update:function(t){this._armature&&this._armature.advanceTime(t)},advanceTimeBySelf:function(t){t?this.scheduleUpdate():this.unscheduleUpdate()},hasEvent:function(t){return this.hasEventListener(t,!1)},addEvent:function(t,i,s){this.on(t,i,s)},removeEvent:function(t,i,s){this.off(t,i,s)},dispose:function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=null)},armature:function(){return this._armature},animation:function(){return this._armature.animation},setDebugBones:function(t){dragonBones.DragonBones.debugDraw=t,t?this.armature().advanceTime(0):this._debugDrawer&&this._debugDrawer.clear()}})},{"../../cocos2d/core/event/event-target":111}],294:[function(t,i,s){var n=dragonBones.BaseObject;dragonBones.CCFactory=cc.T({name:"dragonBones.CCFactory",S:dragonBones.BaseFactory,buildArmatureDisplay:function(t,i,s){var n=this.buildArmature(t,i,s),h=n?n._display:null;return h&&h.advanceTimeBySelf(!0),h},_generateTextureAtlasData:function(t,i){return t||(t=n.borrowObject(dragonBones.CCTextureAtlasData)),t.texture=i,t},_generateArmature:function(t){var i=n.borrowObject(dragonBones.Armature),s=new dragonBones.CCArmatureDisplay;return i._armatureData=t.armature,i._skinData=t.skin,i._animation=n.borrowObject(dragonBones.Animation),i._display=s,s.setCascadeOpacityEnabled(!0),s.setCascadeColorEnabled(!0),s._armature=i,i._animation._armature=i,i.animation.animations=t.armature.animations,i},_generateSlot:function(t,i){var s=n.borrowObject(dragonBones.CCSlot),h=i.slot,r=[];s.name=h.name,s._rawDisplay=new cc.Scale9Sprite,s._rawDisplay.setRenderingType(cc.Scale9Sprite.RenderingType.SIMPLE),s._rawDisplay.setAnchorPoint(cc.p(0,0)),s._meshDisplay=s._rawDisplay;for(var e=0,c=i.displays.length;e<c;++e){var o=i.displays[e];switch(o.type){case dragonBones.DisplayType.Image:o.texture||(o.texture=this._getTextureData(t.dataName,o.name)),r.push(s._rawDisplay);break;case dragonBones.DisplayType.Mesh:o.texture||(o.texture=this._getTextureData(t.dataName,o.name)),cc._renderType===cc.game.RENDER_TYPE_WEBGL?(s._meshDisplay.setRenderingType(cc.Scale9Sprite.RenderingType.MESH),r.push(s._meshDisplay)):cc.warnID(6200);break;case dragonBones.DisplayType.Armature:var u=this.buildArmature(o.name,t.dataName);if(u){if(!s.inheritAnimation){var a=h.actions.length>0?h.actions:u.armatureData.actions;if(a.length>0)for(var f=0,l=a.length;f<l;++f)u._bufferAction(a[f]);else u.animation.play()}o.armature=u.armatureData}r.push(u);break;default:r.push(null)}}return s._setDisplayList(r),s._rawDisplay.setLocalZOrder(h.zOrder),s},getTextureDisplay:function(t,i){var s=this._getTextureData(i,t);if(s){if(!s.texture){var n=s.parent.texture,h=cc.rect(s.region.x,s.region.y,s.region.width,s.region.height),r=cc.p(0,0),e=cc.size(s.region.width,s.region.height);s.texture=new cc.P,s.texture.setTexture(n,h,s.rotated,r,e)}var c=new cc.Scale9Sprite;return c.initWithSpriteFrame(s.texture),c}return null}}),dragonBones.CCFactory._factory=null,dragonBones.CCFactory.getFactory=function(){return dragonBones.CCFactory._factory||(dragonBones.CCFactory._factory=new dragonBones.CCFactory),dragonBones.CCFactory._factory}},{}],295:[function(t,i,s){dragonBones.CCSlot=cc.T({name:"dragonBones.CCSlot",S:dragonBones.Slot,_renderDisplay:null,statics:{toString:function(){return"[class dragonBones.CCSlot]"}},_onClear:function(){dragonBones.Slot.prototype._onClear.call(this),this._renderDisplay=null},_onUpdateDisplay:function(){this._rawDisplay||(this._rawDisplay=new cc.Scale9Sprite),this._renderDisplay=this._display||this._rawDisplay},_initDisplay:function(t){},_addDisplay:function(){this._armature._display.addChild(this._renderDisplay)},_replaceDisplay:function(t){var i=this._armature._display,s=t;i.addChild(this._renderDisplay,s.getLocalZOrder()),i.removeChild(s)},_removeDisplay:function(){this._renderDisplay.removeFromParent()},_disposeDisplay:function(t){},_updateVisible:function(){this._renderDisplay.setVisible(this._parent.visible)},_updateZOrder:function(){this._renderDisplay._parent?this._renderDisplay.setLocalZOrder(this._zOrder):this._armature._display.addChild(this._renderDisplay,this._zOrder)},_updateBlendMode:function(){if(this._renderDisplay instanceof cc.Scale9Sprite)switch(this._blendMode){case 0:break;case 1:var t=this._renderDisplay._spriteFrame.getTexture();t&&t.hasPremultipliedAlpha()?this._renderDisplay.setBlendFunc(cc.BlendFunc.BlendFactor.ONE,cc.BlendFunc.BlendFactor.ONE):this._renderDisplay.setBlendFunc(cc.BlendFunc.BlendFactor.SRC_ALPHA,cc.BlendFunc.BlendFactor.ONE)}else if(this._childArmature)for(var i=this._childArmature.getSlots(),s=0,n=i.length;s<n;s++){var h=i[s];h._blendMode=this._blendMode,h._updateBlendMode()}},_updateColor:function(){this._renderDisplay.setOpacity(255*this._colorTransform.alphaMultiplier);var t=255*this._colorTransform.redMultiplier,i=255*this._colorTransform.greenMultiplier,s=255*this._colorTransform.blueMultiplier;this._renderDisplay.setColor(cc.color(t,i,s))},_updateFilters:function(){},_updateFrame:function(){if(this._display&&this._displayIndex>=0){var t=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,i=(this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null)||t,s=i.texture;if(s){var n=s.parent.texture;if(n&&(!s.texture||s.texture.getTexture()!==n)){var h=cc.rect(s.region.x,s.region.y,s.region.width,s.region.height),r=cc.p(0,0),e=cc.size(s.region.width,s.region.height);s.texture=new cc.P,s.texture.setTexture(n,h,!1,r,e)}var c=this._armature._replacedTexture||(s.texture?s.texture.getTexture():null);if(this._meshData&&this._display===this._meshDisplay){var o=s.region,u=s.texture.getTexture().getContentSize(),a=[],f=[],l=cc.rect(999999,999999,-999999,-999999);this._meshData!==t.mesh&&t&&t!==i?(this._pivotX=t.transform.x-i.transform.x,this._pivotY=t.transform.y-i.transform.y):(this._pivotX=0,this._pivotY=0);var v,d;for(v=0,d=this._meshData.uvs.length;v<d;v+=2){var p=this._meshData.vertices[v],g=this._meshData.vertices[v+1],m=(o.x+this._meshData.uvs[v]*o.width)/u.width,w=(o.y+this._meshData.uvs[v+1]*o.height)/u.height;a.push({x:p,y:-g,u:m,v:w}),l.x>p&&(l.x=p),l.width<p&&(l.width=p),l.y>-g&&(l.y=-g),l.height<-g&&(l.height=-g)}for(l.width-=l.x,l.height-=l.y,v=0,d=this._meshData.vertexIndices.length;v<d;++v)f.push(this._meshData.vertexIndices[v]);var _={triangles:{verts:a,indices:f},rect:l};this._meshDisplay.setSpriteFrame(s.texture),c!=s.texture.getTexture()&&this._meshDisplay.setTexture(c),this._meshDisplay.setMeshPolygonInfo(_),this._meshDisplay.setContentSize(cc.size(l.width,l.height)),this._meshData.skinned&&(this._meshDisplay.setScale(1,1),this._meshDisplay.setRotationX(0),this._meshDisplay.setRotationY(0),this._meshDisplay.setPosition(0,0)),this._meshDisplay.setAnchorPoint(cc.p(0,0))}else{var C=this._armature.armatureData.scale;if(this._pivotX=i.pivot.x,this._pivotY=i.pivot.y,i.isRelativePivot){var b=s.frame||s.region,y=b.width*C,T=b.height*C;!s.frame&&s.rotated&&(y=b.height,T=b.width),this._pivotX*=y,this._pivotY*=T}s.frame&&(this._pivotX+=s.frame.x*C,this._pivotY+=s.frame.y*C),t&&t!==i&&(this._pivotX+=t.transform.x-i.transform.x,this._pivotY+=t.transform.y-i.transform.y),this._pivotY-=s.region.height*C,this._rawDisplay.setSpriteFrame(s.texture),this._rawDisplay.setContentSize(s.texture.getOriginalSize()),c!==s.texture.getTexture()&&this._rawDisplay.setTexture(c),this._blendModeDirty=!0}return void this._updateVisible()}}this._pivotX=0,this._pivotY=0,this._rawDisplay.setTexture(null),this._rawDisplay.setVisible(!1),this._rawDisplay.setPosition(this.origin.x,this.origin.y)},_updateMesh:function(){var t=this._meshDisplay,i=t.getMeshPolygonInfo();if(t&&i){var s,n,h=this._ffdVertices.length>0,r=i.triangles.verts,e=cc.rect(999999,999999,-999999,-999999),c=0,o=0,u=0;if(this._meshData.skinned){var a=0;for(s=0,n=this._meshData.vertices.length;s<n;s+=2){c=Math.floor(s/2);var f=this._meshData.boneIndices[c],l=this._meshData.boneVertices[c],v=this._meshData.weights[c];o=0,u=0;for(var d=0,p=f.length;d<p;++d){var g=this._meshBones[f[d]].globalTransformMatrix,m=v[d],w=0,_=0;h?(w=l[2*d]+this._ffdVertices[a],_=l[2*d+1]+this._ffdVertices[a+1]):(w=l[2*d],_=l[2*d+1]),o+=(g.a*w+g.c*_+g.tx)*m,u+=(g.b*w+g.d*_+g.ty)*m,a+=2}r[c].x=o,r[c].y=-u,e.x>o&&(e.x=o),e.width<o&&(e.width=o),e.y>-u&&(e.y=-u),e.height<-u&&(e.height=-u)}}else if(h){var C=this._meshData.vertices;for(s=0,n=this._meshData.vertices.length;s<n;s+=2)c=Math.floor(s/2),o=C[s]+this._ffdVertices[s],u=C[s+1]+this._ffdVertices[s+1],r[c].x=o,r[c].y=-u,e.x>o&&(e.x=o),e.width<o&&(e.width=o),e.y>-u&&(e.y=-u),e.height<-u&&(e.height=-u)}e.width-=e.x,e.height-=e.y,i.rect=e;var b=t.getNodeToParentTransform();t.setContentSize(cc.size(e.width,e.height)),t.setMeshPolygonInfo(i),this._renderDisplay._renderCmd.setNodeToParentTransform(b)}},_updateTransform:function(){var t={a:this.globalTransformMatrix.a,b:-this.globalTransformMatrix.b,c:-this.globalTransformMatrix.c,d:this.globalTransformMatrix.d,tx:this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),ty:-(this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY))};this._renderDisplay._renderCmd.setNodeToParentTransform(t)}})},{}],296:[function(t,i,s){dragonBones.CCTextureAtlasData=cc.T({name:"dragonBones.CCTextureAtlasData",S:dragonBones.TextureAtlasData,texture:null,statics:{toString:function(){return"[class dragonBones.CCTextureAtlasData]"}},_onClear:function(){dragonBones.TextureAtlasData.prototype._onClear.call(this),this.texture=null},generateTextureData:function(){return dragonBones.BaseObject.borrowObject(dragonBones.CCTextureData)}}),dragonBones.CCTextureData=cc.T({name:"dragonBones.CCTextureData",S:dragonBones.TextureData,texture:null,statics:{toString:function(){return"[class dragonBones.CCTextureData]"}},_onClear:function(){dragonBones.TextureData.prototype._onClear.call(this),this.texture&&(this.texture.dispose(),this.texture=null)}})},{}],297:[function(t,i,s){var n=cc.T({name:"dragonBones.DragonBonesAsset",S:cc.Asset,O:{_dragonBonesJson:"",dragonBonesJson:{get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this.reset()}}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){},getRuntimeData:!1,getArmatureEnum:!1,getAnimsEnum:!1});dragonBones.DragonBonesAsset=i.exports=n},{}],298:[function(t,i,s){var n=cc.T({name:"dragonBones.DragonBonesAtlasAsset",S:cc.Asset,O:{_atlasJson:"",atlasJson:{get:function(){return this._atlasJson},set:function(t){this._atlasJson=t}},texture:{default:"",url:cc.Texture2D}},statics:{preventDeferredLoadDependents:!0},createNode:!1});dragonBones.DragonBonesAtlasAsset=i.exports=n},{}],299:[function(t,i,s){dragonBones=t("./lib/dragonBones"),dragonBones.DisplayType={Image:0,Armature:1,Mesh:2},dragonBones.ArmatureType={Armature:0,MovieClip:1,Stage:2},dragonBones.ExtensionType={FFD:0,AdjustColor:10,BevelFilter:11,BlurFilter:12,DropShadowFilter:13,GlowFilter:14,GradientBevelFilter:15,GradientGlowFilter:16},dragonBones.EventType={Frame:0,Sound:1},dragonBones.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5},dragonBones.AnimationFadeOutMode={None:0,SameLayer:1,SameGroup:2,SameLayerAndGroup:3,All:4},t("./CCFactory"),t("./CCSlot"),t("./CCTextureData"),t("./CCArmatureDisplay"),t("./DragonBonesAsset"),t("./DragonBonesAtlasAsset"),t("./ArmatureDisplay")},{"./ArmatureDisplay":292,"./CCArmatureDisplay":293,"./CCFactory":294,"./CCSlot":295,"./CCTextureData":296,"./DragonBonesAsset":297,"./DragonBonesAtlasAsset":298,"./lib/dragonBones":300}],300:[function(t,i,s){var n=this&&this.__extends||function(t,i){function s(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)};!function(t){var i=function(){function t(){}return t.hasArmature=function(i){return t._armatures.indexOf(i)>=0},t.addArmature=function(i){i&&t._armatures.indexOf(i)<0&&t._armatures.push(i)},t.removeArmature=function(i){if(i){var s=t._armatures.indexOf(i);s>=0&&t._armatures.splice(s,1)}},t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.ANGLE_TO_RADIAN=Math.PI/180,t.RADIAN_TO_ANGLE=180/Math.PI,t.SECOND_TO_MILLISECOND=1e3,t.NO_TWEEN=100,t.VERSION="4.7.2",t.debug=!1,t.debugDraw=!1,t._armatures=[],t}();t.DragonBones=i}(h||(h={})),function(t){var i=function(){function t(){this.hashCode=t._hashCode++}return t._returnObject=function(i){var s=String(i.constructor),n=null==t._maxCountMap[s]?t._defaultMaxCount:t._maxCountMap[s],h=t._poolsMap[s]=t._poolsMap[s]||[];if(h.length<n){if(!(h.indexOf(i)<0))throw new Error;h.push(i)}},t.setMaxCount=function(i,s){if((s<0||s!=s)&&(s=0),i)n=String(i),t._maxCountMap[n]=s,(h=t._poolsMap[n])&&h.length>s&&(h.length=s);else{t._defaultMaxCount=s;for(var n in t._poolsMap)if(null!=t._maxCountMap[n]){t._maxCountMap[n]=s;var h=t._poolsMap[n];h.length>s&&(h.length=s)}}},t.clearPool=function(i){if(void 0===i&&(i=null),i)(n=t._poolsMap[String(i)])&&n.length&&(n.length=0);else for(var s in t._poolsMap){var n=t._poolsMap[s];n.length=0}},t.borrowObject=function(i){var s=t._poolsMap[String(i)];if(s&&s.length)return s.pop();var n=new i;return n._onClear(),n},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=5e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=i}(h||(h={})),function(t){var i=function(){function t(t,i,s,n,h,r,e,c){void 0===t&&(t=1),void 0===i&&(i=1),void 0===s&&(s=1),void 0===n&&(n=1),void 0===h&&(h=0),void 0===r&&(r=0),void 0===e&&(e=0),void 0===c&&(c=0),this.alphaMultiplier=t,this.redMultiplier=i,this.greenMultiplier=s,this.blueMultiplier=n,this.alphaOffset=h,this.redOffset=r,this.greenOffset=e,this.blueOffset=c}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.redOffset=t.redOffset,this.greenOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=i}(h||(h={})),function(t){var i=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=i}(h||(h={})),function(t){var i=function(){function t(t,i,s,n,h,r){void 0===t&&(t=1),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=1),void 0===h&&(h=0),void 0===r&&(r=0),this.a=t,this.b=i,this.c=s,this.d=n,this.tx=h,this.ty=r}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},t.prototype.identity=function(){this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0},t.prototype.concat=function(t){var i=this.a,s=this.b,n=this.c,h=this.d,r=this.tx,e=this.ty,c=t.a,o=t.b,u=t.c,a=t.d,f=t.tx,l=t.ty;this.a=i*c+s*u,this.b=i*o+s*a,this.c=n*c+h*u,this.d=n*o+h*a,this.tx=c*r+u*e+f,this.ty=a*e+o*r+l},t.prototype.invert=function(){var t=this.a,i=this.b,s=this.c,n=this.d,h=this.tx,r=this.ty,e=t*n-i*s;this.a=n/e,this.b=-i/e,this.c=-s/e,this.d=t/e,this.tx=(s*r-n*h)/e,this.ty=-(t*r-i*h)/e},t.prototype.transformPoint=function(t,i,s,n){void 0===n&&(n=!1),s.x=this.a*t+this.c*i,s.y=this.b*t+this.d*i,n||(s.x+=this.tx,s.y+=this.ty)},t}();t.Matrix=i}(h||(h={})),function(t){var i=function(){function t(t,i,s,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),this.x=t,this.y=i,this.width=s,this.height=n}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=i}(h||(h={})),function(t){var i=function(){function t(t,i,s,n,h,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),void 0===h&&(h=1),void 0===r&&(r=1),this.x=t,this.y=i,this.skewX=s,this.skewY=n,this.scaleX=h,this.scaleY=r}return t.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skewX/Math.PI+" skewY:"+180*this.skewY/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skewX=t.skewX,this.skewY=t.skewY,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=this.skewX=this.skewY=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skewX+=t.skewX,this.skewY+=t.skewY,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(i){return this.x-=i.x,this.y-=i.y,this.skewX=t.normalizeRadian(this.skewX-i.skewX),this.skewY=t.normalizeRadian(this.skewY-i.skewY),this.scaleX/=i.scaleX,this.scaleY/=i.scaleY,this},t.prototype.fromMatrix=function(t){var i=.25*Math.PI,s=this.scaleX,n=this.scaleY;return this.x=t.tx,this.y=t.ty,this.skewX=Math.atan(-t.c/t.d),this.skewY=Math.atan(t.b/t.a),this.skewX!=this.skewX&&(this.skewX=0),this.skewY!=this.skewY&&(this.skewY=0),this.scaleY=this.skewX>-i&&this.skewX<i?t.d/Math.cos(this.skewX):-t.c/Math.sin(this.skewX),this.scaleX=this.skewY>-i&&this.skewY<i?t.a/Math.cos(this.skewY):t.b/Math.sin(this.skewY),s>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.skewY=this.skewY-Math.PI),n>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.skewX=this.skewX-Math.PI),this},t.prototype.toMatrix=function(t){return t.a=this.scaleX*Math.cos(this.skewY),t.b=this.scaleX*Math.sin(this.skewY),t.c=-this.scaleY*Math.sin(this.skewX),t.d=this.scaleY*Math.cos(this.skewX),t.tx=this.x,t.ty=this.y,this},Object.defineProperty(t.prototype,"rotation",{get:function(){return this.skewY},set:function(t){var i=t-this.skewY;this.skewX+=i,this.skewY+=i},enumerable:!0,configurable:!0}),t}();t.Transform=i}(h||(h={})),function(t){var i=function(t){function i(){t.call(this)}return n(i,t),i.prototype._onClear=function(){this._isCompleted=!1,this._currentPlayTimes=0,this._currentTime=-1,this._timeline=null,this._isReverse=!1,this._hasAsynchronyTimeline=!1,this._frameRate=0,this._keyFrameCount=0,this._frameCount=0,this._position=0,this._duration=0,this._animationDutation=0,this._timeScale=1,this._timeOffset=0,this._currentFrame=null,this._armature=null,this._animationState=null},i.prototype._onUpdateFrame=function(t){},i.prototype._onArriveAtFrame=function(t){},i.prototype._setCurrentTime=function(t){var i=0;if(1==this._keyFrameCount&&this!=this._animationState._timeline)this._isCompleted=this._animationState._fadeState>=0,i=1;else if(this._hasAsynchronyTimeline){var s=this._animationState.playTimes,n=s*this._duration;t*=this._timeScale,0!=this._timeOffset&&(t+=this._timeOffset*this._animationDutation),s>0&&(t>=n||t<=-n)?(this._isCompleted=!0,i=s,t=t<0?0:this._duration):(this._isCompleted=!1,t<0?(i=Math.floor(-t/this._duration),t=this._duration- -t%this._duration):(i=Math.floor(t/this._duration),t%=this._duration),s>0&&i>s&&(i=s)),t+=this._position}else this._isCompleted=this._animationState._timeline._isCompleted,i=this._animationState._timeline._currentPlayTimes;return this._currentTime!=t&&(this._isReverse=this._currentTime>t&&this._currentPlayTimes==i,this._currentTime=t,this._currentPlayTimes=i,this._animationState._onFadeInComplete&&(this._currentFrame=null),!0)},i.prototype.fadeIn=function(t,i,s,n){this._armature=t,this._animationState=i,this._timeline=s;var h=this==this._animationState._timeline;this._hasAsynchronyTimeline=h||this._animationState.animationData.hasAsynchronyTimeline,this._frameRate=this._armature.armatureData.frameRate,this._keyFrameCount=this._timeline.frames.length,this._frameCount=this._animationState.animationData.frameCount,this._position=this._animationState._position,this._duration=this._animationState._duration,this._animationDutation=this._animationState.animationData.duration,this._timeScale=h?1:1/this._timeline.scale,this._timeOffset=h?0:this._timeline.offset},i.prototype.fadeOut=function(){},i.prototype.update=function(t){if(!this._isCompleted&&this._setCurrentTime(t)){var i=this._keyFrameCount>1?Math.floor(this._currentTime*this._frameRate):0,s=this._timeline.frames[i];this._currentFrame!=s&&(this._currentFrame=s,this._onArriveAtFrame(!0)),this._onUpdateFrame(!0)}},i}(t.BaseObject);t.TimelineState=i;var s=function(i){function s(){i.call(this)}return n(s,i),s._getEasingValue=function(t,i){if(t<=0)return 0;if(t>=1)return 1;var s=1;if(i>2)return t;if(i>1)s=.5*(1-Math.cos(t*Math.PI)),i-=1;else if(i>0)s=1-Math.pow(1-t,2);else if(i>=-1)i*=-1,s=Math.pow(t,2);else{if(!(i>=-2))return t;i*=-1,s=Math.acos(1-2*t)/Math.PI,i-=1}return(s-t)*i+t},s._getEasingCurveValue=function(t,i){if(t<=0)return 0;if(t>=1)return 1;var s=i.length+1,n=Math.floor(t*s),h=0==n?0:i[n-1];return h+((n==s-1?1:i[n])-h)*(t-n/s)},s.prototype._onClear=function(){i.prototype._onClear.call(this),this._tweenProgress=0,this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null},s.prototype._onArriveAtFrame=function(i){this._tweenEasing=this._currentFrame.tweenEasing,this._curve=this._currentFrame.curve,(this._keyFrameCount<=1||this._currentFrame.next==this._timeline.frames[0]&&(this._tweenEasing!=t.DragonBones.NO_TWEEN||this._curve)&&this._animationState.playTimes>0&&this._animationState.currentPlayTimes==this._animationState.playTimes-1)&&(this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null)},s.prototype._onUpdateFrame=function(i){this._tweenEasing!=t.DragonBones.NO_TWEEN?(this._tweenProgress=(this._currentTime-this._currentFrame.position+this._position)/this._currentFrame.duration,0!=this._tweenEasing&&(this._tweenProgress=s._getEasingValue(this._tweenProgress,this._tweenEasing))):this._curve?(this._tweenProgress=(this._currentTime-this._currentFrame.position+this._position)/this._currentFrame.duration,this._tweenProgress=s._getEasingCurveValue(this._tweenProgress,this._curve)):this._tweenProgress=0},s.prototype._updateExtensionKeyFrame=function(t,i,s){var n=0;if(t.type==i.type)for(var h=0,r=t.tweens.length;h<r;++h){var e=i.tweens[h]-t.tweens[h];s.tweens[h]=e,e>0&&(n=2)}if(0==n)for(s.type!=t.type&&(n=1,s.type=t.type),s.tweens.length!=t.tweens.length&&(n=1,s.tweens.length=t.tweens.length),s.keys.length!=t.keys.length&&(n=1,s.keys.length=t.keys.length),h=0,r=t.keys.length;h<r;++h){var c=t.keys[h];s.keys[h]!=c&&(n=1,s.keys[h]=c)}return n},s}(i);t.TweenTimelineState=s}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this._animations={},this._animationNames=[],this._animationStates=[]}return n(s,i),s._sortAnimationState=function(t,i){return t.layer>i.layer?-1:1},s.toString=function(){return"[class dragonBones.Animation]"},s.prototype._onClear=function(){for(var t in this._animations)delete this._animations[t];t=0;for(var i=this._animationStates.length;t<i;++t)this._animationStates[t].returnToPool();this.timeScale=1,this._animationStateDirty=!1,this._armature=null,this._isPlaying=!1,this._time=0,this._duration=0,this._lastAnimationState=null,this._animationNames.length=0,this._animationStates.length=0},s.prototype._fadeOut=function(t,i,s,n,h){var r=0,e=this._animationStates.length,c=null;switch(n){case 1:for(;r<e;++r)(c=this._animationStates[r]).layer==i&&c.fadeOut(t,h);break;case 2:for(;r<e;++r)(c=this._animationStates[r]).group==s&&c.fadeOut(t,h);break;case 4:for(;r<e;++r)c=this._animationStates[r],0==t?c.returnToPool():c.fadeOut(t,h);0==t&&(this._animationStates.length=0);break;case 3:for(;r<e;++r)(c=this._animationStates[r]).layer==i&&c.group==s&&c.fadeOut(t,h)}},s.prototype._updateFFDTimelineStates=function(){for(var t=0,i=this._animationStates.length;t<i;++t)this._animationStates[t]._updateFFDTimelineStates()},s.prototype._advanceTime=function(t){if(this._isPlaying){t<0&&(t=-t);var i=this._animationStates.length;if(1==i)(o=this._animationStates[0])._fadeState>0&&o._fadeProgress<=0?(o.returnToPool(),this._animationStates.length=0,this._animationStateDirty=!0,this._lastAnimationState=null):o._advanceTime(t,1,0);else if(i>1)for(var s=this._animationStates[0]._layer,n=1,h=0,r=1,e=0,c=0;e<i;++e){var o=this._animationStates[e];o._fadeState>0&&o._fadeProgress<=0?(c++,o.returnToPool(),this._animationStateDirty=!0,this._lastAnimationState==o&&(this._lastAnimationState=e-c>=0?this._animationStates[e-c]:null)):(c>0&&(this._animationStates[e-c]=o),s!=o._layer&&(s=o._layer,h>=n?n=0:n-=h,h=0),o._advanceTime(t,n,r),o._weightResult>0&&(h+=o._weightResult,r++)),e==i-1&&c>0&&(this._animationStates.length-=c)}}},s.prototype.reset=function(){for(var t=0,i=this._animationStates.length;t<i;++t)this._animationStates[t].returnToPool();this._isPlaying=!1,this._lastAnimationState=null,this._animationStates.length=0},s.prototype.stop=function(t){if(void 0===t&&(t=null),t){var i=this.getState(t);i&&i.stop()}else this._isPlaying=!1},s.prototype.play=function(t,i){void 0===t&&(t=null),void 0===i&&(i=-1);var s=null;if(t)s=this.fadeIn(t,0,i,0,null,4);else if(this._lastAnimationState)this._isPlaying&&(this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted)?s=this.fadeIn(this._lastAnimationState.name,0,i,0,null,4):(this._isPlaying=!0,this._lastAnimationState.play());else{var n=this._armature.armatureData.defaultAnimation;n&&(s=this.fadeIn(n.name,0,i,0,null,4))}return s},s.prototype.fadeIn=function(i,n,h,r,e,c,o,u,a,f){void 0===n&&(n=-1),void 0===h&&(h=-1),void 0===r&&(r=0),void 0===e&&(e=null),void 0===c&&(c=3),void 0===o&&(o=!1),void 0===u&&(u=!0),void 0===a&&(a=!0),void 0===f&&(f=!0);var l=this._animations[i];if(!l)return this._time=0,this._duration=0,console.warn("Non-existent animation.","DragonBones: "+this._armature.armatureData.parent.name,"Armature: "+this._armature.name,"Animation: "+i),null;this._isPlaying=!0,this._time!=this._time&&(this._time=0),this._duration!=this._duration&&(this._duration=0),(n!=n||n<0)&&(n=this._lastAnimationState?l.fadeInTime:0),h<0&&(h=l.playTimes),this._fadeOut(n,r,e,c,a);var v=this._duration>0?0:this._time,d=this._duration>0?this._time:l.position,p=this._duration>0?this._duration:l.duration;this._lastAnimationState=t.BaseObject.borrowObject(t.AnimationState),this._lastAnimationState._layer=r,this._lastAnimationState._group=e,this._lastAnimationState.additiveBlending=o,this._lastAnimationState.displayControl=u,this._lastAnimationState._fadeIn(this._armature,l.animation||l,i,h,d,p,v,1/l.scale,n,f),this._animationStates.push(this._lastAnimationState),this._animationStateDirty=!0,this._time=0,this._duration=0,this._armature._cacheFrameIndex=-1,this._animationStates.length>1&&this._animationStates.sort(s._sortAnimationState);for(var g=this._armature.getSlots(),m=0,w=g.length;m<w;++m){var _=g[m];if(_.inheritAnimation){var C=_.childArmature;C&&C.animation.hasAnimation(i)&&!C.animation.getState(i)&&C.animation.fadeIn(i)}}return n<=0&&this._armature.advanceTime(0),this._lastAnimationState},s.prototype.gotoAndPlayByTime=function(t,i,s,n){void 0===i&&(i=0),void 0===s&&(s=-1),void 0===n&&(n=0);var h=this._animations[t];return h&&(this._time=i,this._duration=n-i,this._duration<0?this._duration=0:this._duration>h.duration-this._time&&(this._duration=h.duration-this._time)),this.fadeIn(t,0,s,0,null,4)},s.prototype.gotoAndPlayByFrame=function(t,i,s,n){void 0===i&&(i=0),void 0===s&&(s=-1),void 0===n&&(n=0);var h=this._animations[t];return h&&(this._time=h.duration*i/h.frameCount,this._duration<0?this._duration=0:this._duration>h.duration-this._time&&(this._duration=h.duration-this._time)),this.fadeIn(t,0,s,0,null,4)},s.prototype.gotoAndPlayByProgress=function(t,i,s,n){void 0===i&&(i=0),void 0===s&&(s=-1),void 0===n&&(n=0);var h=this._animations[t];return h&&(this._time=h.duration*(i>0?i:0),this._duration<0?this._duration=0:this._duration>h.duration-this._time&&(this._duration=h.duration-this._time)),this.fadeIn(t,0,s,0,null,4)},s.prototype.gotoAndStopByTime=function(t,i){void 0===i&&(i=0);var s=this.gotoAndPlayByTime(t,i,1);return s&&s.stop(),s},s.prototype.gotoAndStopByFrame=function(t,i){void 0===i&&(i=0);var s=this.gotoAndPlayByFrame(t,i,1);return s&&s.stop(),s},s.prototype.gotoAndStopByProgress=function(t,i){void 0===i&&(i=0);var s=this.gotoAndPlayByProgress(t,i,1);return s&&s.stop(),s},s.prototype.getState=function(t){for(var i=0,s=this._animationStates.length;i<s;++i){var n=this._animationStates[i];if(n.name==t)return n}return null},s.prototype.hasAnimation=function(t){return null!=this._animations[t]},Object.defineProperty(s.prototype,"isPlaying",{get:function(){return this._animationStates.length>1?this._isPlaying&&!this.isCompleted:this._lastAnimationState?this._isPlaying&&this._lastAnimationState.isPlaying:this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isCompleted",{get:function(){if(this._lastAnimationState){if(!this._lastAnimationState.isCompleted)return!1;for(var t=0,i=this._animationStates.length;t<i;++t)if(!this._animationStates[t].isCompleted)return!1;return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lastAnimationName",{get:function(){return this._lastAnimationState?this._lastAnimationState.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!=t){for(var i in this._animations)delete this._animations[i];if(this._animationNames.length=0,t)for(var i in t)this._animations[i]=t[i],this._animationNames.push(i)}},enumerable:!0,configurable:!0}),s.prototype.gotoAndPlay=function(t,i,s,n,h,r,e,c,o){void 0===i&&(i=-1),void 0===s&&(s=-1),void 0===n&&(n=-1),void 0===h&&(h=0),void 0===r&&(r=null),void 0===e&&(e=3),void 0===c&&(c=!0),void 0===o&&(o=!0);var u=this.fadeIn(t,i,n,h,r,e,!1,!0,c,o);return u&&s&&s>0&&(u.timeScale=u.totalTime/s),u},s.prototype.gotoAndStop=function(t,i){return void 0===i&&(i=0),this.gotoAndStopByTime(t,i)},Object.defineProperty(s.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animationDataList",{get:function(){for(var t=[],i=0,s=this._animationNames.length;i<s;++i)t.push(this._animations[this._animationNames[i]]);return t},enumerable:!0,configurable:!0}),s}(t.BaseObject);t.Animation=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this._boneMask=[],this._boneTimelines=[],this._slotTimelines=[],this._ffdTimelines=[],this.autoTween=!1}return n(s,i),s.toString=function(){return"[class dragonBones.AnimationState]"},s.prototype._onClear=function(){for(var t=0,i=this._boneTimelines.length;t<i;++t)this._boneTimelines[t].returnToPool();for(t=0,i=this._slotTimelines.length;t<i;++t)this._slotTimelines[t].returnToPool();for(t=0,i=this._ffdTimelines.length;t<i;++t)this._ffdTimelines[t].returnToPool();this._timeline&&this._timeline.returnToPool(),this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.displayControl=!0,this.additiveBlending=!1,this.actionEnabled=!1,this.playTimes=1,this.timeScale=1,this.weight=1,this.autoFadeOutTime=-1,this.fadeTotalTime=0,this._onFadeInComplete=!1,this._fadeState=0,this._layer=0,this._position=0,this._duration=0,this._weightResult=0,this._fadeProgress=0,this._group=null,this._timeline=null,this._isPlaying=!0,this._isPausePlayhead=!1,this._fadeTime=0,this._time=0,this._name=null,this._armature=null,this._animationData=null,this._zOrderTimeline=null,this._boneMask.length=0,this._boneTimelines.length=0,this._slotTimelines.length=0,this._ffdTimelines.length=0},s.prototype._updateTimelineStates=function(){var i=this._time;this._animationData.hasAsynchronyTimeline||(i=this._timeline._currentTime);for(var s={},n={},h=0,r=this._boneTimelines.length;h<r;++h)s[(a=this._boneTimelines[h]).bone.name]=a;var e=this._armature.getBones();for(h=0,r=e.length;h<r;++h){var c=e[h],o=c.name,u=this._animationData.getBoneTimeline(o);u&&this.containsBoneMask(o)&&((a=s[o])?delete s[o]:((a=t.BaseObject.borrowObject(t.BoneTimelineState)).bone=c,a.fadeIn(this._armature,this,u,i),this._boneTimelines.push(a)))}for(var h in s){var a=s[h];a.bone.invalidUpdate(),this._boneTimelines.splice(this._boneTimelines.indexOf(a),1),a.returnToPool()}for(h=0,r=this._slotTimelines.length;h<r;++h)n[(g=this._slotTimelines[h]).slot.name]=g;var f=this._armature.getSlots();for(h=0,r=f.length;h<r;++h){var l=f[h],v=l.name,d=l.parent.name,p=this._animationData.getSlotTimeline(v);p&&this.containsBoneMask(d)&&this._fadeState<=0&&((g=n[v])?delete n[v]:((g=t.BaseObject.borrowObject(t.SlotTimelineState)).slot=l,g.fadeIn(this._armature,this,p,i),this._slotTimelines.push(g)))}for(var h in n){var g=n[h];this._slotTimelines.splice(this._slotTimelines.indexOf(g),1),g.returnToPool()}this._updateFFDTimelineStates()},s.prototype._advanceFadeTime=function(i){i<0&&(i=-i),this._fadeTime+=i;var s=0;if(s=this._fadeTime>=this.fadeTotalTime?this._fadeState>0?0:1:this._fadeTime>0?this._fadeState>0?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeState>0?1:0,this._fadeProgress!=s){this._fadeProgress=s;var n=this._armature._display;if(this._fadeTime<=i)if(this._fadeState>0){if(n.hasEvent(t.EventObject.FADE_OUT)){var h=t.BaseObject.borrowObject(t.EventObject);h.animationState=this,this._armature._bufferEvent(h,t.EventObject.FADE_OUT)}}else if(n.hasEvent(t.EventObject.FADE_IN)){var r=t.BaseObject.borrowObject(t.EventObject);r.animationState=this,this._armature._bufferEvent(r,t.EventObject.FADE_IN)}if(this._fadeTime>=this.fadeTotalTime)if(this._fadeState>0){if(n.hasEvent(t.EventObject.FADE_OUT_COMPLETE)){var e=t.BaseObject.borrowObject(t.EventObject);e.animationState=this,this._armature._bufferEvent(e,t.EventObject.FADE_OUT_COMPLETE)}}else if(this._onFadeInComplete=!0,this._isPausePlayhead=!1,this._fadeState=0,n.hasEvent(t.EventObject.FADE_IN_COMPLETE)){var c=t.BaseObject.borrowObject(t.EventObject);c.animationState=this,this._armature._bufferEvent(c,t.EventObject.FADE_IN_COMPLETE)}}},s.prototype._isDisabled=function(t){return!(this.displayControl&&(!t.displayController||t.displayController==this._name||t.displayController==this._group))},s.prototype._fadeIn=function(i,n,h,r,e,c,o,u,a,f){this._armature=i,this._animationData=n,this._name=h,this.actionEnabled=s.stateActionEnabled,this.playTimes=r,this.timeScale=u,this.fadeTotalTime=a,this._fadeState=-1,this._position=e,this._duration=c,this._time=o,this._isPausePlayhead=f,this.fadeTotalTime<=0&&(this._fadeProgress=.999999),this._timeline=t.BaseObject.borrowObject(t.AnimationTimelineState),this._timeline.fadeIn(this._armature,this,this._animationData,this._time),this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.fadeIn(this._armature,this,this._animationData.zOrderTimeline,this._time)),this._updateTimelineStates()},s.prototype._updateFFDTimelineStates=function(){var i=this._time;this._animationData.hasAsynchronyTimeline||(i=this._timeline._currentTime);for(var s={},n=0,h=this._ffdTimelines.length;n<h;++n)s[(v=this._ffdTimelines[n]).slot.name]=v;var r=this._armature.getSlots();for(n=0,h=r.length;n<h;++n){var e=r[n],c=e.name,o=e.parent.name,u=e.displayData;if(u&&e._meshData&&e._meshData==u.mesh){var a=this._animationData.getFFDTimeline(this._armature._skinData.name,c,u.share&&u.inheritAnimation?u.share.name:u.name);if(a&&this.containsBoneMask(o))(v=s[c])&&v._timeline==a?delete s[c]:((v=t.BaseObject.borrowObject(t.FFDTimelineState)).slot=e,v.fadeIn(this._armature,this,a,i),this._ffdTimelines.push(v));else{for(var f=0,l=e._ffdVertices.length;f<l;++f)e._ffdVertices[f]=0;e._ffdDirty=!0}}}for(var n in s){var v=s[n];this._ffdTimelines.splice(this._ffdTimelines.indexOf(v),1),v.returnToPool()}},s.prototype._advanceTime=function(t,i,s){if(this._onFadeInComplete=!1,0!=this._fadeState&&this._advanceFadeTime(t),0!=(t*=this.timeScale)&&this._isPlaying&&!this._isPausePlayhead&&(this._time+=t),this._weightResult=this.weight*this._fadeProgress*i,0!=this._weightResult){var n=this._animationData.cacheFrameRate,h=this._fadeProgress>=1&&0==s&&n>0,r=!0,e=!0,c=2*n;if(c=h?Math.floor(this._time*c)/c:this._time,this._timeline.update(c),this._animationData.hasAsynchronyTimeline||(c=this._timeline._currentTime),this._zOrderTimeline&&this._zOrderTimeline.update(c),h){var o=Math.floor(this._timeline._currentTime*n);if(this._armature._cacheFrameIndex==o)r=!1,e=!1;else{if(this._armature._cacheFrameIndex=o,this._armature._animation._animationStateDirty){this._armature._animation._animationStateDirty=!1;for(var u=0,a=this._boneTimelines.length;u<a;++u){var f=this._boneTimelines[u];f.bone._cacheFrames=f._timeline.cachedFrames}for(u=0,a=this._slotTimelines.length;u<a;++u){var l=this._slotTimelines[u];l.slot._cacheFrames=l._timeline.cachedFrames}}this._animationData.cachedFrames[o]?e=!1:this._animationData.cachedFrames[o]=!0}}else this._armature._cacheFrameIndex=-1;if(r){if(e)for(u=0,a=this._boneTimelines.length;u<a;++u)this._boneTimelines[u].update(c);for(u=0,a=this._slotTimelines.length;u<a;++u)this._slotTimelines[u].update(c);for(u=0,a=this._ffdTimelines.length;u<a;++u)this._ffdTimelines[u].update(c)}}this.autoFadeOutTime>=0&&this._fadeProgress>=1&&this._timeline._isCompleted&&this.fadeOut(this.autoFadeOutTime)},s.prototype.play=function(){this._isPlaying=!0},s.prototype.stop=function(){this._isPlaying=!1},s.prototype.fadeOut=function(t,i){if(void 0===i&&(i=!0),(t<0||t!=t)&&(t=0),this._isPausePlayhead=i,this._fadeState>0){if(t>t-this._fadeTime)return}else{this._fadeState=1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var s=0,n=this._boneTimelines.length;s<n;++s)this._boneTimelines[s].fadeOut();for(s=0,n=this._slotTimelines.length;s<n;++s)this._slotTimelines[s].fadeOut()}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},s.prototype.containsBoneMask=function(t){return!this._boneMask.length||this._boneMask.indexOf(t)>=0},s.prototype.addBoneMask=function(t,i){void 0===i&&(i=!0);var s=this._armature.getBone(t);if(s){if(this._boneMask.indexOf(t)<0&&this._animationData.getBoneTimeline(t)&&this._boneMask.push(t),i)for(var n=this._armature.getBones(),h=0,r=n.length;h<r;++h){var e=n[h],c=e.name;this._boneMask.indexOf(c)<0&&this._animationData.getBoneTimeline(c)&&s.contains(e)&&this._boneMask.push(c)}this._updateTimelineStates()}},s.prototype.removeBoneMask=function(t,i){void 0===i&&(i=!0);var s=this._boneMask.indexOf(t);if(s>=0&&this._boneMask.splice(s,1),i){var n=this._armature.getBone(t);if(n)for(var h=this._armature.getBones(),r=0,e=h.length;r<e;++r){var c=h[r],o=c.name,u=this._boneMask.indexOf(o);u>=0&&n.contains(c)&&this._boneMask.splice(u,1)}}this._updateTimelineStates()},s.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._updateTimelineStates()},Object.defineProperty(s.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"group",{get:function(){return this._group},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isCompleted",{get:function(){return this._timeline._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._timeline._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentPlayTimes",{get:function(){return this._timeline._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentTime",{get:function(){return this._timeline._currentTime},set:function(t){(t<0||t!=t)&&(t=0);var i=this._timeline._currentPlayTimes-(this._timeline._isCompleted?1:0);if(t=t%this._duration+i*this._duration,this._time!=t){this._time=t,this._timeline.setCurrentTime(this._time),this._zOrderTimeline&&(this._zOrderTimeline._isCompleted=!1);for(var s=0,n=this._boneTimelines.length;s<n;++s)this._boneTimelines[s]._isCompleted=!1;for(s=0,n=this._slotTimelines.length;s<n;++s)this._slotTimelines[s]._isCompleted=!1;for(s=0,n=this._ffdTimelines.length;s<n;++s)this._ffdTimelines[s]._isCompleted=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"clip",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),s.stateActionEnabled=!0,s}(t.BaseObject);t.AnimationState=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this)}return n(s,i),s.toString=function(){return"[class dragonBones.AnimationTimelineState]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this._isStarted=!1},s.prototype._onCrossFrame=function(i){if(!(this._animationState._fadeState<0)){if(this._animationState.actionEnabled)for(var s=i.actions,n=0,h=s.length;n<h;++n)this._armature._bufferAction(s[n]);var r=this._armature._display,e=i.events;for(n=0,h=e.length;n<h;++n){var c=e[n],o="";switch(c.type){case 10:o=t.EventObject.FRAME_EVENT;break;case 11:o=t.EventObject.SOUND_EVENT}if((11==c.type?this._armature._eventManager:r).hasEvent(o)){var u=t.BaseObject.borrowObject(t.EventObject);u.name=c.name,u.animationState=this._animationState,u.frame=i,u.data=c,c.bone&&(u.bone=this._armature.getBone(c.bone.name)),c.slot&&(u.slot=this._armature.getSlot(c.slot.name)),this._armature._bufferEvent(u,o)}}}},s.prototype.fadeIn=function(t,s,n,h){i.prototype.fadeIn.call(this,t,s,n,h),this._currentTime=h},s.prototype.update=function(i){var s=this._currentTime,n=this._currentPlayTimes;if(!this._isCompleted&&this._setCurrentTime(i)){var h=this._armature._display;if(this._isStarted||(this._isStarted=!0,h.hasEvent(t.EventObject.START)&&((u=t.BaseObject.borrowObject(t.EventObject)).animationState=this._animationState,this._armature._bufferEvent(u,t.EventObject.START))),this._keyFrameCount>0){var r=this._keyFrameCount>1?Math.floor(this._currentTime*this._frameRate):0,e=this._timeline.frames[r];if(this._currentFrame!=e)if(this._keyFrameCount>1){var c=this._currentFrame;if(this._currentFrame=e,!c){var o=Math.floor(s*this._frameRate);c=this._timeline.frames[o],this._isReverse||(s<=c.position||n!=this._currentPlayTimes)&&(c=c.prev)}if(this._isReverse)for(;c!=e;)this._onCrossFrame(c),c=c.prev;else for(;c!=e;)c=c.next,this._onCrossFrame(c)}else this._currentFrame=e,this._onCrossFrame(this._currentFrame)}if(n!=this._currentPlayTimes){if(h.hasEvent(t.EventObject.LOOP_COMPLETE)&&((u=t.BaseObject.borrowObject(t.EventObject)).animationState=this._animationState,this._armature._bufferEvent(u,t.EventObject.LOOP_COMPLETE)),this._isCompleted&&h.hasEvent(t.EventObject.COMPLETE)){var u=t.BaseObject.borrowObject(t.EventObject);u.animationState=this._animationState,this._armature._bufferEvent(u,t.EventObject.COMPLETE)}this._currentFrame=null}}},s.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._currentFrame=null},s}(t.TimelineState);t.AnimationTimelineState=i;var s=function(t){function i(){t.call(this)}return n(i,t),i.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},i.prototype._onArriveAtFrame=function(i){t.prototype._onArriveAtFrame.call(this,i),this._armature._sortZOrder(this._currentFrame.zOrder)},i}(t.TimelineState);t.ZOrderTimelineState=s;var h=function(i){function s(){i.call(this),this._transform=new t.Transform,this._currentTransform=new t.Transform,this._durationTransform=new t.Transform}return n(s,i),s.toString=function(){return"[class dragonBones.BoneTimelineState]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.bone=null,this._tweenTransform=0,this._tweenRotate=0,this._tweenScale=0,this._boneTransform=null,this._originalTransform=null,this._transform.identity(),this._currentTransform.identity(),this._durationTransform.identity()},s.prototype._onArriveAtFrame=function(s){if(i.prototype._onArriveAtFrame.call(this,s),this._currentTransform.copyFrom(this._currentFrame.transform),this._tweenTransform=1,this._tweenRotate=1,this._tweenScale=1,this._keyFrameCount>1&&(this._tweenEasing!=t.DragonBones.NO_TWEEN||this._curve)){var n=this._currentFrame.next.transform;this._durationTransform.x=n.x-this._currentTransform.x,this._durationTransform.y=n.y-this._currentTransform.y,0==this._durationTransform.x&&0==this._durationTransform.y||(this._tweenTransform=2);var h=this._currentFrame.tweenRotate;if(h==h){if(h)if(h>0?n.skewY>=this._currentTransform.skewY:n.skewY<=this._currentTransform.skewY){var r=h>0?h-1:h+1;this._durationTransform.skewX=n.skewX-this._currentTransform.skewX+t.DragonBones.PI_D*r,this._durationTransform.skewY=n.skewY-this._currentTransform.skewY+t.DragonBones.PI_D*r}else this._durationTransform.skewX=n.skewX-this._currentTransform.skewX+t.DragonBones.PI_D*h,this._durationTransform.skewY=n.skewY-this._currentTransform.skewY+t.DragonBones.PI_D*h;else this._durationTransform.skewX=t.Transform.normalizeRadian(n.skewX-this._currentTransform.skewX),this._durationTransform.skewY=t.Transform.normalizeRadian(n.skewY-this._currentTransform.skewY);0==this._durationTransform.skewX&&0==this._durationTransform.skewY||(this._tweenRotate=2)}else this._durationTransform.skewX=0,this._durationTransform.skewY=0;this._currentFrame.tweenScale?(this._durationTransform.scaleX=n.scaleX-this._currentTransform.scaleX,this._durationTransform.scaleY=n.scaleY-this._currentTransform.scaleY,0==this._durationTransform.scaleX&&0==this._durationTransform.scaleY||(this._tweenScale=2)):(this._durationTransform.scaleX=0,this._durationTransform.scaleY=0)}else this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0},s.prototype._onUpdateFrame=function(t){if(this._tweenTransform||this._tweenRotate||this._tweenScale){i.prototype._onUpdateFrame.call(this,t);var s=0;this._tweenTransform&&(1==this._tweenTransform?(this._tweenTransform=0,s=0):s=this._tweenProgress,this._animationState.additiveBlending?(this._transform.x=this._currentTransform.x+this._durationTransform.x*s,this._transform.y=this._currentTransform.y+this._durationTransform.y*s):(this._transform.x=this._originalTransform.x+this._currentTransform.x+this._durationTransform.x*s,this._transform.y=this._originalTransform.y+this._currentTransform.y+this._durationTransform.y*s)),this._tweenRotate&&(1==this._tweenRotate?(this._tweenRotate=0,s=0):s=this._tweenProgress,this._animationState.additiveBlending?(this._transform.skewX=this._currentTransform.skewX+this._durationTransform.skewX*s,this._transform.skewY=this._currentTransform.skewY+this._durationTransform.skewY*s):(this._transform.skewX=this._originalTransform.skewX+this._currentTransform.skewX+this._durationTransform.skewX*s,this._transform.skewY=this._originalTransform.skewY+this._currentTransform.skewY+this._durationTransform.skewY*s)),this._tweenScale&&(1==this._tweenScale?(this._tweenScale=0,s=0):s=this._tweenProgress,this._animationState.additiveBlending?(this._transform.scaleX=this._currentTransform.scaleX+this._durationTransform.scaleX*s,this._transform.scaleY=this._currentTransform.scaleY+this._durationTransform.scaleY*s):(this._transform.scaleX=this._originalTransform.scaleX*(this._currentTransform.scaleX+this._durationTransform.scaleX*s),this._transform.scaleY=this._originalTransform.scaleY*(this._currentTransform.scaleY+this._durationTransform.scaleY*s))),this.bone.invalidUpdate()}},s.prototype.fadeIn=function(t,s,n,h){i.prototype.fadeIn.call(this,t,s,n,h),this._originalTransform=this._timeline.originalTransform,this._boneTransform=this.bone._animationPose},s.prototype.fadeOut=function(){this._transform.skewX=t.Transform.normalizeRadian(this._transform.skewX),this._transform.skewY=t.Transform.normalizeRadian(this._transform.skewY)},s.prototype.update=function(t){i.prototype.update.call(this,t);var s=this._animationState._weightResult;s>0&&(0==this.bone._blendIndex?(this._boneTransform.x=this._transform.x*s,this._boneTransform.y=this._transform.y*s,this._boneTransform.skewX=this._transform.skewX*s,this._boneTransform.skewY=this._transform.skewY*s,this._boneTransform.scaleX=(this._transform.scaleX-1)*s+1,this._boneTransform.scaleY=(this._transform.scaleY-1)*s+1):(this._boneTransform.x+=this._transform.x*s,this._boneTransform.y+=this._transform.y*s,this._boneTransform.skewX+=this._transform.skewX*s,this._boneTransform.skewY+=this._transform.skewY*s,this._boneTransform.scaleX+=(this._transform.scaleX-1)*s,this._boneTransform.scaleY+=(this._transform.scaleY-1)*s),this.bone._blendIndex++,0!=this._animationState._fadeState&&this.bone.invalidUpdate())},s}(t.TweenTimelineState);t.BoneTimelineState=h;var r=function(i){function s(){i.call(this),this._color=new t.ColorTransform,this._durationColor=new t.ColorTransform}return n(s,i),s.toString=function(){return"[class dragonBones.SlotTimelineState]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.slot=null,this._colorDirty=!1,this._tweenColor=0,this._slotColor=null,this._color.identity(),this._durationColor.identity()},s.prototype._onArriveAtFrame=function(s){if(i.prototype._onArriveAtFrame.call(this,s),this._animationState._isDisabled(this.slot))return this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null,void(this._tweenColor=0);this._animationState._fadeState>=0&&(this.slot._setDisplayIndex(this._currentFrame.displayIndex),this.slot._updateMeshData(!0)),this._tweenColor=0;var n=this._currentFrame.color;if(this._keyFrameCount>1&&(this._tweenEasing!=t.DragonBones.NO_TWEEN||this._curve)){var h=this._currentFrame.next,r=h.color;n!=r&&h.displayIndex>=0&&(this._durationColor.alphaMultiplier=r.alphaMultiplier-n.alphaMultiplier,this._durationColor.redMultiplier=r.redMultiplier-n.redMultiplier,this._durationColor.greenMultiplier=r.greenMultiplier-n.greenMultiplier,this._durationColor.blueMultiplier=r.blueMultiplier-n.blueMultiplier,this._durationColor.alphaOffset=r.alphaOffset-n.alphaOffset,this._durationColor.redOffset=r.redOffset-n.redOffset,this._durationColor.greenOffset=r.greenOffset-n.greenOffset,this._durationColor.blueOffset=r.blueOffset-n.blueOffset,0==this._durationColor.alphaMultiplier&&0==this._durationColor.redMultiplier&&0==this._durationColor.greenMultiplier&&0==this._durationColor.blueMultiplier&&0==this._durationColor.alphaOffset&&0==this._durationColor.redOffset&&0==this._durationColor.greenOffset&&0==this._durationColor.blueOffset||(this._tweenColor=2))}0==this._tweenColor&&(this._slotColor.alphaMultiplier==n.alphaMultiplier&&this._slotColor.redMultiplier==n.redMultiplier&&this._slotColor.greenMultiplier==n.greenMultiplier&&this._slotColor.blueMultiplier==n.blueMultiplier&&this._slotColor.alphaOffset==n.alphaOffset&&this._slotColor.redOffset==n.redOffset&&this._slotColor.greenOffset==n.greenOffset&&this._slotColor.blueOffset==n.blueOffset||(this._tweenColor=1))},s.prototype._onUpdateFrame=function(t){i.prototype._onUpdateFrame.call(this,t);var s=0;if(this._tweenColor){1==this._tweenColor?(this._tweenColor=0,s=0):s=this._tweenProgress;var n=this._currentFrame.color;this._color.alphaMultiplier=n.alphaMultiplier+this._durationColor.alphaMultiplier*s,this._color.redMultiplier=n.redMultiplier+this._durationColor.redMultiplier*s,this._color.greenMultiplier=n.greenMultiplier+this._durationColor.greenMultiplier*s,this._color.blueMultiplier=n.blueMultiplier+this._durationColor.blueMultiplier*s,this._color.alphaOffset=n.alphaOffset+this._durationColor.alphaOffset*s,this._color.redOffset=n.redOffset+this._durationColor.redOffset*s,this._color.greenOffset=n.greenOffset+this._durationColor.greenOffset*s,this._color.blueOffset=n.blueOffset+this._durationColor.blueOffset*s,this._colorDirty=!0}},s.prototype.fadeIn=function(t,s,n,h){i.prototype.fadeIn.call(this,t,s,n,h),this._slotColor=this.slot._colorTransform},s.prototype.fadeOut=function(){this._tweenColor=0},s.prototype.update=function(t){if(i.prototype.update.call(this,t),(0!=this._tweenColor||this._colorDirty)&&this._animationState._weightResult>0)if(0!=this._animationState._fadeState){var s=Math.pow(this._animationState._fadeProgress,4);this._slotColor.alphaMultiplier+=(this._color.alphaMultiplier-this._slotColor.alphaMultiplier)*s,this._slotColor.redMultiplier+=(this._color.redMultiplier-this._slotColor.redMultiplier)*s,this._slotColor.greenMultiplier+=(this._color.greenMultiplier-this._slotColor.greenMultiplier)*s,this._slotColor.blueMultiplier+=(this._color.blueMultiplier-this._slotColor.blueMultiplier)*s,this._slotColor.alphaOffset+=(this._color.alphaOffset-this._slotColor.alphaOffset)*s,this._slotColor.redOffset+=(this._color.redOffset-this._slotColor.redOffset)*s,this._slotColor.greenOffset+=(this._color.greenOffset-this._slotColor.greenOffset)*s,this._slotColor.blueOffset+=(this._color.blueOffset-this._slotColor.blueOffset)*s,this.slot._colorDirty=!0}else this._colorDirty&&(this._colorDirty=!1,this._slotColor.alphaMultiplier=this._color.alphaMultiplier,this._slotColor.redMultiplier=this._color.redMultiplier,this._slotColor.greenMultiplier=this._color.greenMultiplier,this._slotColor.blueMultiplier=this._color.blueMultiplier,this._slotColor.alphaOffset=this._color.alphaOffset,this._slotColor.redOffset=this._color.redOffset,this._slotColor.greenOffset=this._color.greenOffset,this._slotColor.blueOffset=this._color.blueOffset,this.slot._colorDirty=!0)},s}(t.TweenTimelineState);t.SlotTimelineState=r;var e=function(i){function s(){i.call(this),this._ffdVertices=[]}return n(s,i),s.toString=function(){return"[class dragonBones.FFDTimelineState]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.slot=null,this._tweenFFD=0,this._slotFFDVertices=null,this._durationFFDFrame&&(this._durationFFDFrame.returnToPool(),this._durationFFDFrame=null),this._ffdVertices.length=0},s.prototype._onArriveAtFrame=function(s){if(i.prototype._onArriveAtFrame.call(this,s),this._tweenFFD=0,(this._tweenEasing!=t.DragonBones.NO_TWEEN||this._curve)&&(this._tweenFFD=this._updateExtensionKeyFrame(this._currentFrame,this._currentFrame.next,this._durationFFDFrame)),0==this._tweenFFD)for(var n=this._currentFrame.tweens,h=0,r=n.length;h<r;++h)if(this._slotFFDVertices[h]!=n[h]){this._tweenFFD=1;break}},s.prototype._onUpdateFrame=function(t){i.prototype._onUpdateFrame.call(this,t);var s=0;if(0!=this._tweenFFD){1==this._tweenFFD?(this._tweenFFD=0,s=0):s=this._tweenProgress;for(var n=this._currentFrame.tweens,h=this._durationFFDFrame.tweens,r=0,e=n.length;r<e;++r)this._ffdVertices[r]=n[r]+h[r]*s;this.slot._ffdDirty=!0}},s.prototype.fadeIn=function(s,n,h,r){i.prototype.fadeIn.call(this,s,n,h,r),this._slotFFDVertices=this.slot._ffdVertices,this._durationFFDFrame=t.BaseObject.borrowObject(t.ExtensionFrameData),this._durationFFDFrame.tweens.length=this._slotFFDVertices.length,this._ffdVertices.length=this._slotFFDVertices.length;for(var e=0,c=this._durationFFDFrame.tweens.length;e<c;++e)this._durationFFDFrame.tweens[e]=0;for(e=0,c=this._ffdVertices.length;e<c;++e)this._ffdVertices[e]=0},s.prototype.update=function(t){i.prototype.update.call(this,t);var s=this._animationState._weightResult;if(s>0){if(0==this.slot._blendIndex)for(var n=0,h=this._ffdVertices.length;n<h;++n)this._slotFFDVertices[n]=this._ffdVertices[n]*s;else for(n=0,h=this._ffdVertices.length;n<h;++n)this._slotFFDVertices[n]+=this._ffdVertices[n]*s;this.slot._blendIndex++,0!=this._animationState._fadeState&&(this.slot._ffdDirty=!0)}},s}(t.TweenTimelineState);t.FFDTimelineState=e}(h||(h={})),function(t){var i=function(){function i(){this.time=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND,this.timeScale=1,this._animatebles=[]}return Object.defineProperty(i,"clock",{get:function(){return i._clock||(i._clock=new i),i._clock},enumerable:!0,configurable:!0}),i.prototype.advanceTime=function(i){if(i!=i&&(i=0),i<0&&(i=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND-this.time),(i*=this.timeScale)<0?this.time-=i:this.time+=i,i){for(var s=0,n=0,h=this._animatebles.length;s<h;++s)(r=this._animatebles[s])?(n>0&&(this._animatebles[s-n]=r,this._animatebles[s]=null),r.advanceTime(i)):n++;if(n>0){for(h=this._animatebles.length;s<h;++s){var r=this._animatebles[s];r?this._animatebles[s-n]=r:n++}this._animatebles.length-=n}}},i.prototype.contains=function(t){return this._animatebles.indexOf(t)>=0},i.prototype.add=function(i){i&&this._animatebles.indexOf(i)<0&&(this._animatebles.push(i),t.DragonBones.debug&&i instanceof t.Armature&&t.DragonBones.addArmature(i))},i.prototype.remove=function(i){var s=this._animatebles.indexOf(i);s>=0&&(this._animatebles[s]=null,t.DragonBones.debug&&i instanceof t.Armature&&t.DragonBones.removeArmature(i))},i.prototype.clear=function(){for(var t=0,i=this._animatebles.length;t<i;++t)this._animatebles[t]=null},i._clock=null,i}();t.WorldClock=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this.global=new t.Transform,this.origin=new t.Transform,this.offset=new t.Transform,this._globalTransformMatrix=new t.Matrix}return n(s,i),s.prototype._onClear=function(){this.userData=null,this.name=null,this.globalTransformMatrix=this._globalTransformMatrix,this.global.identity(),this.origin.identity(),this.offset.identity(),this._armature=null,this._parent=null,this._globalTransformMatrix.identity()},s.prototype._setArmature=function(t){this._armature=t},s.prototype._setParent=function(t){this._parent=t},Object.defineProperty(s.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),s}(t.BaseObject);t.TransformObject=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this._bones=[],this._slots=[],this._actions=[],this._events=[],this.enableCache=!1}return n(s,i),s.toString=function(){return"[class dragonBones.Armature]"},s._onSortSlots=function(t,i){return t._zOrder>i._zOrder?1:-1},s.prototype._onClear=function(){for(var t=0,i=this._bones.length;t<i;++t)this._bones[t].returnToPool();for(t=0,i=this._slots.length;t<i;++t)this._slots[t].returnToPool();for(t=0,i=this._events.length;t<i;++t)this._events[t].returnToPool();this._animation&&this._animation.returnToPool(),this._display&&this._display._onClear(),this.userData=null,this._cacheFrameIndex=-1,this._armatureData=null,this._skinData=null,this._animation=null,this._display=null,this._parent=null,this._eventManager=null,this._delayDispose=!1,this._lockDispose=!1,this._debugDraw=!1,this._bonesDirty=!1,this._slotsDirty=!1,this._replacedTexture=null,this._bones.length=0,this._slots.length=0,this._actions.length=0,this._events.length=0},s.prototype._sortBones=function(){var t=this._bones.length;if(!(t<=0)){var i=this._bones.concat(),s=0,n=0;for(this._bones.length=0;n<t;){var h=i[s++];s>=t&&(s=0),this._bones.indexOf(h)>=0||h.parent&&this._bones.indexOf(h.parent)<0||h.ik&&this._bones.indexOf(h.ik)<0||(h.ik&&h.ikChain>0&&h.ikChainIndex==h.ikChain?this._bones.splice(this._bones.indexOf(h.parent)+1,0,h):this._bones.push(h),n++)}}},s.prototype._sortSlots=function(){this._slots.sort(s._onSortSlots)},s.prototype._doAction=function(t){switch(t.type){case 0:this._animation.play(t.data[0],t.data[1]);break;case 1:this._animation.stop(t.data[0]);break;case 2:this._animation.gotoAndPlayByTime(t.data[0],t.data[1],t.data[2]);break;case 3:this._animation.gotoAndStopByTime(t.data[0],t.data[1]);break;case 4:this._animation.fadeIn(t.data[0],t.data[1],t.data[2])}},s.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones.push(t))},s.prototype._removeBoneFromBoneList=function(t){var i=this._bones.indexOf(t);i>=0&&this._bones.splice(i,1)},s.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots.push(t))},s.prototype._removeSlotFromSlotList=function(t){var i=this._slots.indexOf(t);i>=0&&this._slots.splice(i,1)},s.prototype._sortZOrder=function(t){for(var i=this._armatureData.sortedSlots,s=t.length<1,n=0,h=i.length;n<h;++n){var r=i[s?n:t[n]],e=this.getSlot(r.name);e&&e._setZorder(n)}this._slotsDirty=!0},s.prototype._bufferAction=function(t){this._actions.push(t)},s.prototype._bufferEvent=function(t,i){t.type=i,t.armature=this,this._events.push(t)},s.prototype.dispose=function(){this._delayDispose=!0,!this._lockDispose&&this._animation&&this.returnToPool()},s.prototype.advanceTime=function(i){if(!this._animation)throw new Error("The armature has been disposed.");var s=i*this._animation.timeScale;this._animation._advanceTime(s),this._bonesDirty&&(this._bonesDirty=!1,this._sortBones()),this._slotsDirty&&(this._slotsDirty=!1,this._sortSlots());for(var n=0,h=this._bones.length;n<h;++n)this._bones[n]._update(this._cacheFrameIndex);for(n=0,h=this._slots.length;n<h;++n)(c=this._slots[n])._update(this._cacheFrameIndex),(a=c._childArmature)&&(c.inheritAnimation?a.advanceTime(s):a.advanceTime(i));if((t.DragonBones.debugDraw||this._debugDraw)&&(this._debugDraw=t.DragonBones.debugDraw,this._display._debugDraw(this._debugDraw)),!this._lockDispose){if(this._lockDispose=!0,this._events.length>0){for(n=0,h=this._events.length;n<h;++n){var r=this._events[n];r.type==t.EventObject.SOUND_EVENT?this._eventManager._dispatchEvent(r):this._display._dispatchEvent(r),r.returnToPool()}this._events.length=0}if(this._actions.length>0){for(n=0,h=this._actions.length;n<h;++n){var e=this._actions[n];if(e.slot){var c=this.getSlot(e.slot.name);c&&(a=c._childArmature)&&a._doAction(e)}else if(e.bone)for(var o=0,u=this._slots.length;o<u;++o){var a=this._slots[o]._childArmature;a&&a._doAction(e)}else this._doAction(e)}this._actions.length=0}this._lockDispose=!1}this._delayDispose&&this.returnToPool()},s.prototype.containsPoint=function(t,i,s){void 0===s&&(s=0);for(var n=0,h=this._slots.length;n<h;++n){var r=this._slots[n];if(r.containsPoint(t,i,s))return r}return null},s.prototype.intersectsSegment=function(t,i,s,n,h,r,e,c){void 0===h&&(h=0),void 0===r&&(r=null),void 0===e&&(e=null),void 0===c&&(c=null);for(var o=t==s,u=0,a=0,f=0,l=0,v=0,d=0,p=0,g=0,m=null,w=null,_=0,C=this._slots.length;_<C;++_){var b=this._slots[_];if(b.intersectsSegment(t,i,s,n,h,r,e,c)>0){if(!r&&!e){m=b;break}if(r&&((y=o?r.y-i:r.x-t)<0&&(y=-y),(!m||y<u)&&(u=y,f=r.x,l=r.y,m=b,c&&(p=c.x))),e){var y=e.x-t;y<0&&(y=-y),(!w||y>a)&&(a=y,v=e.x,d=e.y,w=b,c&&(g=c.y))}}}return m&&r&&(r.x=f,r.y=l,c&&(c.x=p)),w&&e&&(e.x=v,e.y=d,c&&(c.y=g)),m},s.prototype.invalidUpdate=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=!1),t){var s=this.getBone(t);if(s&&(s.invalidUpdate(),i))for(var n=0,h=this._slots.length;n<h;++n){var r=this._slots[n];r.parent==s&&r.invalidUpdate()}}else{for(n=0,h=this._bones.length;n<h;++n)this._bones[n].invalidUpdate();if(i)for(n=0,h=this._slots.length;n<h;++n)this._slots[n].invalidUpdate()}},s.prototype.getBone=function(t){for(var i=0,s=this._bones.length;i<s;++i){var n=this._bones[i];if(n.name==t)return n}return null},s.prototype.getBoneByDisplay=function(t){var i=this.getSlotByDisplay(t);return i?i.parent:null},s.prototype.getSlot=function(t){for(var i=0,s=this._slots.length;i<s;++i){var n=this._slots[i];if(n.name==t)return n}return null},s.prototype.getSlotByDisplay=function(t){if(t)for(var i=0,s=this._slots.length;i<s;++i){var n=this._slots[i];if(n.display==t)return n}return null},s.prototype.replaceTexture=function(t){this.replacedTexture=t},s.prototype.getBones=function(){return this._bones},s.prototype.getSlots=function(){return this._slots},Object.defineProperty(s.prototype,"name",{get:function(){return this._armatureData?this._armatureData.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!=t){this._armatureData.cacheFrames(t);for(var i=0,s=this._slots.length;i<s;++i){var n=this._slots[i].childArmature;n&&0==n.cacheFrameRate&&(n.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){this._display._onReplaceTexture(t),this._replacedTexture=t;for(var i=0,s=this._slots.length;i<s;++i)this._slots[i].invalidUpdate()},enumerable:!0,configurable:!0}),s.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},s.prototype.hasEventListener=function(t){return this._display.hasEvent(t)},s.prototype.addEventListener=function(t,i,s){this._display.addEvent(t,i,s)},s.prototype.removeEventListener=function(t,i,s){this._display.removeEvent(t,i,s)},s.prototype.addBone=function(t,i){if(void 0===i&&(i=null),!t)throw new Error;t._setArmature(this),t._setParent(i?this.getBone(i):null)},s.prototype.addSlot=function(t,i){var s=this.getBone(i);if(!s)throw new Error;t._setArmature(this),t._setParent(s)},s.prototype.removeBone=function(t){if(!t||t.armature!=this)throw new Error;t._setParent(null),t._setArmature(null)},s.prototype.removeSlot=function(t){if(!t||t.armature!=this)throw new Error;t._setParent(null),t._setArmature(null)},s.prototype.getDisplay=function(){return this._display},s}(t.BaseObject);t.Armature=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this._animationPose=new t.Transform,this._bones=[],this._slots=[]}return n(s,i),s.toString=function(){return"[class dragonBones.Bone]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.ikBendPositive=!1,this.ikWeight=0,this.length=0,this._transformDirty=2,this._blendIndex=0,this._cacheFrames=null,this._animationPose.identity(),this._visible=!0,this._ikChain=0,this._ikChainIndex=0,this._ik=null,this._bones.length=0,this._slots.length=0},s.prototype._updateGlobalTransformMatrix=function(){if(this._parent){var t=this._parent.global.skewY,i=this._parent.globalTransformMatrix;if(this.inheritScale)this.inheritRotation||(this.global.skewX-=t,this.global.skewY-=t),this.global.toMatrix(this.globalTransformMatrix),this.globalTransformMatrix.concat(i),this.inheritTranslation||(this.globalTransformMatrix.tx=this.global.x,this.globalTransformMatrix.ty=this.global.y),this.global.fromMatrix(this.globalTransformMatrix);else{if(this.inheritTranslation){var s=this.global.x,n=this.global.y;this.global.x=i.a*s+i.c*n+i.tx,this.global.y=i.d*n+i.b*s+i.ty}this.inheritRotation&&(this.global.skewX+=t,this.global.skewY+=t),this.global.toMatrix(this.globalTransformMatrix)}}else this.global.toMatrix(this.globalTransformMatrix)},s.prototype._computeIKA=function(){var t=this._ik.global,i=this.globalTransformMatrix.a*this.length,s=this.globalTransformMatrix.b*this.length,n=(Math.atan2(t.y-this.global.y,t.x-this.global.x)+this.offset.skewY-2*this.global.skewY+Math.atan2(s,i))*this.ikWeight;this.global.skewX+=n,this.global.skewY+=n,this.global.toMatrix(this.globalTransformMatrix)},s.prototype._computeIKB=function(){var t=this._parent.global,i=this._ik.global,s=this.globalTransformMatrix.a*this.length,n=this.globalTransformMatrix.b*this.length,h=s*s+n*n,r=Math.sqrt(h),e=this.global.x-t.x,c=this.global.y-t.y,o=e*e+c*c,u=Math.sqrt(o),a=(e=i.x-t.x)*e+(c=i.y-t.y)*c,f=Math.sqrt(a),l=0;if(r+u<=f||f+r<=u||f+u<=r)l=Math.atan2(i.y-t.y,i.x-t.x)+this._parent.offset.skewY,r+u<=f||u<r&&(l+=Math.PI);else{var v=(o-h+a)/(2*a),d=Math.sqrt(o-v*v*a)/f,p=t.x+e*v,g=t.y+c*v,m=-c*d,w=e*d;this.ikBendPositive?(this.global.x=p-m,this.global.y=g-w):(this.global.x=p+m,this.global.y=g+w),l=Math.atan2(this.global.y-t.y,this.global.x-t.x)+this._parent.offset.skewY}l=(l-t.skewY)*this.ikWeight,t.skewX+=l,t.skewY+=l,t.toMatrix(this._parent.globalTransformMatrix),this._parent._transformDirty=1,this.global.x=t.x+Math.cos(t.skewY)*u,this.global.y=t.y+Math.sin(t.skewY)*u;var _=(Math.atan2(i.y-this.global.y,i.x-this.global.x)+this.offset.skewY-2*this.global.skewY+Math.atan2(n,s))*this.ikWeight;this.global.skewX+=_,this.global.skewY+=_,this.global.toMatrix(this.globalTransformMatrix)},s.prototype._setArmature=function(t){if(this._armature!=t){this._ik=null;var i=null,s=null;if(this._armature&&(i=this.getSlots(),s=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,this._armature&&this._armature._addBoneToBoneList(this),i)for(var n=0,h=i.length;n<h;++n){var r=i[n];r.parent==this&&r._setArmature(this._armature)}if(s)for(n=0,h=s.length;n<h;++n){var e=s[n];e.parent==this&&e._setArmature(this._armature)}}},s.prototype._setIK=function(t,i,s){if(t){if(i==s){var n=this._parent;if(i&&n?i=1:(i=0,s=0,n=this),n==t||n.contains(t))t=null,i=0,s=0;else for(var h=t;h.ik&&h.ikChain;){if(n.contains(h.ik)){t=null,i=0,s=0;break}h=h.parent}}}else i=0,s=0;this._ik=t,this._ikChain=i,this._ikChainIndex=s,this._armature&&(this._armature._bonesDirty=!0)},s.prototype._update=function(i){if(this._blendIndex=0,i>=0){var s=this._cacheFrames[i];this.globalTransformMatrix==s?this._transformDirty=0:s?(this._transformDirty=2,this.globalTransformMatrix=s):2==this._transformDirty||this._parent&&0!=this._parent._transformDirty||this._ik&&this.ikWeight>0&&0!=this._ik._transformDirty?(this._transformDirty=2,this.globalTransformMatrix=this._globalTransformMatrix):this.globalTransformMatrix!=this._globalTransformMatrix?(this._transformDirty=0,this._cacheFrames[i]=this.globalTransformMatrix):(this._transformDirty=2,this.globalTransformMatrix=this._globalTransformMatrix)}else(2==this._transformDirty||this._parent&&0!=this._parent._transformDirty||this._ik&&this.ikWeight>0&&0!=this._ik._transformDirty)&&(this._transformDirty=2,this.globalTransformMatrix=this._globalTransformMatrix);0!=this._transformDirty&&(2==this._transformDirty?(this._transformDirty=1,this.globalTransformMatrix==this._globalTransformMatrix&&(this.global.x=this.origin.x+this.offset.x+this._animationPose.x,this.global.y=this.origin.y+this.offset.y+this._animationPose.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this._animationPose.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this._animationPose.skewY,this.global.scaleX=this.origin.scaleX*this.offset.scaleX*this._animationPose.scaleX,this.global.scaleY=this.origin.scaleY*this.offset.scaleY*this._animationPose.scaleY,this._updateGlobalTransformMatrix(),this._ik&&this._ikChainIndex==this._ikChain&&this.ikWeight>0&&(this.inheritTranslation&&this._ikChain>0&&this._parent?this._computeIKB():this._computeIKA()),i>=0&&!this._cacheFrames[i]&&(this.globalTransformMatrix=t.BoneTimelineData.cacheFrame(this._cacheFrames,i,this._globalTransformMatrix)))):this._transformDirty=0)},s.prototype.invalidUpdate=function(){this._transformDirty=2},s.prototype.contains=function(t){if(t){if(t==this)return!1;for(var i=t;i!=this&&i;)i=i.parent;return i==this}return!1},s.prototype.getBones=function(){this._bones.length=0;for(var t=this._armature.getBones(),i=0,s=t.length;i<s;++i){var n=t[i];n.parent==this&&this._bones.push(n)}return this._bones},s.prototype.getSlots=function(){this._slots.length=0;for(var t=this._armature.getSlots(),i=0,s=t.length;i<s;++i){var n=t[i];n.parent==this&&this._slots.push(n)}return this._slots},Object.defineProperty(s.prototype,"ikChain",{get:function(){return this._ikChain},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"ikChainIndex",{get:function(){return this._ikChainIndex},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"ik",{get:function(){return this._ik},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!=t){this._visible=t;for(var i=this._armature.getSlots(),s=0,n=i.length;s<n;++s){var h=i[s];h._parent==this&&h._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"slot",{get:function(){for(var t=this._armature.getSlots(),i=0,s=t.length;i<s;++i){var n=t[i];if(n.parent==this)return n}return null},enumerable:!0,configurable:!0}),s}(t.TransformObject);t.Bone=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this._colorTransform=new t.ColorTransform,this._ffdVertices=[],this._replacedDisplayDataSet=[],this._localMatrix=new t.Matrix,this._displayList=[],this._meshBones=[]}return n(s,i),s.prototype._onClear=function(){i.prototype._onClear.call(this);for(var s=[],n=0,h=this._displayList.length;n<h;++n)(r=this._displayList[n])!=this._rawDisplay&&r!=this._meshDisplay&&s.indexOf(r)<0&&s.push(r);for(n=0,h=s.length;n<h;++n){var r=s[n];r instanceof t.Armature?r.dispose():this._disposeDisplay(r)}this._meshDisplay&&this._meshDisplay!=this._rawDisplay&&this._disposeDisplay(this._meshDisplay),this._rawDisplay&&this._disposeDisplay(this._rawDisplay),this.inheritAnimation=!0,this.displayController=null,this._blendIndex=0,this._displayDataSet=null,this._meshData=null,this._childArmature=null,this._rawDisplay=null,this._meshDisplay=null,this._cacheFrames=null,this._colorTransform.identity(),this._ffdVertices.length=0,this._replacedDisplayDataSet.length=0,this._zOrderDirty=!1,this._displayDirty=!1,this._colorDirty=!1,this._blendModeDirty=!1,this._originDirty=!1,this._transformDirty=!1,this._ffdDirty=!1,this._zOrder=0,this._displayIndex=-2,this._pivotX=0,this._pivotY=0,this._blendMode=0,this._display=null,this._localMatrix.identity(),this._displayList.length=0,this._meshBones.length=0},s.prototype._isMeshBonesUpdate=function(){for(var t=0,i=this._meshBones.length;t<i;++t)if(0!=this._meshBones[t]._transformDirty)return!0;return!1},s.prototype._updatePivot=function(t,i,n){var h=t&&t!=i&&(!this._meshData||this._meshData!=t.mesh);if(this._meshData&&this._display==this._meshDisplay)this._pivotX=0,this._pivotY=0;else{var r=this._armature.armatureData.scale;if(this._pivotX=i.pivot.x,this._pivotY=i.pivot.y,i.isRelativePivot){var e=n.frame||n.region,c=e.width*r,o=e.height*r;n.rotated&&(c=e.height,o=e.width),this._pivotX*=c,this._pivotY*=o}n.frame&&(this._pivotX+=n.frame.x*r,this._pivotY+=n.frame.y*r)}h&&(t.transform.toMatrix(s._helpMatrix),s._helpMatrix.invert(),s._helpMatrix.transformPoint(0,0,s._helpPoint),this._pivotX-=s._helpPoint.x,this._pivotY-=s._helpPoint.y,i.transform.toMatrix(s._helpMatrix),s._helpMatrix.invert(),s._helpMatrix.transformPoint(0,0,s._helpPoint),this._pivotX+=s._helpPoint.x,this._pivotY+=s._helpPoint.y)},s.prototype._updateDisplay=function(){var i=this._display||this._rawDisplay,s=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature._display):this._childArmature=null):(this._display=null,this._childArmature=null);var n=this._display||this._rawDisplay;if(n!=i&&(this._onUpdateDisplay(),i?this._replaceDisplay(i):this._addDisplay(),this._blendModeDirty=!0,this._colorDirty=!0),this._displayDataSet&&this._displayIndex>=0&&this._displayIndex<this._displayDataSet.displays.length&&(this.origin.copyFrom(this._displayDataSet.displays[this._displayIndex].transform),this._originDirty=!0),this._updateMeshData(!1),n!=this._rawDisplay&&n!=this._meshDisplay||this._updateFrame(),this._childArmature!=s&&(s&&(s._parent=null,this.inheritAnimation&&s.animation.reset()),this._childArmature&&(this._childArmature._parent=this,this.inheritAnimation))){if(0==this._childArmature.cacheFrameRate){var h=this._armature.cacheFrameRate;0!=h&&(this._childArmature.cacheFrameRate=h)}var r=this._armature.armatureData.getSlot(this.name),e=r.actions.length>0?r.actions:this._childArmature.armatureData.actions;if(e.length>0)for(var c=0,o=e.length;c<o;++c)this._childArmature._bufferAction(e[c]);else this._childArmature.animation.play()}},s.prototype._updateLocalTransformMatrix=function(){this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix)},s.prototype._updateGlobalTransformMatrix=function(){this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(this._parent.globalTransformMatrix),this.global.fromMatrix(this.globalTransformMatrix)},s.prototype._setArmature=function(t){this._armature!=t&&(this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},s.prototype._updateMeshData=function(t){var i=this._meshData,s=null;if(this._display&&this._display==this._meshDisplay&&this._displayIndex>=0){s=this._displayDataSet&&this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex].mesh:null;var n=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,h=n?n.mesh:null;this._meshData=h||s}else this._meshData=null;if(this._meshData!=i){if(this._meshData&&this._meshData==s){if(this._meshData.skinned){this._meshBones.length=this._meshData.bones.length;for(var r=0,e=this._meshBones.length;r<e;++r)this._meshBones[r]=this._armature.getBone(this._meshData.bones[r].name);var c=0;for(r=0,e=this._meshData.boneIndices.length;r<e;++r)c+=this._meshData.boneIndices[r].length;this._ffdVertices.length=2*c}else this._meshBones.length=0,this._ffdVertices.length=this._meshData.vertices.length;for(r=0,e=this._ffdVertices.length;r<e;++r)this._ffdVertices[r]=0;this._ffdDirty=!0}else this._meshBones.length=0,this._ffdVertices.length=0;t&&this._armature.animation._updateFFDTimelineStates()}},s.prototype._update=function(i){if(this._blendIndex=0,this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),this._displayDirty&&(this._displayDirty=!1,this._updateDisplay()),this._display&&(this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),!this._meshData||((this._ffdDirty||this._meshData.skinned&&this._isMeshBonesUpdate())&&(this._ffdDirty=!1,this._updateMesh()),!this._meshData.skinned))){if(this._originDirty&&(this._originDirty=!1,this._transformDirty=!0,this._updateLocalTransformMatrix()),i>=0&&this._cacheFrames){var s=this._cacheFrames[i];this.globalTransformMatrix==s?this._transformDirty=!1:s?(this._transformDirty=!0,this.globalTransformMatrix=s):this._transformDirty||0!=this._parent._transformDirty?(this._transformDirty=!0,this.globalTransformMatrix=this._globalTransformMatrix):this.globalTransformMatrix!=this._globalTransformMatrix?(this._transformDirty=!1,this._cacheFrames[i]=this.globalTransformMatrix):(this._transformDirty=!0,this.globalTransformMatrix=this._globalTransformMatrix)}else(this._transformDirty||0!=this._parent._transformDirty)&&(this._transformDirty=!0,this.globalTransformMatrix=this._globalTransformMatrix);this._transformDirty&&(this._transformDirty=!1,this.globalTransformMatrix==this._globalTransformMatrix&&(this._updateGlobalTransformMatrix(),i>=0&&this._cacheFrames&&!this._cacheFrames[i]&&(this.globalTransformMatrix=t.SlotTimelineData.cacheFrame(this._cacheFrames,i,this._globalTransformMatrix))),this._updateTransform())}},s.prototype._setDisplayList=function(i){if(i&&i.length>0){this._displayList.length!=i.length&&(this._displayList.length=i.length);for(var s=0,n=i.length;s<n;++s){var h=i[s];h&&h!=this._rawDisplay&&h!=this._meshDisplay&&!(h instanceof t.Armature)&&this._displayList.indexOf(h)<0&&this._initDisplay(h),this._displayList[s]=h}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!=this._displayList[this._displayIndex]:this._displayDirty=null!=this._display,this._displayDirty},s.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},s.prototype._setDisplayIndex=function(t){return this._displayIndex!=t&&(this._displayIndex=t,this._displayDirty=!0,this._displayDirty)},s.prototype._setBlendMode=function(t){return this._blendMode!=t&&(this._blendMode=t,this._blendModeDirty=!0,!0)},s.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,!0},s.prototype.containsPoint=function(t,i,n){void 0===n&&(n=0);var h=this.displayData;return!(!h||!h.boundingBox||n&&h.color!=n)&&(0==this._blendIndex&&(this._blendIndex=1,this._updateLocalTransformMatrix(),this._updateGlobalTransformMatrix()),s._helpMatrix.copyFrom(this.globalTransformMatrix),s._helpMatrix.invert(),s._helpMatrix.transformPoint(t,i,s._helpPoint),h.boundingBox.containsPoint(s._helpPoint.x,s._helpPoint.y))},s.prototype.intersectsSegment=function(t,i,n,h,r,e,c,o){void 0===r&&(r=0),void 0===e&&(e=null),void 0===c&&(c=null),void 0===o&&(o=null);var u=this.displayData;if(!u||!u.boundingBox||r&&u.color!=r)return 0;0==this._blendIndex&&(this._blendIndex=1,this._updateLocalTransformMatrix(),this._updateGlobalTransformMatrix()),s._helpMatrix.copyFrom(this.globalTransformMatrix),s._helpMatrix.invert(),s._helpMatrix.transformPoint(t,i,s._helpPoint),t=s._helpPoint.x,i=s._helpPoint.y,s._helpMatrix.transformPoint(n,h,s._helpPoint),n=s._helpPoint.x,h=s._helpPoint.y;var a=u.boundingBox.intersectsSegment(t,i,n,h,e,c,o);return a>0&&(1==a||2==a?e?(this.globalTransformMatrix.transformPoint(e.x,e.y,e),c&&(c.x=e.x,c.y=e.y)):c&&this.globalTransformMatrix.transformPoint(c.x,c.y,c):(e&&this.globalTransformMatrix.transformPoint(e.x,e.y,e),c&&this.globalTransformMatrix.transformPoint(c.x,c.y,c)),o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),s._helpPoint,!0),o.x=Math.atan2(s._helpPoint.y,s._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),s._helpPoint,!0),o.y=Math.atan2(s._helpPoint.y,s._helpPoint.x))),a},s.prototype.invalidUpdate=function(){this._displayDirty=!0},Object.defineProperty(s.prototype,"displayData",{get:function(){return this._displayIndex<0||this._displayIndex>=this._displayDataSet.displays.length?null:this._displayDataSet.displays[this._displayIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this._update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(i){var s=this._displayList.concat(),n=[];this._setDisplayList(i)&&this._update(-1);for(var h=0,r=s.length;h<r;++h)(e=s[h])&&e!=this._rawDisplay&&e!=this._meshDisplay&&this._displayList.indexOf(e)<0&&n.indexOf(e)<0&&n.push(e);for(h=0,r=n.length;h<r;++h){var e=n[h];e instanceof t.Armature?e.dispose():this._disposeDisplay(e)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!=t){var i=this._displayList.length;if(this._displayIndex<0&&0==i&&(this._displayIndex=0),!(this._displayIndex<0)){var s=this.displayList;i<=this._displayIndex&&(s.length=this._displayIndex+1),s[this._displayIndex]=t,this.displayList=s}}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!=t&&(t&&t.display.advanceTimeBySelf(!1),this.display=t)},enumerable:!0,configurable:!0}),s.prototype.getDisplay=function(){return this._display},s.prototype.setDisplay=function(t){this.display=t},s._helpPoint=new t.Point,s._helpMatrix=new t.Matrix,s}(t.TransformObject);t.Slot=i}(h||(h={})),function(t){var i=function(t){function i(){t.call(this)}return n(i,t),i.toString=function(){return"[class dragonBones.EventObject]"},i.prototype._onClear=function(){this.type=null,this.name=null,this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.frame=null,this.data=null,this.userData=null},i.prototype.getInt=function(t){return this.data?this.data.ints[t]:0},i.prototype.getFloat=function(t){return this.data?this.data.floats[t]:0},i.prototype.getString=function(t){return this.data?this.data.strings[t]:null},i.START="start",i.LOOP_COMPLETE="loopComplete",i.COMPLETE="complete",i.FADE_IN="fadeIn",i.FADE_IN_COMPLETE="fadeInComplete",i.FADE_OUT="fadeOut",i.FADE_OUT_COMPLETE="fadeOutComplete",i.FRAME_EVENT="frameEvent",i.SOUND_EVENT="soundEvent",i}(t.BaseObject);t.EventObject=i}(h||(h={})),function(t){var i=function(t){function i(){t.call(this),this.frames=[]}return n(i,t),i.toString=function(){return"[class dragonBones.TimelineData]"},i.prototype._onClear=function(){for(var t=null,i=0,s=this.frames.length;i<s;++i){var n=this.frames[i];t&&n!=t&&t.returnToPool(),t=n}this.scale=1,this.offset=0,this.frames.length=0},i}(t.BaseObject);t.TimelineData=i;var s=function(t){function i(){t.apply(this,arguments)}return n(i,t),i.toString=function(){return"[class dragonBones.ZOrderTimelineData]"},i}(i);t.ZOrderTimelineData=s;var h=function(i){function s(){i.call(this),this.originalTransform=new t.Transform,this.cachedFrames=[]}return n(s,i),s.cacheFrame=function(i,s,n){var h=i[s]=new t.Matrix;return h.copyFrom(n),h},s.toString=function(){return"[class dragonBones.BoneTimelineData]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.bone=null,this.originalTransform.identity(),this.cachedFrames.length=0},s.prototype.cacheFrames=function(t){this.cachedFrames.length=0,this.cachedFrames.length=t},s}(i);t.BoneTimelineData=h;var r=function(i){function s(){i.call(this),this.cachedFrames=[]}return n(s,i),s.cacheFrame=function(i,s,n){var h=i[s]=new t.Matrix;return h.copyFrom(n),h},s.toString=function(){return"[class dragonBones.SlotTimelineData]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.slot=null,this.cachedFrames.length=0},s.prototype.cacheFrames=function(t){this.cachedFrames.length=0,this.cachedFrames.length=t},s}(i);t.SlotTimelineData=r;var e=function(t){function i(){t.call(this)}return n(i,t),i.toString=function(){return"[class dragonBones.FFDTimelineData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.skin=null,this.slot=null,this.display=null},i}(i);t.FFDTimelineData=e}(h||(h={})),function(t){var i=function(t){function i(){t.call(this),this.boneTimelines={},this.slotTimelines={},this.ffdTimelines={},this.cachedFrames=[]}return n(i,t),i.toString=function(){return"[class dragonBones.AnimationData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.zOrderTimeline&&this.zOrderTimeline.returnToPool();for(var i in this.boneTimelines)this.boneTimelines[i].returnToPool(),delete this.boneTimelines[i];for(var i in this.slotTimelines)this.slotTimelines[i].returnToPool(),delete this.slotTimelines[i];for(var i in this.ffdTimelines){for(var s in this.ffdTimelines[i])for(var n in this.ffdTimelines[i][s])this.ffdTimelines[i][s][n].returnToPool();delete this.ffdTimelines[i]}this.hasAsynchronyTimeline=!1,this.frameCount=0,this.playTimes=0,this.position=0,this.duration=0,this.fadeInTime=0,this.cacheFrameRate=0,this.name=null,this.animation=null,this.zOrderTimeline=null,this.cachedFrames.length=0},i.prototype.cacheFrames=function(t){if(!this.animation){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var i=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=0,this.cachedFrames.length=i;for(var s in this.boneTimelines)this.boneTimelines[s].cacheFrames(i);for(var s in this.slotTimelines)this.slotTimelines[s].cacheFrames(i)}},i.prototype.addBoneTimeline=function(t){if(!t||!t.bone||this.boneTimelines[t.bone.name])throw new Error;this.boneTimelines[t.bone.name]=t},i.prototype.addSlotTimeline=function(t){if(!t||!t.slot||this.slotTimelines[t.slot.name])throw new Error;this.slotTimelines[t.slot.name]=t},i.prototype.addFFDTimeline=function(t){if(!(t&&t.skin&&t.slot&&t.display))throw new Error;var i=this.ffdTimelines[t.skin.name]=this.ffdTimelines[t.skin.name]||{},s=i[t.slot.slot.name]=i[t.slot.slot.name]||{};if(s[t.display.name])throw new Error;s[t.display.name]=t},i.prototype.getBoneTimeline=function(t){return this.boneTimelines[t]},i.prototype.getSlotTimeline=function(t){return this.slotTimelines[t]},i.prototype.getFFDTimeline=function(t,i,s){var n=this.ffdTimelines[t];if(n){var h=n[i];if(h)return h[s]}return null},i}(t.TimelineData);t.AnimationData=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this),this.aabb=new t.Rectangle,this.bones={},this.slots={},this.skins={},this.animations={},this.actions=[],this._sortedBones=[],this._sortedSlots=[],this._bonesChildren={}}return n(s,i),s._onSortSlots=function(t,i){return t.zOrder>i.zOrder?1:-1},s.toString=function(){return"[class dragonBones.ArmatureData]"},s.prototype._onClear=function(){for(var t in this.bones)this.bones[t].returnToPool(),delete this.bones[t];for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t];for(var t in this.skins)this.skins[t].returnToPool(),delete this.skins[t];for(var t in this.animations)this.animations[t].returnToPool(),delete this.animations[t];t=0;for(var i=this.actions.length;t<i;++t)this.actions[t].returnToPool();this.frameRate=0,this.type=-1,this.name=null,this.parent=null,this.userData=null,this.aabb.clear(),this.actions.length=0,this.cacheFrameRate=0,this.scale=1;for(var t in this._bonesChildren)delete this._bonesChildren[t];this._boneDirty=!1,this._slotDirty=!1,this._defaultSkin=null,this._defaultAnimation=null,this._sortedBones.length=0,this._sortedSlots.length=0},s.prototype._sortBones=function(){var t=this._sortedBones.length;if(!(t<1)){var i=this._sortedBones.concat(),s=0,n=0;for(this._sortedBones.length=0;n<t;){var h=i[s++];s>=t&&(s=0),this._sortedBones.indexOf(h)>=0||h.parent&&this._sortedBones.indexOf(h.parent)<0||h.ik&&this._sortedBones.indexOf(h.ik)<0||(h.ik&&h.chain>0&&h.chainIndex==h.chain?this._sortedBones.splice(this._sortedBones.indexOf(h.parent)+1,0,h):this._sortedBones.push(h),n++)}}},s.prototype._sortSlots=function(){this._sortedSlots.sort(s._onSortSlots)},s.prototype.cacheFrames=function(t){if(this.cacheFrameRate!=t){this.cacheFrameRate=t;for(var i in this.animations)this.animations[i].cacheFrames(this.cacheFrameRate)}},s.prototype.addBone=function(t,i){if(!t||!t.name||this.bones[t.name])throw new Error;if(i){var s=this.getBone(i);s?t.parent=s:(this._bonesChildren[i]=this._bonesChildren[i]||[]).push(t)}var n=this._bonesChildren[t.name];if(n){for(var h=0,r=n.length;h<r;++h)n[h].parent=t;delete this._bonesChildren[t.name]}this.bones[t.name]=t,this._sortedBones.push(t),this._boneDirty=!0},s.prototype.addSlot=function(t){if(!t||!t.name||this.slots[t.name])throw new Error;this.slots[t.name]=t,this._sortedSlots.push(t),this._slotDirty=!0},s.prototype.addSkin=function(t){if(!t||!t.name||this.skins[t.name])throw new Error;this.skins[t.name]=t,this._defaultSkin||(this._defaultSkin=t)},s.prototype.addAnimation=function(t){if(!t||!t.name||this.animations[t.name])throw new Error;this.animations[t.name]=t,this._defaultAnimation||(this._defaultAnimation=t)},s.prototype.getBone=function(t){return this.bones[t]},s.prototype.getSlot=function(t){return this.slots[t]},s.prototype.getSkin=function(t){return t?this.skins[t]:this._defaultSkin},s.prototype.getAnimation=function(t){return t?this.animations[t]:this._defaultAnimation},Object.defineProperty(s.prototype,"sortedBones",{get:function(){return this._boneDirty&&(this._boneDirty=!1,this._sortBones()),this._sortedBones},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sortedSlots",{get:function(){return this._slotDirty&&(this._slotDirty=!1,this._sortSlots()),this._sortedSlots},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"defaultSkin",{get:function(){return this._defaultSkin},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"defaultAnimation",{get:function(){return this._defaultAnimation},enumerable:!0,configurable:!0}),s}(t.BaseObject);t.ArmatureData=i;var s=function(i){function s(){i.call(this),this.transform=new t.Transform}return n(s,i),s.toString=function(){return"[class dragonBones.BoneData]"},s.prototype._onClear=function(){this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.bendPositive=!1,this.chain=0,this.chainIndex=0,this.weight=0,this.length=0,this.name=null,this.parent=null,this.ik=null,this.transform.identity()},s}(t.BaseObject);t.BoneData=s;var h=function(i){function s(){i.call(this),this.actions=[]}return n(s,i),s.generateColor=function(){return new t.ColorTransform},s.toString=function(){return"[class dragonBones.SlotData]"},s.prototype._onClear=function(){for(var t=0,i=this.actions.length;t<i;++t)this.actions[t].returnToPool();this.displayIndex=0,this.zOrder=0,this.blendMode=0,this.name=null,this.parent=null,this.color=null,this.actions.length=0},s.DEFAULT_COLOR=new t.ColorTransform,s}(t.BaseObject);t.SlotData=h;var r=function(t){function i(){t.call(this),this.slots={}}return n(i,t),i.toString=function(){return"[class dragonBones.SkinData]"},i.prototype._onClear=function(){for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t];this.name=null},i.prototype.addSlot=function(t){if(!t||!t.slot||this.slots[t.slot.name])throw new Error;this.slots[t.slot.name]=t},i.prototype.getSlot=function(t){return this.slots[t]},i}(t.BaseObject);t.SkinData=r;var e=function(t){function i(){t.call(this),this.displays=[]}return n(i,t),i.toString=function(){return"[class dragonBones.SlotDisplayDataSet]"},i.prototype._onClear=function(){for(var t=0,i=this.displays.length;t<i;++t)this.displays[t].returnToPool();this.slot=null,this.displays.length=0},i}(t.BaseObject);t.SlotDisplayDataSet=e;var c=function(i){function s(){i.call(this),this.pivot=new t.Point,this.transform=new t.Transform}return n(s,i),s.toString=function(){return"[class dragonBones.DisplayData]"},s.prototype._onClear=function(){this.mesh&&!this.share&&this.mesh.returnToPool(),this.boundingBox&&this.boundingBox.returnToPool(),this.isRelativePivot=!1,this.type=-1,this.inheritAnimation=!0,this.color=0,this.name=null,this.path=null,this.texture=null,this.armature=null,this.mesh=null,this.share=null,this.boundingBox=null,this.pivot.clear(),this.transform.identity()},s}(t.BaseObject);t.DisplayData=c;var o=function(i){function s(){i.call(this),this.slotPose=new t.Matrix,this.uvs=[],this.vertices=[],this.vertexIndices=[],this.boneIndices=[],this.weights=[],this.boneVertices=[],this.bones=[],this.inverseBindPose=[]}return n(s,i),s.toString=function(){return"[class dragonBones.MeshData]"},s.prototype._onClear=function(){this.skinned=!1,this.slotPose.identity(),this.uvs.length=0,this.vertices.length=0,this.vertexIndices.length=0,this.boneIndices.length=0,this.weights.length=0,this.boneVertices.length=0,this.bones.length=0,this.inverseBindPose.length=0},s}(t.BaseObject);t.MeshData=o;var u=function(t){function i(){t.call(this),this.x=0,this.y=0,this.width=0,this.height=0,this.vertices=[]}return n(i,t),i.toString=function(){return"[class dragonBones.BoundingBoxData]"},i._computeOutCode=function(t,i,s,n,h,r){var e=0;return t<s?e|=1:t>h&&(e|=2),i<n?e|=4:i>r&&(e|=8),e},i.segmentIntersectsRectangle=function(t,s,n,h,r,e,c,o,u,a,f){void 0===u&&(u=null),void 0===a&&(a=null),void 0===f&&(f=null);var l=t>r&&t<c&&s>e&&s<o,v=n>r&&n<c&&h>e&&h<o;if(l&&v)return-1;for(var d=0,p=i._computeOutCode(t,s,r,e,c,o),g=i._computeOutCode(n,h,r,e,c,o);;){if(!(p|g)){d=2;break}if(p&g)break;var m=0,w=0,_=0,C=p||g;4&C?(m=t+(n-t)*(e-s)/(h-s),w=e,f&&(_=.5*-Math.PI)):8&C?(m=t+(n-t)*(o-s)/(h-s),w=o,f&&(_=.5*Math.PI)):2&C?(w=s+(h-s)*(c-t)/(n-t),m=c,f&&(_=0)):1&C&&(w=s+(h-s)*(r-t)/(n-t),m=r,f&&(_=Math.PI)),C==p?(t=m,s=w,p=i._computeOutCode(t,s,r,e,c,o),f&&(f.x=_)):(n=m,h=w,g=i._computeOutCode(n,h,r,e,c,o),f&&(f.y=_))}return d&&(l?(d=2,u&&(u.x=n,u.y=h),a&&(a.x=n,a.y=n),f&&(f.x=f.y+Math.PI)):v?(d=1,u&&(u.x=t,u.y=s),a&&(a.x=t,a.y=s),f&&(f.y=f.x+Math.PI)):(d=3,u&&(u.x=t,u.y=s),a&&(a.x=n,a.y=h))),d},i.segmentIntersectsEllipse=function(t,i,s,n,h,r,e,c,o,u,a){void 0===o&&(o=null),void 0===u&&(u=null),void 0===a&&(a=null);var f=e/c,l=f*f,v=s-t,d=(n*=f)-(i*=f),p=Math.sqrt(v*v+d*d),g=v/p,m=d/p,w=(h-t)*g+(r-i)*m,_=e*e,C=_-(t*t+i*i)+w*w,b=0;if(C>=0){var y=Math.sqrt(C),T=w-y,S=w+y,A=T<0?-1:T<=p?0:1,M=S<0?-1:S<=p?0:1,x=A*M;if(x<0)return-1;0==x&&(-1==A?(b=2,s=t+S*g,n=(i+S*m)/f,o&&(o.x=s,o.y=n),u&&(u.x=s,u.y=n),a&&(a.x=Math.atan2(n/_*l,s/_),a.y=a.x+Math.PI)):1==M?(b=1,t+=T*g,i=(i+T*m)/f,o&&(o.x=t,o.y=i),u&&(u.x=t,u.y=i),a&&(a.x=Math.atan2(i/_*l,t/_),a.y=a.x+Math.PI)):(b=3,o&&(o.x=t+T*g,o.y=(i+T*m)/f,a&&(a.x=Math.atan2(o.y/_*l,o.x/_))),u&&(u.x=t+S*g,u.y=(i+S*m)/f,a&&(a.y=Math.atan2(u.y/_*l,u.x/_)))))}return b},i.segmentIntersectsPolygon=function(t,i,s,n,h,r,e,c){void 0===r&&(r=null),void 0===e&&(e=null),void 0===c&&(c=null),t==s&&(t=s+.01),i==n&&(i=n+.01);for(var o=h.length,u=t-s,a=i-n,f=t*n-i*s,l=0,v=h[o-2],d=h[o-1],p=0,g=0,m=0,w=0,_=0,C=0,b=0;b<o;b+=2){var y=h[b],T=h[b+1];v==y&&(v=y+.01),d==T&&(d=T+.01);var S=v-y,A=d-T,M=v*T-d*y,x=u*A-a*S,E=(f*S-u*M)/x;if((E>=v&&E<=y||E>=y&&E<=v)&&(0==u||E>=t&&E<=s||E>=s&&E<=t)){var O=(f*A-a*M)/x;if((O>=d&&O<=T||O>=T&&O<=d)&&(0==a||O>=i&&O<=n||O>=n&&O<=i)){if(!e){m=E,w=O,_=E,C=O,l++,c&&(c.x=Math.atan2(T-d,y-v)-.5*Math.PI,c.y=c.x);break}var P=E-t;P<0&&(P=-P),0==l?(p=P,g=P,m=E,w=O,_=E,C=O,c&&(c.x=Math.atan2(T-d,y-v)-.5*Math.PI,c.y=c.x)):(P<p&&(p=P,m=E,w=O,c&&(c.x=Math.atan2(T-d,y-v)-.5*Math.PI)),P>g&&(g=P,_=E,C=O,c&&(c.y=Math.atan2(T-d,y-v)-.5*Math.PI))),l++}}v=y,d=T}return 1==l?(r&&(r.x=m,r.y=w),e&&(e.x=m,e.y=w),c&&(c.y=c.x+Math.PI)):l>1&&(l++,r&&(r.x=m,r.y=w),e&&(e.x=_,e.y=C)),l},i.prototype._onClear=function(){this.type=-1,this.x=0,this.y=0,this.width=0,this.height=0,this.vertices.length=0},i.prototype.containsPoint=function(t,i){var s=!1;if(2==this.type){if(t>=this.x&&t<=this.width&&i>=this.y&&i<=this.height)for(var n=0,h=this.vertices.length,r=h-2;n<h;n+=2){var e=this.vertices[r+1],c=this.vertices[n+1];if(c<i&&e>=i||e<i&&c>=i){var o=this.vertices[r],u=this.vertices[n];(i-c)*(o-u)/(e-c)+u<t&&(s=!s)}r=n}}else{var a=.5*this.width;if(t>=-a&&t<=a){var f=.5*this.height;i>=-f&&i<=f&&(1==this.type?(i*=a/f,s=Math.sqrt(t*t+i*i)<=a):s=!0)}}return s},i.prototype.intersectsSegment=function(t,s,n,h,r,e,c){void 0===r&&(r=null),void 0===e&&(e=null),void 0===c&&(c=null);var o=0;switch(this.type){case 0:var u=.5*this.width,a=.5*this.height;o=i.segmentIntersectsRectangle(t,s,n,h,-u,-a,u,a,r,e,c);break;case 1:o=i.segmentIntersectsEllipse(t,s,n,h,0,0,.5*this.width,.5*this.height,r,e,c);break;case 2:0!=i.segmentIntersectsRectangle(t,s,n,h,this.x,this.y,this.width,this.height,null,null)&&(o=i.segmentIntersectsPolygon(t,s,n,h,this.vertices,r,e,c))}return o},i}(t.BaseObject);t.BoundingBoxData=u}(h||(h={})),function(t){var i=function(t){function i(){t.call(this),this.armatures={},this._armatureNames=[]}return n(i,t),i.toString=function(){return"[class dragonBones.DragonBonesData]"},i.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];this.autoSearch=!1,this.frameRate=0,this.name=null,this._armatureNames.length=0},i.prototype.getArmature=function(t){return this.armatures[t]},i.prototype.addArmature=function(t){if(!t||!t.name||this.armatures[t.name])throw new Error;this.armatures[t.name]=t,this._armatureNames.push(t.name),t.parent=this},Object.defineProperty(i.prototype,"armatureNames",{get:function(){return this._armatureNames},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.returnToPool()},i}(t.BaseObject);t.DragonBonesData=i}(h||(h={})),function(t){var i=function(t){function i(){t.call(this),this.data=[]}return n(i,t),i.toString=function(){return"[class dragonBones.ActionData]"},i.prototype._onClear=function(){this.type=-1,this.bone=null,this.slot=null,this.data.length=0},i}(t.BaseObject);t.ActionData=i;var s=function(t){function i(){t.call(this),this.ints=[],this.floats=[],this.strings=[]}return n(i,t),i.toString=function(){return"[class dragonBones.EventData]"},i.prototype._onClear=function(){this.type=-1,this.name=null,this.ints.length=0,this.floats.length=0,this.strings.length=0,this.bone=null,this.slot=null},i}(t.BaseObject);t.EventData=s;var h=function(t){function i(){t.call(this)}return n(i,t),i.prototype._onClear=function(){this.position=0,this.duration=0,this.prev=null,this.next=null},i}(t.BaseObject);t.FrameData=h;var r=function(i){function s(){i.call(this)}return n(s,i),s._getCurvePoint=function(t,i,s,n,h,r,e,c,o,u){var a=1-o,f=a*a,l=o*o,v=a*f,d=3*o*f,p=3*a*l,g=o*l;u.x=v*t+d*s+p*h+g*e,u.y=v*i+d*n+p*r+g*c},s.samplingEasingCurve=function(i,n){for(var h=i.length,r=new t.Point,e=-2,c=0,o=n.length;c<o;++c){for(var u=(c+1)/(o+1);(e+6<h?i[e+6]:1)<u;)e+=6;for(var a=e>=0&&e+6<h,f=a?i[e]:0,l=a?i[e+1]:0,v=i[e+2],d=i[e+3],p=i[e+4],g=i[e+5],m=a?i[e+6]:1,w=a?i[e+7]:1,_=0,C=1;C-_>.01;){var b=(C+_)/2;s._getCurvePoint(f,l,v,d,p,g,m,w,b,r),u-r.x>0?_=b:C=b}n[c]=r.y}},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.tweenEasing=0,this.curve=null},s}(h);t.TweenFrameData=r;var e=function(t){function i(){t.call(this),this.actions=[],this.events=[]}return n(i,t),i.toString=function(){return"[class dragonBones.AnimationFrameData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this);for(var i=0,s=this.actions.length;i<s;++i)this.actions[i].returnToPool();for(i=0,s=this.events.length;i<s;++i)this.events[i].returnToPool();this.actions.length=0,this.events.length=0},i}(h);t.AnimationFrameData=e;var c=function(t){function i(){t.call(this),this.zOrder=[]}return n(i,t),i.prototype._onClear=function(){t.prototype._onClear.call(this),this.zOrder.length=0},i}(h);t.ZOrderFrameData=c;var o=function(i){function s(){i.call(this),this.transform=new t.Transform}return n(s,i),s.toString=function(){return"[class dragonBones.BoneFrameData]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.tweenScale=!1,this.tweenRotate=0,this.transform.identity()},s}(r);t.BoneFrameData=o;var u=function(i){function s(){i.call(this)}return n(s,i),s.generateColor=function(){return new t.ColorTransform},s.toString=function(){return"[class dragonBones.SlotFrameData]"},s.prototype._onClear=function(){i.prototype._onClear.call(this),this.displayIndex=0,this.color=null},s.DEFAULT_COLOR=new t.ColorTransform,s}(r);t.SlotFrameData=u;var a=function(t){function i(){t.call(this),this.tweens=[],this.keys=[]}return n(i,t),i.toString=function(){return"[class dragonBones.ExtensionFrameData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=-1,this.tweens.length=0,this.keys.length=0},i}(r);t.ExtensionFrameData=a}(h||(h={})),function(t){var i=function(){function i(){this._data=null,this._armature=null,this._skin=null,this._slotDisplayDataSet=null,this._animation=null,this._timeline=null,this._isOldData=!1,this._isGlobalTransform=!1,this._isAutoTween=!1,this._animationTweenEasing=0,this._timelinePivot=new t.Point,this._helpPoint=new t.Point,this._helpTransformA=new t.Transform,this._helpTransformB=new t.Transform,this._helpMatrix=new t.Matrix,this._rawBones=[]}return i._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return-1}},i._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;default:return-1}},i._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return-1}},i._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return-1}},i._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"stop":return 1;case"gotoandplay":return 2;case"gotoandstop":return 3;case"fadein":return 4;case"fadeout":return 5;default:return-1}},i.prototype._getTimelineFrameMatrix=function(i,s,n,h){var r=Math.floor(n*i.frameCount/i.duration);if(1==s.frames.length||r>=s.frames.length)h.copyFrom(s.frames[0].transform);else{var e=s.frames[r],c=0;e.tweenEasing!=t.DragonBones.NO_TWEEN?(c=(n-e.position)/e.duration,0!=e.tweenEasing&&(c=t.TweenTimelineState._getEasingValue(c,e.tweenEasing))):e.curve&&(c=(n-e.position)/e.duration,c=t.TweenTimelineState._getEasingCurveValue(c,e.curve));var o=e.next;h.x=o.transform.x-e.transform.x,h.y=o.transform.y-e.transform.y,h.skewX=t.Transform.normalizeRadian(o.transform.skewX-e.transform.skewX),h.skewY=t.Transform.normalizeRadian(o.transform.skewY-e.transform.skewY),h.scaleX=o.transform.scaleX-e.transform.scaleX,h.scaleY=o.transform.scaleY-e.transform.scaleY,h.x=e.transform.x+h.x*c,h.y=e.transform.y+h.y*c,h.skewX=e.transform.skewX+h.skewX*c,h.skewY=e.transform.skewY+h.skewY*c,h.scaleX=e.transform.scaleX+h.scaleX*c,h.scaleY=e.transform.scaleY+h.scaleY*c}h.add(s.originalTransform)},i.prototype._globalToLocal=function(t){for(var i=new Array,s=t.sortedBones.concat().reverse(),n=0,h=s.length;n<h;++n){var r=s[n];r.parent&&(r.parent.transform.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(r.transform.x,r.transform.y,this._helpPoint),r.transform.x=this._helpPoint.x,r.transform.y=this._helpPoint.y,r.transform.rotation-=r.parent.transform.rotation);for(var e in t.animations){var c=t.animations[e],o=c.getBoneTimeline(r.name);if(o){var u=r.parent?c.getBoneTimeline(r.parent.name):null;this._helpTransformB.copyFrom(o.originalTransform),i.length=0;for(var a=0,f=o.frames.length;a<f;++a){var l=o.frames[a];i.indexOf(l)>=0||(i.push(l),u?(this._getTimelineFrameMatrix(c,u,l.position,this._helpTransformA),l.transform.add(this._helpTransformB),this._helpTransformA.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(l.transform.x,l.transform.y,this._helpPoint),l.transform.x=this._helpPoint.x,l.transform.y=this._helpPoint.y,l.transform.rotation-=this._helpTransformA.rotation):l.transform.add(this._helpTransformB),l.transform.minus(r.transform),0==a?(o.originalTransform.copyFrom(l.transform),l.transform.identity()):l.transform.minus(o.originalTransform))}}}}},i.prototype._mergeFrameToAnimationTimeline=function(i,s,n){var h=Math.floor(i*this._armature.frameRate),r=this._animation.frames;if(0==r.length){var e=t.BaseObject.borrowObject(t.AnimationFrameData);if(e.position=0,this._animation.frameCount>1){r.length=this._animation.frameCount+1;var c=t.BaseObject.borrowObject(t.AnimationFrameData);c.position=this._animation.frameCount/this._armature.frameRate,r[0]=e,r[this._animation.frameCount]=c}}var o=null,u=r[h];if(!u||0!=h&&r[h-1]!=u.prev){(o=t.BaseObject.borrowObject(t.AnimationFrameData)).position=h/this._armature.frameRate,r[h]=o;for(var a=h+1,f=r.length;a<f;++a)u&&r[a]==u&&(r[a]=null)}else o=u;if(s)for(a=0,f=s.length;a<f;++a)o.actions.push(s[a]);if(n)for(a=0,f=n.length;a<f;++a)o.events.push(n[a]);var l=null,v=null;for(a=0,f=r.length;a<f;++a){var d=r[a];d&&v!=d?(v=d,l&&(v.prev=l,l.next=v,l.duration=v.position-l.position),l=v):r[a]=l}v.duration=this._animation.duration-v.position,v=r[0],l.next=v,v.prev=l},i.parseDragonBonesData=function(i){return t.ObjectDataParser.getInstance().parseDragonBonesData(i)},i.parseTextureAtlasData=function(s,n){void 0===n&&(n=1);for(var h={},r=s[i.SUB_TEXTURE],e=0,c=r.length;e<c;e++){var o=r[e],u=o[i.NAME],a=new t.Rectangle,f=null;a.x=o[i.X]/n,a.y=o[i.Y]/n,a.width=o[i.WIDTH]/n,a.height=o[i.HEIGHT]/n,i.FRAME_WIDTH in o&&((f=new t.Rectangle).x=o[i.FRAME_X]/n,f.y=o[i.FRAME_Y]/n,f.width=o[i.FRAME_WIDTH]/n,f.height=o[i.FRAME_HEIGHT]/n),h[u]={region:a,frame:f,rotated:!1}}return h},i.DATA_VERSION_2_3="2.3",i.DATA_VERSION_3_0="3.0",i.DATA_VERSION_4_0="4.0",i.DATA_VERSION="4.5",i.TEXTURE_ATLAS="TextureAtlas",i.SUB_TEXTURE="SubTexture",i.FORMAT="format",i.IMAGE_PATH="imagePath",i.WIDTH="width",i.HEIGHT="height",i.ROTATED="rotated",i.FRAME_X="frameX",i.FRAME_Y="frameY",i.FRAME_WIDTH="frameWidth",i.FRAME_HEIGHT="frameHeight",i.DRADON_BONES="dragonBones",i.ARMATURE="armature",i.BONE="bone",i.IK="ik",i.SLOT="slot",i.SKIN="skin",i.DISPLAY="display",i.ANIMATION="animation",i.Z_ORDER="zOrder",i.FFD="ffd",i.FRAME="frame",i.EVENTS="events",i.ACTIONS="actions",i.INTS="ints",i.FLOATS="floats",i.STRINGS="strings",i.PIVOT="pivot",i.TRANSFORM="transform",i.AABB="aabb",i.COLOR="color",i.FILTER="filter",i.VERSION="version",i.IS_GLOBAL="isGlobal",i.FRAME_RATE="frameRate",i.TYPE="type",i.SUB_TYPE="subType",i.NAME="name",i.PARENT="parent",i.SHARE="share",i.LENGTH="length",i.DATA="data",i.DISPLAY_INDEX="displayIndex",i.BLEND_MODE="blendMode",i.INHERIT_TRANSLATION="inheritTranslation",i.INHERIT_ROTATION="inheritRotation",i.INHERIT_SCALE="inheritScale",i.INHERIT_ANIMATION="inheritAnimation",i.TARGET="target",i.BEND_POSITIVE="bendPositive",i.CHAIN="chain",i.WEIGHT="weight",i.FADE_IN_TIME="fadeInTime",i.PLAY_TIMES="playTimes",i.SCALE="scale",i.OFFSET="offset",i.POSITION="position",i.DURATION="duration",i.TWEEN_EASING="tweenEasing",i.TWEEN_ROTATE="tweenRotate",i.TWEEN_SCALE="tweenScale",i.CURVE="curve",i.GUIDE_CURVE="guideCurve",i.EVENT="event",i.SOUND="sound",i.ACTION="action",i.DEFAULT_ACTIONS="defaultActions",i.X="x",i.Y="y",i.SKEW_X="skX",i.SKEW_Y="skY",i.SCALE_X="scX",i.SCALE_Y="scY",i.ALPHA_OFFSET="aO",i.RED_OFFSET="rO",i.GREEN_OFFSET="gO",i.BLUE_OFFSET="bO",i.ALPHA_MULTIPLIER="aM",i.RED_MULTIPLIER="rM",i.GREEN_MULTIPLIER="gM",i.BLUE_MULTIPLIER="bM",i.UVS="uvs",i.VERTICES="vertices",i.TRIANGLES="triangles",i.WEIGHTS="weights",i.SLOT_POSE="slotPose",i.BONE_POSE="bonePose",i.TWEEN="tween",i.KEY="key",i.COLOR_TRANSFORM="colorTransform",i.TIMELINE="timeline",i.PIVOT_X="pX",i.PIVOT_Y="pY",i.Z="z",i.LOOP="loop",i.AUTO_TWEEN="autoTween",i.HIDE="hide",i}();t.DataParser=i}(h||(h={})),function(t){var i=function(i){function s(){i.call(this)}return n(s,i),s._getBoolean=function(t,i,s){if(i in t){var n=t[i],h=typeof n;if("boolean"==h)return n;if("string"!=h)return!!n;switch(n){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return s},s._getNumber=function(t,i,s){if(i in t){var n=t[i];return null==n||"NaN"==n?s:+n||0}return s},s._getString=function(t,i,s){return i in t?String(t[i]):s},s._getParameter=function(t,i,s){return t.length>i?t[i]:s},s.prototype._parseArmature=function(i,n){var h=t.BaseObject.borrowObject(t.ArmatureData);if(h.name=s._getString(i,s.NAME,null),h.frameRate=s._getNumber(i,s.FRAME_RATE,this._data.frameRate)||this._data.frameRate,h.scale=n,s.TYPE in i&&"string"==typeof i[s.TYPE]?h.type=s._getArmatureType(i[s.TYPE]):h.type=s._getNumber(i,s.TYPE,0),this._armature=h,this._rawBones.length=0,s.AABB in i){var r=i[s.AABB];h.aabb.x=s._getNumber(r,s.X,0),h.aabb.y=s._getNumber(r,s.Y,0),h.aabb.width=s._getNumber(r,s.WIDTH,0),h.aabb.height=s._getNumber(r,s.HEIGHT,0)}if(s.BONE in i)for(var e=i[s.BONE],c=0,o=e.length;c<o;++c){var u=e[c],a=this._parseBone(u);h.addBone(a,s._getString(u,s.PARENT,null)),this._rawBones.push(a)}if(s.IK in i){var f=i[s.IK];for(c=0,o=f.length;c<o;++c)this._parseIK(f[c])}if(s.SLOT in i){var l=i[s.SLOT],v=0;for(c=0,o=l.length;c<o;++c)h.addSlot(this._parseSlot(l[c],v++))}if(s.SKIN in i){var d=i[s.SKIN];for(c=0,o=d.length;c<o;++c)h.addSkin(this._parseSkin(d[c]))}if(s.ANIMATION in i){var p=i[s.ANIMATION];for(c=0,o=p.length;c<o;++c)h.addAnimation(this._parseAnimation(p[c]))}return(s.ACTIONS in i||s.DEFAULT_ACTIONS in i)&&this._parseActionData(i,h.actions,null,null),this._isOldData&&this._isGlobalTransform&&this._globalToLocal(h),this._armature=null,this._rawBones.length=0,h},s.prototype._parseBone=function(i){var n=t.BaseObject.borrowObject(t.BoneData);return n.name=s._getString(i,s.NAME,null),n.inheritTranslation=s._getBoolean(i,s.INHERIT_TRANSLATION,!0),n.inheritRotation=s._getBoolean(i,s.INHERIT_ROTATION,!0),n.inheritScale=s._getBoolean(i,s.INHERIT_SCALE,!0),n.length=s._getNumber(i,s.LENGTH,0)*this._armature.scale,s.TRANSFORM in i&&this._parseTransform(i[s.TRANSFORM],n.transform),this._isOldData&&(n.inheritScale=!1),n},s.prototype._parseIK=function(t){var i=this._armature.getBone(s._getString(t,s.BONE in t?s.BONE:s.NAME,null));i&&(i.ik=this._armature.getBone(s._getString(t,s.TARGET,null)),i.bendPositive=s._getBoolean(t,s.BEND_POSITIVE,!0),i.chain=s._getNumber(t,s.CHAIN,0),i.weight=s._getNumber(t,s.WEIGHT,1),i.chain>0&&i.parent&&!i.parent.ik?(i.parent.ik=i.ik,i.parent.chainIndex=0,i.parent.chain=0,i.chainIndex=1):(i.chain=0,i.chainIndex=0))},s.prototype._parseSlot=function(i,n){var h=t.BaseObject.borrowObject(t.SlotData);return h.name=s._getString(i,s.NAME,null),h.parent=this._armature.getBone(s._getString(i,s.PARENT,null)),h.displayIndex=s._getNumber(i,s.DISPLAY_INDEX,0),h.zOrder=s._getNumber(i,s.Z,n),s.COLOR in i||s.COLOR_TRANSFORM in i?(h.color=t.SlotData.generateColor(),this._parseColorTransform(i[s.COLOR]||i[s.COLOR_TRANSFORM],h.color)):h.color=t.SlotData.DEFAULT_COLOR,s.BLEND_MODE in i&&"string"==typeof i[s.BLEND_MODE]?h.blendMode=s._getBlendMode(i[s.BLEND_MODE]):h.blendMode=s._getNumber(i,s.BLEND_MODE,0),(s.ACTIONS in i||s.DEFAULT_ACTIONS in i)&&this._parseActionData(i,h.actions,null,null),this._isOldData&&(s.COLOR_TRANSFORM in i?(h.color=t.SlotData.generateColor(),this._parseColorTransform(i[s.COLOR_TRANSFORM],h.color)):h.color=t.SlotData.DEFAULT_COLOR),h},s.prototype._parseSkin=function(i){var n=t.BaseObject.borrowObject(t.SkinData);if(n.name=s._getString(i,s.NAME,"__default")||"__default",s.SLOT in i){this._skin=n;for(var h=i[s.SLOT],r=0,e=0,c=h.length;e<c;++e)this._isOldData&&this._armature.addSlot(this._parseSlot(h[e],r++)),n.addSlot(this._parseSlotDisplaySet(h[e]));this._skin=null}return n},s.prototype._parseSlotDisplaySet=function(i){var n=t.BaseObject.borrowObject(t.SlotDisplayDataSet);if(n.slot=this._armature.getSlot(s._getString(i,s.NAME,null)),s.DISPLAY in i){var h=i[s.DISPLAY],r=n.displays;this._slotDisplayDataSet=n;for(var e=0,c=h.length;e<c;++e)r.push(this._parseDisplay(h[e]));this._slotDisplayDataSet=null}return n},s.prototype._parseDisplay=function(i){var n=t.BaseObject.borrowObject(t.DisplayData);if(n.name=s._getString(i,s.NAME,null),n.path=s._getString(i,s.SHARE,n.name),n.inheritAnimation=s._getBoolean(i,s.INHERIT_ANIMATION,!0),s.TYPE in i&&"string"==typeof i[s.TYPE]?n.type=s._getDisplayType(i[s.TYPE]):n.type=s._getNumber(i,s.TYPE,0),n.isRelativePivot=!0,s.PIVOT in i){var h=i[s.PIVOT];n.pivot.x=s._getNumber(h,s.X,0),n.pivot.y=s._getNumber(h,s.Y,0)}else if(this._isOldData){var r=i[s.TRANSFORM];n.isRelativePivot=!1,n.pivot.x=s._getNumber(r,s.PIVOT_X,0)*this._armature.scale,n.pivot.y=s._getNumber(r,s.PIVOT_Y,0)*this._armature.scale}else n.pivot.x=.5,n.pivot.y=.5;switch(s.TRANSFORM in i&&this._parseTransform(i[s.TRANSFORM],n.transform),n.type){case 0:case 1:break;case 2:var e=s._getString(i,s.SHARE,null);if(e)for(var c=0,o=this._slotDisplayDataSet.displays.length;c<o;++c){var u=this._slotDisplayDataSet.displays[c];if(u.name==e){n.share=u,n.mesh=u.mesh;break}}else n.mesh=this._parseMesh(i);break;case 3:n.boundingBox=this._BoundingBox(i)}return n},s.prototype._BoundingBox=function(i){var n=t.BaseObject.borrowObject(t.BoundingBoxData);switch(s.SUB_TYPE in i&&"string"==typeof i[s.SUB_TYPE]?n.type=s._getBoundingBoxType(i[s.SUB_TYPE]):n.type=s._getNumber(i,s.SUB_TYPE,0),n.type){case 0:case 1:n.width=s._getNumber(i,s.WIDTH,0),n.height=s._getNumber(i,s.HEIGHT,0);break;case 2:if(s.VERTICES in i){var h=i[s.VERTICES];n.vertices.length=h.length;for(var r=0,e=h.length;r<e;r+=2){var c=r+1,o=h[r],u=h[c];n.vertices[r]=o,n.vertices[c]=u,0==r?(n.x=o,n.y=u,n.width=o,n.height=u):(o<n.x?n.x=o:o>n.width&&(n.width=o),u<n.y?n.y=u:u>n.height&&(n.height=u))}}}return n},s.prototype._parseMesh=function(i){var n=t.BaseObject.borrowObject(t.MeshData),h=i[s.VERTICES],r=i[s.UVS],e=i[s.TRIANGLES],c=Math.floor(h.length/2),o=Math.floor(e.length/3),u=new Array(this._armature.sortedBones.length);if(n.skinned=s.WEIGHTS in i&&i[s.WEIGHTS].length>0,n.uvs.length=2*c,n.vertices.length=2*c,n.vertexIndices.length=3*o,n.skinned){if(n.boneIndices.length=c,n.weights.length=c,n.boneVertices.length=c,s.SLOT_POSE in i){var a=i[s.SLOT_POSE];n.slotPose.a=a[0],n.slotPose.b=a[1],n.slotPose.c=a[2],n.slotPose.d=a[3],n.slotPose.tx=a[4]*this._armature.scale,n.slotPose.ty=a[5]*this._armature.scale}if(s.BONE_POSE in i)for(var f=i[s.BONE_POSE],l=0,v=f.length;l<v;l+=7){var d=u[x=f[l]]=new t.Matrix;d.a=f[l+1],d.b=f[l+2],d.c=f[l+3],d.d=f[l+4],d.tx=f[l+5]*this._armature.scale,d.ty=f[l+6]*this._armature.scale,d.invert()}}l=0;var p=0;for(v=h.length;l<v;l+=2){var g=l+1,m=l/2,w=n.vertices[l]=h[l]*this._armature.scale,_=n.vertices[g]=h[g]*this._armature.scale;if(n.uvs[l]=r[l],n.uvs[g]=r[g],n.skinned){var C=i[s.WEIGHTS],b=C[p],y=n.boneIndices[m]=new Array(b),T=n.weights[m]=new Array(b),S=n.boneVertices[m]=new Array(2*b);n.slotPose.transformPoint(w,_,this._helpPoint),w=n.vertices[l]=this._helpPoint.x,_=n.vertices[g]=this._helpPoint.y;for(var A=0;A<b;++A){var M=p+1+2*A,x=C[M],E=this._rawBones[x],O=n.bones.indexOf(E);O<0&&(O=n.bones.length,n.bones[O]=E,n.inverseBindPose[O]=u[x]),n.inverseBindPose[O].transformPoint(w,_,this._helpPoint),y[A]=O,T[A]=C[M+1],S[2*A]=this._helpPoint.x,S[2*A+1]=this._helpPoint.y}p+=2*b+1}}for(l=0,v=e.length;l<v;++l)n.vertexIndices[l]=e[l];return n},s.prototype._parseAnimation=function(i){var n=t.BaseObject.borrowObject(t.AnimationData);n.name=s._getString(i,s.NAME,"__default")||"__default",n.frameCount=Math.max(s._getNumber(i,s.DURATION,1),1),n.position=s._getNumber(i,s.POSITION,0)/this._armature.frameRate,n.duration=n.frameCount/this._armature.frameRate,n.playTimes=s._getNumber(i,s.PLAY_TIMES,1),n.fadeInTime=s._getNumber(i,s.FADE_IN_TIME,0),this._animation=n;var h=s._getString(i,s.ANIMATION,null);if(h)return n.animation=this._armature.getAnimation(h),n.animation,n;if(this._parseTimeline(i,n,this._parseAnimationFrame),s.Z_ORDER in i&&(n.zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineData),this._parseTimeline(i[s.Z_ORDER],n.zOrderTimeline,this._parseZOrderFrame)),s.BONE in i)for(var r=i[s.BONE],e=0,c=r.length;e<c;++e)n.addBoneTimeline(this._parseBoneTimeline(r[e]));if(s.SLOT in i){var o=i[s.SLOT];for(e=0,c=o.length;e<c;++e)n.addSlotTimeline(this._parseSlotTimeline(o[e]))}if(s.FFD in i){var u=i[s.FFD];for(e=0,c=u.length;e<c;++e)n.addFFDTimeline(this._parseFFDTimeline(u[e]))}if(this._isOldData){if(this._isAutoTween=s._getBoolean(i,s.AUTO_TWEEN,!0),this._animationTweenEasing=s._getNumber(i,s.TWEEN_EASING,0)||0,n.playTimes=s._getNumber(i,s.LOOP,1),s.TIMELINE in i){var a=i[s.TIMELINE];for(e=0,c=a.length;e<c;++e){var f=a[e];n.addBoneTimeline(this._parseBoneTimeline(f)),n.addSlotTimeline(this._parseSlotTimeline(f))}}}else this._isAutoTween=!1,this._animationTweenEasing=0;for(var e in this._armature.bones){var l=this._armature.bones[e];if(!n.getBoneTimeline(l.name)){var v=t.BaseObject.borrowObject(t.BoneTimelineData),d=t.BaseObject.borrowObject(t.BoneFrameData);v.bone=l,v.frames[0]=d,n.addBoneTimeline(v)}}for(var e in this._armature.slots){var p=this._armature.slots[e];if(!n.getSlotTimeline(p.name)){var g=t.BaseObject.borrowObject(t.SlotTimelineData),m=t.BaseObject.borrowObject(t.SlotFrameData);g.slot=p,m.displayIndex=p.displayIndex,p.color==t.SlotData.DEFAULT_COLOR?m.color=t.SlotFrameData.DEFAULT_COLOR:(m.color=t.SlotFrameData.generateColor(),m.color.copyFrom(p.color)),g.frames[0]=m,n.addSlotTimeline(g),this._isOldData&&(m.displayIndex=-1)}}return this._animation=null,n},s.prototype._parseBoneTimeline=function(i){var n=t.BaseObject.borrowObject(t.BoneTimelineData);n.bone=this._armature.getBone(s._getString(i,s.NAME,null)),this._parseTimeline(i,n,this._parseBoneFrame);for(var h=n.originalTransform,r=null,e=0,c=n.frames.length;e<c;++e){var o=n.frames[e];r?r!=o&&o.transform.minus(h):(h.copyFrom(o.transform),o.transform.identity(),0==h.scaleX&&(h.scaleX=.001),0==h.scaleY&&(h.scaleY=.001)),r=o}return 1==n.scale&&0==n.offset||(this._animation.hasAsynchronyTimeline=!0),this._isOldData&&(s.PIVOT_X in i||s.PIVOT_Y in i)?(this._timelinePivot.x=s._getNumber(i,s.PIVOT_X,0),this._timelinePivot.y=s._getNumber(i,s.PIVOT_Y,0)):this._timelinePivot.clear(),n},s.prototype._parseSlotTimeline=function(i){var n=t.BaseObject.borrowObject(t.SlotTimelineData);return n.slot=this._armature.getSlot(s._getString(i,s.NAME,null)),this._parseTimeline(i,n,this._parseSlotFrame),1==n.scale&&0==n.offset||(this._animation.hasAsynchronyTimeline=!0),n},s.prototype._parseFFDTimeline=function(i){var n=t.BaseObject.borrowObject(t.FFDTimelineData);n.skin=this._armature.getSkin(s._getString(i,s.SKIN,null)),n.slot=n.skin.getSlot(s._getString(i,s.SLOT,null));for(var h=s._getString(i,s.NAME,null),r=0,e=n.slot.displays.length;r<e;++r){var c=n.slot.displays[r];if(c.mesh&&c.name==h){n.display=c;break}}return this._parseTimeline(i,n,this._parseFFDFrame),n},s.prototype._parseAnimationFrame=function(i,n,h){var r=t.BaseObject.borrowObject(t.AnimationFrameData);return this._parseFrame(i,r,n,h),(s.ACTION in i||s.ACTIONS in i)&&this._parseActionData(i,r.actions,null,null),(s.EVENT in i||s.SOUND in i)&&this._parseEventData(i,r.events,null,null),r},s.prototype._parseZOrderFrame=function(i,n,h){var r=t.BaseObject.borrowObject(t.ZOrderFrameData);this._parseFrame(i,r,n,h);var e=i[s.Z_ORDER];if(e&&e.length>0){var c=this._armature.sortedSlots.length,o=new Array(c-e.length/2);r.zOrder.length=c;for(var u=0;u<c;++u)r.zOrder[u]=-1;for(var a=0,f=0,l=0,v=e.length;l<v;l+=2){for(var d=e[l],p=e[l+1];a!=d;)o[f++]=a++;r.zOrder[a+p]=a++}for(;a<c;)o[f++]=a++;for(var g=c;g--;)-1==r.zOrder[g]&&(r.zOrder[g]=o[--f])}return r},s.prototype._parseBoneFrame=function(i,n,h){var r=t.BaseObject.borrowObject(t.BoneFrameData);if(r.tweenRotate=s._getNumber(i,s.TWEEN_ROTATE,0),r.tweenScale=s._getBoolean(i,s.TWEEN_SCALE,!0),this._parseTweenFrame(i,r,n,h),s.TRANSFORM in i){var e=i[s.TRANSFORM];this._parseTransform(e,r.transform),this._isOldData&&(this._helpPoint.x=this._timelinePivot.x+s._getNumber(e,s.PIVOT_X,0),this._helpPoint.y=this._timelinePivot.y+s._getNumber(e,s.PIVOT_Y,0),r.transform.toMatrix(this._helpMatrix),this._helpMatrix.transformPoint(this._helpPoint.x,this._helpPoint.y,this._helpPoint,!0),r.transform.x+=this._helpPoint.x,r.transform.y+=this._helpPoint.y)}var c=this._timeline.bone,o=new Array,u=new Array;if(s.ACTION in i||s.ACTIONS in i){var a=this._armature.getSlot(c.name);this._parseActionData(i,o,c,a)}return(s.EVENT in i||s.SOUND in i)&&this._parseEventData(i,u,c,null),(o.length>0||u.length>0)&&this._mergeFrameToAnimationTimeline(r.position,o,u),r},s.prototype._parseSlotFrame=function(i,n,h){var r=t.BaseObject.borrowObject(t.SlotFrameData);if(r.displayIndex=s._getNumber(i,s.DISPLAY_INDEX,0),this._parseTweenFrame(i,r,n,h),s.COLOR in i||s.COLOR_TRANSFORM in i?(r.color=t.SlotFrameData.generateColor(),this._parseColorTransform(i[s.COLOR]||i[s.COLOR_TRANSFORM],r.color)):r.color=t.SlotFrameData.DEFAULT_COLOR,this._isOldData)s._getBoolean(i,s.HIDE,!1)&&(r.displayIndex=-1);else if(s.ACTION in i||s.ACTIONS in i){var e=this._timeline.slot,c=new Array;this._parseActionData(i,c,e.parent,e),this._mergeFrameToAnimationTimeline(r.position,c,null)}return r},s.prototype._parseFFDFrame=function(i,n,h){var r=this._timeline.display.mesh,e=t.BaseObject.borrowObject(t.ExtensionFrameData);e.type=s._getNumber(i,s.TYPE,0),this._parseTweenFrame(i,e,n,h);for(var c=i[s.VERTICES],o=s._getNumber(i,s.OFFSET,0),u=0,a=0,f=0,l=r.vertices.length;f<l;f+=2)if(!c||f<o||f-o>=c.length?(u=0,a=0):(u=c[f-o]*this._armature.scale,a=c[f+1-o]*this._armature.scale),r.skinned){r.slotPose.transformPoint(u,a,this._helpPoint,!0),u=this._helpPoint.x,a=this._helpPoint.y;for(var v=r.boneIndices[f/2],d=0,p=v.length;d<p;++d){var g=v[d];r.inverseBindPose[g].transformPoint(u,a,this._helpPoint,!0),e.tweens.push(this._helpPoint.x,this._helpPoint.y)}}else e.tweens.push(u,a);return e},s.prototype._parseTweenFrame=function(i,n,h,r){this._parseFrame(i,n,h,r),n.duration>0?(s.TWEEN_EASING in i?n.tweenEasing=s._getNumber(i,s.TWEEN_EASING,t.DragonBones.NO_TWEEN):this._isOldData?n.tweenEasing=this._isAutoTween?this._animationTweenEasing:t.DragonBones.NO_TWEEN:n.tweenEasing=t.DragonBones.NO_TWEEN,this._isOldData&&1==this._animation.scale&&1==this._timeline.scale&&n.duration*this._armature.frameRate<2&&(n.tweenEasing=t.DragonBones.NO_TWEEN),r>0&&s.CURVE in i&&(n.curve=new Array(2*r-1),t.TweenFrameData.samplingEasingCurve(i[s.CURVE],n.curve))):(n.tweenEasing=t.DragonBones.NO_TWEEN,n.curve=null)},s.prototype._parseFrame=function(t,i,s,n){i.position=s/this._armature.frameRate,i.duration=n/this._armature.frameRate},s.prototype._parseTimeline=function(i,n,h){if(n.scale=s._getNumber(i,s.SCALE,1),n.offset=s._getNumber(i,s.OFFSET,0),s.FRAME in i){this._timeline=n;var r=i[s.FRAME];if(1==r.length)n.frames.length=1,n.frames[0]=h.call(this,r[0],0,s._getNumber(r[0],s.DURATION,1));else if(r.length>1){n.frames.length=this._animation.frameCount+1;for(var e=0,c=0,o=null,u=null,a=0,f=0,l=n.frames.length;a<l;++a){if(e+c<=a&&f<r.length){var v=r[f++];e=a,c=s._getNumber(v,s.DURATION,1),o=h.call(this,v,e,c),u&&(u.next=o,o.prev=u,this._isOldData&&u instanceof t.TweenFrameData&&-1==s._getNumber(v,s.DISPLAY_INDEX,0)&&(u.tweenEasing=t.DragonBones.NO_TWEEN)),u=o}n.frames[a]=o}o.duration=this._animation.duration-o.position,o=n.frames[0],u.next=o,o.prev=u,this._isOldData&&u instanceof t.TweenFrameData&&-1==s._getNumber(r[0],s.DISPLAY_INDEX,0)&&(u.tweenEasing=t.DragonBones.NO_TWEEN)}this._timeline=null}},s.prototype._parseActionData=function(i,n,h,r){var e=i[s.ACTION]||i[s.ACTIONS]||i[s.DEFAULT_ACTIONS];if("string"==typeof e)(f=t.BaseObject.borrowObject(t.ActionData)).type=4,f.bone=h,f.slot=r,f.data[0]=e,f.data[1]=-1,f.data[2]=-1,n.push(f);else if(e instanceof Array)for(var c=0,o=e.length;c<o;++c){var u=e[c],a=u instanceof Array,f=t.BaseObject.borrowObject(t.ActionData),l=a?s._getParameter(u,1,null):s._getString(u,"gotoAndPlay",null);if(a){var v=u[0];f.type="string"==typeof v?s._getActionType(v):s._getParameter(u,0,4)}else f.type=2;switch(f.type){case 0:f.data[0]=l,f.data[1]=a?s._getParameter(u,2,-1):-1;break;case 1:f.data[0]=l;break;case 2:f.data[0]=l,f.data[1]=a?s._getParameter(u,2,0):0,f.data[2]=a?s._getParameter(u,3,-1):-1;break;case 3:f.data[0]=l,f.data[1]=a?s._getParameter(u,2,0):0;break;case 4:f.data[0]=l,f.data[1]=a?s._getParameter(u,2,-1):-1,f.data[2]=a?s._getParameter(u,3,-1):-1;break;case 5:f.data[0]=l,f.data[1]=a?s._getParameter(u,2,0):0}f.bone=h,f.slot=r,n.push(f)}},s.prototype._parseEventData=function(i,n,h,r){if(s.SOUND in i){var e=t.BaseObject.borrowObject(t.EventData);e.type=11,e.name=s._getString(i,s.SOUND,null),e.bone=h,e.slot=r,n.push(e)}if(s.EVENT in i&&((l=t.BaseObject.borrowObject(t.EventData)).type=10,l.name=s._getString(i,s.EVENT,null),l.bone=h,l.slot=r,n.push(l)),s.EVENTS in i)for(var c=i[s.EVENTS],o=0,u=c.length;o<u;++o){var a=c[o],f=s._getString(a,s.BONE,null),l=t.BaseObject.borrowObject(t.EventData);if(l.type=10,l.name=s._getString(a,s.NAME,null),l.bone=this._armature.getBone(f),s.INTS in a)for(var v=a[s.INTS],d=0,p=v.length;d<p;++d)l.ints.push(s._getParameter(v,d,0));if(s.FLOATS in a)for(var g=a[s.FLOATS],m=0,w=g.length;m<w;++m)l.floats.push(s._getParameter(g,m,0));if(s.STRINGS in a)for(var _=a[s.STRINGS],C=0,b=_.length;C<b;++C)l.strings.push(s._getParameter(_,C,null));n.push(l)}},s.prototype._parseTransform=function(i,n){n.x=s._getNumber(i,s.X,0)*this._armature.scale,n.y=s._getNumber(i,s.Y,0)*this._armature.scale,n.skewX=s._getNumber(i,s.SKEW_X,0)*t.DragonBones.ANGLE_TO_RADIAN,n.skewY=s._getNumber(i,s.SKEW_Y,0)*t.DragonBones.ANGLE_TO_RADIAN,n.scaleX=s._getNumber(i,s.SCALE_X,1),n.scaleY=s._getNumber(i,s.SCALE_Y,1)},s.prototype._parseColorTransform=function(t,i){i.alphaMultiplier=.01*s._getNumber(t,s.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*s._getNumber(t,s.RED_MULTIPLIER,100),i.greenMultiplier=.01*s._getNumber(t,s.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*s._getNumber(t,s.BLUE_MULTIPLIER,100),i.alphaOffset=s._getNumber(t,s.ALPHA_OFFSET,0),i.redOffset=s._getNumber(t,s.RED_OFFSET,0),i.greenOffset=s._getNumber(t,s.GREEN_OFFSET,0),i.blueOffset=s._getNumber(t,s.BLUE_OFFSET,0)},s.prototype.parseDragonBonesData=function(i,n){if(void 0===n&&(n=1),i){var h=s._getString(i,s.VERSION,null);if(this._isOldData=h==s.DATA_VERSION_2_3||h==s.DATA_VERSION_3_0,this._isOldData?this._isGlobalTransform=s._getBoolean(i,s.IS_GLOBAL,!0):this._isGlobalTransform=!1,h==s.DATA_VERSION||h==s.DATA_VERSION_4_0||this._isOldData){var r=t.BaseObject.borrowObject(t.DragonBonesData);if(r.name=s._getString(i,s.NAME,null),r.frameRate=s._getNumber(i,s.FRAME_RATE,24)||24,s.ARMATURE in i){this._data=r;for(var e=i[s.ARMATURE],c=0,o=e.length;c<o;++c)r.addArmature(this._parseArmature(e[c],n));this._data=null}return r}throw new Error("Nonsupport data version.")}throw new Error("No data.")},s.prototype.parseTextureAtlasData=function(i,n,h){if(void 0===h&&(h=0),!i)throw new Error("No data.");if(n.name=s._getString(i,s.NAME,null),n.imagePath=s._getString(i,s.IMAGE_PATH,null),h>0?n.scale=h:h=n.scale=s._getNumber(i,s.SCALE,n.scale),h=1/h,s.SUB_TEXTURE in i)for(var r=i[s.SUB_TEXTURE],e=0,c=r.length;e<c;++e){var o=r[e],u=n.generateTextureData();u.name=s._getString(o,s.NAME,null),u.rotated=s._getBoolean(o,s.ROTATED,!1),u.region.x=s._getNumber(o,s.X,0)*h,u.region.y=s._getNumber(o,s.Y,0)*h,u.region.width=s._getNumber(o,s.WIDTH,0)*h,u.region.height=s._getNumber(o,s.HEIGHT,0)*h;var a=s._getNumber(o,s.FRAME_WIDTH,-1),f=s._getNumber(o,s.FRAME_HEIGHT,-1);a>0&&f>0&&(u.frame=t.TextureData.generateRectangle(),u.frame.x=s._getNumber(o,s.FRAME_X,0)*h,u.frame.y=s._getNumber(o,s.FRAME_Y,0)*h,u.frame.width=a*h,u.frame.height=f*h),n.addTexture(u)}},s.getInstance=function(){return s._instance||(s._instance=new s),s._instance},s._instance=null,s}(t.DataParser);t.ObjectDataParser=i}(h||(h={})),function(t){var i=function(t){function i(){t.call(this),this.textures={}}return n(i,t),i.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.scale=1,this.name=null,this.imagePath=null},i.prototype.addTexture=function(t){if(!t||!t.name||this.textures[t.name])throw new Error;this.textures[t.name]=t,t.parent=this},i.prototype.getTexture=function(t){return this.textures[t]},i}(t.BaseObject);t.TextureAtlasData=i;var s=function(i){function s(){i.call(this),this.region=new t.Rectangle}return n(s,i),s.generateRectangle=function(){return new t.Rectangle},s.prototype._onClear=function(){this.rotated=!1,this.name=null,this.frame=null,this.parent=null,this.region.clear()},s}(t.BaseObject);t.TextureData=s}(h||(h={}));var h;!function(t){var i=function(){function i(s){void 0===s&&(s=null),this.autoSearch=!1,this._dataParser=null,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dataParser=s,this._dataParser||(i._defaultParser||(i._defaultParser=new t.ObjectDataParser),this._dataParser=i._defaultParser)}return i.prototype._getTextureData=function(t,i){var s=this._textureAtlasDataMap[t];if(s)for(var n=0,h=s.length;n<h;++n)if(o=s[n].getTexture(i))return o;if(this.autoSearch)for(var n in this._textureAtlasDataMap)for(var r=0,e=(s=this._textureAtlasDataMap[n]).length;r<e;++r){var c=s[r];if(c.autoSearch){var o=c.getTexture(i);if(o)return o}}return null},i.prototype._fillBuildArmaturePackage=function(t,i,s,n,h){var r=null,e=null;if(i&&(r=this._dragonBonesDataMap[i])&&(e=r.getArmature(s)),!e&&(!i||this.autoSearch))for(var c in this._dragonBonesDataMap)if(r=this._dragonBonesDataMap[c],(!i||r.autoSearch)&&(e=r.getArmature(s))){i=c;break}return!!e&&(t.dataName=i,t.textureAtlasName=h,t.data=r,t.armature=e,t.skin=e.getSkin(n),t.skin||(t.skin=e.defaultSkin),!0)},i.prototype._buildBones=function(i,s){for(var n=i.armature.sortedBones,h=0,r=n.length;h<r;++h){var e=n[h],c=t.BaseObject.borrowObject(t.Bone);c.name=e.name,c.inheritTranslation=e.inheritTranslation,c.inheritRotation=e.inheritRotation,c.inheritScale=e.inheritScale,c.length=e.length,c.origin.copyFrom(e.transform),e.parent?s.addBone(c,e.parent.name):s.addBone(c),e.ik&&(c.ikBendPositive=e.bendPositive,c.ikWeight=e.weight,c._setIK(s.getBone(e.ik.name),e.chain,e.chainIndex))}},i.prototype._buildSlots=function(t,i){var s=t.skin,n=t.armature.defaultSkin,h={};for(var r in n.slots)h[(u=n.slots[r]).slot.name]=u;if(s!=n)for(var r in s.slots)h[(u=s.slots[r]).slot.name]=u;for(var e=t.armature.sortedSlots,c=(r=0,e.length);r<c;++r){var o=e[r],u=h[o.name];if(u){var a=this._generateSlot(t,u,i);a&&(a._displayDataSet=u,a._setDisplayIndex(o.displayIndex),a._setBlendMode(o.blendMode),a._setColor(o.color),i.addSlot(a,o.parent.name))}}},i.prototype._replaceSlotDisplay=function(t,i,s,n){if(n<0&&(n=s.displayIndex),n>=0){var h=s.displayList;if(h.length<=n&&(h.length=n+1),s._replacedDisplayDataSet.length<=n&&(s._replacedDisplayDataSet.length=n+1),s._replacedDisplayDataSet[n]=i,1==i.type){var r=this.buildArmature(i.path,t.dataName,null,t.textureAtlasName);h[n]=r}else i.texture&&!t.textureAtlasName||(i.texture=this._getTextureData(t.textureAtlasName||t.dataName,i.path)),i.mesh||n<s._displayDataSet.displays.length&&s._displayDataSet.displays[n].mesh?h[n]=s.meshDisplay:h[n]=s.rawDisplay;s.displayList=h,s.invalidUpdate()}},i.prototype.parseDragonBonesData=function(t,i,s){void 0===i&&(i=null),void 0===s&&(s=1);var n=this._dataParser.parseDragonBonesData(t,s);return this.addDragonBonesData(n,i),n},i.prototype.parseTextureAtlasData=function(t,i,s,n){void 0===s&&(s=null),void 0===n&&(n=0);var h=this._generateTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,h,n),this._generateTextureAtlasData(h,i),this.addTextureAtlasData(h,s),h},i.prototype.getDragonBonesData=function(t){return this._dragonBonesDataMap[t]},i.prototype.addDragonBonesData=function(t,i){if(void 0===i&&(i=null),!t)throw new Error;(i=i||t.name)?this._dragonBonesDataMap[i]?console.warn("Same name data.",i):this._dragonBonesDataMap[i]=t:console.warn("Unnamed data.")},i.prototype.removeDragonBonesData=function(i,s){void 0===s&&(s=!0);var n=this._dragonBonesDataMap[i];if(n){if(s){if(t.DragonBones.debug)for(var h=0,r=t.DragonBones._armatures.length;h<r;++h){var e=t.DragonBones._armatures[h];if(e.armatureData.parent==n)throw new Error("ArmatureData: "+e.armatureData.name+" DragonBonesData: "+i)}n.returnToPool()}delete this._dragonBonesDataMap[i]}},i.prototype.getTextureAtlasData=function(t){return this._textureAtlasDataMap[t]},i.prototype.addTextureAtlasData=function(t,i){if(void 0===i&&(i=null),!t)throw new Error;if(i=i||t.name){var s=this._textureAtlasDataMap[i]=this._textureAtlasDataMap[i]||[];s.indexOf(t)<0&&s.push(t)}else console.warn("Unnamed data.")},i.prototype.removeTextureAtlasData=function(t,i){void 0===i&&(i=!0);var s=this._textureAtlasDataMap[t];if(s){if(i)for(var n=0,h=s.length;n<h;++n)s[n].returnToPool();delete this._textureAtlasDataMap[t]}},i.prototype.clear=function(t){void 0===t&&(t=!0);for(var i in this._dragonBonesDataMap)t&&this._dragonBonesDataMap[i].returnToPool(),delete this._dragonBonesDataMap[i];for(var i in this._textureAtlasDataMap){if(t)for(var s=this._textureAtlasDataMap[i],n=0,h=s.length;n<h;++n)s[n].returnToPool();delete this._textureAtlasDataMap[i]}},i.prototype.buildArmature=function(t,i,s,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null);var h={};if(this._fillBuildArmaturePackage(h,i,t,s,n)){var r=this._generateArmature(h);return this._buildBones(h,r),this._buildSlots(h,r),r.advanceTime(0),r}return console.warn("No armature data.",t,i||""),null},i.prototype.copyAnimationsToArmature=function(i,s,n,h,r){void 0===n&&(n=null),void 0===h&&(h=null),void 0===r&&(r=!0);var e={};if(this._fillBuildArmaturePackage(e,h,s,n,null)){var c=e.armature;if(r)i.animation.animations=c.animations;else{var o={};for(var u in i.animation.animations)o[u]=i.animation.animations[u];for(var u in c.animations)o[u]=c.animations[u];i.animation.animations=o}if(e.skin){for(var a=i.getSlots(),f=0,l=a.length;f<l;++f)for(var v=a[f],d=v.displayList,p=0,g=d.length;p<g;++p){var m=d[p];if(m instanceof t.Armature){var w=e.skin.getSlot(v.name).displays;if(p<w.length){var _=w[p];1==_.type&&this.copyAnimationsToArmature(m,_.path,n,h,r)}}}return!0}}return!1},i.prototype.replaceSlotDisplay=function(t,i,s,n,h,r){void 0===r&&(r=-1);var e={};if(this._fillBuildArmaturePackage(e,t,i,null,null)){var c=e.skin.getSlot(s);if(c)for(var o=0,u=c.displays.length;o<u;++o){var a=c.displays[o];if(a.path==n){this._replaceSlotDisplay(e,a,h,r);break}}}},i.prototype.replaceSlotDisplayList=function(t,i,s,n){var h={};if(this._fillBuildArmaturePackage(h,t,i,null,null)){var r=h.skin.getSlot(s);if(r)for(var e=0,c=0,o=r.displays.length;c<o;++c){var u=r.displays[c];this._replaceSlotDisplay(h,u,n,e++)}}},i.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},i.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},i._defaultParser=null,i}();t.BaseFactory=i}(h||(h={})),i.exports=h},{}],301:[function(t,i,s){var n=sp.spine;sp._SGSkeleton=_ccsg.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,ctor:function(t,i,s){_ccsg.Node.prototype.ctor.call(this),0===arguments.length?this._():this.initWithArgs(t,i,s)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new sp._SGSkeleton.CanvasRenderCmd(this):new sp._SGSkeleton.WebGLRenderCmd(this)},_:function(){_ccsg.Node.prototype._.call(this),this._premultipliedAlpha=cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA,this.scheduleUpdate()},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,i,s){var h,r,e,c=t,o=i;if(cc.js.isString(c)){if(cc.js.isString(o)){var u=cc.loader.getRes(o);sp._atlasLoader.setAtlasFile(o),r=new n.TextureAtlas(u,sp._atlasLoader.load.bind(sp._atlasLoader))}else r=i;s=s||1/cc.director.getContentScaleFactor();var a=new n.AtlasAttachmentLoader(r),f=new n.SkeletonJson(a);f.scale=s;var l=cc.loader.getRes(c);h=f.readSkeletonData(l),r.dispose(f),e=!0}else h=t,e=i;this.setSkeletonData(h,e),this._()},getBoundingBox:function(){for(var t,i=cc.macro.FLT_MAX,s=cc.macro.FLT_MAX,h=cc.macro.FLT_MIN,r=cc.macro.FLT_MIN,e=this.getScaleX(),c=this.getScaleY(),o=this._skeleton.slots,u=n.RegionAttachment,a=0,f=o.length;a<f;++a){var l=o[a],v=l.attachment;v&&v instanceof n.RegionAttachment&&(t=v.updateWorldVertices(l,!1),i=Math.min(i,t[u.X1]*e,t[u.X4]*e,t[u.X2]*e,t[u.X3]*e),s=Math.min(s,t[u.Y1]*c,t[u.Y4]*c,t[u.Y2]*c,t[u.Y3]*c),h=Math.max(h,t[u.X1]*e,t[u.X4]*e,t[u.X2]*e,t[u.X3]*e),r=Math.max(r,t[u.Y1]*c,t[u.Y4]*c,t[u.Y2]*c,t[u.Y3]*c))}var d=this.getPosition();return cc.rect(d.x+i,d.y+s,h-i,r-s)},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,i){return this._skeleton.getAttachmentByName(t,i)},setAttachment:function(t,i){this._skeleton.setAttachment(t,i)},setPremultipliedAlpha:function(t){this._premultipliedAlpha=t},isPremultipliedAlpha:function(){return this._premultipliedAlpha},setSkeletonData:function(t,i){null!=t.width&&null!=t.height&&this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor()),this._skeleton=new n.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=i,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.region},getBlendFunc:function(){var t=this._skeleton.drawOrder[0];return t?this._renderCmd._getBlendFunc(t.data.blendMode,this._premultipliedAlpha):{}},setBlendFunc:function(t,i){},update:function(t){this._skeleton.update(t)}});var h=sp._SGSkeleton.prototype;Object.defineProperty(h,"opacityModifyRGB",{get:h.isOpacityModifyRGB}),Object.defineProperty(h,"_blendFunc",{get:h.getBlendFunc}),Object.defineProperty(h,"_texture",{get:function(){return this._renderCmd._currTexture}})},{}],302:[function(t,i,s){var n=sp.spine,h=sp.AnimationEventType;sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t){var i=cc.path.join(cc.path.dirname(this.spAtlasFile),t),s=cc.textureCache.addImage(i),n=new sp.SkeletonTexture({width:s.getPixelWidth(),height:s.getPixelHeight()});return n.setRealTexture(s),n},unload:function(t){}},sp.TrackEntryListeners=function(t,i,s,n,h,r){this.startListener=t||null,this.endListener=i||null,this.completeListener=s||null,this.eventListener=n||null,this.interruptListener=h||null,this.disposeListener=r||null,this.callback=null,this.callbackTarget=null,this.skeletonNode=null};var r=sp.TrackEntryListeners.prototype;r.start=function(t){this.startListener&&this.startListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.START,null,0)},r.interrupt=function(t){this.interruptListener&&this.interruptListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.INTERRUPT,null,0)},r.end=function(t){this.endListener&&this.endListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.END,null,0)},r.dispose=function(t){this.disposeListener&&this.disposeListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.DISPOSE,null,0)},r.complete=function(t){var i=Math.floor(t.trackTime/t.animationEnd);this.completeListener&&this.completeListener(t,i),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.COMPLETE,null,i)},r.event=function(t,i){this.eventListener&&this.eventListener(t,i),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,h.EVENT,i,0)},sp.TrackEntryListeners.getListeners=function(t){return t.listener||(t.listener=new sp.TrackEntryListeners),t.listener},sp._SGSkeletonAnimation=sp._SGSkeleton.extend({_state:null,_ownsAnimationStateData:!1,_listener:null,_:function(){sp._SGSkeleton.prototype._.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new n.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var i=new n.AnimationState(t);this._listener=new sp.TrackEntryListeners,i.rendererObject=this,i.addListener(this._listener),this._state=i},setMix:function(t,i,s){this._state.data.setMixWith(t,i,s)},setAnimationListener:function(t,i){this._listener.callbackTarget=t,this._listener.callback=i,this._listener.skeletonNode=this},setAnimation:function(t,i,s){var n=this._skeleton.data.findAnimation(i);return n?this._state.setAnimationWith(t,n,s):(cc.logID(7509,i),null)},addAnimation:function(t,i,s,n){n=null==n?0:n;var h=this._skeleton.data.findAnimation(i);return h?this._state.addAnimationWith(t,h,s,n):(cc.logID(7510,i),null)},findAnimation:function(t){return this._skeleton.data.findAnimation(t)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty),this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._listener.startListener=t},setInterruptListener:function(t){this._listener.interruptListener=t},setEndListener:function(t){this._listener.endListener=t},setDisposeListener:function(t){this._listener.disposeListener=t},setCompleteListener:function(t){this._listener.completeListener=t},setEventListener:function(t){this._listener.eventListener=t},setTrackStartListener:function(t,i){sp.TrackEntryListeners.getListeners(t).startListener=i},setTrackInterruptListener:function(t,i){sp.TrackEntryListeners.getListeners(t).interruptListener=i},setTrackEndListener:function(t,i){sp.TrackEntryListeners.getListeners(t).endListener=i},setTrackDisposeListener:function(t,i){sp.TrackEntryListeners.getListeners(t).disposeListener=i},setTrackCompleteListener:function(t,i){sp.TrackEntryListeners.getListeners(t).completeListener=i},setTrackEventListener:function(t,i){sp.TrackEntryListeners.getListeners(t).eventListener=i},getState:function(){return this._state}})},{}],303:[function(t,i,s){var n=sp.spine;sp._SGSkeleton.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0};var h=sp._SGSkeleton.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);h.constructor=sp._SGSkeleton.CanvasRenderCmd,h.rendering=function(t,i,s){var h,r,e,c,o=this._node;t=t||cc._renderContext;var u=o._skeleton,a=u.drawOrder;for(h=0,r=a.length;h<r;h++)(c=(e=a[h])._slotNode)._visible&&c._renderCmd&&e.currentSprite&&(c._renderCmd.transform(this,!0),e.currentSprite._renderCmd.rendering(t,i,s),c._renderCmd._dirtyFlag=e.currentSprite._renderCmd._dirtyFlag=0);if(o._debugSlots||o._debugBones){t.setTransform(this._worldTransform,i,s),t.setGlobalAlpha(1);var f,l=cc._drawingUtil;if(o._debugSlots){l.setDrawColor(0,0,255,255),l.setLineWidth(1);var v=[];for(h=0,r=u.slots.length;h<r;h++)(e=u.drawOrder[h]).attachment&&e.attachment instanceof n.RegionAttachment&&(f=e.attachment,this._updateRegionAttachmentSlot(f,e,v),l.drawPoly(v,4,!0))}if(o._debugBones){var d;for(l.setLineWidth(2),l.setDrawColor(255,0,0,255),h=0,r=u.bones.length;h<r;h++){var p=(d=u.bones[h]).data.length*d.a+d.worldX,g=d.data.length*d.c+d.worldY;l.drawLine({x:d.worldX,y:d.worldY},{x:p,y:g})}for(l.setPointSize(4),l.setDrawColor(0,0,255,255),h=0,r=u.bones.length;h<r;h++)d=u.bones[h],l.drawPoint({x:d.worldX,y:d.worldY}),0===h&&l.setDrawColor(0,255,0,255)}}},h.updateStatus=function(){this.originUpdateStatus(),this._updateCurrentRegions(),this._regionFlag=_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~_ccsg.Node._dirtyFlags.contentDirty},h.getLocalBB=function(){return this._node.getBoundingBox()},h._updateRegionAttachmentSlot=function(t,i,s){if(s){var h=t.updateWorldVertices(i,!1),r=n.RegionAttachment;s.length=0,s.push(cc.p(h[r.X1],h[r.Y1])),s.push(cc.p(h[r.X4],h[r.Y4])),s.push(cc.p(h[r.X3],h[r.Y3])),s.push(cc.p(h[r.X2],h[r.Y2]))}},h._createChildFormSkeletonData=function(){for(var t,i,s=this._node._skeleton,h=0,r=s.slots.length;h<r;h++){var e=s.slots[h],c=e.attachment,o=new _ccsg.Node;e._slotNode=o,c instanceof n.RegionAttachment?(t=c.region.name,i=this._createSprite(e,c),e.currentSprite=i,e.currentSpriteName=t,o.addChild(i)):n.MeshAttachment}},h._createSprite=function(t,i){var s=i.region,n=s.texture.getRealTexture(),h=new cc.Rect(s.x,s.y,s.width,s.height),r=new _ccsg.Sprite;return r.initWithTexture(n,h,s.rotate,!1),r._rect.width=i.width,r._rect.height=i.height,r.setContentSize(i.width,i.height),r.setRotation(-i.rotation),r.setScale(s.width/s.originalWidth*i.scaleX,s.height/s.originalHeight*i.scaleY),t.sprites=t.sprites||{},t.sprites[s.name]=r,r},h._updateChild=function(){var t,i,s,h,r,e,c,o,u=this._node._skeleton.slots,a=this._displayedColor,f=this._displayedOpacity;for(t=0,i=u.length;t<i;t++)if(e=u[t],c=e.attachment,o=e._slotNode,c){if(c instanceof n.RegionAttachment){if(c.region&&(!e.currentSpriteName||e.currentSpriteName!==c.name)){var l=c.region.name;if(void 0!==e.currentSprite&&e.currentSprite.setVisible(!1),e.sprites=e.sprites||{},void 0!==e.sprites[l])e.sprites[l].setVisible(!0);else{var v=this._createSprite(e,c);o.addChild(v)}e.currentSprite=e.sprites[l],e.currentSpriteName=l}var d=e.bone;0===c.region.offsetX&&0===c.region.offsetY?(h=c.x,r=c.y):(h=.5*(c.offset[0]+c.offset[4]),r=.5*(c.offset[1]+c.offset[5])),o.setPosition(d.worldX+h*d.a+r*d.b,d.worldY+h*d.c+r*d.d),o.setScale(d.getWorldScaleX(),d.getWorldScaleY()),(s=e.currentSprite)._flippedX=d.skeleton.flipX,s._flippedY=d.skeleton.flipY,s._flippedY||s._flippedX?(o.setRotation(d.getWorldRotationX()),s.setRotation(c.rotation)):(o.setRotation(-d.getWorldRotationX()),s.setRotation(-c.rotation)),s._renderCmd._displayedOpacity=0|f*e.color.a;var p=0|a.r*e.color.r,g=0|a.g*e.color.g,m=0|a.b*e.color.b;s.setColor(cc.color(p,g,m)),s._renderCmd._updateColor()}else if(!(c instanceof n.MeshAttachment)){o.setVisible(!1);continue}o.setVisible(!0)}else o.setVisible(!1)}},{}],304:[function(t,i,s){sp.SkeletonTexture=cc.T({name:"sp.SkeletonTexture",S:sp.spine.Texture,_texture:null,setRealTexture:function(t){this._texture=t},getRealTexture:function(){return this._texture},setFilters:function(t,i){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=cc._renderContext;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i)}},setWraps:function(t,i){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=cc._renderContext;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i)}},dispose:function(){},bind:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.gl.bindTexture2D(this._texture)}})},{}],305:[function(t,i,s){var n=sp.spine;sp._SGSkeleton.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._currTexture=null,this._currBlendFunc={},this.vertexType=cc.renderer.VertexType.CUSTOM,this.setShaderProgram(cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR))};var h=sp._SGSkeleton.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);h.constructor=sp._SGSkeleton.WebGLRenderCmd,h.uploadData=function(t,i,s){var h,r,e,c,o=this._node,u=this._displayedColor,a=o._skeleton,f=o._premultipliedAlpha;a.r=u.r/255,a.g=u.g/255,a.b=u.b/255,a.a=this._displayedOpacity/255,f&&(a.r*=a.a,a.g*=a.a,a.b*=a.a);var l=null;for(this._node._debugSlots&&(l=[]),e=0,c=a.drawOrder.length;e<c;e++)if((r=a.drawOrder[e]).attachment){var v=0;if((h=r.attachment)instanceof n.RegionAttachment)v=6;else{if(!(h instanceof n.MeshAttachment))continue;v=h.regionUVs.length/2}if(0!==v){var d=o.getTextureAtlas(h);this._currTexture=d.texture.getRealTexture();var p=cc.renderer._updateBatchedInfo(this._currTexture,this._getBlendFunc(r.data.blendMode,f),this._shaderProgram);!p&&s+6*v>t.length&&(cc.renderer._batchRendering(),p=!0),p&&(s=0);var g=null;if(h instanceof n.RegionAttachment)g=this._uploadRegionAttachmentData(h,r,f,t,i,s);else{if(!(h instanceof n.MeshAttachment))continue;this._uploadMeshAttachmentData(h,r,f,t,i,s)}this._node._debugSlots&&(l[e]=g),h instanceof n.RegionAttachment?cc.renderer._increaseBatchingSize(v,cc.renderer.VertexType.TRIANGLE):cc.renderer._increaseBatchingSize(v,cc.renderer.VertexType.CUSTOM,h.triangles),s+=6*v}}if(o._debugBones||o._debugSlots){cc.renderer._batchRendering();var m=this._worldTransform,w=this._matrix.mat;w[0]=m.a,w[4]=m.c,w[12]=m.tx,w[1]=m.b,w[5]=m.d,w[13]=m.ty,cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._matrix;var _=cc._drawingUtil;if(o._debugSlots&&l&&l.length>0)for(_.setDrawColor(0,0,255,255),_.setLineWidth(1),e=0,c=a.slots.length;e<c;e++){var C=l[e];C&&_.drawPoly(C,4,!0)}if(o._debugBones){var b;for(_.setLineWidth(2),_.setDrawColor(255,0,0,255),e=0,c=a.bones.length;e<c;e++){var y=(b=a.bones[e]).data.length*b.a+b.worldX,T=b.data.length*b.c+b.worldY;_.drawLine(cc.p(b.worldX,b.worldY),cc.p(y,T))}for(_.setPointSize(4),_.setDrawColor(0,0,255,255),e=0,c=a.bones.length;e<c;e++)b=a.bones[e],_.drawPoint(cc.p(b.worldX,b.worldY)),0==e&&_.setDrawColor(0,255,0,255)}cc.math.glPopMatrix()}return 0},h._getBlendFunc=function(t,i){var s=this._currBlendFunc;switch(t){case n.BlendMode.Normal:s.src=i?cc.macro.ONE:cc.macro.SRC_ALPHA,s.dst=cc.macro.ONE_MINUS_SRC_ALPHA;break;case n.BlendMode.Additive:s.src=i?cc.macro.ONE:cc.macro.SRC_ALPHA,s.dst=cc.macro.ONE;break;case n.BlendMode.Multiply:s.src=cc.macro.DST_COLOR,s.dst=cc.macro.ONE_MINUS_SRC_ALPHA;break;case n.BlendMode.Screen:s.src=cc.macro.ONE,s.dst=cc.macro.ONE_MINUS_SRC_COLOR;break;default:s=this._node._blendFunc}return s},h._createChildFormSkeletonData=function(){},h._updateChild=function(){},h._uploadRegionAttachmentData=function(t,i,s,h,r,e){for(var c=this._displayedColor,o=c.r,u=c.g,a=c.b,f=this._displayedOpacity,l=t.updateWorldVertices(i,s),v=this._worldTransform,d=v.a,p=v.b,g=v.c,m=v.d,w=v.tx,_=v.ty,C=this._node.vertexZ,b=e,y=0;y<6;y++){var T=y<4?y%3:y-2,S=l[8*T],A=l[8*T+1],M=S*d+A*g+w,x=S*p+A*m+_,E=l[8*T+2]*o,O=l[8*T+3]*u,P=l[8*T+4]*a,R=l[8*T+5]*f<<24|P<<16|O<<8|E;h[b]=M,h[b+1]=x,h[b+2]=C,r[b+3]=R,h[b+4]=l[8*T+6],h[b+5]=l[8*T+7],b+=6}if(this._node._debugSlots){var I=n.RegionAttachment;return[cc.p(l[I.X1],l[I.Y1]),cc.p(l[I.X2],l[I.Y2]),cc.p(l[I.X3],l[I.Y3]),cc.p(l[I.X4],l[I.Y4])]}},h._uploadMeshAttachmentData=function(t,i,s,n,h,r){for(var e=this._worldTransform,c=e.a,o=e.b,u=e.c,a=e.d,f=e.tx,l=e.ty,v=this._node.vertexZ,d=t.updateWorldVertices(i,s),p=r,g=this._displayedColor,m=g.r,w=g.g,_=g.b,C=this._displayedOpacity,b=0,y=d.length;b<y;b+=8){var T=d[b],S=d[b+1],A=T*c+S*u+f,M=T*o+S*a+l,x=d[b+2]*m,E=d[b+3]*w,O=d[b+4]*_,P=d[b+5]*C<<24|O<<16|E<<8|x;n[p]=A,n[p+1]=M,n[p+2]=v,h[p+3]=P,n[p+4]=d[b+6],n[p+5]=d[b+7],p+=6}}},{}],306:[function(t,i,s){var n=cc.Enum({default:-1}),h=cc.Enum({"<None>":0});sp.Skeleton=cc.T({name:"sp.Skeleton",S:cc._RendererUnderSG,editor:!1,O:{_startListener:{default:null,serializable:!1},_endListener:{default:null,serializable:!1},_completeListener:{default:null,serializable:!1},_eventListener:{default:null,serializable:!1},_disposeListener:{default:null,serializable:!1},_interruptListener:{default:null,serializable:!1},_paused:!1,paused:{get:function(){return this._paused},set:function(t){this._paused=t,this._sgNode&&(t?this._sgNode.pause():this._sgNode.resume())},visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._refresh()},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){this.defaultAnimation=t,t?this.setAnimation(0,t,this.loop):(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData&&this.defaultSkin){var t=this.skeletonData.getSkinsEnum();if(t){var i=t[this.defaultSkin];if(void 0!==i)return i}}return 0},set:function(t){var i;if(this.skeletonData&&(i=this.skeletonData.getSkinsEnum()),!i)return cc.errorID("",this.name);var s=i[t];void 0!==s?this.defaultSkin=s:cc.errorID(7501,this.name)},type:n,visible:!0,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var i=this.skeletonData.getAnimsEnum();if(i){var s=i[t];if(void 0!==s)return s}}return 0},set:function(t){if(0!==t){var i;if(this.skeletonData&&(i=this.skeletonData.getAnimsEnum()),!i)return cc.errorID(7502,this.name);var s=i[t];void 0!==s?this.animation=s:cc.errorID(7503,this.name)}else this.animation=""},type:h,visible:!0,displayName:"Animation",tooltip:!1},loop:{default:!0,tooltip:!1},_premultipliedAlpha:!0,premultipliedAlpha:{get:function(){return this._premultipliedAlpha},set:function(t){this._premultipliedAlpha=t,this._sgNode&&this._sgNode.setPremultipliedAlpha(t)},tooltip:!1},timeScale:{default:1,notify:function(){this._sgNode&&this._sgNode.setTimeScale(this.timeScale)},tooltip:!1},debugSlots:{default:!1,notify:function(){this._sgNode&&this._sgNode.setDebugSlotsEnabled(this.debugSlots)},editorOnly:!0,tooltip:!1},debugBones:{default:!1,notify:function(){this._sgNode&&this._sgNode.setDebugBonesEnabled(this.debugBones)},editorOnly:!0,tooltip:!1}},__preload:function(){this.node.setContentSize(0,0),this._refresh()},_createSgNode:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t)try{return new sp._SGSkeletonAnimation(t,null,this.skeletonData.scale)}catch(t){cc._throw(t)}}return null},_initSgNode:function(){var t=this._sgNode;t.setTimeScale(this.timeScale);var i=this;if(t.onEnter=function(){_ccsg.Node.prototype.onEnter.call(this),i._paused&&this.pause()},this._startListener&&this.setStartListener(this._startListener),this._endListener&&this.setEndListener(this._endListener),this._completeListener&&this.setCompleteListener(this._completeListener),this._eventListener&&this.setEventListener(this._eventListener),this._interruptListener&&this.setInterruptListener(this._interruptListener),this._disposeListener&&this.setDisposeListener(this._disposeListener),this.defaultSkin)try{t.setSkin(this.defaultSkin)}catch(t){cc._throw(t)}t.setPremultipliedAlpha(this._premultipliedAlpha),this.animation=this.defaultAnimation},_getLocalBounds:!1,updateWorldTransform:function(){this._sgNode&&this._sgNode.updateWorldTransform()},setToSetupPose:function(){this._sgNode&&this._sgNode.setToSetupPose()},setBonesToSetupPose:function(){this._sgNode&&this._sgNode.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._sgNode&&this._sgNode.setSlotsToSetupPose()},findBone:function(t){return this._sgNode?this._sgNode.findBone(t):null},findSlot:function(t){return this._sgNode?this._sgNode.findSlot(t):null},setSkin:function(t){return this._sgNode?this._sgNode.setSkin(t):null},getAttachment:function(t,i){return this._sgNode?this._sgNode.getAttachment(t,i):null},setAttachment:function(t,i){this._sgNode&&this._sgNode.setAttachment(t,i)},setSkeletonData:function(t,i){this._sgNode&&this._sgNode.setSkeletonData(t,i)},setAnimationStateData:function(t){if(this._sgNode)return this._sgNode.setAnimationStateData(t)},setMix:function(t,i,s){this._sgNode&&this._sgNode.setMix(t,i,s)},setAnimationListener:function(t,i){this._sgNode&&this._sgNode.setAnimationListener(t,i)},setAnimation:function(t,i,s){return this._sgNode?this._sgNode.setAnimation(t,i,s):null},_sample:function(){this._sgNode&&this._sgNode.update(0)},addAnimation:function(t,i,s,n){return this._sgNode?this._sgNode.addAnimation(t,i,s,n||0):null},findAnimation:function(t){return this._sgNode?this._sgNode.findAnimation(t):null},getCurrent:function(t){return this._sgNode?this._sgNode.getCurrent(t):null},clearTracks:function(){this._sgNode&&this._sgNode.clearTracks()},clearTrack:function(t){this._sgNode&&this._sgNode.clearTrack(t)},_updateAnimEnum:!1,_updateSkinEnum:!1,setStartListener:function(t){this._startListener=t,this._sgNode&&this._sgNode.setStartListener(t)},setInterruptListener:function(t){this._interruptListener=t,this._sgNode&&this._sgNode.setInterruptListener(t)},setEndListener:function(t){this._endListener=t,this._sgNode&&this._sgNode.setEndListener(t)},setDisposeListener:function(t){this._disposeListener=t,this._sgNode&&this._sgNode.setDisposeListener(t)},setCompleteListener:function(t){this._completeListener=t,this._sgNode&&this._sgNode.setCompleteListener(t)},setEventListener:function(t){this._eventListener=t,this._sgNode&&this._sgNode.setEventListener(t)},setTrackStartListener:function(t,i){this._sgNode&&this._sgNode.setTrackStartListener(t,i)},setTrackInterruptListener:function(t,i){this._sgNode&&this._sgNode.setTrackInterruptListener(t,i)},setTrackEndListener:function(t,i){this._sgNode&&this._sgNode.setTrackEndListener(t,i)},setTrackDisposeListener:function(t,i){this._sgNode&&this._sgNode.setTrackDisposeListener(t,i)},setTrackCompleteListener:function(t,i){this._sgNode&&this._sgNode.setTrackCompleteListener(t,i)},setTrackEventListener:function(t,i){this._sgNode&&this._sgNode.setTrackEventListener(t,i)},getState:function(){if(this._sgNode)return this._sgNode.getState()},_refresh:function(){this._sgNode&&(this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode(),this._sgNode=null);var t=this._sgNode=this._createSgNode();t&&(this.enabledInHierarchy||t.setVisible(!1),t.setContentSize(0,0),this._initSgNode(),this._appendSgNode(t),this._registSizeProvider())}})},{}],307:[function(t,i,s){var n=cc.T({ctor:function(){this.asset=arguments[0]},getTexture:function(t){for(var i=this.asset.textures,s=0;s<i.length;s++){var n=i[s];if(n.endsWith(t)){var h=cc.textureCache.addImage(n),r=new sp.SkeletonTexture({width:h.getPixelWidth(),height:h.getPixelHeight()});return r.setRealTexture(h),r}}return null},load:function(t){return this.getTexture(t)||(cc.errorID(7506,t),null)},unload:function(t){}}),h=cc.T({name:"sp.SkeletonData",S:cc.Asset,ctor:function(){this.reset()},O:{_skeletonJson:null,skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this._skeletonJson=t,this.reset()}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},atlasUrl:{default:"",url:cc.RawAsset},textures:{default:[],url:[cc.Texture2D]},scale:1},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0))return t||cc.errorID(7507,this.name),null;var i=this._getAtlas(t);if(!i)return null;var s=new sp.spine.AtlasAttachmentLoader(i),n=new sp.spine.SkeletonJson(s);n.scale=this.scale;var h=this.skeletonJson;return this._skeletonCache=n.readSkeletonData(h),i.dispose(n),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getAtlas:function(t){if(this._atlasCache)return this._atlasCache;if(!this.atlasText)return t||cc.errorID(7508,this.name),null;var i=new n(this);return this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,i.load.bind(i))}});sp.SkeletonData=i.exports=h},{}],308:[function(t,i,s){sp={},sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7},sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=t("./lib/spine"),t("./SGSkeletonTexture"),t("./SGSkeleton"),t("./SGSkeletonCanvasRenderCmd"),t("./SGSkeletonWebGLRenderCmd"),t("./SGSkeletonAnimation"),t("./SkeletonData"),t("./Skeleton")},{"./SGSkeleton":301,"./SGSkeletonAnimation":302,"./SGSkeletonCanvasRenderCmd":303,"./SGSkeletonTexture":304,"./SGSkeletonWebGLRenderCmd":305,"./Skeleton":306,"./SkeletonData":307,"./lib/spine":309}],309:[function(t,i,s){var n=this&&this.__extends||function(t,i){function s(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)};!function(t){var i=function(){function t(t,i,s){if(null==t)throw new Error("name cannot be null.");if(null==i)throw new Error("timelines cannot be null.");this.name=t,this.timelines=i,this.duration=s}return t.prototype.apply=function(t,i,s,n,h,r,e,c){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(s%=this.duration,i>0&&(i%=this.duration));for(var o=this.timelines,u=0,a=o.length;u<a;u++)o[u].apply(t,i,s,h,r,e,c)},t.binarySearch=function(t,i,s){void 0===s&&(s=1);var n=0,h=t.length/s-2;if(0==h)return s;for(var r=h>>>1;;){if(t[(r+1)*s]<=i?n=r+1:h=r,n==h)return(n+1)*s;r=n+h>>>1}},t.linearSearch=function(t,i,s){for(var n=0,h=t.length-s;n<=h;n+=s)if(t[n]>i)return n;return-1},t}();t.Animation=i,function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix"}(t.TimelineType||(t.TimelineType={}));var s=t.TimelineType,h=function(){function i(s){if(s<=0)throw new Error("frameCount must be > 0: "+s);this.curves=t.Utils.newFloatArray((s-1)*i.BEZIER_SIZE)}return i.prototype.getFrameCount=function(){return this.curves.length/i.BEZIER_SIZE+1},i.prototype.setLinear=function(t){this.curves[t*i.BEZIER_SIZE]=i.LINEAR},i.prototype.setStepped=function(t){this.curves[t*i.BEZIER_SIZE]=i.STEPPED},i.prototype.getCurveType=function(t){var s=t*i.BEZIER_SIZE;if(s==this.curves.length)return i.LINEAR;var n=this.curves[s];return n==i.LINEAR?i.LINEAR:n==i.STEPPED?i.STEPPED:i.BEZIER},i.prototype.setCurve=function(t,s,n,h,r){var e=.03*(2*-s+h),c=.03*(2*-n+r),o=.006*(3*(s-h)+1),u=.006*(3*(n-r)+1),a=2*e+o,f=2*c+u,l=.3*s+e+.16666667*o,v=.3*n+c+.16666667*u,d=t*i.BEZIER_SIZE,p=this.curves;p[d++]=i.BEZIER;for(var g=l,m=v,w=d+i.BEZIER_SIZE-1;d<w;d+=2)p[d]=g,p[d+1]=m,l+=a,v+=f,a+=o,f+=u,g+=l,m+=v},i.prototype.getCurvePercent=function(s,n){n=t.MathUtils.clamp(n,0,1);var h=this.curves,r=s*i.BEZIER_SIZE,e=h[r];if(e==i.LINEAR)return n;if(e==i.STEPPED)return 0;for(var c=0,o=++r,u=r+i.BEZIER_SIZE-1;r<u;r+=2)if((c=h[r])>=n){var a=void 0,f=void 0;return r==o?(a=0,f=0):(a=h[r-2],f=h[r-1]),f+(h[r+1]-f)*(n-a)/(c-a)}var l=h[r-1];return l+(1-l)*(n-c)/(1-c)},i.LINEAR=0,i.STEPPED=1,i.BEZIER=2,i.BEZIER_SIZE=19,i}();t.CurveTimeline=h;var r=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i<<1)}return n(r,h),r.prototype.getPropertyId=function(){return(s.rotate<<24)+this.boneIndex},r.prototype.setFrame=function(t,i,s){t<<=1,this.frames[t]=i,this.frames[t+r.ROTATION]=s},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.bones[this.boneIndex];if(n<u[0])c&&(a.rotation=a.data.rotation);else if(n>=u[u.length-r.ENTRIES])if(c)a.rotation=a.data.rotation+u[u.length+r.PREV_ROTATION]*e;else{var f=a.data.rotation+u[u.length+r.PREV_ROTATION]-a.rotation;f-=360*(16384-(16384.499999999996-f/360|0)),a.rotation+=f*e}else{var l=i.binarySearch(u,n,r.ENTRIES),v=u[l+r.PREV_ROTATION],d=u[l],p=this.getCurvePercent((l>>1)-1,1-(n-d)/(u[l+r.PREV_TIME]-d)),g=u[l+r.ROTATION]-v;g=v+(g-=360*(16384-(16384.499999999996-g/360|0)))*p,c?(g-=360*(16384-(16384.499999999996-g/360|0)),a.rotation=a.data.rotation+g*e):(g=a.data.rotation+g-a.rotation,g-=360*(16384-(16384.499999999996-g/360|0)),a.rotation+=g*e)}},r.ENTRIES=2,r.PREV_TIME=-2,r.PREV_ROTATION=-1,r.ROTATION=1,r}(h);t.RotateTimeline=r;var e=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.translate<<24)+this.boneIndex},r.prototype.setFrame=function(t,i,s,n){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.X]=s,this.frames[t+r.Y]=n},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.bones[this.boneIndex];if(n<u[0])c&&(a.x=a.data.x,a.y=a.data.y);else{var f=0,l=0;if(n>=u[u.length-r.ENTRIES])f=u[u.length+r.PREV_X],l=u[u.length+r.PREV_Y];else{var v=i.binarySearch(u,n,r.ENTRIES);f=u[v+r.PREV_X],l=u[v+r.PREV_Y];var d=u[v],p=this.getCurvePercent(v/r.ENTRIES-1,1-(n-d)/(u[v+r.PREV_TIME]-d));f+=(u[v+r.X]-f)*p,l+=(u[v+r.Y]-l)*p}c?(a.x=a.data.x+f*e,a.y=a.data.y+l*e):(a.x+=(a.data.x+f-a.x)*e,a.y+=(a.data.y+l-a.y)*e)}},r.ENTRIES=3,r.PREV_TIME=-3,r.PREV_X=-2,r.PREV_Y=-1,r.X=1,r.Y=2,r}(h);t.TranslateTimeline=e;var c=function(h){function r(t){h.call(this,t)}return n(r,h),r.prototype.getPropertyId=function(){return(s.scale<<24)+this.boneIndex},r.prototype.apply=function(s,n,h,e,c,o,u){var a=this.frames,f=s.bones[this.boneIndex];if(h<a[0])o&&(f.scaleX=f.data.scaleX,f.scaleY=f.data.scaleY);else{var l=0,v=0;if(h>=a[a.length-r.ENTRIES])l=a[a.length+r.PREV_X]*f.data.scaleX,v=a[a.length+r.PREV_Y]*f.data.scaleY;else{var d=i.binarySearch(a,h,r.ENTRIES);l=a[d+r.PREV_X],v=a[d+r.PREV_Y];var p=a[d],g=this.getCurvePercent(d/r.ENTRIES-1,1-(h-p)/(a[d+r.PREV_TIME]-p));l=(l+(a[d+r.X]-l)*g)*f.data.scaleX,v=(v+(a[d+r.Y]-v)*g)*f.data.scaleY}if(1==c)f.scaleX=l,f.scaleY=v;else{var m=0,w=0;o?(m=f.data.scaleX,w=f.data.scaleY):(m=f.scaleX,w=f.scaleY),u?(l=Math.abs(l)*t.MathUtils.signum(m),v=Math.abs(v)*t.MathUtils.signum(w)):(m=Math.abs(m)*t.MathUtils.signum(l),w=Math.abs(w)*t.MathUtils.signum(v)),f.scaleX=m+(l-m)*c,f.scaleY=w+(v-w)*c}}},r}(e);t.ScaleTimeline=c;var o=function(t){function h(i){t.call(this,i)}return n(h,t),h.prototype.getPropertyId=function(){return(s.shear<<24)+this.boneIndex},h.prototype.apply=function(t,s,n,r,e,c,o){var u=this.frames,a=t.bones[this.boneIndex];if(n<u[0])c&&(a.shearX=a.data.shearX,a.shearY=a.data.shearY);else{var f=0,l=0;if(n>=u[u.length-h.ENTRIES])f=u[u.length+h.PREV_X],l=u[u.length+h.PREV_Y];else{var v=i.binarySearch(u,n,h.ENTRIES);f=u[v+h.PREV_X],l=u[v+h.PREV_Y];var d=u[v],p=this.getCurvePercent(v/h.ENTRIES-1,1-(n-d)/(u[v+h.PREV_TIME]-d));f+=(u[v+h.X]-f)*p,l+=(u[v+h.Y]-l)*p}c?(a.shearX=a.data.shearX+f*e,a.shearY=a.data.shearY+l*e):(a.shearX+=(a.data.shearX+f-a.shearX)*e,a.shearY+=(a.data.shearY+l-a.shearY)*e)}},h}(e);t.ShearTimeline=o;var u=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.color<<24)+this.slotIndex},r.prototype.setFrame=function(t,i,s,n,h,e){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.R]=s,this.frames[t+r.G]=n,this.frames[t+r.B]=h,this.frames[t+r.A]=e},r.prototype.apply=function(t,s,n,h,e,c,o){var u=t.slots[this.slotIndex],a=this.frames;if(n<a[0])c&&u.color.setFromColor(u.data.color);else{var f=0,l=0,v=0,d=0;if(n>=a[a.length-r.ENTRIES]){var p=a.length;f=a[p+r.PREV_R],l=a[p+r.PREV_G],v=a[p+r.PREV_B],d=a[p+r.PREV_A]}else{var g=i.binarySearch(a,n,r.ENTRIES);f=a[g+r.PREV_R],l=a[g+r.PREV_G],v=a[g+r.PREV_B],d=a[g+r.PREV_A];var m=a[g],w=this.getCurvePercent(g/r.ENTRIES-1,1-(n-m)/(a[g+r.PREV_TIME]-m));f+=(a[g+r.R]-f)*w,l+=(a[g+r.G]-l)*w,v+=(a[g+r.B]-v)*w,d+=(a[g+r.A]-d)*w}if(1==e)u.color.set(f,l,v,d);else{var _=u.color;c&&_.setFromColor(u.data.color),_.add((f-_.r)*e,(l-_.g)*e,(v-_.b)*e,(d-_.a)*e)}}},r.ENTRIES=5,r.PREV_TIME=-5,r.PREV_R=-4,r.PREV_G=-3,r.PREV_B=-2,r.PREV_A=-1,r.R=1,r.G=2,r.B=3,r.A=4,r}(h);t.ColorTimeline=u;var a=function(){function n(i){this.frames=t.Utils.newFloatArray(i),this.attachmentNames=new Array(i)}return n.prototype.getPropertyId=function(){return(s.attachment<<24)+this.slotIndex},n.prototype.getFrameCount=function(){return this.frames.length},n.prototype.setFrame=function(t,i,s){this.frames[t]=i,this.attachmentNames[t]=s},n.prototype.apply=function(t,s,n,h,r,e,c){var o=t.slots[this.slotIndex];if(c&&e){var u=o.data.attachmentName;o.setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}else{var a=this.frames;if(n<a[0]){if(e){var f=o.data.attachmentName;o.setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var l=0;l=n>=a[a.length-1]?a.length-1:i.binarySearch(a,n,1)-1;var v=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==v?null:t.getAttachment(this.slotIndex,v))}}},n}();t.AttachmentTimeline=a;var f=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i),this.frameVertices=new Array(i)}return n(r,h),r.prototype.getPropertyId=function(){return(s.deform<<24)+this.slotIndex},r.prototype.setFrame=function(t,i,s){this.frames[t]=i,this.frameVertices[t]=s},r.prototype.apply=function(s,n,h,r,e,c,o){var u=s.slots[this.slotIndex],a=u.getAttachment();if(a instanceof t.VertexAttachment&&a.applyDeform(this.attachment)){var f=this.frames,l=u.attachmentVertices;if(h<f[0])c&&t.Utils.setArraySize(l,0);else{var v=this.frameVertices,d=v[0].length;l.length!=d&&(e=1);var p=t.Utils.setArraySize(l,d);if(h>=f[f.length-1]){var g=v[f.length-1];if(1==e)t.Utils.arrayCopy(g,0,p,0,d);else if(c)if(null==(S=a).bones)for(var m=S.vertices,w=0;w<d;w++)M=m[w],p[w]=M+(g[w]-M)*e;else for(w=0;w<d;w++)p[w]=g[w]*e;else for(w=0;w<d;w++)p[w]+=(g[w]-p[w])*e}else{var _=i.binarySearch(f,h),C=v[_-1],b=v[_],y=f[_],T=this.getCurvePercent(_-1,1-(h-y)/(f[_-1]-y));if(1==e)for(w=0;w<d;w++)A=C[w],p[w]=A+(b[w]-A)*T;else if(c){var S=a;if(null==S.bones)for(m=S.vertices,w=0;w<d;w++){var A=C[w],M=m[w];p[w]=M+(A+(b[w]-A)*T-M)*e}else for(w=0;w<d;w++)A=C[w],p[w]=(A+(b[w]-A)*T)*e}else for(w=0;w<d;w++)A=C[w],p[w]+=(A+(b[w]-A)*T-p[w])*e}}}},r}(h);t.DeformTimeline=f;var l=function(){function n(i){this.frames=t.Utils.newFloatArray(i),this.events=new Array(i)}return n.prototype.getPropertyId=function(){return s.event<<24},n.prototype.getFrameCount=function(){return this.frames.length},n.prototype.setFrame=function(t,i){this.frames[t]=i.time,this.events[t]=i},n.prototype.apply=function(t,s,n,h,r,e,c){if(null!=h){var o=this.frames,u=this.frames.length;if(s>n)this.apply(t,s,Number.MAX_VALUE,h,r,e,c),s=-1;else if(s>=o[u-1])return;if(!(n<o[0])){var a=0;if(s<o[0])a=0;else for(var f=o[a=i.binarySearch(o,s)];a>0&&o[a-1]==f;)a--;for(;a<u&&n>=o[a];a++)h.push(this.events[a])}}},n}();t.EventTimeline=l;var v=function(){function n(i){this.frames=t.Utils.newFloatArray(i),this.drawOrders=new Array(i)}return n.prototype.getPropertyId=function(){return s.drawOrder<<24},n.prototype.getFrameCount=function(){return this.frames.length},n.prototype.setFrame=function(t,i,s){this.frames[t]=i,this.drawOrders[t]=s},n.prototype.apply=function(s,n,h,r,e,c,o){var u=s.drawOrder,a=s.slots;if(o&&c)t.Utils.arrayCopy(s.slots,0,s.drawOrder,0,s.slots.length);else{var f=this.frames;if(h<f[0])c&&t.Utils.arrayCopy(s.slots,0,s.drawOrder,0,s.slots.length);else{var l=0;l=h>=f[f.length-1]?f.length-1:i.binarySearch(f,h)-1;var v=this.drawOrders[l];if(null==v)t.Utils.arrayCopy(a,0,u,0,a.length);else for(var d=0,p=v.length;d<p;d++)u[d]=a[v[d]]}}},n}();t.DrawOrderTimeline=v;var d=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.ikConstraint<<24)+this.ikConstraintIndex},r.prototype.setFrame=function(t,i,s,n){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.MIX]=s,this.frames[t+r.BEND_DIRECTION]=n},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.ikConstraints[this.ikConstraintIndex];if(n<u[0])c&&(a.mix=a.data.mix,a.bendDirection=a.data.bendDirection);else if(n>=u[u.length-r.ENTRIES])c?(a.mix=a.data.mix+(u[u.length+r.PREV_MIX]-a.data.mix)*e,a.bendDirection=o?a.data.bendDirection:u[u.length+r.PREV_BEND_DIRECTION]):(a.mix+=(u[u.length+r.PREV_MIX]-a.mix)*e,o||(a.bendDirection=u[u.length+r.PREV_BEND_DIRECTION]));else{var f=i.binarySearch(u,n,r.ENTRIES),l=u[f+r.PREV_MIX],v=u[f],d=this.getCurvePercent(f/r.ENTRIES-1,1-(n-v)/(u[f+r.PREV_TIME]-v));c?(a.mix=a.data.mix+(l+(u[f+r.MIX]-l)*d-a.data.mix)*e,a.bendDirection=o?a.data.bendDirection:u[f+r.PREV_BEND_DIRECTION]):(a.mix+=(l+(u[f+r.MIX]-l)*d-a.mix)*e,o||(a.bendDirection=u[f+r.PREV_BEND_DIRECTION]))}},r.ENTRIES=3,r.PREV_TIME=-3,r.PREV_MIX=-2,r.PREV_BEND_DIRECTION=-1,r.MIX=1,r.BEND_DIRECTION=2,r}(h);t.IkConstraintTimeline=d;var p=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.transformConstraint<<24)+this.transformConstraintIndex},r.prototype.setFrame=function(t,i,s,n,h,e){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.ROTATE]=s,this.frames[t+r.TRANSLATE]=n,this.frames[t+r.SCALE]=h,this.frames[t+r.SHEAR]=e},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.transformConstraints[this.transformConstraintIndex];if(n<u[0])c&&(_=a.data,a.rotateMix=_.rotateMix,a.translateMix=_.rotateMix,a.scaleMix=_.scaleMix,a.shearMix=_.shearMix);else{var f=0,l=0,v=0,d=0;if(n>=u[u.length-r.ENTRIES]){var p=u.length;f=u[p+r.PREV_ROTATE],l=u[p+r.PREV_TRANSLATE],v=u[p+r.PREV_SCALE],d=u[p+r.PREV_SHEAR]}else{var g=i.binarySearch(u,n,r.ENTRIES);f=u[g+r.PREV_ROTATE],l=u[g+r.PREV_TRANSLATE],v=u[g+r.PREV_SCALE],d=u[g+r.PREV_SHEAR];var m=u[g],w=this.getCurvePercent(g/r.ENTRIES-1,1-(n-m)/(u[g+r.PREV_TIME]-m));f+=(u[g+r.ROTATE]-f)*w,l+=(u[g+r.TRANSLATE]-l)*w,v+=(u[g+r.SCALE]-v)*w,d+=(u[g+r.SHEAR]-d)*w}if(c){var _=a.data;a.rotateMix=_.rotateMix+(f-_.rotateMix)*e,a.translateMix=_.translateMix+(l-_.translateMix)*e,a.scaleMix=_.scaleMix+(v-_.scaleMix)*e,a.shearMix=_.shearMix+(d-_.shearMix)*e}else a.rotateMix+=(f-a.rotateMix)*e,a.translateMix+=(l-a.translateMix)*e,a.scaleMix+=(v-a.scaleMix)*e,a.shearMix+=(d-a.shearMix)*e}},r.ENTRIES=5,r.PREV_TIME=-5,r.PREV_ROTATE=-4,r.PREV_TRANSLATE=-3,r.PREV_SCALE=-2,r.PREV_SHEAR=-1,r.ROTATE=1,r.TRANSLATE=2,r.SCALE=3,r.SHEAR=4,r}(h);t.TransformConstraintTimeline=p;var g=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.pathConstraintPosition<<24)+this.pathConstraintIndex},r.prototype.setFrame=function(t,i,s){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.VALUE]=s},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(n<u[0])c&&(a.position=a.data.position);else{var f=0;if(n>=u[u.length-r.ENTRIES])f=u[u.length+r.PREV_VALUE];else{var l=i.binarySearch(u,n,r.ENTRIES);f=u[l+r.PREV_VALUE];var v=u[l],d=this.getCurvePercent(l/r.ENTRIES-1,1-(n-v)/(u[l+r.PREV_TIME]-v));f+=(u[l+r.VALUE]-f)*d}c?a.position=a.data.position+(f-a.data.position)*e:a.position+=(f-a.position)*e}},r.ENTRIES=2,r.PREV_TIME=-2,r.PREV_VALUE=-1,r.VALUE=1,r}(h);t.PathConstraintPositionTimeline=g;var m=function(t){function h(i){t.call(this,i)}return n(h,t),h.prototype.getPropertyId=function(){return(s.pathConstraintSpacing<<24)+this.pathConstraintIndex},h.prototype.apply=function(t,s,n,r,e,c,o){var u=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(n<u[0])c&&(a.spacing=a.data.spacing);else{var f=0;if(n>=u[u.length-h.ENTRIES])f=u[u.length+h.PREV_VALUE];else{var l=i.binarySearch(u,n,h.ENTRIES);f=u[l+h.PREV_VALUE];var v=u[l],d=this.getCurvePercent(l/h.ENTRIES-1,1-(n-v)/(u[l+h.PREV_TIME]-v));f+=(u[l+h.VALUE]-f)*d}c?a.spacing=a.data.spacing+(f-a.data.spacing)*e:a.spacing+=(f-a.spacing)*e}},h}(g);t.PathConstraintSpacingTimeline=m;var w=function(h){function r(i){h.call(this,i),this.frames=t.Utils.newFloatArray(i*r.ENTRIES)}return n(r,h),r.prototype.getPropertyId=function(){return(s.pathConstraintMix<<24)+this.pathConstraintIndex},r.prototype.setFrame=function(t,i,s,n){t*=r.ENTRIES,this.frames[t]=i,this.frames[t+r.ROTATE]=s,this.frames[t+r.TRANSLATE]=n},r.prototype.apply=function(t,s,n,h,e,c,o){var u=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(n<u[0])c&&(a.rotateMix=a.data.rotateMix,a.translateMix=a.data.translateMix);else{var f=0,l=0;if(n>=u[u.length-r.ENTRIES])f=u[u.length+r.PREV_ROTATE],l=u[u.length+r.PREV_TRANSLATE];else{var v=i.binarySearch(u,n,r.ENTRIES);f=u[v+r.PREV_ROTATE],l=u[v+r.PREV_TRANSLATE];var d=u[v],p=this.getCurvePercent(v/r.ENTRIES-1,1-(n-d)/(u[v+r.PREV_TIME]-d));f+=(u[v+r.ROTATE]-f)*p,l+=(u[v+r.TRANSLATE]-l)*p}c?(a.rotateMix=a.data.rotateMix+(f-a.data.rotateMix)*e,a.translateMix=a.data.translateMix+(l-a.data.translateMix)*e):(a.rotateMix+=(f-a.rotateMix)*e,a.translateMix+=(l-a.translateMix)*e)}},r.ENTRIES=3,r.PREV_TIME=-3,r.PREV_ROTATE=-2,r.PREV_TRANSLATE=-1,r.ROTATE=1,r.TRANSLATE=2,r}(h);t.PathConstraintMixTimeline=w}(h||(h={})),function(t){var i=function(){function i(i){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new t.Pool(function(){return new s}),this.data=i}return i.prototype.update=function(t){t*=this.timeScale;for(var i=this.tracks,s=0,n=i.length;s<n;s++){var h=i[s];if(null!=h){h.animationLast=h.nextAnimationLast,h.trackLast=h.nextTrackLast;var r=t*h.timeScale;if(h.delay>0){if(h.delay-=r,h.delay>0)continue;r=-h.delay,h.delay=0}var e=h.next;if(null!=e){var c=h.trackLast-e.delay;if(c>=0){for(e.delay=0,e.trackTime=c+t*e.timeScale,h.trackTime+=r,this.setCurrent(s,e,!0);null!=e.mixingFrom;)e.mixTime+=r,e=e.mixingFrom;continue}}else if(h.trackLast>=h.trackEnd&&null==h.mixingFrom){i[s]=null,this.queue.end(h),this.disposeNext(h);continue}this.updateMixingFrom(h,t),h.trackTime+=r}}this.queue.drain()},i.prototype.updateMixingFrom=function(t,i){var s=t.mixingFrom;if(null!=s){if(this.updateMixingFrom(s,i),t.mixTime>=t.mixDuration&&null!=s.mixingFrom&&t.mixTime>0)return t.mixingFrom=null,void this.queue.end(s);s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,s.trackTime+=i*s.timeScale,t.mixTime+=i*s.timeScale}},i.prototype.apply=function(i){if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var s=this.events,n=this.tracks,h=0,r=n.length;h<r;h++){var e=n[h];if(!(null==e||e.delay>0)){var c=e.alpha;null!=e.mixingFrom?c*=this.applyMixingFrom(e,i):e.trackTime>=e.trackEnd&&(c=0);var o=e.animationLast,u=e.getAnimationTime(),a=e.animation.timelines.length,f=e.animation.timelines;if(1==c)for(p=0;p<a;p++)f[p].apply(i,o,u,s,1,!0,!1);else{var l=0==e.timelinesRotation.length;l&&t.Utils.setArraySize(e.timelinesRotation,a<<1,null);for(var v=e.timelinesRotation,d=e.timelinesFirst,p=0;p<a;p++){var g=f[p];g instanceof t.RotateTimeline?this.applyRotateTimeline(g,i,u,c,d[p],v,p<<1,l):g.apply(i,o,u,s,c,d[p],!1)}}this.queueEvents(e,u),s.length=0,e.nextAnimationLast=u,e.nextTrackLast=e.trackTime}}this.queue.drain()},i.prototype.applyMixingFrom=function(i,s){var n=i.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,s);var h=0;0==i.mixDuration?h=1:(h=i.mixTime/i.mixDuration)>1&&(h=1);var r=h<n.eventThreshold?this.events:null,e=h<n.attachmentThreshold,c=h<n.drawOrderThreshold,o=n.animationLast,u=n.getAnimationTime(),a=n.animation.timelines.length,f=n.animation.timelines,l=n.timelinesFirst,v=n.alpha*i.mixAlpha*(1-h),d=0==n.timelinesRotation.length;d&&t.Utils.setArraySize(n.timelinesRotation,a<<1,null);for(var p=n.timelinesRotation,g=0;g<a;g++){var m=f[g],w=l[g];if(m instanceof t.RotateTimeline)this.applyRotateTimeline(m,s,u,v,w,p,g<<1,d);else{if(!w){if(!e&&m instanceof t.AttachmentTimeline)continue;if(!c&&m instanceof t.DrawOrderTimeline)continue}m.apply(s,o,u,r,v,w,!0)}}return i.mixDuration>0&&this.queueEvents(n,u),this.events.length=0,n.nextAnimationLast=u,n.nextTrackLast=n.trackTime,h},i.prototype.applyRotateTimeline=function(i,s,n,h,r,e,c,o){if(o&&(e[c]=0),1!=h){var u=i,a=u.frames,f=s.bones[u.boneIndex];if(n<a[0])r&&(f.rotation=f.data.rotation);else{var l=0;if(n>=a[a.length-t.RotateTimeline.ENTRIES])l=f.data.rotation+a[a.length+t.RotateTimeline.PREV_ROTATION];else{var v=t.Animation.binarySearch(a,n,t.RotateTimeline.ENTRIES),d=a[v+t.RotateTimeline.PREV_ROTATION],p=a[v],g=u.getCurvePercent((v>>1)-1,1-(n-p)/(a[v+t.RotateTimeline.PREV_TIME]-p));l=a[v+t.RotateTimeline.ROTATION]-d,l=d+(l-=360*(16384-(16384.499999999996-l/360|0)))*g+f.data.rotation,l-=360*(16384-(16384.499999999996-l/360|0))}var m=r?f.data.rotation:f.rotation,w=0,_=l-m;if(0==_)w=e[c];else{_-=360*(16384-(16384.499999999996-_/360|0));var C=0,b=0;o?(C=0,b=_):(C=e[c],b=e[c+1]);var y=_>0,T=C>=0;t.MathUtils.signum(b)!=t.MathUtils.signum(_)&&Math.abs(b)<=90&&(Math.abs(C)>180&&(C+=360*t.MathUtils.signum(C)),T=y),w=_+C-C%360,T!=y&&(w+=360*t.MathUtils.signum(C)),e[c]=w}e[c+1]=_,m+=w*h,f.rotation=m-360*(16384-(16384.499999999996-m/360|0))}}else i.apply(s,0,n,null,1,r,!1)},i.prototype.queueEvents=function(t,i){for(var s=t.animationStart,n=t.animationEnd,h=n-s,r=t.trackLast%h,e=this.events,c=0,o=e.length;c<o;c++){var u=e[c];if(u.time<r)break;u.time>n||this.queue.event(t,u)}for((t.loop?r>t.trackTime%h:i>=n&&t.animationLast<n)&&this.queue.complete(t);c<o;c++)e[c].time<s||this.queue.event(t,e[c])},i.prototype.clearTracks=function(){this.queue.drainDisabled=!0;for(var t=0,i=this.tracks.length;t<i;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=!1,this.queue.drain()},i.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var i=this.tracks[t];if(null!=i){this.queue.end(i),this.disposeNext(i);for(var s=i;;){var n=s.mixingFrom;if(null==n)break;this.queue.end(n),s.mixingFrom=null,s=n}this.tracks[i.trackIndex]=null,this.queue.drain()}}},i.prototype.setCurrent=function(t,i,s){var n=this.expandToIndex(t);this.tracks[t]=i,null!=n&&(s&&this.queue.interrupt(n),i.mixingFrom=n,i.mixTime=0,n.timelinesRotation.length=0,null!=n.mixingFrom&&n.mixDuration>0&&(i.mixAlpha*=Math.min(n.mixTime/n.mixDuration,1))),this.queue.start(i)},i.prototype.setAnimation=function(t,i,s){var n=this.data.skeletonData.findAnimation(i);if(null==n)throw new Error("Animation not found: "+i);return this.setAnimationWith(t,n,s)},i.prototype.setAnimationWith=function(t,i,s){if(null==i)throw new Error("animation cannot be null.");var n=!0,h=this.expandToIndex(t);null!=h&&(-1==h.nextTrackLast?(this.tracks[t]=h.mixingFrom,this.queue.interrupt(h),this.queue.end(h),this.disposeNext(h),h=h.mixingFrom,n=!1):this.disposeNext(h));var r=this.trackEntry(t,i,s,h);return this.setCurrent(t,r,n),this.queue.drain(),r},i.prototype.addAnimation=function(t,i,s,n){var h=this.data.skeletonData.findAnimation(i);if(null==h)throw new Error("Animation not found: "+i);return this.addAnimationWith(t,h,s,n)},i.prototype.addAnimationWith=function(t,i,s,n){if(null==i)throw new Error("animation cannot be null.");var h=this.expandToIndex(t);if(null!=h)for(;null!=h.next;)h=h.next;var r=this.trackEntry(t,i,s,h);if(null==h)this.setCurrent(t,r,!0),this.queue.drain();else if(h.next=r,n<=0){var e=h.animationEnd-h.animationStart;0!=e?n+=e*(1+(h.trackTime/e|0))-this.data.getMix(h.animation,i):n=0}return r.delay=n,r},i.prototype.setEmptyAnimation=function(t,s){var n=this.setAnimationWith(t,i.emptyAnimation,!1);return n.mixDuration=s,n.trackEnd=s,n},i.prototype.addEmptyAnimation=function(t,s,n){n<=0&&(n-=s);var h=this.addAnimationWith(t,i.emptyAnimation,!1,n);return h.mixDuration=s,h.trackEnd=s,h},i.prototype.setEmptyAnimations=function(t){this.queue.drainDisabled=!0;for(var i=0,s=this.tracks.length;i<s;i++){var n=this.tracks[i];null!=n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=!1,this.queue.drain()},i.prototype.expandToIndex=function(i){return i<this.tracks.length?this.tracks[i]:(t.Utils.ensureArrayCapacity(this.tracks,i-this.tracks.length+1,null),this.tracks.length=i+1,null)},i.prototype.trackEntry=function(t,i,s,n){var h=this.trackEntryPool.obtain();return h.trackIndex=t,h.animation=i,h.loop=s,h.eventThreshold=0,h.attachmentThreshold=0,h.drawOrderThreshold=0,h.animationStart=0,h.animationEnd=i.duration,h.animationLast=-1,h.nextAnimationLast=-1,h.delay=0,h.trackTime=0,h.trackLast=-1,h.nextTrackLast=-1,h.trackEnd=Number.MAX_VALUE,h.timeScale=1,h.alpha=1,h.mixAlpha=1,h.mixTime=0,h.mixDuration=null==n?0:this.data.getMix(n.animation,i),h},i.prototype.disposeNext=function(t){for(var i=t.next;null!=i;)this.queue.dispose(i),i=i.next;t.next=null},i.prototype._animationsChanged=function(){this.animationsChanged=!1;var t=this.propertyIDs,i=0,s=this.tracks.length;for(t.clear();i<s;i++)if(null!=(n=this.tracks[i])){this.setTimelinesFirst(n),i++;break}for(;i<s;i++){var n=this.tracks[i];null!=n&&this.checkTimelinesFirst(n)}},i.prototype.setTimelinesFirst=function(i){if(null!=i.mixingFrom)return this.setTimelinesFirst(i.mixingFrom),void this.checkTimelinesUsage(i,i.timelinesFirst);for(var s=this.propertyIDs,n=i.animation.timelines,h=n.length,r=t.Utils.setArraySize(i.timelinesFirst,h,!1),e=0;e<h;e++)s.add(n[e].getPropertyId()),r[e]=!0},i.prototype.checkTimelinesFirst=function(t){null!=t.mixingFrom&&this.checkTimelinesFirst(t.mixingFrom),this.checkTimelinesUsage(t,t.timelinesFirst)},i.prototype.checkTimelinesUsage=function(i,s){for(var n=this.propertyIDs,h=i.animation.timelines,r=h.length,e=t.Utils.setArraySize(s,r),c=0;c<r;c++)e[c]=n.add(h[c].getPropertyId())},i.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},i.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},i.prototype.removeListener=function(t){var i=this.listeners.indexOf(t);i>=0&&this.listeners.splice(i,1)},i.prototype.clearListeners=function(){this.listeners.length=0},i.prototype.clearListenerNotifications=function(){this.queue.clear()},i.emptyAnimation=new t.Animation("<empty>",[],0),i}();t.AnimationState=i;var s=function(){function t(){this.timelinesFirst=new Array,this.timelinesRotation=new Array}return t.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.animation=null,this.listener=null,this.timelinesFirst.length=0,this.timelinesRotation.length=0},t.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},t.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},t.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},t.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},t}();t.TrackEntry=s;var n=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(h.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(h.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(h.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(h.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(h.complete),this.objects.push(t)},t.prototype.event=function(t,i){this.objects.push(h.event),this.objects.push(t),this.objects.push(i)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,i=this.animState.listeners,s=0;s<t.length;s+=2){var n=t[s],r=t[s+1];switch(n){case h.start:for(null!=r.listener&&r.listener.start&&r.listener.start(r),c=0;c<i.length;c++)i[c].start&&i[c].start(r);break;case h.interrupt:for(null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r),c=0;c<i.length;c++)i[c].interrupt&&i[c].interrupt(r);break;case h.end:for(null!=r.listener&&r.listener.end&&r.listener.end(r),c=0;c<i.length;c++)i[c].end&&i[c].end(r);case h.dispose:for(null!=r.listener&&r.listener.dispose&&r.listener.dispose(r),c=0;c<i.length;c++)i[c].dispose&&i[c].dispose(r);this.animState.trackEntryPool.free(r);break;case h.complete:for(null!=r.listener&&r.listener.complete&&r.listener.complete(r),c=0;c<i.length;c++)i[c].complete&&i[c].complete(r);break;case h.event:var e=t[2+s++];null!=r.listener&&r.listener.event&&r.listener.event(r,e);for(var c=0;c<i.length;c++)i[c].event&&i[c].event(r,e)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=n,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(t.EventType||(t.EventType={}));var h=t.EventType,r=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,i){},t}();t.AnimationStateAdapter2=r}(h||(h={})),function(t){var i=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,i,s){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var h=this.skeletonData.findAnimation(i);if(null==h)throw new Error("Animation not found: "+i);this.setMixWith(n,h,s)},t.prototype.setMixWith=function(t,i,s){if(null==t)throw new Error("from cannot be null.");if(null==i)throw new Error("to cannot be null.");var n=t.name+i.name;this.animationToMixTime[n]=s},t.prototype.getMix=function(t,i){var s=t.name+i.name,n=this.animationToMixTime[s];return void 0===n?this.defaultMix:n},t}();t.AnimationStateData=i}(h||(h={})),function(t){var i=function(){function t(t,i){void 0===i&&(i=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=i}return t.prototype.loadText=function(t,i,s){var n=this;void 0===i&&(i=null),void 0===s&&(s=null),t=this.pathPrefix+t,this.toLoad++;var h=new XMLHttpRequest;h.onreadystatechange=function(){h.readyState==XMLHttpRequest.DONE&&(h.status>=200&&h.status<300?(n.assets[t]=h.responseText,i&&i(t,h.responseText)):(n.errors[t]="Couldn't load text "+t+": status "+h.status+", "+h.responseText,s&&s(t,"Couldn't load text "+t+": status "+h.status+", "+h.responseText)),n.toLoad--,n.loaded++)},h.open("GET",t,!0),h.send()},t.prototype.loadTexture=function(t,i,s){var n=this;void 0===i&&(i=null),void 0===s&&(s=null),t=this.pathPrefix+t,this.toLoad++;var h=new Image;h.crossOrigin="anonymous",h.src=t,h.onload=function(s){var r=n.textureLoader(h);n.assets[t]=r,n.toLoad--,n.loaded++,i&&i(t,h)},h.onerror=function(i){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,s&&s(t,"Couldn't load image "+t)}},t.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},t.prototype.remove=function(t){t=this.pathPrefix+t;var i=this.assets[t];i.dispose&&i.dispose(),this.assets[t]=null},t.prototype.removeAll=function(){for(var t in this.assets){var i=this.assets[t];i.dispose&&i.dispose()}this.assets={}},t.prototype.isLoadingComplete=function(){return 0==this.toLoad},t.prototype.getToLoad=function(){return this.toLoad},t.prototype.getLoaded=function(){return this.loaded},t.prototype.dispose=function(){this.removeAll()},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.AssetManager=i}(h||(h={})),function(t){var i=function(){function i(t){this.atlas=t}return i.prototype.newRegionAttachment=function(i,s,n){var h=this.atlas.findRegion(n);if(null==h)throw new Error("Region not found in atlas: "+n+" (region attachment: "+s+")");h.renderObject=h;var r=new t.RegionAttachment(s);return r.setRegion(h),r},i.prototype.newMeshAttachment=function(i,s,n){var h=this.atlas.findRegion(n);if(null==h)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+s+")");h.renderObject=h;var r=new t.MeshAttachment(s);return r.region=h,r},i.prototype.newBoundingBoxAttachment=function(i,s){return new t.BoundingBoxAttachment(s)},i.prototype.newPathAttachment=function(i,s){return new t.PathAttachment(s)},i}();t.AtlasAttachmentLoader=i}(h||(h={})),function(t){var i=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=i;var s=function(t){function i(i){t.call(this,i),this.worldVerticesLength=0}return n(i,t),i.prototype.computeWorldVertices=function(t,i){this.computeWorldVerticesWith(t,0,this.worldVerticesLength,i,0)},i.prototype.computeWorldVerticesWith=function(t,i,s,n,h){s+=h;var r=t.bone.skeleton,e=t.attachmentVertices,c=this.vertices,o=this.bones;if(null!=o){for(var u=0,a=0,f=0;f<i;f+=2)u+=(m=o[u])+1,a+=m;var l=r.bones;if(0==e.length)for(var v=h,d=3*a;v<s;v+=2){var p=0,g=0,m=o[u++];for(m+=u;u<m;u++,d+=3){var w=l[o[u]],_=c[d],C=c[d+1],b=c[d+2];p+=(_*w.a+C*w.b+w.worldX)*b,g+=(_*w.c+C*w.d+w.worldY)*b}n[v]=p,n[v+1]=g}else for(var y=e,T=(v=h,d=3*a,a<<1);v<s;v+=2){for(p=0,g=0,m=o[u++],m+=u;u<m;u++,d+=3,T+=2)w=l[o[u]],_=c[d]+y[T],C=c[d+1]+y[T+1],b=c[d+2],p+=(_*w.a+C*w.b+w.worldX)*b,g+=(_*w.c+C*w.d+w.worldY)*b;n[v]=p,n[v+1]=g}}else{e.length>0&&(c=e);var S=(w=t.bone).worldX,A=w.worldY,M=w.a,x=(d=w.b,w.c),E=w.d,O=i;for(v=h;v<s;O+=2,v+=2)_=c[O],C=c[O+1],n[v]=_*M+C*d+S,n[v+1]=_*x+C*E+A}},i.prototype.applyDeform=function(t){return this==t},i}(i);t.VertexAttachment=s}(h||(h={})),function(t){!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path"}(t.AttachmentType||(t.AttachmentType={})),t.AttachmentType}(h||(h={})),function(t){var i=function(i){function s(s){i.call(this,s),this.color=new t.Color(1,1,1,1)}return n(s,i),s}(t.VertexAttachment);t.BoundingBoxAttachment=i}(h||(h={})),function(t){var i=function(i){function s(s){i.call(this,s),this.color=new t.Color(1,1,1,1),this.inheritDeform=!1,this.tempColor=new t.Color(0,0,0,0)}return n(s,i),s.prototype.updateUVs=function(){var i=this.regionUVs,s=i.length,n=8*(s>>1);null!=this.worldVertices&&this.worldVertices.length==n||(this.worldVertices=t.Utils.newFloatArray(n));var h=0,r=0,e=0,c=0;if(null==this.region?(h=r=0,e=c=1):(h=this.region.u,r=this.region.v,e=this.region.u2-h,c=this.region.v2-r),this.region.rotate)for(var o=0,u=6;o<s;o+=2,u+=8)this.worldVertices[u]=h+i[o+1]*e,this.worldVertices[u+1]=r+c-i[o]*c;else for(o=0,u=6;o<s;o+=2,u+=8)this.worldVertices[u]=h+i[o]*e,this.worldVertices[u+1]=r+i[o+1]*c},s.prototype.updateWorldVertices=function(t,i){var s=t.bone.skeleton,n=s.color,h=t.color,r=this.color,e=n.a*h.a*r.a,c=i?e:1,o=this.tempColor;o.set(n.r*h.r*r.r*c,n.g*h.g*r.g*c,n.b*h.b*r.b*c,e);var u=t.attachmentVertices,a=this.vertices,f=this.worldVertices,l=this.bones;if(null==l){var v=a.length;u.length>0&&(a=u);for(var d=(O=t.bone).worldX,p=O.worldY,g=O.a,m=O.b,w=O.c,_=O.d,C=0,b=0;C<v;C+=2,b+=8){var y=a[C],T=a[C+1];f[b]=y*g+T*m+d,f[b+1]=y*w+T*_+p,f[b+2]=o.r,f[b+3]=o.g,f[b+4]=o.b,f[b+5]=o.a}return f}var S=s.bones;if(0==u.length){b=0,C=0,m=0;for(var A=l.length;C<A;b+=8){for(var M=0,x=0,E=l[C++]+C;C<E;C++,m+=3){var O=S[l[C]],P=(y=a[m],T=a[m+1],a[m+2]);M+=(y*O.a+T*O.b+O.worldX)*P,x+=(y*O.c+T*O.d+O.worldY)*P}f[b]=M,f[b+1]=x,f[b+2]=o.r,f[b+3]=o.g,f[b+4]=o.b,f[b+5]=o.a}}else{var R=u,I=(b=0,C=0,m=0,0);for(A=l.length;C<A;b+=8){for(M=0,x=0,E=l[C++]+C;C<E;C++,m+=3,I+=2)O=S[l[C]],y=a[m]+R[I],T=a[m+1]+R[I+1],P=a[m+2],M+=(y*O.a+T*O.b+O.worldX)*P,x+=(y*O.c+T*O.d+O.worldY)*P;f[b]=M,f[b+1]=x,f[b+2]=o.r,f[b+3]=o.g,f[b+4]=o.b,f[b+5]=o.a}}return f},s.prototype.applyDeform=function(t){return this==t||this.inheritDeform&&this.parentMesh==t},s.prototype.getParentMesh=function(){return this.parentMesh},s.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength)},s}(t.VertexAttachment);t.MeshAttachment=i}(h||(h={})),function(t){var i=function(i){function s(s){i.call(this,s),this.closed=!1,this.constantSpeed=!1,this.color=new t.Color(1,1,1,1)}return n(s,i),s}(t.VertexAttachment);t.PathAttachment=i}(h||(h={})),function(t){var i=function(i){function s(s){i.call(this,s),this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new t.Color(1,1,1,1),this.offset=t.Utils.newFloatArray(8),this.vertices=t.Utils.newFloatArray(32),this.tempColor=new t.Color(1,1,1,1)}return n(s,i),s.prototype.setRegion=function(t){var i=this.vertices;t.rotate?(i[s.U2]=t.u,i[s.V2]=t.v2,i[s.U3]=t.u,i[s.V3]=t.v,i[s.U4]=t.u2,i[s.V4]=t.v,i[s.U1]=t.u2,i[s.V1]=t.v2):(i[s.U1]=t.u,i[s.V1]=t.v2,i[s.U2]=t.u,i[s.V2]=t.v,i[s.U3]=t.u2,i[s.V3]=t.v,i[s.U4]=t.u2,i[s.V4]=t.v2),this.region=t},s.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,i=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,h=-this.height/2*this.scaleY+this.region.offsetY*i,r=n+this.region.width*t,e=h+this.region.height*i,c=this.rotation*Math.PI/180,o=Math.cos(c),u=Math.sin(c),a=n*o+this.x,f=n*u,l=h*o+this.y,v=h*u,d=r*o+this.x,p=r*u,g=e*o+this.y,m=e*u,w=this.offset;w[s.OX1]=a-v,w[s.OY1]=l+f,w[s.OX2]=a-m,w[s.OY2]=g+f,w[s.OX3]=d-m,w[s.OY3]=g+p,w[s.OX4]=d-v,w[s.OY4]=l+p},s.prototype.updateWorldVertices=function(t,i){var n=t.bone.skeleton.color,h=t.color,r=this.color,e=n.a*h.a*r.a,c=i?e:1,o=this.tempColor;o.set(n.r*h.r*r.r*c,n.g*h.g*r.g*c,n.b*h.b*r.b*c,e);var u=this.vertices,a=this.offset,f=t.bone,l=f.worldX,v=f.worldY,d=f.a,p=f.b,g=f.c,m=f.d,w=0,_=0;return w=a[s.OX1],_=a[s.OY1],u[s.X1]=w*d+_*p+l,u[s.Y1]=w*g+_*m+v,u[s.C1R]=o.r,u[s.C1G]=o.g,u[s.C1B]=o.b,u[s.C1A]=o.a,w=a[s.OX2],_=a[s.OY2],u[s.X2]=w*d+_*p+l,u[s.Y2]=w*g+_*m+v,u[s.C2R]=o.r,u[s.C2G]=o.g,u[s.C2B]=o.b,u[s.C2A]=o.a,w=a[s.OX3],_=a[s.OY3],u[s.X3]=w*d+_*p+l,u[s.Y3]=w*g+_*m+v,u[s.C3R]=o.r,u[s.C3G]=o.g,u[s.C3B]=o.b,u[s.C3A]=o.a,w=a[s.OX4],_=a[s.OY4],u[s.X4]=w*d+_*p+l,u[s.Y4]=w*g+_*m+v,u[s.C4R]=o.r,u[s.C4G]=o.g,u[s.C4B]=o.b,u[s.C4A]=o.a,u},s.OX1=0,s.OY1=1,s.OX2=2,s.OY2=3,s.OX3=4,s.OY3=5,s.OX4=6,s.OY4=7,s.X1=0,s.Y1=1,s.C1R=2,s.C1G=3,s.C1B=4,s.C1A=5,s.U1=6,s.V1=7,s.X2=8,s.Y2=9,s.C2R=10,s.C2G=11,s.C2B=12,s.C2A=13,s.U2=14,s.V2=15,s.X3=16,s.Y3=17,s.C3R=18,s.C3G=19,s.C3B=20,s.C3A=21,s.U3=22,s.V3=23,s.X4=24,s.Y4=25,s.C4R=26,s.C4G=27,s.C4B=28,s.C4A=29,s.U4=30,s.V4=31,s}(t.Attachment);t.RegionAttachment=i}(h||(h={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={})),t.BlendMode}(h||(h={})),function(t){var i=function(){function i(t,i,s){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.worldX=0,this.c=0,this.d=0,this.worldY=0,this.sorted=!1,null==t)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=i,this.parent=s,this.setToSetupPose()}return i.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},i.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},i.prototype.updateWorldTransformWith=function(i,s,n,h,r,e,c){this.ax=i,this.ay=s,this.arotation=n,this.ascaleX=h,this.ascaleY=r,this.ashearX=e,this.ashearY=c,this.appliedValid=!0;var o=this.parent;if(null==o){var u=n+90+c,a=t.MathUtils.cosDeg(n+e)*h,f=t.MathUtils.cosDeg(u)*r,l=t.MathUtils.sinDeg(n+e)*h,v=t.MathUtils.sinDeg(u)*r,d=this.skeleton;return d.flipX&&(i=-i,a=-a,f=-f),d.flipY&&(s=-s,l=-l,v=-v),this.a=a,this.b=f,this.c=l,this.d=v,this.worldX=i+d.x,void(this.worldY=s+d.y)}var p=o.a,g=o.b,m=o.c,w=o.d;switch(this.worldX=p*i+g*s+o.worldX,this.worldY=m*i+w*s+o.worldY,this.data.transformMode){case t.TransformMode.Normal:return u=n+90+c,a=t.MathUtils.cosDeg(n+e)*h,f=t.MathUtils.cosDeg(u)*r,l=t.MathUtils.sinDeg(n+e)*h,v=t.MathUtils.sinDeg(u)*r,this.a=p*a+g*l,this.b=p*f+g*v,this.c=m*a+w*l,void(this.d=m*f+w*v);case t.TransformMode.OnlyTranslation:u=n+90+c,this.a=t.MathUtils.cosDeg(n+e)*h,this.b=t.MathUtils.cosDeg(u)*r,this.c=t.MathUtils.sinDeg(n+e)*h,this.d=t.MathUtils.sinDeg(u)*r;break;case t.TransformMode.NoRotationOrReflection:var _=0;(M=p*p+m*m)>1e-4?(g=m*(M=Math.abs(p*w-g*m)/M),w=p*M,_=Math.atan2(m,p)*t.MathUtils.radDeg):(p=0,m=0,_=90-Math.atan2(w,g)*t.MathUtils.radDeg);var C=n+e-_,b=n+c-_+90;a=t.MathUtils.cosDeg(C)*h,f=t.MathUtils.cosDeg(b)*r,l=t.MathUtils.sinDeg(C)*h,v=t.MathUtils.sinDeg(b)*r,this.a=p*a-g*l,this.b=p*f-g*v,this.c=m*a+w*l,this.d=m*f+w*v;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var y=t.MathUtils.cosDeg(n),T=t.MathUtils.sinDeg(n),S=p*y+g*T,A=m*y+w*T,M=Math.sqrt(S*S+A*A);M>1e-5&&(M=1/M),S*=M,A*=M,M=Math.sqrt(S*S+A*A);var x=Math.PI/2+Math.atan2(A,S),E=Math.cos(x)*M,O=Math.sin(x)*M;return a=t.MathUtils.cosDeg(e)*h,f=t.MathUtils.cosDeg(90+c)*r,l=t.MathUtils.sinDeg(e)*h,v=t.MathUtils.sinDeg(90+c)*r,this.a=S*a+E*l,this.b=S*f+E*v,this.c=A*a+O*l,this.d=A*f+O*v,void((this.data.transformMode!=t.TransformMode.NoScaleOrReflection?p*w-g*m<0:this.skeleton.flipX!=this.skeleton.flipY)&&(this.b=-this.b,this.d=-this.d))}this.skeleton.flipX&&(this.a=-this.a,this.b=-this.b),this.skeleton.flipY&&(this.c=-this.c,this.d=-this.d)},i.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},i.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},i.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},i.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},i.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},i.prototype.worldToLocalRotationX=function(){var i=this.parent;if(null==i)return this.arotation;var s=i.a,n=i.b,h=i.c,r=i.d,e=this.a,c=this.c;return Math.atan2(s*c-h*e,r*e-n*c)*t.MathUtils.radDeg},i.prototype.worldToLocalRotationY=function(){var i=this.parent;if(null==i)return this.arotation;var s=i.a,n=i.b,h=i.c,r=i.d,e=this.b,c=this.d;return Math.atan2(s*c-h*e,r*e-n*c)*t.MathUtils.radDeg},i.prototype.rotateWorld=function(i){var s=this.a,n=this.b,h=this.c,r=this.d,e=t.MathUtils.cosDeg(i),c=t.MathUtils.sinDeg(i);this.a=e*s-c*h,this.b=e*n-c*r,this.c=c*s+e*h,this.d=c*n+e*r,this.appliedValid=!1},i.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var i=this.parent;if(null==i)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var s=i.a,n=i.b,h=i.c,r=i.d,e=1/(s*r-n*h),c=this.worldX-i.worldX,o=this.worldY-i.worldY;this.ax=c*r*e-o*n*e,this.ay=o*s*e-c*h*e;var u=e*r,a=e*s,f=e*n,l=e*h,v=u*this.a-f*this.c,d=u*this.b-f*this.d,p=a*this.c-l*this.a,g=a*this.d-l*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(v*v+p*p),this.ascaleX>1e-4){var m=v*g-d*p;this.ascaleY=m/this.ascaleX,this.ashearY=Math.atan2(v*d+p*g,m)*t.MathUtils.radDeg,this.arotation=Math.atan2(p,v)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(d*d+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,d)*t.MathUtils.radDeg},i.prototype.worldToLocal=function(t){var i=this.a,s=this.b,n=this.c,h=this.d,r=1/(i*h-s*n),e=t.x-this.worldX,c=t.y-this.worldY;return t.x=e*h*r-c*s*r,t.y=c*i*r-e*n*r,t},i.prototype.localToWorld=function(t){var i=t.x,s=t.y;return t.x=i*this.a+s*this.b+this.worldX,t.y=i*this.c+s*this.d+this.worldY,t},i}();t.Bone=i}(h||(h={})),function(t){t.BoneData=function(t,s,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=i.Normal,t<0)throw new Error("index must be >= 0.");if(null==s)throw new Error("name cannot be null.");this.index=t,this.name=s,this.parent=n},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(t.TransformMode||(t.TransformMode={}));var i=t.TransformMode}(h||(h={})),(h||(h={})).Event=function(t,i){if(null==i)throw new Error("data cannot be null.");this.time=t,this.data=i},(h||(h={})).EventData=function(t){this.name=t},function(t){var i=function(){function i(t,i){if(this.mix=1,this.bendDirection=0,null==t)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=new Array;for(var s=0;s<t.bones.length;s++)this.bones.push(i.findBone(t.bones[s].name));this.target=i.findBone(t.target.name)}return i.prototype.getOrder=function(){return this.data.order},i.prototype.apply=function(){this.update()},i.prototype.update=function(){var t=this.target,i=this.bones;switch(i.length){case 1:this.apply1(i[0],t.worldX,t.worldY,this.mix);break;case 2:this.apply2(i[0],i[1],t.worldX,t.worldY,this.bendDirection,this.mix)}},i.prototype.apply1=function(i,s,n,h){i.appliedValid||i.updateAppliedTransform();var r=i.parent,e=1/(r.a*r.d-r.b*r.c),c=s-r.worldX,o=n-r.worldY,u=(c*r.d-o*r.b)*e-i.ax,a=(o*r.a-c*r.c)*e-i.ay,f=Math.atan2(a,u)*t.MathUtils.radDeg-i.ashearX-i.arotation;i.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360),i.updateWorldTransformWith(i.ax,i.ay,i.arotation+f*h,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)},i.prototype.apply2=function(i,s,n,h,r,e){if(0!=e){i.appliedValid||i.updateAppliedTransform(),s.appliedValid||s.updateAppliedTransform();var c=i.ax,o=i.ay,u=i.ascaleX,a=i.ascaleY,f=s.ascaleX,l=0,v=0,d=0;u<0?(u=-u,l=180,d=-1):(l=0,d=1),a<0&&(a=-a,d=-d),f<0?(f=-f,v=180):v=0;var p=s.ax,g=0,m=0,w=0,_=i.a,C=i.b,b=i.c,y=i.d,T=Math.abs(u-a)<=1e-4;T?(m=_*p+C*(g=s.ay)+i.worldX,w=b*p+y*g+i.worldY):(g=0,m=_*p+i.worldX,w=b*p+i.worldY);var S=i.parent;_=S.a,C=S.b,b=S.c;var A=1/(_*(y=S.d)-C*b),M=n-S.worldX,x=h-S.worldY,E=(M*y-x*C)*A-c,O=(x*_-M*b)*A-o,P=((M=m-S.worldX)*y-(x=w-S.worldY)*C)*A-c,R=(x*_-M*b)*A-o,I=Math.sqrt(P*P+R*R),L=s.data.length*f,D=0,F=0;t:if(T){var N=(E*E+O*O-I*I-(L*=u)*L)/(2*I*L);N<-1?N=-1:N>1&&(N=1),F=Math.acos(N)*r,_=I+L*N,C=L*Math.sin(F),D=Math.atan2(O*_-E*C,E*_+O*C)}else{var k=(_=u*L)*_,B=(C=a*L)*C,G=E*E+O*O,z=Math.atan2(O,E),j=-2*B*I,V=B-k;if((y=j*j-4*V*(b=B*I*I+k*G-k*B))>=0){var U=Math.sqrt(y);j<0&&(U=-U);var W=(U=-(j+U)/2)/V,H=b/U,X=Math.abs(W)<Math.abs(H)?W:H;if(X*X<=G){x=Math.sqrt(G-X*X)*r,D=z-Math.atan2(x,X),F=Math.atan2(x/a,(X-I)/u);break t}}var J=0,Y=Number.MAX_VALUE,q=0,Z=0,Q=0,K=0,$=0,tt=0;(y=(M=I+_)*M)>K&&(Q=0,K=y,$=M),(y=(M=I-_)*M)<Y&&(J=t.MathUtils.PI,Y=y,q=M);var it=Math.acos(-_*I/(k-B));(y=(M=_*Math.cos(it)+I)*M+(x=C*Math.sin(it))*x)<Y&&(J=it,Y=y,q=M,Z=x),y>K&&(Q=it,K=y,$=M,tt=x),G<=(Y+K)/2?(D=z-Math.atan2(Z*r,q),F=J*r):(D=z-Math.atan2(tt*r,$),F=Q*r)}var st=Math.atan2(g,p)*d,nt=i.arotation;(D=(D-st)*t.MathUtils.radDeg+l-nt)>180?D-=360:D<-180&&(D+=360),i.updateWorldTransformWith(c,o,nt+D*e,i.ascaleX,i.ascaleY,0,0),nt=s.arotation,(F=((F+st)*t.MathUtils.radDeg-s.ashearX)*d+v-nt)>180?F-=360:F<-180&&(F+=360),s.updateWorldTransformWith(p,g,nt+F*e,s.ascaleX,s.ascaleY,s.ashearX,s.ashearY)}else s.updateWorldTransform()},i}();t.IkConstraint=i}(h||(h={})),(h||(h={})).IkConstraintData=function(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.mix=1,this.name=t},function(t){var i=function(){function i(t,i){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var s=0,n=t.bones.length;s<n;s++)this.bones.push(i.findBone(t.bones[s].name));this.target=i.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return i.prototype.apply=function(){this.update()},i.prototype.update=function(){var i=this.target.getAttachment();if(i instanceof t.PathAttachment){var s=this.rotateMix,n=this.translateMix,h=s>0;if(n>0||h){var r=this.data,e=r.spacingMode,c=e==t.SpacingMode.Length,o=r.rotateMode,u=o==t.RotateMode.Tangent,a=o==t.RotateMode.ChainScale,f=this.bones.length,l=u?f:f+1,v=this.bones,d=t.Utils.setArraySize(this.spaces,l),p=null,g=this.spacing;if(a||c){a&&(p=t.Utils.setArraySize(this.lengths,f));for(var m=0,w=l-1;m<w;){var _=(E=v[m]).data.length,C=_*E.a,b=_*E.c;_=Math.sqrt(C*C+b*b),a&&(p[m]=_),d[++m]=c?Math.max(0,_+g):g}}else for(m=1;m<l;m++)d[m]=g;var y=this.computeWorldPositions(i,l,u,r.positionMode==t.PositionMode.Percent,e==t.SpacingMode.Percent),T=y[0],S=y[1],A=r.offsetRotation,M=!1;0==A?M=o==t.RotateMode.Chain:(M=!1,A*=(x=this.target.bone).a*x.d-x.b*x.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),m=0;for(var x=3;m<f;m++,x+=3){var E=v[m];E.worldX+=(T-E.worldX)*n,E.worldY+=(S-E.worldY)*n;var O=(C=y[x])-T,P=(b=y[x+1])-S;if(a){var R=p[m];if(0!=R){var I=(Math.sqrt(O*O+P*P)/R-1)*s+1;E.a*=I,E.c*=I}}if(T=C,S=b,h){var L=E.a,D=E.b,F=E.c,N=E.d,k=0,B=0,G=0;if(k=u?y[x-1]:0==d[m+1]?y[x+2]:Math.atan2(P,O),k-=Math.atan2(F,L),M){B=Math.cos(k),G=Math.sin(k);var z=E.data.length;T+=(z*(B*L-G*F)-O)*s,S+=(z*(G*L+B*F)-P)*s}else k+=A;k>t.MathUtils.PI?k-=t.MathUtils.PI2:k<-t.MathUtils.PI&&(k+=t.MathUtils.PI2),k*=s,B=Math.cos(k),G=Math.sin(k),E.a=B*L-G*F,E.b=B*D-G*N,E.c=G*L+B*F,E.d=G*D+B*N}E.appliedValid=!1}}}},i.prototype.computeWorldPositions=function(s,n,h,r,e){var c=this.target,o=this.position,u=this.spaces,a=t.Utils.setArraySize(this.positions,3*n+2),f=null,l=s.closed,v=s.worldVerticesLength,d=v/6,p=i.NONE;if(!s.constantSpeed){var g=s.lengths,m=g[d-=l?1:2];if(r&&(o*=m),e)for(w=0;w<n;w++)u[w]*=m;f=t.Utils.setArraySize(this.world,8);for(var w=0,_=0,C=0;w<n;w++,_+=3){if(H=o+=W=u[w],l)(H%=m)<0&&(H+=m),C=0;else{if(H<0){p!=i.BEFORE&&(p=i.BEFORE,s.computeWorldVerticesWith(c,2,4,f,0)),this.addBeforePosition(H,f,0,a,_);continue}if(H>m){p!=i.AFTER&&(p=i.AFTER,s.computeWorldVerticesWith(c,v-6,4,f,0)),this.addAfterPosition(H-m,f,0,a,_);continue}}for(;;C++){var b=g[C];if(!(H>b)){0==C?H/=b:H=(H-(q=g[C-1]))/(b-q);break}}C!=p&&(p=C,l&&C==d?(s.computeWorldVerticesWith(c,v-4,4,f,0),s.computeWorldVerticesWith(c,0,4,f,4)):s.computeWorldVerticesWith(c,6*C+2,8,f,0)),this.addCurvePosition(H,f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],a,_,h||w>0&&0==W)}return a}l?(v+=2,f=t.Utils.setArraySize(this.world,v),s.computeWorldVerticesWith(c,2,v-4,f,0),s.computeWorldVerticesWith(c,0,2,f,v-4),f[v-2]=f[0],f[v-1]=f[1]):(d--,v-=4,f=t.Utils.setArraySize(this.world,v),s.computeWorldVerticesWith(c,2,v,f,0));for(var y=t.Utils.setArraySize(this.curves,d),T=0,S=f[0],A=f[1],M=0,x=0,E=0,O=0,P=0,R=0,I=0,L=0,D=0,F=0,N=0,k=0,B=0,G=0,z=(w=0,2);w<d;w++,z+=6)M=f[z],x=f[z+1],E=f[z+2],O=f[z+3],N=2*(I=.1875*(S-2*M+E))+(D=.09375*(3*(M-E)-S+(P=f[z+4]))),k=2*(L=.1875*(A-2*x+O))+(F=.09375*(3*(x-O)-A+(R=f[z+5]))),B=.75*(M-S)+I+.16666667*D,G=.75*(x-A)+L+.16666667*F,T+=Math.sqrt(B*B+G*G),B+=N,G+=k,N+=D,k+=F,T+=Math.sqrt(B*B+G*G),B+=N,G+=k,T+=Math.sqrt(B*B+G*G),B+=N+D,G+=k+F,T+=Math.sqrt(B*B+G*G),y[w]=T,S=P,A=R;if(r&&(o*=T),e)for(w=0;w<n;w++)u[w]*=T;for(var j=this.segments,V=0,U=(w=0,_=0,C=0,0);w<n;w++,_+=3){var W=u[w],H=o+=W;if(l)(H%=T)<0&&(H+=T),C=0;else{if(H<0){this.addBeforePosition(H,f,0,a,_);continue}if(H>T){this.addAfterPosition(H-T,f,v-4,a,_);continue}}for(;;C++){var X=y[C];if(!(H>X)){0==C?H/=X:H=(H-(q=y[C-1]))/(X-q);break}}if(C!=p){p=C;var J=6*C;for(S=f[J],A=f[J+1],M=f[J+2],x=f[J+3],E=f[J+4],O=f[J+5],N=2*(I=.03*(S-2*M+E))+(D=.006*(3*(M-E)-S+(P=f[J+6]))),k=2*(L=.03*(A-2*x+O))+(F=.006*(3*(x-O)-A+(R=f[J+7]))),B=.3*(M-S)+I+.16666667*D,G=.3*(x-A)+L+.16666667*F,V=Math.sqrt(B*B+G*G),j[0]=V,J=1;J<8;J++)B+=N,G+=k,N+=D,k+=F,V+=Math.sqrt(B*B+G*G),j[J]=V;B+=N,G+=k,V+=Math.sqrt(B*B+G*G),j[8]=V,B+=N+D,G+=k+F,V+=Math.sqrt(B*B+G*G),j[9]=V,U=0}for(H*=V;;U++){var Y=j[U];if(!(H>Y)){if(0==U)H/=Y;else{var q=j[U-1];H=U+(H-q)/(Y-q)}break}}this.addCurvePosition(.1*H,S,A,M,x,E,O,P,R,a,_,h||w>0&&0==W)}return a},i.prototype.addBeforePosition=function(t,i,s,n,h){var r=i[s],e=i[s+1],c=i[s+2]-r,o=i[s+3]-e,u=Math.atan2(o,c);n[h]=r+t*Math.cos(u),n[h+1]=e+t*Math.sin(u),n[h+2]=u},i.prototype.addAfterPosition=function(t,i,s,n,h){var r=i[s+2],e=i[s+3],c=r-i[s],o=e-i[s+1],u=Math.atan2(o,c);n[h]=r+t*Math.cos(u),n[h+1]=e+t*Math.sin(u),n[h+2]=u},i.prototype.addCurvePosition=function(t,i,s,n,h,r,e,c,o,u,a,f){(0==t||isNaN(t))&&(t=1e-4);var l=t*t,v=l*t,d=1-t,p=d*d,g=p*d,m=d*t,w=3*m,_=d*w,C=w*t,b=i*g+n*_+r*C+c*v,y=s*g+h*_+e*C+o*v;u[a]=b,u[a+1]=y,f&&(u[a+2]=Math.atan2(y-(s*p+h*m*2+e*l),b-(i*p+n*m*2+r*l)))},i.prototype.getOrder=function(){return this.data.order},i.NONE=-1,i.BEFORE=-2,i.AFTER=-3,i}();t.PathConstraint=i}(h||(h={})),function(t){t.PathConstraintData=function(t){this.order=0,this.bones=new Array,this.name=t},function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(t.PositionMode||(t.PositionMode={})),t.PositionMode,function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(t.SpacingMode||(t.SpacingMode={})),t.SpacingMode,function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(t.RotateMode||(t.RotateMode={})),t.RotateMode}(h||(h={})),function(t){var i=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var i in this.assets)t++;return t},t}(),s=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,s,n){var h=this.clientAssets[t];return null!==h&&void 0!==h||(h=new i(t),this.clientAssets[t]=h),null!==s&&(h.textureLoader=s),h.toLoad.push(n),this.queuedAssets[n]!==n&&(this.queuedAssets[n]=n,!0)},t.prototype.loadText=function(t,i){var s=this;if(i=this.pathPrefix+i,this.queueAsset(t,null,i)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(n.status>=200&&n.status<300?s.rawAssets[i]=n.responseText:s.errors[i]="Couldn't load text "+i+": status "+n.status+", "+n.responseText)},n.open("GET",i,!0),n.send()}},t.prototype.loadJson=function(t,i){var s=this;if(i=this.pathPrefix+i,this.queueAsset(t,null,i)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(n.status>=200&&n.status<300?s.rawAssets[i]=JSON.parse(n.responseText):s.errors[i]="Couldn't load text "+i+": status "+n.status+", "+n.responseText)},n.open("GET",i,!0),n.send()}},t.prototype.loadTexture=function(t,i,s){var n=this;if(s=this.pathPrefix+s,this.queueAsset(t,i,s)){var h=new Image;h.src=s,h.crossOrigin="anonymous",h.onload=function(t){n.rawAssets[s]=h},h.onerror=function(t){n.errors[s]="Couldn't load image "+s}}},t.prototype.get=function(t,i){i=this.pathPrefix+i;var s=this.clientAssets[t];return null===s||void 0===s||s.assets[i]},t.prototype.updateClientAssets=function(t){for(var i=0;i<t.toLoad.length;i++){var s=t.toLoad[i],n=t.assets[s];if(null===n||void 0===n){var h=this.rawAssets[s];if(null===h||void 0===h)continue;h instanceof HTMLImageElement?t.assets[s]=t.textureLoader(h):t.assets[s]=h}}},t.prototype.isLoadingComplete=function(t){var i=this.clientAssets[t];return null===i||void 0===i||(this.updateClientAssets(i),i.toLoad.length==i.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=s}(h||(h={})),function(t){var i=function(){function i(i){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.flipX=!1,this.flipY=!1,this.x=0,this.y=0,null==i)throw new Error("data cannot be null.");for(this.data=i,this.bones=new Array,u=0;u<i.bones.length;u++){var s=i.bones[u],n=void 0;if(null==s.parent)n=new t.Bone(s,this,null);else{var h=this.bones[s.parent.index];n=new t.Bone(s,this,h),h.children.push(n)}this.bones.push(n)}for(this.slots=new Array,this.drawOrder=new Array,u=0;u<i.slots.length;u++){var r=i.slots[u],e=(n=this.bones[r.boneData.index],new t.Slot(r,n));this.slots.push(e),this.drawOrder.push(e)}for(this.ikConstraints=new Array,u=0;u<i.ikConstraints.length;u++){var c=i.ikConstraints[u];this.ikConstraints.push(new t.IkConstraint(c,this))}for(this.transformConstraints=new Array,u=0;u<i.transformConstraints.length;u++){var o=i.transformConstraints[u];this.transformConstraints.push(new t.TransformConstraint(o,this))}this.pathConstraints=new Array;for(var u=0;u<i.pathConstraints.length;u++){var a=i.pathConstraints[u];this.pathConstraints.push(new t.PathConstraint(a,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return i.prototype.updateCache=function(){this._updateCache.length=0;for(var t=this.bones,i=0,s=t.length;i<s;i++)t[i].sorted=!1;var n=this.ikConstraints,h=this.transformConstraints,r=this.pathConstraints,e=n.length,c=h.length,o=r.length,u=e+c+o;t:for(i=0;i<u;i++){for(a=0;a<e;a++)if((f=n[a]).data.order==i){this.sortIkConstraint(f);continue t}for(a=0;a<c;a++)if((f=h[a]).data.order==i){this.sortTransformConstraint(f);continue t}for(var a=0;a<o;a++){var f=r[a];if(f.data.order==i){this.sortPathConstraint(f);continue t}}}for(i=0,s=t.length;i<s;i++)this.sortBone(t[i])},i.prototype.sortIkConstraint=function(t){var i=t.target;this.sortBone(i);var s=t.bones,n=s[0];if(this.sortBone(n),s.length>1){var h=s[s.length-1];this._updateCache.indexOf(h)>-1||this.updateCacheReset.push(h)}this._updateCache.push(t),this.sortReset(n.children),s[s.length-1].sorted=!0},i.prototype.sortPathConstraint=function(i){var s=i.target,n=s.data.index,h=s.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,h),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,h);for(var r=0,e=this.data.skins.length;r<e;r++)this.sortPathConstraintAttachment(this.data.skins[r],n,h);var c=s.getAttachment();c instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(c,h);var o=i.bones,u=o.length;for(r=0;r<u;r++)this.sortBone(o[r]);for(this._updateCache.push(i),r=0;r<u;r++)this.sortReset(o[r].children);for(r=0;r<u;r++)o[r].sorted=!0},i.prototype.sortTransformConstraint=function(t){this.sortBone(t.target);for(var i=t.bones,s=i.length,n=0;n<s;n++)this.sortBone(i[n]);for(this._updateCache.push(t),n=0;n<s;n++)this.sortReset(i[n].children);for(n=0;n<s;n++)i[n].sorted=!0},i.prototype.sortPathConstraintAttachment=function(t,i,s){var n=t.attachments[i];if(n)for(var h in n)this.sortPathConstraintAttachmentWith(n[h],s)},i.prototype.sortPathConstraintAttachmentWith=function(i,s){if(i instanceof t.PathAttachment){var n=i.bones;if(null==n)this.sortBone(s);else for(var h=this.bones,r=0;r<n.length;)for(var e=n[r++],c=r+e;r<c;r++){var o=n[r];this.sortBone(h[o])}}},i.prototype.sortBone=function(t){if(!t.sorted){var i=t.parent;null!=i&&this.sortBone(i),t.sorted=!0,this._updateCache.push(t)}},i.prototype.sortReset=function(t){for(var i=0,s=t.length;i<s;i++){var n=t[i];n.sorted&&this.sortReset(n.children),n.sorted=!1}},i.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,i=0,s=t.length;i<s;i++){var n=t[i];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}var h=this._updateCache;for(i=0,s=h.length;i<s;i++)h[i].update()},i.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},i.prototype.setBonesToSetupPose=function(){for(var t=this.bones,i=0,s=t.length;i<s;i++)t[i].setToSetupPose();var n=this.ikConstraints;for(i=0,s=n.length;i<s;i++)(e=n[i]).bendDirection=e.data.bendDirection,e.mix=e.data.mix;var h=this.transformConstraints;for(i=0,s=h.length;i<s;i++)c=(e=h[i]).data,e.rotateMix=c.rotateMix,e.translateMix=c.translateMix,e.scaleMix=c.scaleMix,e.shearMix=c.shearMix;var r=this.pathConstraints;for(i=0,s=r.length;i<s;i++){var e=r[i],c=e.data;e.position=c.position,e.spacing=c.spacing,e.rotateMix=c.rotateMix,e.translateMix=c.translateMix}},i.prototype.setSlotsToSetupPose=function(){var i=this.slots;t.Utils.arrayCopy(i,0,this.drawOrder,0,i.length);for(var s=0,n=i.length;s<n;s++)i[s].setToSetupPose()},i.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},i.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var i=this.bones,s=0,n=i.length;s<n;s++){var h=i[s];if(h.data.name==t)return h}return null},i.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var i=this.bones,s=0,n=i.length;s<n;s++)if(i[s].data.name==t)return s;return-1},i.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,s=0,n=i.length;s<n;s++){var h=i[s];if(h.data.name==t)return h}return null},i.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,s=0,n=i.length;s<n;s++)if(i[s].data.name==t)return s;return-1},i.prototype.setSkinByName=function(t){var i=this.data.findSkin(t);if(null==i)throw new Error("Skin not found: "+t);this.setSkin(i)},i.prototype.setSkin=function(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var i=this.slots,s=0,n=i.length;s<n;s++){var h=i[s],r=h.data.attachmentName;if(null!=r){var e=t.getAttachment(s,r);null!=e&&h.setAttachment(e)}}this.skin=t},i.prototype.getAttachmentByName=function(t,i){return this.getAttachment(this.data.findSlotIndex(t),i)},i.prototype.getAttachment=function(t,i){if(null==i)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var s=this.skin.getAttachment(t,i);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,i):null},i.prototype.setAttachment=function(t,i){if(null==t)throw new Error("slotName cannot be null.");for(var s=this.slots,n=0,h=s.length;n<h;n++){var r=s[n];if(r.data.name==t){var e=null;if(null!=i&&null==(e=this.getAttachment(n,i)))throw new Error("Attachment not found: "+i+", for slot: "+t);return void r.setAttachment(e)}}throw new Error("Slot not found: "+t)},i.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.ikConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.data.name==t)return h}return null},i.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.transformConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.data.name==t)return h}return null},i.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.pathConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.data.name==t)return h}return null},i.prototype.getBounds=function(i,s){if(null==i)throw new Error("offset cannot be null.");if(null==s)throw new Error("size cannot be null.");for(var n=this.drawOrder,h=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,o=0,u=n.length;o<u;o++){var a=n[o],f=null,l=a.getAttachment();if(l instanceof t.RegionAttachment?f=l.updateWorldVertices(a,!1):l instanceof t.MeshAttachment&&(f=l.updateWorldVertices(a,!0)),null!=f)for(var v=0,d=f.length;v<d;v+=8){var p=f[v],g=f[v+1];h=Math.min(h,p),r=Math.min(r,g),e=Math.max(e,p),c=Math.max(c,g)}}i.set(h,r),s.set(e-h,c-r)},i.prototype.update=function(t){this.time+=t},i}();t.Skeleton=i}(h||(h={})),function(t){var i=function(){function i(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool(function(){return t.Utils.newFloatArray(16)})}return i.prototype.update=function(i,s){if(null==i)throw new Error("skeleton cannot be null.");var n=this.boundingBoxes,h=this.polygons,r=this.polygonPool,e=i.slots,c=e.length;n.length=0,r.freeAll(h),h.length=0;for(var o=0;o<c;o++){var u=e[o],a=u.getAttachment();if(a instanceof t.BoundingBoxAttachment){var f=a;n.push(f);var l=r.obtain();l.length!=f.worldVerticesLength&&(l=t.Utils.newFloatArray(f.worldVerticesLength)),h.push(l),f.computeWorldVertices(u,l)}}s?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},i.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,h=this.polygons,r=0,e=h.length;r<e;r++)for(var c=h[r],o=c,u=0,a=c.length;u<a;u+=2){var f=o[u],l=o[u+1];t=Math.min(t,f),i=Math.min(i,l),s=Math.max(s,f),n=Math.max(n,l)}this.minX=t,this.minY=i,this.maxX=s,this.maxY=n},i.prototype.aabbContainsPoint=function(t,i){return t>=this.minX&&t<=this.maxX&&i>=this.minY&&i<=this.maxY},i.prototype.aabbIntersectsSegment=function(t,i,s,n){var h=this.minX,r=this.minY,e=this.maxX,c=this.maxY;if(t<=h&&s<=h||i<=r&&n<=r||t>=e&&s>=e||i>=c&&n>=c)return!1;var o=(n-i)/(s-t),u=o*(h-t)+i;if(u>r&&u<c)return!0;if((u=o*(e-t)+i)>r&&u<c)return!0;var a=(r-i)/o+t;return a>h&&a<e||(a=(c-i)/o+t)>h&&a<e},i.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},i.prototype.containsPoint=function(t,i){for(var s=this.polygons,n=0,h=s.length;n<h;n++)if(this.containsPointPolygon(s[n],t,i))return this.boundingBoxes[n];return null},i.prototype.containsPointPolygon=function(t,i,s){for(var n=t,h=t.length,r=h-2,e=!1,c=0;c<h;c+=2){var o=n[c+1],u=n[r+1];if(o<s&&u>=s||u<s&&o>=s){var a=n[c];a+(s-o)/(u-o)*(n[r]-a)<i&&(e=!e)}r=c}return e},i.prototype.intersectsSegment=function(t,i,s,n){for(var h=this.polygons,r=0,e=h.length;r<e;r++)if(this.intersectsSegmentPolygon(h[r],t,i,s,n))return this.boundingBoxes[r];return null},i.prototype.intersectsSegmentPolygon=function(t,i,s,n,h){for(var r=t,e=t.length,c=i-n,o=s-h,u=i*h-s*n,a=r[e-2],f=r[e-1],l=0;l<e;l+=2){var v=r[l],d=r[l+1],p=a*d-f*v,g=a-v,m=f-d,w=c*m-o*g,_=(u*g-c*p)/w;if((_>=a&&_<=v||_>=v&&_<=a)&&(_>=i&&_<=n||_>=n&&_<=i)){var C=(u*m-o*p)/w;if((C>=f&&C<=d||C>=d&&C<=f)&&(C>=s&&C<=h||C>=h&&C<=s))return!0}a=v,f=d}return!1},i.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var i=this.boundingBoxes.indexOf(t);return-1==i?null:this.polygons[i]},i.prototype.getWidth=function(){return this.maxX-this.minX},i.prototype.getHeight=function(){return this.maxY-this.minY},i}();t.SkeletonBounds=i}(h||(h={})),function(t){var i=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var i=this.bones,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var i=this.bones,s=0,n=i.length;s<n;s++)if(i[s].name==t)return s;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,s=0,n=i.length;s<n;s++)if(i[s].name==t)return s;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var i=this.skins,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var i=this.events,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var i=this.animations,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.ikConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.transformConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var i=this.pathConstraints,s=0,n=i.length;s<n;s++){var h=i[s];if(h.name==t)return h}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var i=this.pathConstraints,s=0,n=i.length;s<n;s++)if(i[s].name==t)return s;return-1},t}();t.SkeletonData=i}(h||(h={})),function(t){var i=function(){function i(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return i.prototype.readSkeletonData=function(s){var n=this.scale,h=new t.SkeletonData,r="string"==typeof s?JSON.parse(s):s,e=r.skeleton;if(null!=e&&(h.hash=e.hash,h.version=e.spine,h.width=e.width,h.height=e.height,h.fps=e.fps,h.imagesPath=e.images),r.bones)for(M=0;M<r.bones.length;M++){var c=r.bones[M],o=null,u=this.getValue(c,"parent",null);if(null!=u&&null==(o=h.findBone(u)))throw new Error("Parent bone not found: "+u);(v=new t.BoneData(h.bones.length,c.name,o)).length=this.getValue(c,"length",0)*n,v.x=this.getValue(c,"x",0)*n,v.y=this.getValue(c,"y",0)*n,v.rotation=this.getValue(c,"rotation",0),v.scaleX=this.getValue(c,"scaleX",1),v.scaleY=this.getValue(c,"scaleY",1),v.shearX=this.getValue(c,"shearX",0),v.shearY=this.getValue(c,"shearY",0),v.transformMode=i.transformModeFromString(this.getValue(c,"transform","normal")),h.bones.push(v)}if(r.slots)for(M=0;M<r.slots.length;M++){var a=(T=r.slots[M]).name,f=T.bone,l=h.findBone(f);if(null==l)throw new Error("Slot bone not found: "+f);var v=new t.SlotData(h.slots.length,a,l),d=this.getValue(T,"color",null);null!=d&&v.color.setFromString(d),v.attachmentName=this.getValue(T,"attachment",null),v.blendMode=i.blendModeFromString(this.getValue(T,"blend","normal")),h.slots.push(v)}if(r.ik)for(M=0;M<r.ik.length;M++){for(p=r.ik[M],(v=new t.IkConstraintData(p.name)).order=this.getValue(p,"order",0),g=0;g<p.bones.length;g++){if(f=p.bones[g],null==(m=h.findBone(f)))throw new Error("IK bone not found: "+f);v.bones.push(m)}if(w=p.target,v.target=h.findBone(w),null==v.target)throw new Error("IK target bone not found: "+w);v.bendDirection=this.getValue(p,"bendPositive",!0)?1:-1,v.mix=this.getValue(p,"mix",1),h.ikConstraints.push(v)}if(r.transform)for(M=0;M<r.transform.length;M++){for(p=r.transform[M],(v=new t.TransformConstraintData(p.name)).order=this.getValue(p,"order",0),g=0;g<p.bones.length;g++){if(f=p.bones[g],null==(m=h.findBone(f)))throw new Error("Transform constraint bone not found: "+f);v.bones.push(m)}if(w=p.target,v.target=h.findBone(w),null==v.target)throw new Error("Transform constraint target bone not found: "+w);v.offsetRotation=this.getValue(p,"rotation",0),v.offsetX=this.getValue(p,"x",0)*n,v.offsetY=this.getValue(p,"y",0)*n,v.offsetScaleX=this.getValue(p,"scaleX",0),v.offsetScaleY=this.getValue(p,"scaleY",0),v.offsetShearY=this.getValue(p,"shearY",0),v.rotateMix=this.getValue(p,"rotateMix",1),v.translateMix=this.getValue(p,"translateMix",1),v.scaleMix=this.getValue(p,"scaleMix",1),v.shearMix=this.getValue(p,"shearMix",1),h.transformConstraints.push(v)}if(r.path)for(M=0;M<r.path.length;M++){var p=r.path[M];(v=new t.PathConstraintData(p.name)).order=this.getValue(p,"order",0);for(var g=0;g<p.bones.length;g++){f=p.bones[g];var m=h.findBone(f);if(null==m)throw new Error("Transform constraint bone not found: "+f);v.bones.push(m)}var w=p.target;if(v.target=h.findSlot(w),null==v.target)throw new Error("Path target slot not found: "+w);v.positionMode=i.positionModeFromString(this.getValue(p,"positionMode","percent")),v.spacingMode=i.spacingModeFromString(this.getValue(p,"spacingMode","length")),v.rotateMode=i.rotateModeFromString(this.getValue(p,"rotateMode","tangent")),v.offsetRotation=this.getValue(p,"rotation",0),v.position=this.getValue(p,"position",0),v.positionMode==t.PositionMode.Fixed&&(v.position*=n),v.spacing=this.getValue(p,"spacing",0),v.spacingMode!=t.SpacingMode.Length&&v.spacingMode!=t.SpacingMode.Fixed||(v.spacing*=n),v.rotateMix=this.getValue(p,"rotateMix",1),v.translateMix=this.getValue(p,"translateMix",1),h.pathConstraints.push(v)}if(r.skins)for(var _ in r.skins){var C=r.skins[_],b=new t.Skin(_);for(var a in C){var y=h.findSlotIndex(a);if(-1==y)throw new Error("Slot not found: "+a);var T=C[a];for(var S in T){var A=this.readAttachment(T[S],b,y,S);null!=A&&b.addAttachment(y,S,A)}}h.skins.push(b),"default"==b.name&&(h.defaultSkin=b)}for(var M=0,x=this.linkedMeshes.length;M<x;M++){var E=this.linkedMeshes[M];if(null==(b=null==E.skin?h.defaultSkin:h.findSkin(E.skin)))throw new Error("Skin not found: "+E.skin);var O=b.getAttachment(E.slotIndex,E.parent);if(null==O)throw new Error("Parent mesh not found: "+E.parent);E.mesh.setParentMesh(O),E.mesh.updateUVs()}if(this.linkedMeshes.length=0,r.events)for(var P in r.events){var R=r.events[P];(v=new t.EventData(P)).intValue=this.getValue(R,"int",0),v.floatValue=this.getValue(R,"float",0),v.stringValue=this.getValue(R,"string",""),h.events.push(v)}if(r.animations)for(var I in r.animations){var L=r.animations[I];this.readAnimation(L,I,h)}return h},i.prototype.readAttachment=function(i,n,h,r){var e=this.scale;switch(r=this.getValue(i,"name",r),this.getValue(i,"type","region")){case"region":var c=this.getValue(i,"path",r),o=this.attachmentLoader.newRegionAttachment(n,r,c);return null==o?null:(o.path=c,o.x=this.getValue(i,"x",0)*e,o.y=this.getValue(i,"y",0)*e,o.scaleX=this.getValue(i,"scaleX",1),o.scaleY=this.getValue(i,"scaleY",1),o.rotation=this.getValue(i,"rotation",0),o.width=i.width*e,o.height=i.height*e,null!=(g=this.getValue(i,"color",null))&&o.color.setFromString(g),o.updateOffset(),o);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(n,r);return null==u?null:(this.readVertices(i,u,i.vertexCount<<1),null!=(g=this.getValue(i,"color",null))&&u.color.setFromString(g),u);case"mesh":case"linkedmesh":c=this.getValue(i,"path",r);var a=this.attachmentLoader.newMeshAttachment(n,r,c);if(null==a)return null;a.path=c,null!=(g=this.getValue(i,"color",null))&&a.color.setFromString(g);var f=this.getValue(i,"parent",null);if(null!=f)return a.inheritDeform=this.getValue(i,"deform",!0),this.linkedMeshes.push(new s(a,this.getValue(i,"skin",null),h,f)),a;var l=i.uvs;return this.readVertices(i,a,l.length),a.triangles=i.triangles,a.regionUVs=l,a.updateUVs(),a.hullLength=2*this.getValue(i,"hull",0),a;case"path":if(null==(c=this.attachmentLoader.newPathAttachment(n,r)))return null;c.closed=this.getValue(i,"closed",!1),c.constantSpeed=this.getValue(i,"constantSpeed",!0);var v=i.vertexCount;this.readVertices(i,c,v<<1);for(var d=t.Utils.newArray(v/3,0),p=0;p<i.lengths.length;p++)d[p++]=i.lengths[p]*e;c.lengths=d;var g=this.getValue(i,"color",null);return null!=g&&c.color.setFromString(g),c}return null},i.prototype.readVertices=function(i,s,n){var h=this.scale;s.worldVerticesLength=n;var r=i.vertices;if(n!=r.length){for(var e=new Array,c=new Array,o=0,u=r.length;o<u;){var a=r[o++];c.push(a);for(var f=o+4*a;o<f;o+=4)c.push(r[o]),e.push(r[o+1]*h),e.push(r[o+2]*h),e.push(r[o+3])}s.bones=c,s.vertices=t.Utils.toFloatArray(e)}else{if(1!=h)for(o=0,u=r.length;o<u;o++)r[o]*=h;s.vertices=t.Utils.toFloatArray(r)}},i.prototype.readAnimation=function(i,s,n){var h=this.scale,r=new Array,e=0;if(i.slots)for(var c in i.slots){if(E=i.slots[c],-1==(Y=n.findSlotIndex(c)))throw new Error("Slot not found: "+c);for(var o in E)if(O=E[o],"color"==o){(g=new t.ColorTimeline(O.length)).slotIndex=Y;for(var u=0,a=0;a<O.length;a++){var f=O[a],l=new t.Color;l.setFromString(f.color),g.setFrame(u,f.time,l.r,l.g,l.b,l.a),this.readCurve(f,g,u),u++}r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if(!(o="attachment"))throw new Error("Invalid timeline type for a slot: "+o+" ("+c+")");for((g=new t.AttachmentTimeline(O.length)).slotIndex=Y,u=0,a=0;a<O.length;a++)f=O[a],g.setFrame(u++,f.time,f.name);r.push(g),e=Math.max(e,g.frames[g.getFrameCount()-1])}}if(i.bones)for(var v in i.bones){var d=i.bones[v],p=n.findBoneIndex(v);if(-1==p)throw new Error("Bone not found: "+v);for(var o in d)if(O=d[o],"rotate"===o){for((g=new t.RotateTimeline(O.length)).boneIndex=p,u=0,a=0;a<O.length;a++)f=O[a],g.setFrame(u,f.time,f.angle),this.readCurve(f,g,u),u++;r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==o&&"scale"!==o&&"shear"!==o)throw new Error("Invalid timeline type for a bone: "+o+" ("+v+")");var g=null,m=1;for("scale"===o?g=new t.ScaleTimeline(O.length):"shear"===o?g=new t.ShearTimeline(O.length):(g=new t.TranslateTimeline(O.length),m=h),g.boneIndex=p,u=0,a=0;a<O.length;a++){f=O[a];var w=this.getValue(f,"x",0),_=this.getValue(f,"y",0);g.setFrame(u,f.time,w*m,_*m),this.readCurve(f,g,u),u++}r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(i.ik)for(var C in i.ik){var b=i.ik[C],y=n.findIkConstraint(C);for((g=new t.IkConstraintTimeline(b.length)).ikConstraintIndex=n.ikConstraints.indexOf(y),u=0,a=0;a<b.length;a++)f=b[a],g.setFrame(u,f.time,this.getValue(f,"mix",1),this.getValue(f,"bendPositive",!0)?1:-1),this.readCurve(f,g,u),u++;r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(i.transform)for(var C in i.transform){for(b=i.transform[C],y=n.findTransformConstraint(C),(g=new t.TransformConstraintTimeline(b.length)).transformConstraintIndex=n.transformConstraints.indexOf(y),u=0,a=0;a<b.length;a++)f=b[a],g.setFrame(u,f.time,this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1),this.getValue(f,"scaleMix",1),this.getValue(f,"shearMix",1)),this.readCurve(f,g,u),u++;r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}if(i.paths)for(var C in i.paths){b=i.paths[C];var T=n.findPathConstraintIndex(C);if(-1==T)throw new Error("Path constraint not found: "+C);var S=n.pathConstraints[T];for(var o in b)if(O=b[o],"position"===o||"spacing"===o){for(g=null,m=1,"spacing"===o?(g=new t.PathConstraintSpacingTimeline(O.length),S.spacingMode!=t.SpacingMode.Length&&S.spacingMode!=t.SpacingMode.Fixed||(m=h)):(g=new t.PathConstraintPositionTimeline(O.length),S.positionMode==t.PositionMode.Fixed&&(m=h)),g.pathConstraintIndex=T,u=0,a=0;a<O.length;a++)f=O[a],g.setFrame(u,f.time,this.getValue(f,o,0)*m),this.readCurve(f,g,u),u++;r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===o){for((g=new t.PathConstraintMixTimeline(O.length)).pathConstraintIndex=T,u=0,a=0;a<O.length;a++)f=O[a],g.setFrame(u,f.time,this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1)),this.readCurve(f,g,u),u++;r.push(g),e=Math.max(e,g.frames[(g.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(i.deform)for(var A in i.deform){var M=i.deform[A],x=n.findSkin(A);if(null==x)throw new Error("Skin not found: "+A);for(var c in M){var E=M[c];if(-1==(Y=n.findSlotIndex(c)))throw new Error("Slot not found: "+E.name);for(var o in E){var O=E[o],P=x.getAttachment(Y,o);if(null==P)throw new Error("Deform attachment not found: "+O.name);var R=null!=P.bones,I=P.vertices,L=R?I.length/3*2:I.length;(g=new t.DeformTimeline(O.length)).slotIndex=Y,g.attachment=P,u=0;for(var D=0;D<O.length;D++){f=O[D];var F=void 0,N=this.getValue(f,"vertices",null);if(null==N)F=R?t.Utils.newFloatArray(L):I;else{F=t.Utils.newFloatArray(L);var k=this.getValue(f,"offset",0);if(t.Utils.arrayCopy(N,0,F,k,N.length),1!=h)for(var B=(a=k)+N.length;a<B;a++)F[a]*=h;if(!R)for(a=0;a<L;a++)F[a]+=I[a]}g.setFrame(u,f.time,F),this.readCurve(f,g,u),u++}r.push(g),e=Math.max(e,g.frames[g.getFrameCount()-1])}}}var G=i.drawOrder;if(null==G&&(G=i.draworder),null!=G){g=new t.DrawOrderTimeline(G.length);var z=n.slots.length;for(u=0,D=0;D<G.length;D++){var j=G[D],V=null,U=this.getValue(j,"offsets",null);if(null!=U){V=t.Utils.newArray(z,-1);var W=t.Utils.newArray(z-U.length,0),H=0,X=0;for(a=0;a<U.length;a++){var J=U[a],Y=n.findSlotIndex(J.slot);if(-1==Y)throw new Error("Slot not found: "+J.slot);for(;H!=Y;)W[X++]=H++;V[H+J.offset]=H++}for(;H<z;)W[X++]=H++;for(a=z-1;a>=0;a--)-1==V[a]&&(V[a]=W[--X])}g.setFrame(u++,j.time,V)}r.push(g),e=Math.max(e,g.frames[g.getFrameCount()-1])}if(i.events){for(g=new t.EventTimeline(i.events.length),u=0,a=0;a<i.events.length;a++){var q=i.events[a],Z=n.findEvent(q.name);if(null==Z)throw new Error("Event not found: "+q.name);var Q=new t.Event(q.time,Z);Q.intValue=this.getValue(q,"int",Z.intValue),Q.floatValue=this.getValue(q,"float",Z.floatValue),Q.stringValue=this.getValue(q,"string",Z.stringValue),g.setFrame(u++,Q)}r.push(g),e=Math.max(e,g.frames[g.getFrameCount()-1])}if(isNaN(e))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new t.Animation(s,r,e))},i.prototype.readCurve=function(t,i,s){if(t.curve)if("stepped"===t.curve)i.setStepped(s);else if("[object Array]"===Object.prototype.toString.call(t.curve)){var n=t.curve;i.setCurve(s,n[0],n[1],n[2],n[3])}},i.prototype.getValue=function(t,i,s){return void 0!==t[i]?t[i]:s},i.blendModeFromString=function(i){if("normal"==(i=i.toLowerCase()))return t.BlendMode.Normal;if("additive"==i)return t.BlendMode.Additive;if("multiply"==i)return t.BlendMode.Multiply;if("screen"==i)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+i)},i.positionModeFromString=function(i){if("fixed"==(i=i.toLowerCase()))return t.PositionMode.Fixed;if("percent"==i)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+i)},i.spacingModeFromString=function(i){if("length"==(i=i.toLowerCase()))return t.SpacingMode.Length;if("fixed"==i)return t.SpacingMode.Fixed;if("percent"==i)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+i)},i.rotateModeFromString=function(i){if("tangent"==(i=i.toLowerCase()))return t.RotateMode.Tangent;if("chain"==i)return t.RotateMode.Chain;if("chainscale"==i)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+i)},i.transformModeFromString=function(i){if("normal"==(i=i.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==i)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==i)return t.TransformMode.NoRotationOrReflection;if("noscale"==i)return t.TransformMode.NoScale;if("noscaleorreflection"==i)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+i)},i}();t.SkeletonJson=i;var s=function(t,i,s,n){this.mesh=t,this.skin=i,this.slotIndex=s,this.parent=n}}(h||(h={})),function(t){var i=function(){function t(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return t.prototype.addAttachment=function(t,i,s){if(null==s)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][i]=s},t.prototype.getAttachment=function(t,i){var s=this.attachments[t];return s?s[i]:null},t.prototype.attachAll=function(t,i){for(var s=0,n=0;n<t.slots.length;n++){var h=t.slots[n],r=h.getAttachment();if(r&&s<i.attachments.length){var e=i.attachments[s];for(var c in e)if(r==e[c]){var o=this.getAttachment(s,c);null!=o&&h.setAttachment(o);break}}s++}},t}();t.Skin=i}(h||(h={})),function(t){var i=function(){function i(i,s){if(this.attachmentVertices=new Array,null==i)throw new Error("data cannot be null.");if(null==s)throw new Error("bone cannot be null.");this.data=i,this.bone=s,this.color=new t.Color,this.setToSetupPose()}return i.prototype.getAttachment=function(){return this.attachment},i.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},i.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},i.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},i.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},i}();t.Slot=i}(h||(h={})),function(t){t.SlotData=function(i,s,n){if(this.color=new t.Color(1,1,1,1),i<0)throw new Error("index must be >= 0.");if(null==s)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=i,this.name=s,this.boneData=n}}(h||(h={})),function(t){var i=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return s.Nearest;case"linear":return s.Linear;case"mipmap":return s.MipMap;case"mipmapnearestnearest":return s.MipMapNearestNearest;case"mipmaplinearnearest":return s.MipMapLinearNearest;case"mipmapnearestlinear":return s.MipMapNearestLinear;case"mipmaplinearlinear":return s.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=i,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(t.TextureFilter||(t.TextureFilter={}));var s=t.TextureFilter;!function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(t.TextureWrap||(t.TextureWrap={}));var n=t.TextureWrap;t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0}}(h||(h={})),function(t){var i=function(){function i(t,i){this.pages=new Array,this.regions=new Array,this.load(t,i)}return i.prototype.load=function(i,n){if(null==n)throw new Error("textureLoader cannot be null.");for(var e=new s(i),c=new Array(4),o=null;;){var u=e.readLine();if(null==u)break;if(0==(u=u.trim()).length)o=null;else if(o){var a=new r;a.name=u,a.page=o,a.rotate="true"==e.readValue(),e.readTuple(c);var f=parseInt(c[0]),l=parseInt(c[1]);e.readTuple(c);var v=parseInt(c[0]),d=parseInt(c[1]);a.u=f/o.width,a.v=l/o.height,a.rotate?(a.u2=(f+d)/o.width,a.v2=(l+v)/o.height):(a.u2=(f+v)/o.width,a.v2=(l+d)/o.height),a.x=f,a.y=l,a.width=Math.abs(v),a.height=Math.abs(d),4==e.readTuple(c)&&4==e.readTuple(c)&&e.readTuple(c),a.originalWidth=parseInt(c[0]),a.originalHeight=parseInt(c[1]),e.readTuple(c),a.offsetX=parseInt(c[0]),a.offsetY=parseInt(c[1]),a.index=parseInt(e.readValue()),a.texture=o.texture,this.regions.push(a)}else{(o=new h).name=u,2==e.readTuple(c)&&(o.width=parseInt(c[0]),o.height=parseInt(c[1]),e.readTuple(c)),e.readTuple(c),o.minFilter=t.Texture.filterFromString(c[0]),o.magFilter=t.Texture.filterFromString(c[1]);var p=e.readValue();o.uWrap=t.TextureWrap.ClampToEdge,o.vWrap=t.TextureWrap.ClampToEdge,"x"==p?o.uWrap=t.TextureWrap.Repeat:"y"==p?o.vWrap=t.TextureWrap.Repeat:"xy"==p&&(o.uWrap=o.vWrap=t.TextureWrap.Repeat),o.texture=n(u),o.texture.setFilters(o.minFilter,o.magFilter),o.texture.setWraps(o.uWrap,o.vWrap),o.width=o.texture.getImage().width,o.height=o.texture.getImage().height,this.pages.push(o)}}},i.prototype.findRegion=function(t){for(var i=0;i<this.regions.length;i++)if(this.regions[i].name==t)return this.regions[i];return null},i.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},i}();t.TextureAtlas=i;var s=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),i=t.indexOf(":");if(-1==i)throw new Error("Invalid line: "+t);return t.substring(i+1).trim()},t.prototype.readTuple=function(t){var i=this.readLine(),s=i.indexOf(":");if(-1==s)throw new Error("Invalid line: "+i);for(var n=0,h=s+1;n<3;n++){var r=i.indexOf(",",h);if(-1==r)break;t[n]=i.substr(h,r-h).trim(),h=r+1}return t[n]=i.substring(h).trim(),n+1},t}(),h=function(){};t.TextureAtlasPage=h;var r=function(t){function i(){t.apply(this,arguments)}return n(i,t),i}(t.TextureRegion);t.TextureAtlasRegion=r}(h||(h={})),function(t){var i=function(){function i(i,s){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,null==i)throw new Error("data cannot be null.");if(null==s)throw new Error("skeleton cannot be null.");this.data=i,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this.scaleMix=i.scaleMix,this.shearMix=i.shearMix,this.bones=new Array;for(var n=0;n<i.bones.length;n++)this.bones.push(s.findBone(i.bones[n].name));this.target=s.findBone(i.target.name)}return i.prototype.apply=function(){this.update()},i.prototype.update=function(){for(var i=this.rotateMix,s=this.translateMix,n=this.scaleMix,h=this.shearMix,r=this.target,e=r.a,c=r.b,o=r.c,u=r.d,a=e*u-c*o>0?t.MathUtils.degRad:-t.MathUtils.degRad,f=this.data.offsetRotation*a,l=this.data.offsetShearY*a,v=this.bones,d=0,p=v.length;d<p;d++){var g=v[d],m=!1;if(0!=i){var w=g.a,_=g.b,C=g.c,b=g.d;(E=Math.atan2(o,e)-Math.atan2(C,w)+f)>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E*=i;var y=Math.cos(E),T=Math.sin(E);g.a=y*w-T*C,g.b=y*_-T*b,g.c=T*w+y*C,g.d=T*_+y*b,m=!0}if(0!=s){var S=this.temp;r.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(S.x-g.worldX)*s,g.worldY+=(S.y-g.worldY)*s,m=!0}if(n>0){var A=Math.sqrt(g.a*g.a+g.c*g.c),M=Math.sqrt(e*e+o*o);A>1e-5&&(A=(A+(M-A+this.data.offsetScaleX)*n)/A),g.a*=A,g.c*=A,A=Math.sqrt(g.b*g.b+g.d*g.d),M=Math.sqrt(c*c+u*u),A>1e-5&&(A=(A+(M-A+this.data.offsetScaleY)*n)/A),g.b*=A,g.d*=A,m=!0}if(h>0){_=g.b,b=g.d;var x=Math.atan2(b,_),E=Math.atan2(u,c)-Math.atan2(o,e)-(x-Math.atan2(g.c,g.a));E>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E=x+(E+l)*h,A=Math.sqrt(_*_+b*b),g.b=Math.cos(E)*A,g.d=Math.sin(E)*A,m=!0}m&&(g.appliedValid=!1)}},i.prototype.getOrder=function(){return this.data.order},i}();t.TransformConstraint=i}(h||(h={})),(h||(h={})).TransformConstraintData=function(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,null==t)throw new Error("name cannot be null.");this.name=t};var h;!function(t){var i=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var i=this.contains(t);return this.array[0|t]=0|t,!i},t.prototype.contains=function(t){return void 0!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=i;var s=function(){function t(t,i,s,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=s,this.a=n}return t.prototype.set=function(t,i,s,n){return this.r=t,this.g=i,this.b=s,this.a=n,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,i,s,n){return this.r+=t,this.g+=i,this.b+=s,this.a+=n,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=s;var n=function(){function t(){}return t.clamp=function(t,i,s){return t<i?i:t>s?s:t},t.cosDeg=function(i){return Math.cos(i*t.degRad)},t.sinDeg=function(i){return Math.sin(i*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var i=Math.pow(Math.abs(t),1/3);return t<0?-i:i},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=n;var h=function(){function t(){}return t.arrayCopy=function(t,i,s,n,h){for(var r=i,e=n;r<i+h;r++,e++)s[e]=t[r]},t.setArraySize=function(t,i,s){void 0===s&&(s=0);var n=t.length;if(n==i)return t;if(t.length=i,n<i)for(var h=n;h<i;h++)t[h]=s;return t},t.ensureArrayCapacity=function(i,s,n){return void 0===n&&(n=0),i.length>=s?i:t.setArraySize(i,s,n)},t.newArray=function(t,i){for(var s=new Array(t),n=0;n<t;n++)s[n]=i;return s},t.newFloatArray=function(i){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(i);for(var s=new Array(i),n=0;n<s.length;n++)s[n]=0;return s},t.toFloatArray=function(i){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(i):i},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=h;var r=function(){function t(){}return t.logBones=function(t){for(var i=0;i<t.bones.length;i++){var s=t.bones[i];console.log(s.data.name+", "+s.a+", "+s.b+", "+s.c+", "+s.d+", "+s.worldX+", "+s.worldY)}},t}();t.DebugUtils=r;var e=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var i=0;i<t.length;i++)t[i].reset&&t[i].reset(),this.items[i]=t[i]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=e;var c=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.set=function(t,i){return this.x=t,this.y=i,this},t.prototype.length=function(){var t=this.x,i=this.y;return Math.sqrt(t*t+i*i)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=c;var o=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=o}(h||(h={})),i.exports=h},{}],310:[function(t,i,s){!function(){"use strict";function t(t){t||console.log("Assertion failed! Pls debug.")}function s(t,i,s){this.major=t,this.minor=i,this.revision=s}function n(t){return isFinite(t)&&!isNaN(t)}function h(t,i){void 0!==t?(this.x=t,this.y=i):this.x=this.y=0}function r(t,i,s){void 0!==t&&(this.x=t,this.y=i,this.z=s)}function e(t,i){this.ex=t?t.Clone():new h,this.ey=i?i.Clone():new h}function c(t,i,s){this.ex=t?t.Clone():new r,this.ey=i?i.Clone():new r,this.ez=s?s.Clone():new r}function o(t,i){void 0!==i?(this.s=t,this.c=i):void 0!==t&&this.Set(t)}function u(t,i){this.p=new h,this.q=new o,t&&(this.p.Assign(t),this.q.Assign(i))}function a(){this.localCenter=new h,this.c0=new h,this.c=new h}function f(t,i){return t.x*i.x+t.y*i.y}function l(t,i){return t.x*i.y-t.y*i.x}function v(t,i){return new h(i*t.y,-i*t.x)}function d(t,i){return new h(-t*i.y,t*i.x)}function p(t,i){return new h(t.ex.x*i.x+t.ey.x*i.y,t.ex.y*i.x+t.ey.y*i.y)}function g(t,i){return h.Subtract(t,i).Length()}function m(t,i){var s=h.Subtract(t,i);return f(s,s)}function w(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}function _(t,i){return new r(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}function C(t,i){return r.Add(r.Add(r.Multiply(i.x,t.ex),r.Multiply(i.y,t.ey)),r.Multiply(i.z,t.ez))}function b(t,i){return new h(t.ex.x*i.x+t.ey.x*i.y,t.ex.y*i.x+t.ey.y*i.y)}function y(t,i){var s=new o;return s.s=t.s*i.c+t.c*i.s,s.c=t.c*i.c-t.s*i.s,s}function T(t,i){var s=new o;return s.s=t.c*i.s-t.s*i.c,s.c=t.c*i.c+t.s*i.s,s}function S(t,i){return new h(t.c*i.x-t.s*i.y,t.s*i.x+t.c*i.y)}function A(t,i){return new h(t.c*i.x+t.s*i.y,-t.s*i.x+t.c*i.y)}function M(t,i){return new h(t.q.c*i.x-t.q.s*i.y+t.p.x,t.q.s*i.x+t.q.c*i.y+t.p.y)}function x(t,i){var s=i.x-t.p.x,n=i.y-t.p.y;return new h(t.q.c*s+t.q.s*n,-t.q.s*s+t.q.c*n)}function E(t,i){var s=new u;s.q=T(t.q,i.q);var n=i.p.x-t.p.x,h=i.p.y-t.p.y;return s.p.x=t.q.c*n+t.q.s*h,s.p.y=-t.q.s*n+t.q.c*h,s}function O(t){return new h(hs(t.x),hs(t.y))}function P(t,i){return new h(rs(t.x,i.x),rs(t.y,i.y))}function R(t,i){return new h(es(t.x,i.x),es(t.y,i.y))}function I(t,i,s){return es(i,rs(t,s))}function L(t,i,s){this.r=t||0,this.g=i||0,this.b=s||0}function D(){}function F(){this.Reset()}function N(){this.mass=0,this.center=new h,this.I=0}function k(){this.m_type=0,this.m_radius=0}function B(){this.parent.call(this),this.m_type=k.e_circle,this.m_radius=0,this.m_p=new h,Object.seal(this)}function G(){this.parent.call(this),this.m_type=k.e_edge,this.m_radius=Hi,this.m_vertex0=new h,this.m_vertex1=new h,this.m_vertex2=new h,this.m_vertex3=new h,this.m_hasVertex0=!1,this.m_hasVertex3=!1,Object.seal(this)}function z(){this.parent.call(this),this.m_type=k.e_chain,this.m_radius=Hi,this.m_prevVertex=new h,this.m_nextVertex=new h,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.Clear(),Object.seal(this)}function j(){this.parent.call(this),this.m_type=k.e_polygon,this.m_radius=Hi,this.m_count=0,this.m_centroid=new h,this.m_vertices=new Array(Vi),this.m_normals=new Array(Vi),Object.seal(this)}function V(){this.proxyIdA=0,this.proxyIdB=0}function U(t,i){return t.proxyIdA==i.proxyIdA?t.proxyIdB-i.proxyIdB:t.proxyIdA-i.proxyIdA}function W(){this.m_tree=new bt,this.m_queryProxyId=0,this.m_proxyCount=0,this.m_pairCount=0,this.m_pairBuffer=[],this.m_moveCount=0,this.m_moveBuffer=[]}function H(){this.m_vertices=null,this.m_count=0,this.m_radius=0}function X(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}function J(){this.proxyA=new H,this.proxyB=new H,this.transformA=new u,this.transformB=new u,this.useRadii=!1}function Y(){this.pointA=new h,this.pointB=new h,this.distance=0,this.iterations=0}function q(){this.wA=new h,this.wB=new h,this.w=new h,this.a=0,this.indexA=0,this.indexB=0}function Z(){this.m_v=[new q,new q,new q],this.m_count=0}function Q(i,s,n){++Q.b2_gjkCalls;var h=n.proxyA,r=n.proxyB,e=n.transformA,c=n.transformB;cs.ReadCache(s,h,e,r,c);for(var o=cs.m_v,u=[0,0,0],a=[0,0,0],f=0,l=Bi,v=l,d=0;d<20;){for(f=cs.m_count,C=0;C<f;++C)u[C]=o[C].indexA,a[C]=o[C].indexB;switch(cs.m_count){case 1:break;case 2:cs.Solve2();break;case 3:cs.Solve3();break;default:t(!1)}if(3==cs.m_count)break;if(cs.GetClosestPoint(us),v=us.LengthSquared(),l=v,cs.GetSearchDirection(us),us.LengthSquared()<Gi*Gi)break;var p=o[cs.m_count];p.indexA=h.GetSupport(e.q.c*-us.x+e.q.s*-us.y,-e.q.s*-us.x+e.q.c*-us.y);var m=h.GetVertex(p.indexA);p.wA.x=e.q.c*m.x-e.q.s*m.y+e.p.x,p.wA.y=e.q.s*m.x+e.q.c*m.y+e.p.y,p.indexB=r.GetSupport(c.q.c*us.x+c.q.s*us.y,-c.q.s*us.x+c.q.c*us.y);var w=r.GetVertex(p.indexB);p.wB.x=c.q.c*w.x-c.q.s*w.y+c.p.x,p.wB.y=c.q.s*w.x+c.q.c*w.y+c.p.y,p.w.x=p.wB.x-p.wA.x,p.w.y=p.wB.y-p.wA.y,++d,++Q.b2_gjkIters;for(var _=!1,C=0;C<f;++C)if(p.indexA==u[C]&&p.indexB==a[C]){_=!0;break}if(_)break;++cs.m_count}if(Q.b2_gjkMaxIters=es(Q.b2_gjkMaxIters,d),cs.GetWitnessPoints(i.pointA,i.pointB),i.distance=g(i.pointA,i.pointB),i.iterations=d,cs.WriteCache(s),n.useRadii){var b=h.m_radius,y=r.m_radius;if(i.distance>b+y&&i.distance>Gi)i.distance-=b+y,os.x=i.pointB.x-i.pointA.x,os.y=i.pointB.y-i.pointA.y,os.Normalize(),i.pointA.x+=b*os.x,i.pointA.y+=b*os.y,i.pointB.x-=y*os.x,i.pointB.y-=y*os.y;else{var T=.5*(i.pointA.x+i.pointB.x),S=.5*(i.pointA.y+i.pointB.y);i.pointA.x=T,i.pointA.y=S,i.pointB.x=T,i.pointB.y=S,i.distance=0}}}function K(){}function $(){this.localPoint=new h,this.normalImpulse=0,this.tangentImpulse=0,this.id=new K}function tt(){this.points=new Array(ji),this.localNormal=new h,this.localPoint=new h,this.type=0,this.pointCount=0}function it(){this.normal=new h,this.points=new Array(ji),this.separations=new Array(ji)}function st(){this.v=new h,this.id=new K}function nt(){this.p1=new h,this.p2=new h,this.maxFraction=0}function ht(){this.normal=new h,this.fraction=0}function rt(){this.lowerBound=new h,this.upperBound=new h}function et(t,i,s,n,h){t.pointCount=0;var r=M(s,i.m_p),e=M(h,n.m_p),c=e.x-r.x,o=e.y-r.y,u=c*c+o*o,a=i.m_radius+n.m_radius;u>a*a||(t.type=tt.e_circles,t.localPoint.x=i.m_p.x,t.localPoint.y=i.m_p.y,t.localNormal.x=t.localNormal.y=0,t.pointCount=1,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset())}function ct(t,i,s,n,h){t.pointCount=0;for(var r=x(s,M(h,n.m_p)),e=0,c=-Bi,o=i.m_radius+n.m_radius,u=i.m_count,a=i.m_vertices,f=i.m_normals,l=0;l<u;++l){var v=f[l].x*(r.x-a[l].x)+f[l].y*(r.y-a[l].y);if(v>o)return;v>c&&(c=v,e=l)}var d=e,p=d+1<u?d+1:0,g=a[d],w=a[p];if(c<Gi)return t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=f[e].x,t.localNormal.y=f[e].y,t.localPoint.x=.5*(g.x+w.x),t.localPoint.y=.5*(g.y+w.y),t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,void t.points[0].id.Reset();var _=(r.x-g.x)*(w.x-g.x)+(r.y-g.y)*(w.y-g.y),C=(r.x-w.x)*(g.x-w.x)+(r.y-w.y)*(g.y-w.y);if(_<=0){if(m(r,g)>o*o)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=r.x-g.x,t.localNormal.y=r.y-g.y,t.localNormal.Normalize(),t.localPoint.x=g.x,t.localPoint.y=g.y,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}else if(C<=0){if(m(r,w)>o*o)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=r.x-w.x,t.localNormal.y=r.y-w.y,t.localNormal.Normalize(),t.localPoint.x=w.x,t.localPoint.y=w.y,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}else{var b=.5*(g.x+w.x),y=.5*(g.y+w.y);if((c=(r.x-b)*f[d].x+(r.y-y)*f[d].y)>o)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=f[d].x,t.localNormal.y=f[d].y,t.localPoint.x=b,t.localPoint.y=y,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}}function ot(t,i,s,n,h){for(var r=i.m_count,e=n.m_count,c=i.m_normals,o=i.m_vertices,u=n.m_vertices,a=E(h,s),f=0,l=-Bi,v=0;v<r;++v){for(var d=a.q.c*c[v].x-a.q.s*c[v].y,p=a.q.s*c[v].x+a.q.c*c[v].y,g=a.q.c*o[v].x-a.q.s*o[v].y+a.p.x,m=a.q.s*o[v].x+a.q.c*o[v].y+a.p.y,w=Bi,_=0;_<e;++_){var C=d*(u[_].x-g)+p*(u[_].y-m);C<w&&(w=C)}w>l&&(l=w,f=v)}return t[0]=f,l}function ut(i,s,n,h,r,e){var c=s.m_normals,o=r.m_count,u=r.m_vertices,a=r.m_normals;t(0<=h&&h<s.m_count);for(var f=n.q.c*c[h].x-n.q.s*c[h].y,l=n.q.s*c[h].x+n.q.c*c[h].y,v=e.q.c*f+e.q.s*l,d=-e.q.s*f+e.q.c*l,p=0,g=Bi,m=0;m<o;++m){var w=v*a[m].x+d*a[m].y;w<g&&(g=w,p=m)}var _=p,C=_+1<o?_+1:0;i[0].v.x=e.q.c*u[_].x-e.q.s*u[_].y+e.p.x,i[0].v.y=e.q.s*u[_].x+e.q.c*u[_].y+e.p.y,i[0].id.indexA=h,i[0].id.indexB=_,i[0].id.typeA=K.e_face,i[0].id.typeB=K.e_vertex,i[1].v.x=e.q.c*u[C].x-e.q.s*u[C].y+e.p.x,i[1].v.y=e.q.s*u[C].x+e.q.c*u[C].y+e.p.y,i[1].id.indexA=h,i[1].id.indexB=C,i[1].id.typeA=K.e_face,i[1].id.typeB=K.e_vertex}function at(t,i,s,n,h){t.pointCount=0;var r=i.m_radius+n.m_radius,e=[0],c=ot(e,i,s,n,h);if(!(c>r)){var o=[0],u=ot(o,n,h,i,s);if(!(u>r)){var a,f,l,v,d=0,p=0;u>c+.1*Ui?(a=n,f=i,l=h,v=s,d=o[0],t.type=tt.e_faceB,p=1):(a=i,f=n,l=s,v=h,d=e[0],t.type=tt.e_faceA,p=0),ut(at._local_incidentEdges,a,l,d,f,v);var g=a.m_count,m=a.m_vertices,w=d,_=d+1<g?d+1:0,C=m[w],b=m[_];at._localTangent.x=b.x-C.x,at._localTangent.y=b.y-C.y,at._localTangent.Normalize();var y=1*at._localTangent.y,T=-1*at._localTangent.x,S=.5*(C.x+b.x),A=.5*(C.y+b.y),E=l.q.c*at._localTangent.x-l.q.s*at._localTangent.y,O=l.q.s*at._localTangent.x+l.q.c*at._localTangent.y,P=1*O,R=-1*E;C=M(l,C),b=M(l,b);var I=P*C.x+R*C.y,L=-(E*C.x+O*C.y)+r,D=E*b.x+O*b.y+r,F=new Array(2),N=new Array(2);if(!(mt(F,at._local_incidentEdges,-E,-O,L,w)<2||mt(N,F,E,O,D,_)<2)){t.localNormal.x=y,t.localNormal.y=T,t.localPoint.x=S,t.localPoint.y=A;for(var k=0,B=0;B<ji;++B)if(P*N[B].v.x+R*N[B].v.y-I<=r){var G=t.points[k]=new $;if(G.localPoint.Assign(x(v,N[B].v)),G.id.Assign(N[B].id),p){var z=new K;z.Assign(G.id),G.id.indexA=z.indexB,G.id.indexB=z.indexA,G.id.typeA=z.typeB,G.id.typeB=z.typeA}++k}t.pointCount=k}}}}function ft(i,s,n,h,r){i.pointCount=0;var e=x(n,M(r,h.m_p)),c=s.m_vertex1,o=s.m_vertex2,u=o.x-c.x,a=o.y-c.y,f=u*(o.x-e.x)+a*(o.y-e.y),l=u*(e.x-c.x)+a*(e.y-c.y),v=s.m_radius+h.m_radius,d=new K;if(d.indexB=0,d.typeB=K.e_vertex,l<=0){if(_=c,(R=(O=e.x-_.x)*O+(P=e.y-_.y)*P)>v*v)return;if(s.m_hasVertex0){var p=s.m_vertex0,g=c,m=g.x-p.x,w=g.y-p.y;if(m*(g.x-e.x)+w*(g.y-e.y)>0)return}return d.indexA=0,d.typeA=K.e_vertex,i.pointCount=1,i.type=tt.e_circles,i.localNormal.x=i.localNormal.y=0,i.localPoint.x=_.x,i.localPoint.y=_.y,i.points[0]=new $,i.points[0].id.Assign(d),i.points[0].localPoint.x=h.m_p.x,void(i.points[0].localPoint.y=h.m_p.y)}if(f<=0){var _=o;if((R=(O=e.x-_.x)*O+(P=e.y-_.y)*P)>v*v)return;if(s.m_hasVertex3){var C=s.m_vertex3,b=o,y=C.x-b.x,T=C.y-b.y;if(y*(e.x-b.x)+T*(e.y-b.y)>0)return}return d.indexA=1,d.typeA=K.e_vertex,i.pointCount=1,i.type=tt.e_circles,i.localNormal.x=i.localNormal.y=0,i.localPoint.x=_.x,i.localPoint.y=_.y,i.points[0]=new $,i.points[0].id.Assign(d),i.points[0].localPoint.x=h.m_p.x,void(i.points[0].localPoint.y=h.m_p.y)}var S=u*u+a*a;t(S>0);var A=1/S*(f*c.x+l*o.x),E=1/S*(f*c.y+l*o.y),O=e.x-A,P=e.y-E,R=O*O+P*P;if(!(R>v*v)){var I=-a,L=u;I*(e.x-c.x)+L*(e.y-c.y)<0&&(I=-I,L=-L),d.indexA=0,d.typeA=K.e_face,i.pointCount=1,i.type=tt.e_faceA,i.localNormal.x=I,i.localNormal.y=L,i.localNormal.Normalize(),i.localPoint.x=c.x,i.localPoint.y=c.y,i.points[0]=new $,i.points[0].id.Assign(d),i.points[0].localPoint.x=h.m_p.x,i.points[0].localPoint.y=h.m_p.y}}function lt(){this.type=0,this.index=0,this.separation=0}function vt(){this.vertices=new Array(Vi),this.normals=new Array(Vi),this.count=0}function dt(){this.i1=0,this.i2=0,this.v1=new h,this.v2=new h,this.normal=new h,this.sideNormal1=new h,this.sideOffset1=0,this.sideNormal2=new h,this.sideOffset2=0}function pt(){this.m_polygonB=new vt,this.m_xf=new u,this.m_centroidB=new h,this.m_v0=new h,this.m_v1=new h,this.m_v2=new h,this.m_v3=new h,this.m_normal0=new h,this.m_normal1=new h,this.m_normal2=new h,this.m_normal=new h,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new h,this.m_upperLimit=new h,this.m_radius=0,this.m_front=!1}function gt(t,i,s,n,h){gt.collider.Collide(t,i,s,n,h)}function mt(t,i,s,n,h,r){var e=0,c=s*i[0].v.x+n*i[0].v.y-h,o=s*i[1].v.x+n*i[1].v.y-h;if(c<=0&&(t[e++]=i[0]),o<=0&&(t[e++]=i[1]),c*o<0){var u=c/(c-o);t[e]=new st,t[e].v.x=i[0].v.x+u*(i[1].v.x-i[0].v.x),t[e].v.y=i[0].v.y+u*(i[1].v.y-i[0].v.y),t[e].id.indexA=r,t[e].id.indexB=i[0].id.indexB,t[e].id.typeA=K.e_vertex,t[e].id.typeB=K.e_face,++e}return e}function wt(t,i,s,n,h,r){return wt.input.proxyA.Set(t,i),wt.input.proxyB.Set(s,n),wt.input.transformA=h,wt.input.transformB=r,wt.input.useRadii=!0,wt.cache.count=0,Q(wt.output,wt.cache,wt.input),wt.output.distance<10*Gi}function _t(t,i){return!(i.lowerBound.x-t.upperBound.x>0||i.lowerBound.y-t.upperBound.y>0||t.lowerBound.x-i.upperBound.x>0||t.lowerBound.y-i.upperBound.y>0)}function Ct(){this.aabb=new rt,this.userData=null,this.parent=0,this.child1=this.child2=this.height=0}function bt(){this.m_root=as,this.m_nodeCapacity=16,this.m_nodeCount=0,this.m_nodes=new Array(this.m_nodeCapacity);for(var t=0;t<this.m_nodeCapacity-1;++t)this.m_nodes[t]=new Ct,this.m_nodes[t].parent=t+1,this.m_nodes[t].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new Ct,this.m_nodes[this.m_nodeCapacity-1].parent=as,this.m_nodes[this.m_nodeCapacity-1].height=-1,this.m_freeList=0,this.m_path=0,this.m_insertionCount=0}function yt(){this.proxyA=new H,this.proxyB=new H,this.sweepA=new a,this.sweepB=new a,this.tMax=0}function Tt(){this.state=0,this.t=0}function St(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=0,this.m_localPoint=new h,this.m_axis=new h}function At(i,s){vs.start(),++At.b2_toiCalls,i.state=Tt.e_unknown,i.t=s.tMax;var n=s.proxyA,h=s.proxyB;At._temp_sweepA.Assign(s.sweepA),At._temp_sweepB.Assign(s.sweepB),At._temp_sweepA.Normalize(),At._temp_sweepB.Normalize();var r=s.tMax,e=n.m_radius+h.m_radius,c=es(Ui,e-3*Ui),o=.25*Ui;t(c>o);var u=0,a=0,f=new X;f.count=0;var l=new J;for(l.proxyA.Assign(s.proxyA),l.proxyB.Assign(s.proxyB),l.useRadii=!1;;){At._temp_sweepA.GetTransform(l.transformA,u),At._temp_sweepB.GetTransform(l.transformB,u);var v=new Y;if(Q(v,f,l),v.distance<=0){i.state=Tt.e_overlapped,i.t=0;break}if(v.distance<c+o){i.state=Tt.e_touching,i.t=u;break}var d=new St;d.Initialize(f,n,At._temp_sweepA,h,At._temp_sweepB,u);for(var p=!1,g=r,m=0;;){var w=[],_=d.FindMinSeparation(w,g);if(_>c+o){i.state=Tt.e_separated,i.t=r,p=!0;break}if(_>c-o){u=g;break}var C=d.Evaluate(w[0],w[1],u);if(C<c-o){i.state=Tt.e_failed,i.t=u,p=!0;break}if(C<=c+o){i.state=Tt.e_touching,i.t=u,p=!0;break}for(var b=0,y=u,T=g;;){var S;S=1&b?y+(c-C)*(T-y)/(_-C):.5*(y+T),++b,++At.b2_toiRootIters;var A=d.Evaluate(w[0],w[1],S);if(hs(A-c)<o){g=S;break}if(A>c?(y=S,C=A):(T=S,_=A),50==b)break}if(At.b2_toiMaxRootIters=es(At.b2_toiMaxRootIters,b),++m==Vi)break}if(++a,++At.b2_toiIters,p)break;if(20==a){i.state=Tt.e_failed,i.t=u;break}}At.b2_toiMaxIters=es(At.b2_toiMaxIters,a),vs.stop(),At.b2_toiMaxTime=es(At.b2_toiMaxTime,vs.elapsedTime),At.b2_toiTime+=vs.elapsedTime}function Mt(){this.type=xt.b2_staticBody,this.position=new h(0,0),this.angle=0,this.linearVelocity=new h(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1,Object.seal(this)}function xt(i,s){t(i.position.IsValid()),t(i.linearVelocity.IsValid()),t(n(i.angle)),t(n(i.angularVelocity)),t(n(i.angularDamping)&&i.angularDamping>=0),t(n(i.linearDamping)&&i.linearDamping>=0),this.m_islandIndex=0,this.m_flags=0,i.bullet&&(this.m_flags|=xt.e_bulletFlag),i.fixedRotation&&(this.m_flags|=xt.e_fixedRotationFlag),i.allowSleep&&(this.m_flags|=xt.e_autoSleepFlag),i.awake&&(this.m_flags|=xt.e_awakeFlag),i.active&&(this.m_flags|=xt.e_activeFlag),this.m_world=s,this.m_xf=new u,this.m_xf.p.Assign(i.position),this.m_xf.q.Set(i.angle),this.m_sweep=new a,this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Assign(this.m_xf.p),this.m_sweep.c.Assign(this.m_xf.p),this.m_sweep.a0=i.angle,this.m_sweep.a=i.angle,this.m_sweep.alpha0=0,this.m_jointList=null,this.m_contactList=null,this.m_prev=null,this.m_next=null,this.m_linearVelocity=i.linearVelocity.Clone(),this.m_angularVelocity=i.angularVelocity,this.m_linearDamping=i.linearDamping,this.m_angularDamping=i.angularDamping,this.m_gravityScale=i.gravityScale,this.m_force=new h,this.m_torque=0,this.m_sleepTime=0,this.m_type=i.type,this.m_type==xt.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=i.userData,this.m_fixtureList=null,this.m_fixtureCount=0}function Et(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}function Ot(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new Et,Object.seal(this)}function Pt(){this.aabb=new rt,this.fixture=null,this.childIndex=0,this.proxyId=0}function Rt(){this.m_userData=null,this.m_body=null,this.m_next=null,this.m_proxies=null,this.m_proxyCount=0,this.m_shape=null,this.m_density=0,this.m_filter=new Et,this.m_isSensor=!1,this.m_friction=0,this.m_restitution=0}function It(){}function Lt(){}function Dt(){this.normalImpulses=new Array(ji),this.tangentImpulses=new Array(ji),this.count=0}function Ft(){}function Nt(){}function kt(){}function Bt(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1}function Gt(){this.c=new h,this.a=0}function zt(){this.v=new h,this.w=0}function jt(){this.step=new Bt,this.positions=null,this.velocities=null}function Vt(t){this.m_contactManager=new ni,this.m_destructionListener=null,this.g_debugDraw=null,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_allowSleep=!0,this.m_gravity=t,this.m_flags=Vt.e_clearForces,this.m_inv_dt0=0,this.p_step=new Bt,this.p_island=new ai}function Ut(){this.broadPhase=null,this.callback=null}function Wt(){this.broadPhase=null,this.callback=null}function Ht(t,i){return ss(t*i)}function Xt(t,i){return t>i?t:i}function Jt(){this.fcn=null,this.primary=!1}function Yt(){this.other=null,this.contact=null,this.prev=null,this.next=null}function qt(){this.m_nodeA=new Yt,this.m_nodeB=new Yt,this.m_manifold=new tt}function Zt(){this.parent.call(this)}function Qt(){this.parent.call(this)}function Kt(){this.parent.call(this)}function $t(){this.parent.call(this)}function ti(){this.parent.call(this)}function ii(){this.parent.call(this)}function si(){this.parent.call(this)}function ni(){this.m_broadPhase=new W,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Cs,this.m_contactListener=bs}function hi(){this.rA=new h,this.rB=new h,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function ri(){this.localPoints=new Array(ji),this.localNormal=new h,this.localPoint=new h,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new h,this.localCenterB=new h,this.invIA=0,this.invIB=0,this.type=0,this.radiusA=0,this.radiusB=0,this.pointCount=0}function ei(){this.points=new Array(ji);for(var t=0;t<this.points.length;++t)this.points[t]=new hi;this.normal=new h,this.normalMass=new e,this.K=new e,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}function ci(){this.normal=new h,this.point=new h,this.separation=0}function oi(){this.step=new Bt,this.contacts=null,this.count=0,this.positions=null,this.velocities=null}function ui(){this.m_positionConstraints=[],this.m_velocityConstraints=[]}function ai(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_velocities=[],this.m_positions=[]}function fi(){this.other=null,this.joint=null,this.prev=null,this.next=null}function li(){this.type=vi.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1}function vi(i){t(i.bodyA!=i.bodyB),this.m_type=i.type,this.m_prev=null,this.m_next=null,this.m_bodyA=i.bodyA,this.m_bodyB=i.bodyB,this.m_index=0,this.m_collideConnected=i.collideConnected,this.m_islandFlag=!1,this.m_userData=i.userData,this.m_edgeA=new fi,this.m_edgeA.joint=null,this.m_edgeA.other=null,this.m_edgeA.prev=null,this.m_edgeA.next=null,this.m_edgeB=new fi,this.m_edgeB.joint=null,this.m_edgeB.other=null,this.m_edgeB.prev=null,this.m_edgeB.next=null}function di(){this.parent.call(this),this.type=vi.e_revoluteJoint,this.localAnchorA=new h,this.localAnchorB=new h,this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1,Object.seal(this)}function pi(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_referenceAngle=t.referenceAngle,this.m_impulse=new r,this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=vi.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new c,this.m_motorMass=0}function gi(){this.parent.call(this),this.type=vi.e_mouseJoint,this.target=new h(0,0),this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7,Object.seal(this)}function mi(i){this.parent.call(this,i),t(i.target.IsValid()),t(n(i.maxForce)&&i.maxForce>=0),t(n(i.frequencyHz)&&i.frequencyHz>=0),t(n(i.dampingRatio)&&i.dampingRatio>=0),this.m_targetA=i.target.Clone(),this.m_localAnchorB=x(this.m_bodyB.GetTransform(),this.m_targetA),this.m_maxForce=i.maxForce,this.m_impulse=new h,this.m_frequencyHz=i.frequencyHz,this.m_dampingRatio=i.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=new h,this.m_localCenterB=new h,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new e,this.m_C=new h}function wi(){this.parent.call(this),this.type=vi.e_distanceJoint,this.localAnchorA=new h(0,0),this.localAnchorB=new h(0,0),this.length=1,this.frequencyHz=0,this.dampingRatio=0,Object.seal(this)}function _i(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new h,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0}function Ci(){this.parent.call(this),this.type=vi.e_prismaticJoint,this.localAnchorA=new h,this.localAnchorB=new h,this.localAxisA=new h(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,Object.seal(this)}function bi(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_localXAxisA=t.localAxisA.Clone(),this.m_localXAxisA.Normalize(),this.m_localYAxisA=d(1,this.m_localXAxisA),this.m_referenceAngle=t.referenceAngle,this.m_impulse=new r,this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=vi.e_inactiveLimit,this.m_axis=new h,this.m_perp=new h,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new c,this.m_motorMass=0}function yi(){this.parent.call(this),this.type=vi.e_frictionJoint,this.localAnchorA=new h,this.localAnchorB=new h,this.maxForce=0,this.maxTorque=0,Object.seal(this)}function Ti(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_linearImpulse=new h,this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_indexA=0,this.m_indexB=0,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new e,this.m_angularMass=0}function Si(){this.parent.call(this),this.type=vi.e_weldJoint,this.localAnchorA=new h(0,0),this.localAnchorB=new h(0,0),this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0,Object.seal(this)}function Ai(t){this.parent.call(this,t),this.m_bias=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new c,this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_referenceAngle=t.referenceAngle,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=new r}function Mi(){this.parent.call(this),this.type=vi.e_wheelJoint,this.localAnchorA=new h,this.localAnchorB=new h,this.localAxisA=new h(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7,Object.seal(this)}function xi(t){this.parent.call(this,t),this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_localXAxisA=t.localAxisA.Clone(),this.m_localYAxisA=d(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_ax=new h,this.m_ay=new h,this.m_sAx=this.m_sBx=0,this.m_sAy=this.m_sBy=0}function Ei(){this.parent.call(this),this.type=vi.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1,Object.seal(this)}function Oi(i){this.parent.call(this,i),this.m_joint1=i.joint1,this.m_joint2=i.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),t(this.m_typeA==vi.e_revoluteJoint||this.m_typeA==vi.e_prismaticJoint),t(this.m_typeB==vi.e_revoluteJoint||this.m_typeB==vi.e_prismaticJoint);var s,n;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var r=this.m_bodyA.m_xf,e=this.m_bodyA.m_sweep.a,c=this.m_bodyC.m_xf,o=this.m_bodyC.m_sweep.a;if(this.m_localAnchorA=new h,this.m_localAnchorB=new h,this.m_localAnchorC=new h,this.m_localAnchorD=new h,this.m_localAxisC=new h,this.m_localAxisD=new h,this.m_typeA==vi.e_revoluteJoint)g=i.joint1,this.m_localAnchorC.Assign(g.m_localAnchorA),this.m_localAnchorA.Assign(g.m_localAnchorB),this.m_referenceAngleA=g.m_referenceAngle,this.m_localAxisC.SetZero(),s=e-o-this.m_referenceAngleA;else{m=i.joint1,this.m_localAnchorC.Assign(m.m_localAnchorA),this.m_localAnchorA.Assign(m.m_localAnchorB),this.m_referenceAngleA=m.m_referenceAngle,this.m_localAxisC.Assign(m.m_localXAxisA);var u=this.m_localAnchorC,a=A(c.q,h.Add(S(r.q,this.m_localAnchorA),h.Subtract(r.p,c.p)));s=f(h.Subtract(a,u),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var l=this.m_bodyB.m_xf,v=this.m_bodyB.m_sweep.a,d=this.m_bodyD.m_xf,p=this.m_bodyD.m_sweep.a;if(this.m_typeB==vi.e_revoluteJoint){var g=i.joint2;this.m_localAnchorD.Assign(g.m_localAnchorA),this.m_localAnchorB.Assign(g.m_localAnchorB),this.m_referenceAngleB=g.m_referenceAngle,this.m_localAxisD.SetZero(),n=v-p-this.m_referenceAngleB}else{var m=i.joint2;this.m_localAnchorD.Assign(m.m_localAnchorA),this.m_localAnchorB.Assign(m.m_localAnchorB),this.m_referenceAngleB=m.m_referenceAngle,this.m_localAxisD.Assign(m.m_localXAxisA);var w=this.m_localAnchorD,_=A(d.q,h.Add(S(l.q,this.m_localAnchorB),h.Subtract(l.p,d.p)));n=f(h.Subtract(_,w),this.m_localAxisD)}this.m_ratio=i.ratio,this.m_constant=s+this.m_ratio*n,this.m_impulse=0,this.m_indexA=this.m_indexB=this.m_indexC=this.m_indexD=0,this.m_lcA=new h,this.m_lcB=new h,this.m_lcC=new h,this.m_lcD=new h,this.m_mA=this.m_mB=this.m_mC=this.m_mD=0,this.m_iA=this.m_iB=this.m_iC=this.m_iD=0,this.m_JvAC=new h,this.m_JvBD=new h,this.m_JwA=this.m_JwB=this.m_JwC=this.m_JwD=0,this.m_mass=0}function Pi(){this.parent.call(this),this.type=vi.e_motorJoint,this.linearOffset=new h,this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3,Object.seal(this)}function Ri(t){this.parent.call(this,t),this.m_linearOffset=t.linearOffset.Clone(),this.m_angularOffset=t.angularOffset,this.m_linearImpulse=new h,this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_indexA=0,this.m_indexB=0,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_linearError=new h,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new e,this.m_angularMass=0}function Ii(){this.parent.call(this),this.type=vi.e_pulleyJoint,this.groundAnchorA=new h(-1,1),this.groundAnchorB=new h(1,1),this.localAnchorA=new h(-1,0),this.localAnchorB=new h(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0,Object.seal(this)}function Li(i){this.parent.call(this,i),this.m_indexA=0,this.m_indexB=0,this.m_uA=new h,this.m_uB=new h,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_groundAnchorA=i.groundAnchorA.Clone(),this.m_groundAnchorB=i.groundAnchorB.Clone(),this.m_localAnchorA=i.localAnchorA.Clone(),this.m_localAnchorB=i.localAnchorB.Clone(),this.m_lengthA=i.lengthA,this.m_lengthB=i.lengthB,t(0!=i.ratio),this.m_ratio=i.ratio,this.m_constant=i.lengthA+this.m_ratio*i.lengthB,this.m_impulse=0}function Di(){this.parent.call(this),this.type=vi.e_ropeJoint,this.localAnchorA=new h(-1,0),this.localAnchorB=new h(1,0),this.maxLength=0,Object.seal(this)}function Fi(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_state=vi.e_inactiveLimit,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new h,this.m_rA=new h,this.m_rB=new h,this.m_localCenterA=new h,this.m_localCenterB=new h,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0}function Ni(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_damping=0,this.m_gravity=new h,this.m_k2=1,this.m_k3=.1}Function.prototype._extend=function(t){this.prototype.parent=t;for(var i in t.prototype)this.prototype[i]||(this.prototype[i]=t.prototype[i])},Function.prototype._implement=function(t){return this._extend(t)};var ki=function(){function t(t,i){this.name=t,this.parent=i,this.children={},this.startTime=0,this.elapsedTime=0,this.totalTime=0,this.running=!1,this.childrenCount=0}function i(t,s){if(t.name===s.parent)return t;for(var n in t.children){var h;if(h=i(t.children[n],s))return h}return null}"undefined"==typeof performance&&(window.performance={now:function(){return+new Date}}),t.prototype={start:function(){this.startTime=performance.now(),this.running=!0},stop:function(t){if(this.running){this.running=!1,this.elapsedTime+=performance.now()-this.startTime,t&&this.start();for(var i in this.children)this.children[i].stop()}},reset:function(t){t||(this.running=!0,this.totalTime+=this.elapsedTime,this.start()),this.elapsedTime=0;for(var i in this.children)this.children[i].reset(!0)}};var s=[],n=new t("root");return{create:function(i,n){if(!s)throw new Error("late profile creation not allowed");var h=new t(i,n||"root");return s.push(h),h},destroy:function(t){t.childrenCount--,delete t.children[t.name]},_:function(){for(;s.length;){var t=s.pop();(t.parentNode=i(n,t))?(t.parentNode.children[t.name]=t,t.parentNode.childrenCount++):s.unshift(t)}s=null},reset:function(){n.reset(!0)},profileRoot:n}}(),Bi=Number.MAX_VALUE,Gi=2.220446049250313e-16,zi=Math.PI,ji=2,Vi=8,Ui=.005,Wi=2/180*zi,Hi=2*Ui,Xi=8/180*zi,Ji=.5*zi,Yi=Ji*Ji,qi=2/180*zi;s.prototype={toString:function(){return this.major+"."+this.minor+"."+this.revision}};var Zi=new s(2,3,1),Qi=Math.sqrt,Ki=Math.atan2,$i=Math.sin,ts=Math.cos,is=Math.floor,ss=(Math.ceil,Qi),ns=Ki;h.prototype={Clone:function(){return new h(this.x,this.y)},SetZero:function(){return this.x=0,this.y=0,this},Set:function(t,i){return this.x=t,this.y=i,this},Assign:function(t){return this.x=t.x,this.y=t.y,this},Negate:function(){var t=new h;return t.Set(-this.x,-this.y),t},get_i:function(t){switch(t){case 0:return this.x;case 1:return this.y}},set_i:function(t,i){switch(t){case 0:return this.x=i;case 1:return this.y=i}},Add:function(t){return this.x+=t.x,this.y+=t.y,this},Subtract:function(t){return this.x-=t.x,this.y-=t.y,this},Multiply:function(t){return this.x*=t,this.y*=t,this},Length:function(){return ss(this.x*this.x+this.y*this.y)},LengthSquared:function(){return this.x*this.x+this.y*this.y},Normalize:function(){var t=this.Length();if(t<Gi)return 0;var i=1/t;return this.x*=i,this.y*=i,t},IsValid:function(){return n(this.x)&&n(this.y)},Skew:function(){return new h(-this.y,this.x)},_serialize:function(t){var i=t||[];return i[0]=this.x,i[1]=this.y,i},_deserialize:function(t){this.x=t[0],this.y=t[1]}},h.Add=function(t,i){return new h(t.x+i.x,t.y+i.y)},h.Subtract=function(t,i){return new h(t.x-i.x,t.y-i.y)},h.Equals=function(t,i){return t.x==i.x&&t.y==i.y},h.Multiply=function(t,i){return new h(t*i.x,t*i.y)},h.Negate=function(t){return new h(-t.x,-t.y)},r.prototype={Clone:function(){return new r(this.x,this.y,this.z)},SetZero:function(){this.x=0,this.y=0,this.z=0},Set:function(t,i,s){this.x=t,this.y=i,this.z=s},Negate:function(){var t=new r;return t.Set(-this.x,-this.y,-this.z),t},Add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},Subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},Multiply:function(t){this.x*=t,this.y*=t,this.z*=t},Invert:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},x:0,y:0,z:0},r.Multiply=function(t,i){return new r(t*i.x,t*i.y,t*i.z)},r.Add=function(t,i){return new r(t.x+i.x,t.y+i.y,t.z+i.z)},r.Subtract=function(t,i){return new r(t.x-i.x,t.y-i.y,t.z-i.z)},e.prototype={Set:function(t,i){this.ex.Assign(t),this.ey.Assign(i)},Assign:function(t){this.ex.Assign(t.ex),this.ey.Assign(t.ey)},SetIdentity:function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},SetZero:function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},GetInverse:function(){var t=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,h=new e,r=t*n-i*s;return 0!=r&&(r=1/r),h.ex.x=r*n,h.ey.x=-r*i,h.ex.y=-r*s,h.ey.y=r*t,h},Solve:function(t){var i=this.ex.x,s=this.ey.x,n=this.ex.y,r=this.ey.y,e=i*r-s*n;0!=e&&(e=1/e);var c=new h;return c.x=e*(r*t.x-s*t.y),c.y=e*(i*t.y-n*t.x),c}},e.Add=function(t,i){return new e(h.Add(t.ex,i.ex),h.Add(t.ey,i.ey))},c.prototype={SetZero:function(){this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero()},Solve33:function(t){var i=w(this.ex,_(this.ey,this.ez));0!=i&&(i=1/i);var s=new r;return s.x=i*w(t,_(this.ey,this.ez)),s.y=i*w(this.ex,_(t,this.ez)),s.z=i*w(this.ex,_(this.ey,t)),s},Solve22:function(t){var i=this.ex.x,s=this.ey.x,n=this.ex.y,r=this.ey.y,e=i*r-s*n;0!=e&&(e=1/e);var c=new h;return c.x=e*(r*t.x-s*t.y),c.y=e*(i*t.y-n*t.x),c},GetInverse22:function(t){var i=this.ex.x,s=this.ey.x,n=this.ex.y,h=this.ey.y,r=i*h-s*n;0!=r&&(r=1/r),t.ex.x=r*h,t.ey.x=-r*s,t.ex.z=0,t.ex.y=-r*n,t.ey.y=r*i,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},GetSymInverse33:function(t){var i=w(this.ex,_(this.ey,this.ez));0!=i&&(i=1/i);var s=this.ex.x,n=this.ey.x,h=this.ez.x,r=this.ey.y,e=this.ez.y,c=this.ez.z;t.ex.x=i*(r*c-e*e),t.ex.y=i*(h*e-n*c),t.ex.z=i*(n*e-h*r),t.ey.x=t.ex.y,t.ey.y=i*(s*c-h*h),t.ey.z=i*(h*n-s*e),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=i*(s*r-n*n)}},o.prototype={Clone:function(){return new o(this.s,this.c)},Assign:function(t){this.s=t.s,this.c=t.c},Set:function(t){this.s=$i(t),this.c=ts(t)},SetIdentity:function(){this.s=0,this.c=1},GetAngle:function(){return ns(this.s,this.c)},GetXAxis:function(){return new h(this.c,this.s)},GetYAxis:function(){return new h(-this.s,this.c)},s:0,c:1},u.prototype={Clone:function(){return new u(this.p,this.q)},Assign:function(t){this.p.Assign(t.p),this.q.Assign(t.q)},SetIdentity:function(){this.p.SetZero(),this.q.SetIdentity()},Set:function(t,i){this.p.Assign(t),this.q.Set(i)}},a.prototype={Assign:function(t){this.localCenter.Assign(t.localCenter),this.c0.Assign(t.c0),this.c.Assign(t.c),this.a=t.a,this.a0=t.a0,this.alpha0=t.alpha0},Clone:function(){var t=new a;return t.localCenter.Assign(this.localCenter),t.c0.Assign(this.c0),t.c.Assign(this.c),t.a=this.a,t.a0=this.a0,t.alpha0=this.alpha0,t},GetTransform:function(t,i){t.p.x=(1-i)*this.c0.x+i*this.c.x,t.p.y=(1-i)*this.c0.y+i*this.c.y;var s=(1-i)*this.a0+i*this.a;t.q.Set(s),t.p.x-=t.q.c*this.localCenter.x-t.q.s*this.localCenter.y,t.p.y-=t.q.s*this.localCenter.x+t.q.c*this.localCenter.y},Advance:function(i){t(this.alpha0<1);var s=(i-this.alpha0)/(1-this.alpha0);this.c0.Add(h.Multiply(s,h.Subtract(this.c,this.c0))),this.a0+=s*(this.a-this.a0),this.alpha0=i},Normalize:function(){var t=2*zi,i=t*is(this.a0/t);this.a0-=i,this.a-=i},a0:0,a:0,alpha0:0};var hs=Math.abs,rs=Math.min,es=Math.max;L.prototype={Set:function(t,i,s){this.r=t,this.g=i,this.b=s}},D.prototype={ClearDraw:function(){},SetFlags:function(t){this.m_drawFlags=t},GetFlags:function(){return this.m_drawFlags},AppendFlags:function(t){this.m_drawFlags|=t},ClearFlags:function(t){this.m_drawFlags&=~t},ToggleFlags:function(t){this.m_drawFlags^=t},DrawPolygon:function(t,i,s){},DrawSolidPolygon:function(t,i,s){},DrawCircle:function(t,i,s){},DrawSolidCircle:function(t,i,s,n){},DrawSegment:function(t,i,s){},DrawTransform:function(t){},m_drawFlags:0},D.e_shapeBit=1,D.e_jointBit=2,D.e_aabbBit=4,D.e_centerOfMassBit=8,D.e_contactPoints=16,D.e_contactNormals=32,D.e_contactImpulses=64,D.e_frictionImpulses=128,D.e_statistics=256,D.e_profile=512,D.e_pairBit=1024,"undefined"==typeof performance&&(window.performance={now:function(){return+new Date}}),F.prototype={Reset:function(){this.m_start=performance.now()},GetMilliseconds:function(){return performance.now()-this.m_start}},k.prototype={Clone:function(){},GetType:function(){return this.m_type},GetChildCount:function(){},TestPoint:function(t,i){},RayCast:function(t,i,s,n){},ComputeAABB:function(t,i,s){},ComputeMass:function(t,i){},_serialize:function(t){var i=t||{};return i.m_type=this.m_type,i.m_radius=this.m_radius,i},_deserialize:function(t){this.m_radius=t.m_radius}},k.e_circle=0,k.e_edge=1,k.e_polygon=2,k.e_chain=3,k.e_typeCount=4,B.prototype={Clone:function(){var t=new B;return t.m_radius=this.m_radius,t.m_p=this.m_p.Clone(),t},GetChildCount:function(){return 1},TestPoint:function(t,i){var s=h.Add(t.p,S(t.q,this.m_p)),n=h.Subtract(i,s);return f(n,n)<=this.m_radius*this.m_radius},RayCast:function(t,i,s,n){var r=h.Add(s.p,S(s.q,this.m_p)),e=h.Subtract(i.p1,r),c=f(e,e)-this.m_radius*this.m_radius,o=h.Subtract(i.p2,i.p1),u=f(e,o),a=f(o,o),l=u*u-a*c;if(l<0||a<Gi)return!1;var v=-(u+ss(l));return 0<=v&&v<=i.maxFraction*a&&(v/=a,t.fraction=v,t.normal=h.Add(e,h.Multiply(v,o)),t.normal.Normalize(),!0)},ComputeAABB:function(t,i,s){var n=i.p.x+(i.q.c*this.m_p.x-i.q.s*this.m_p.y),h=i.p.y+(i.q.s*this.m_p.x+i.q.c*this.m_p.y);t.lowerBound.x=n-this.m_radius,t.lowerBound.y=h-this.m_radius,t.upperBound.x=n+this.m_radius,t.upperBound.y=h+this.m_radius},ComputeMass:function(t,i){t.mass=i*zi*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+f(this.m_p,this.m_p))},GetSupport:function(t){return 0},GetSupportVertex:function(t){return this.m_p},GetVertexCount:function(){return 1},GetVertex:function(i){return t(0==i),this.m_p},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.m_p=this.m_p._serialize(),i},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_p._deserialize(t.m_p)}},B._extend(k),G.prototype={Set:function(t,i){this.m_vertex1.Assign(t),this.m_vertex2.Assign(i),this.m_hasVertex0=!1,this.m_hasVertex3=!1},Clone:function(){var t=new G;return t.m_vertex0=this.m_vertex0.Clone(),t.m_vertex1=this.m_vertex1.Clone(),t.m_vertex2=this.m_vertex2.Clone(),t.m_vertex3=this.m_vertex3.Clone(),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},GetChildCount:function(){return 1},TestPoint:function(t,i){return!1},RayCast:function(t,i,s,n){var r=A(s.q,h.Subtract(i.p1,s.p)),e=A(s.q,h.Subtract(i.p2,s.p)),c=h.Subtract(e,r),o=this.m_vertex1,u=this.m_vertex2,a=h.Subtract(u,o),l=new h(a.y,-a.x);l.Normalize();var v=f(l,h.Subtract(o,r)),d=f(l,c);if(0==d)return!1;var p=v/d;if(p<0||i.maxFraction<p)return!1;var g=h.Add(r,h.Multiply(p,c)),m=h.Subtract(u,o),w=f(m,m);if(0==w)return!1;var _=f(h.Subtract(g,o),m)/w;return!(_<0||1<_||(t.fraction=p,t.normal=v>0?S(s.q,l).Negate():S(s.q,l),0))},ComputeAABB:function(t,i,s){var n=i.q.c*this.m_vertex1.x-i.q.s*this.m_vertex1.y+i.p.x,h=i.q.s*this.m_vertex1.x+i.q.c*this.m_vertex1.y+i.p.y,r=i.q.c*this.m_vertex2.x-i.q.s*this.m_vertex2.y+i.p.x,e=i.q.s*this.m_vertex2.x+i.q.c*this.m_vertex2.y+i.p.y,c=rs(n,r),o=rs(h,e),u=es(n,r),a=es(h,e);t.lowerBound.x=c-this.m_radius,t.lowerBound.y=o-this.m_radius,t.upperBound.x=u+this.m_radius,t.upperBound.y=a+this.m_radius},ComputeMass:function(t,i){t.mass=0,t.center=h.Multiply(.5,h.Add(this.m_vertex1,this.m_vertex2)),t.I=0},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.m_vertex1=this.m_vertex1._serialize(),i.m_vertex2=this.m_vertex2._serialize(),i.m_hasVertex0=this.m_hasVertex0,this.m_hasVertex0&&(i.m_vertex0=this.m_vertex0._serialize()),i.m_hasVertex3=this.m_hasVertex3,this.m_hasVertex3&&(i.m_vertex3=this.m_vertex3._serialize()),i},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_vertex1._deserialize(t.m_vertex1),this.m_vertex2._deserialize(t.m_vertex2),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex0&&this.m_vertex0._deserialize(t.m_vertex0),this.m_hasVertex3=t.m_hasVertex3,this.m_hasVertex3&&this.m_vertex3._deserialize(t.m_vertex3)}},G._extend(k),z._tempEdge=new G,z.prototype={Clear:function(){this.m_vertices=null,this.m_count=0},CreateLoop:function(i,s){for(t(null==this.m_vertices&&0==this.m_count),t(s>=3),n=1;n<s;++n)t(m(i[n-1],i[n])>Ui*Ui);this.m_count=s+1,this.m_vertices=new Array(this.m_count);for(var n=0;n<s;++n)this.m_vertices[n]=i[n].Clone();this.m_vertices[s]=this.m_vertices[0].Clone(),this.m_prevVertex.Assign(this.m_vertices[this.m_count-2]),this.m_nextVertex.Assign(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0},CreateChain:function(i,s){for(t(null==this.m_vertices&&0==this.m_count),t(s>=2),n=1;n<s;++n)t(m(i[n-1],i[n])>Ui*Ui);this.m_count=s,this.m_vertices=new Array(s);for(var n=0;n<s;++n)this.m_vertices[n]=i[n].Clone();this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero()},SetPrevVertex:function(t){this.m_prevVertex.Assign(t),this.m_hasPrevVertex=!0},SetNextVertex:function(t){this.m_nextVertex.Assign(t),this.m_hasNextVertex=!0},Clone:function(){var t=new z;t.m_count=this.m_count,t.m_vertices=new Array(this.m_count);for(var i=0;i<this.m_count;++i)t.m_vertices[i]=this.m_vertices[i].Clone();return t.m_prevVertex=this.m_prevVertex.Clone(),t.m_nextVertex=this.m_nextVertex.Clone(),t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},GetChildCount:function(){return this.m_count-1},GetChildEdge:function(i,s){t(0<=s&&s<this.m_count-1),i.m_type=k.e_edge,i.m_radius=this.m_radius,i.m_vertex1=this.m_vertices[s+0],i.m_vertex2=this.m_vertices[s+1],s>0?(i.m_vertex0=this.m_vertices[s-1],i.m_hasVertex0=!0):(i.m_vertex0=this.m_prevVertex,i.m_hasVertex0=this.m_hasPrevVertex),s<this.m_count-2?(i.m_vertex3=this.m_vertices[s+2],i.m_hasVertex3=!0):(i.m_vertex3=this.m_nextVertex,i.m_hasVertex3=this.m_hasNextVertex)},TestPoint:function(t,i){return!1},RayCast:function(i,s,n,h){t(h<this.m_count);var r=h,e=h+1;return e==this.m_count&&(e=0),z._tempEdge.m_vertex1=this.m_vertices[r].Clone(),z._tempEdge.m_vertex2=this.m_vertices[e].Clone(),z._tempEdge.RayCast(i,s,n,0)},ComputeAABB:function(i,s,n){t(n<this.m_count);var h=n,r=n+1;r==this.m_count&&(r=0);var e=s.q.c*this.m_vertices[h].x-s.q.s*this.m_vertices[h].y+s.p.x,c=s.q.s*this.m_vertices[h].x+s.q.c*this.m_vertices[h].y+s.p.y,o=s.q.c*this.m_vertices[r].x-s.q.s*this.m_vertices[r].y+s.p.x,u=s.q.s*this.m_vertices[r].x+s.q.c*this.m_vertices[r].y+s.p.y;i.lowerBound.x=rs(e,o),i.lowerBound.y=rs(c,u),i.upperBound.x=es(e,o),i.upperBound.y=es(c,u)},ComputeMass:function(t,i){t.mass=0,t.center.SetZero(),t.I=0},_serialize:function(t){var i=t||{};this.parent.prototype._serialize.call(this,i),i.m_count=this.m_count,i.m_vertices=[];for(var s=0;s<this.m_count;++s)i.m_vertices.push(this.m_vertices[s]._serialize());return i.m_hasPrevVertex=this.m_hasPrevVertex,this.m_hasPrevVertex&&(i.m_prevVertex=this.m_prevVertex._serialize()),i.m_hasNextVertex=this.m_hasNextVertex,this.m_hasNextVertex&&(i.m_nextVertex=this.m_nextVertex._serialize()),i},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_count=t.m_count,this.m_vertices=[];for(var i=0;i<this.m_count;++i)this.m_vertices[i]=new h,this.m_vertices[i]._deserialize(t.m_vertices[i]);this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasPrevVertex&&this.m_prevVertex._deserialize(t.m_prevVertex),this.m_hasNextVertex=t.m_hasNextVertex,this.m_hasNextVertex&&this.m_nextVertex._deserialize(t.m_nextVertex)}},z._extend(k),j.prototype={Clone:function(){var t=new j;t.m_count=this.m_count,t.m_centroid=this.m_centroid.Clone();for(var i=0;i<this.m_count;++i)t.m_vertices[i]=this.m_vertices[i].Clone(),t.m_normals[i]=this.m_normals[i].Clone();return t},GetChildCount:function(){return 1},Set:function(i,s){if(t(3<=s&&s<=Vi),s<3)this.SetAsBox(1,1);else{for(var n=rs(s,Vi),r=new Array(Vi),e=0,c=0;c<n;++c){for(var o=i[c],u=!0,a=0;a<e;++a)if(m(o,r[a])<.5*Ui){u=!1;break}u&&(r[e++]=o.Clone())}if((n=e)<3)return t(!1),void this.SetAsBox(1,1);var f=0,d=r[0].x;for(c=1;c<n;++c){var p=r[c].x;(p>d||p==d&&r[c].y<r[f].y)&&(f=c,d=p)}for(var g=new Array(Vi),w=0,_=f;;){g[w]=_;var C=0;for(a=1;a<n;++a)if(C!=_){var b=h.Subtract(r[C],r[g[w]]),y=l(b,o=h.Subtract(r[a],r[g[w]]));y<0&&(C=a),0==y&&o.LengthSquared()>b.LengthSquared()&&(C=a)}else C=a;if(++w,_=C,C==f)break}if(w<3)return t(!1),void this.SetAsBox(1,1);for(this.m_count=w,c=0;c<w;++c)this.m_vertices[c]=r[g[c]].Clone();for(c=0;c<w;++c){var T=c,S=c+1<w?c+1:0,A=h.Subtract(this.m_vertices[S],this.m_vertices[T]);t(A.LengthSquared()>Gi*Gi),this.m_normals[c]=v(A,1).Clone(),this.m_normals[c].Normalize()}this.m_centroid=j.ComputeCentroid(this.m_vertices,w)}},SetAsBox:function(t,i,s,n){if(this.m_count=4,this.m_vertices[0]=new h(-t,-i),this.m_vertices[1]=new h(t,-i),this.m_vertices[2]=new h(t,i),this.m_vertices[3]=new h(-t,i),this.m_normals[0]=new h(0,-1),this.m_normals[1]=new h(1,0),this.m_normals[2]=new h(0,1),this.m_normals[3]=new h(-1,0),s){this.m_centroid.Assign(s);var r=new u;r.p=s,r.q.Set(n);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Assign(M(r,this.m_vertices[e])),this.m_normals[e].Assign(S(r.q,this.m_normals[e]))}},TestPoint:function(t,i){for(var s=A(t.q,h.Subtract(i,t.p)),n=0;n<this.m_count;++n)if(f(this.m_normals[n],h.Subtract(s,this.m_vertices[n]))>0)return!1;return!0},RayCast:function(i,s,n,r){for(var e=A(n.q,h.Subtract(s.p1,n.p)),c=A(n.q,h.Subtract(s.p2,n.p)),o=h.Subtract(c,e),u=0,a=s.maxFraction,l=-1,v=0;v<this.m_count;++v){var d=f(this.m_normals[v],h.Subtract(this.m_vertices[v],e)),p=f(this.m_normals[v],o);if(0==p){if(d<0)return!1}else p<0&&d<u*p?(u=d/p,l=v):p>0&&d<a*p&&(a=d/p);if(a<u)return!1}return t(0<=u&&u<=s.maxFraction),l>=0&&(i.fraction=u,i.normal=S(n.q,this.m_normals[l]),!0)},ComputeAABB:function(t,i,s){for(var n=i.q.c*this.m_vertices[0].x-i.q.s*this.m_vertices[0].y+i.p.x,h=i.q.s*this.m_vertices[0].x+i.q.c*this.m_vertices[0].y+i.p.y,r=n,e=h,c=1;c<this.m_count;++c){var o=i.q.c*this.m_vertices[c].x-i.q.s*this.m_vertices[c].y+i.p.x,u=i.q.s*this.m_vertices[c].x+i.q.c*this.m_vertices[c].y+i.p.y;n=rs(n,o),h=rs(h,u),r=es(r,o),e=es(e,u)}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=h-this.m_radius,t.upperBound.x=r+this.m_radius,t.upperBound.y=e+this.m_radius},ComputeMass:function(i,s){t(this.m_count>=3);for(var n=new h(0,0),r=0,e=0,c=new h(0,0),o=0;o<this.m_count;++o)c.Add(this.m_vertices[o]);for(c.Multiply(1/this.m_count),o=0;o<this.m_count;++o){var u=h.Subtract(this.m_vertices[o],c),a=o+1<this.m_count?h.Subtract(this.m_vertices[o+1],c):h.Subtract(this.m_vertices[0],c),v=l(u,a),d=.5*v;r+=d,n.Add(h.Multiply(d*(1/3),h.Add(u,a)));var p=u.x,g=u.y,m=a.x,w=a.y;e+=1/3*.25*v*(p*p+m*p+m*m+(g*g+w*g+w*w))}i.mass=s*r,t(r>Gi),n.Multiply(1/r),i.center=h.Add(n,c),i.I=s*e,i.I+=i.mass*(f(i.center,i.center)-f(n,n))},GetVertexCount:function(){return this.m_count},GetVertex:function(i){return t(0<=i&&i<this.m_count),this.m_vertices[i]},Validate:function(){for(var t=0;t<this.m_count;++t)for(var i=t,s=t<this.m_count-1?i+1:0,n=this.m_vertices[i],r=h.Subtract(this.m_vertices[s],n),e=0;e<this.m_count;++e)if(e!=i&&e!=s&&l(r,h.Subtract(this.m_vertices[e],n))<0)return!1;return!0},_serialize:function(t){var i=t||{};this.parent.prototype._serialize.call(this,i),i.m_count=this.m_count,i.m_centroid=this.m_centroid._serialize(),i.m_vertices=[],i.m_normals=[];for(var s=0;s<this.m_count;++s)i.m_vertices.push(this.m_vertices[s]._serialize()),i.m_normals.push(this.m_normals[s]._serialize());return i},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_count=t.m_count,this.m_centroid._deserialize(t.m_centroid),this.m_vertices=[],this.m_normals=[];for(var i=0;i<this.m_count;++i)this.m_vertices[i]=new h,this.m_vertices[i]._deserialize(t.m_vertices[i]),this.m_normals[i]=new h,this.m_normals[i]._deserialize(t.m_normals[i])}},j.ComputeCentroid=function(i,s){t(s>=3);for(var n=new h,r=0,e=new h(0,0),c=0;c<s;++c){var o=e,u=i[c],a=c+1<s?i[c+1]:i[0],f=.5*l(h.Subtract(u,o),h.Subtract(a,o));r+=f,n.Add(h.Multiply(f,h.Multiply(1/3,h.Add(h.Add(o,u),a))))}return t(r>Gi),n.Multiply(1/r),n},j._extend(k),W.prototype={CreateProxy:function(t,i){var s=this.m_tree.CreateProxy(t,i);return++this.m_proxyCount,this.BufferMove(s),s},DestroyProxy:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},MoveProxy:function(t,i,s){this.m_tree.MoveProxy(t,i,s)&&this.BufferMove(t)},TouchProxy:function(t){this.BufferMove(t)},GetFatAABB:function(t){return this.m_tree.GetFatAABB(t)},GetUserData:function(t){return this.m_tree.GetUserData(t)},TestOverlap:function(t,i){return _t(this.m_tree.GetFatAABB(t),this.m_tree.GetFatAABB(i))},GetProxyCount:function(){return this.m_proxyCount},UpdatePairs:function(t){for(this.m_pairCount=0,this.m_pairBuffer.length=0,s=0;s<this.m_moveCount;++s)if(this.m_queryProxyId=this.m_moveBuffer[s],this.m_queryProxyId!=W.e_nullProxy){var i=this.m_tree.GetFatAABB(this.m_queryProxyId);this.m_tree.Query(this,i)}this.m_moveCount=0,this.m_pairBuffer.sort(U);for(var s=0;s<this.m_pairCount;){var n=this.m_pairBuffer[s],h=this.m_tree.GetUserData(n.proxyIdA),r=this.m_tree.GetUserData(n.proxyIdB);for(t.AddPair(h,r),++s;s<this.m_pairCount;){var e=this.m_pairBuffer[s];if(e.proxyIdA!=n.proxyIdA||e.proxyIdB!=n.proxyIdB)break;++s}}},Query:function(t,i){this.m_tree.Query(t,i)},RayCast:function(t,i){this.m_tree.RayCast(t,i)},GetTreeHeight:function(){return this.m_tree.GetHeight()},GetTreeBalance:function(){return this.m_tree.GetMaxBalance()},GetTreeQuality:function(){return this.m_tree.GetAreaRatio()},ShiftOrigin:function(t){this.m_tree.ShiftOrigin(t)},BufferMove:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},UnBufferMove:function(t){for(var i=0;i<this.m_moveCount;++i)this.m_moveBuffer[i]==t&&(this.m_moveBuffer[i]=W.e_nullProxy)},QueryCallback:function(t){return t==this.m_queryProxyId||(this.m_pairBuffer[this.m_pairCount]=new V,this.m_pairBuffer[this.m_pairCount].proxyIdA=rs(t,this.m_queryProxyId),this.m_pairBuffer[this.m_pairCount].proxyIdB=es(t,this.m_queryProxyId),++this.m_pairCount,!0)}},W.e_nullProxy=-1,H.prototype={Assign:function(t){this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius},Set:function(i,s){switch(i.GetType()){case k.e_circle:var n=i;this.m_vertices=[n.m_p],this.m_count=1,this.m_radius=n.m_radius;break;case k.e_polygon:var h=i;this.m_vertices=h.m_vertices,this.m_count=h.m_count,this.m_radius=h.m_radius;break;case k.e_chain:var r=i;t(0<=s&&s<r.m_count),this.m_vertices=[r.m_vertices[s]],s+1<r.m_count?this.m_vertices[1]=r.m_vertices[s+1]:this.m_vertices[1]=r.m_vertices[0],this.m_count=2,this.m_radius=r.m_radius;break;case k.e_edge:var e=i;this.m_vertices=[e.m_vertex1,e.m_vertex2],this.m_count=2,this.m_radius=e.m_radius;break;default:t(!1)}},GetSupport:function(t,i){for(var s=0,n=this.m_vertices[0].x*t+this.m_vertices[0].y*i,h=1;h<this.m_count;++h){var r=this.m_vertices[h].x*t+this.m_vertices[h].y*i;r>n&&(s=h,n=r)}return s},GetSupportVertex:function(t,i){return this.m_vertices[this.GetSupport(t,i)]},GetVertexCount:function(){return this.m_count},GetVertex:function(i){return t(0<=i&&i<this.m_count),this.m_vertices[i]}},q.prototype={Assign:function(t){this.wA.x=t.wA.x,this.wA.y=t.wA.y,this.wB.x=t.wB.x,this.wB.y=t.wB.y,this.w.x=t.w.x,this.w.y=t.w.y,this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB}},Z.prototype={ReadCache:function(i,s,n,h,r){t(i.count<=3),this.m_count=i.count;for(var e=this.m_v,c=0;c<this.m_count;++c){(l=e[c]).indexA=i.indexA[c],l.indexB=i.indexB[c];var o=s.GetVertex(l.indexA),u=h.GetVertex(l.indexB);l.wA.x=n.q.c*o.x-n.q.s*o.y+n.p.x,l.wA.y=n.q.s*o.x+n.q.c*o.y+n.p.y,l.wB.x=r.q.c*u.x-r.q.s*u.y+r.p.x,l.wB.y=r.q.s*u.x+r.q.c*u.y+r.p.y,l.w.x=l.wB.x-l.wA.x,l.w.y=l.wB.y-l.wA.y,l.a=0}if(this.m_count>1){var a=i.metric,f=this.GetMetric();(f<.5*a||2*a<f||f<Gi)&&(this.m_count=0)}if(0==this.m_count){var l=e[0];l.indexA=0,l.indexB=0,o=s.GetVertex(0),u=h.GetVertex(0),l.wA.x=n.q.c*o.x-n.q.s*o.y+n.p.x,l.wA.y=n.q.s*o.x+n.q.c*o.y+n.p.y,l.wB.x=r.q.c*u.x-r.q.s*u.y+r.p.x,l.wB.y=r.q.s*u.x+r.q.c*u.y+r.p.y,l.w.x=l.wB.x-l.wA.x,l.w.y=l.wB.y-l.wA.y,l.a=1,this.m_count=1}},WriteCache:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var i=this.m_v,s=0;s<this.m_count;++s)t.indexA[s]=i[s].indexA,t.indexB[s]=i[s].indexB},GetSearchDirection:function(i){switch(this.m_count){case 1:i.x=-this.m_v[0].w.x,i.y=-this.m_v[0].w.y;break;case 2:var s=this.m_v[1].w.x-this.m_v[0].w.x,n=this.m_v[1].w.y-this.m_v[0].w.y;s*-this.m_v[0].w.y-n*-this.m_v[0].w.x>0?(i.x=-1*n,i.y=1*s):(i.x=1*n,i.y=-1*s);break;default:t(!1),i.x=i.y=0}},GetClosestPoint:function(i){switch(this.m_count){case 1:i.x=this.m_v[0].w.x,i.y=this.m_v[0].w.y;break;case 2:i.x=this.m_v[0].a*this.m_v[0].w.x+this.m_v[1].a*this.m_v[1].w.x,i.y=this.m_v[0].a*this.m_v[0].w.y+this.m_v[1].a*this.m_v[1].w.y;break;case 3:i.x=i.y=0;break;default:t(!1),i.x=i.y=0}},GetWitnessPoints:function(i,s){switch(this.m_count){case 1:i.x=this.m_v[0].wA.x,i.y=this.m_v[0].wA.y,s.x=this.m_v[0].wB.x,s.y=this.m_v[0].wB.y;break;case 2:i.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x,i.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y,s.x=this.m_v[0].a*this.m_v[0].wB.x+this.m_v[1].a*this.m_v[1].wB.x,s.y=this.m_v[0].a*this.m_v[0].wB.y+this.m_v[1].a*this.m_v[1].wB.y;break;case 3:i.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x+this.m_v[2].a*this.m_v[2].wA.x,i.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y+this.m_v[2].a*this.m_v[2].wA.y,s.x=i.x,s.y=i.y;break;default:t(!1)}},GetMetric:function(){switch(this.m_count){case 1:return 0;case 2:return g(this.m_v[0].w,this.m_v[1].w);case 3:return(this.m_v[1].w.x-this.m_v[0].w.x)*(this.m_v[2].w.y-this.m_v[0].w.y)-(this.m_v[1].w.y-this.m_v[0].w.y)*(this.m_v[2].w.x-this.m_v[0].w.x);default:return t(!1),0}},Solve2:function(){var t=this.m_v[0].w,i=this.m_v[1].w,s=i.x-t.x,n=i.y-t.y,h=-(t.x*s+t.y*n);if(h<=0)return this.m_v[0].a=1,void(this.m_count=1);var r=i.x*s+i.y*n;if(r<=0)return this.m_v[1].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[1]);var e=1/(r+h);this.m_v[0].a=r*e,this.m_v[1].a=h*e,this.m_count=2},Solve3:function(){var t=this.m_v[0].w,i=this.m_v[1].w,s=this.m_v[2].w,n=i.x-t.x,h=i.y-t.y,r=t.x*n+t.y*h,e=i.x*n+i.y*h,c=-r,o=s.x-t.x,u=s.y-t.y,a=t.x*o+t.y*u,f=s.x*o+s.y*u,l=-a,v=s.x-i.x,d=s.y-i.y,p=i.x*v+i.y*d,g=s.x*v+s.y*d,m=-p,w=n*u-h*o,_=w*(i.x*s.y-i.y*s.x),C=w*(s.x*t.y-s.y*t.x),b=w*(t.x*i.y-t.y*i.x);if(c<=0&&l<=0)return this.m_v[0].a=1,void(this.m_count=1);if(e>0&&c>0&&b<=0){var y=1/(e+c);return this.m_v[0].a=e*y,this.m_v[1].a=c*y,void(this.m_count=2)}if(f>0&&l>0&&C<=0){var T=1/(f+l);return this.m_v[0].a=f*T,this.m_v[2].a=l*T,this.m_count=2,void this.m_v[1].Assign(this.m_v[2])}if(e<=0&&m<=0)return this.m_v[1].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[1]);if(f<=0&&g<=0)return this.m_v[2].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[2]);if(g>0&&m>0&&_<=0){var S=1/(g+m);return this.m_v[1].a=g*S,this.m_v[2].a=m*S,this.m_count=2,void this.m_v[0].Assign(this.m_v[2])}var A=1/(_+C+b);this.m_v[0].a=_*A,this.m_v[1].a=C*A,this.m_v[2].a=b*A,this.m_count=3}};var cs=new Z,os=new h,us=new h;Q.b2_gjkCalls=0,Q.b2_gjkIters=0,Q.b2_gjkMaxIters=0,K.prototype={indexA:0,indexB:0,typeA:0,typeB:0,Reset:function(){this.indexA=this.indexB=this.typeA=this.typeB=0},Get:function(){return this.indexA|this.indexB<<8|this.typeA<<16|this.typeB<<24},Assign:function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB}},K.e_vertex=0,K.e_face=1,$.prototype={Clone:function(){var t=new $;return t.localPoint.x=this.localPoint.x,t.localPoint.y=this.localPoint.y,t.normalImpulse=this.normalImpulse,t.tangentImpulse=this.tangentImpulse,t.id.Assign(this.id),t}},tt.prototype={Clone:function(){var t=new tt;t.pointCount=this.pointCount,t.type=this.type,t.localPoint.x=this.localPoint.x,t.localPoint.y=this.localPoint.y,t.localNormal.x=this.localNormal.x,t.localNormal.y=this.localNormal.y;for(var i=0;i<this.pointCount;++i)t.points[i]=this.points[i].Clone();return t},Assign:function(t){this.pointCount=t.pointCount,this.type=t.type,this.localPoint.x=t.localPoint.x,this.localPoint.y=t.localPoint.y,this.localNormal.x=t.localNormal.x,this.localNormal.y=t.localNormal.y;for(var i=0;i<this.pointCount;++i)this.points[i]=t.points[i].Clone()}},tt.e_circles=0,tt.e_faceA=1,tt.e_faceB=2,tt.b2_nullState=0,tt.b2_addState=1,tt.b2_persistState=2,tt.b2_removeState=3,it.prototype={Initialize:function(t,i,s,n,r){if(0!=t.pointCount)switch(t.type){case tt.e_circles:this.normal.x=1,this.normal.y=0;var e=i.q.c*t.localPoint.x-i.q.s*t.localPoint.y+i.p.x,c=i.q.s*t.localPoint.x+i.q.c*t.localPoint.y+i.p.y,o=n.q.c*t.points[0].localPoint.x-n.q.s*t.points[0].localPoint.y+n.p.x,u=n.q.s*t.points[0].localPoint.x+n.q.c*t.points[0].localPoint.y+n.p.y,a=e-o,f=c-u;a*a+f*f>Gi*Gi&&(this.normal.x=o-e,this.normal.y=u-c,this.normal.Normalize());var l=e+s*this.normal.x,v=c+s*this.normal.y,d=o-r*this.normal.x,p=u-r*this.normal.y;this.points[0]=new h(.5*(l+d),.5*(v+p)),this.separations[0]=(d-l)*this.normal.x+(p-v)*this.normal.y;break;case tt.e_faceA:this.normal.x=i.q.c*t.localNormal.x-i.q.s*t.localNormal.y,this.normal.y=i.q.s*t.localNormal.x+i.q.c*t.localNormal.y;for(var g=i.q.c*t.localPoint.x-i.q.s*t.localPoint.y+i.p.x,m=i.q.s*t.localPoint.x+i.q.c*t.localPoint.y+i.p.y,w=0;w<t.pointCount;++w){var _=n.q.c*t.points[w].localPoint.x-n.q.s*t.points[w].localPoint.y+n.p.x,C=n.q.s*t.points[w].localPoint.x+n.q.c*t.points[w].localPoint.y+n.p.y;l=_+(s-(b=(_-g)*this.normal.x+(C-m)*this.normal.y))*this.normal.x,v=C+(s-b)*this.normal.y,d=_-r*this.normal.x,p=C-r*this.normal.y,this.points[w]=new h(.5*(l+d),.5*(v+p)),this.separations[w]=(d-l)*this.normal.x+(p-v)*this.normal.y}break;case tt.e_faceB:for(this.normal.x=n.q.c*t.localNormal.x-n.q.s*t.localNormal.y,this.normal.y=n.q.s*t.localNormal.x+n.q.c*t.localNormal.y,g=n.q.c*t.localPoint.x-n.q.s*t.localPoint.y+n.p.x,m=n.q.s*t.localPoint.x+n.q.c*t.localPoint.y+n.p.y,w=0;w<t.pointCount;++w){_=i.q.c*t.points[w].localPoint.x-i.q.s*t.points[w].localPoint.y+i.p.x,C=i.q.s*t.points[w].localPoint.x+i.q.c*t.points[w].localPoint.y+i.p.y;var b=(_-g)*this.normal.x+(C-m)*this.normal.y;d=_+(r-b)*this.normal.x,p=C+(r-b)*this.normal.y,l=_-s*this.normal.x,v=C-s*this.normal.y,this.points[w]=new h(.5*(l+d),.5*(v+p)),this.separations[w]=(l-d)*this.normal.x+(v-p)*this.normal.y}this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}},rt.prototype={Assign:function(t){this.lowerBound.x=t.lowerBound.x,this.lowerBound.y=t.lowerBound.y,this.upperBound.x=t.upperBound.x,this.upperBound.y=t.upperBound.y},Clone:function(){var t=new rt;return t.lowerBound.x=this.lowerBound.x,t.lowerBound.y=this.lowerBound.y,t.upperBound.x=this.upperBound.x,t.upperBound.y=this.upperBound.y,t},IsValid:function(){return this.upperBound.x-this.lowerBound.x>=0&&this.upperBound.y-this.lowerBound.y>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},GetCenter:function(){return new h(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},GetExtents:function(){return new h(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},GetPerimeter:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},Combine:function(t,i){i?(this.lowerBound.x=rs(t.lowerBound.x,i.lowerBound.x),this.lowerBound.y=rs(t.lowerBound.y,i.lowerBound.y),this.upperBound.x=es(t.upperBound.x,i.upperBound.x),this.upperBound.y=es(t.upperBound.y,i.upperBound.y)):(this.lowerBound.x=rs(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=rs(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=es(this.upperBound.x,t.upperBound.x),this.upperBound.y=es(this.upperBound.y,t.upperBound.y))},Contains:function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},RayCast:function(t,i){for(var s=-Bi,n=Bi,r=i.p1,e=h.Subtract(i.p2,i.p1),c=O(e),o=new h,u=0;u<2;++u)if(c.get_i(u)<Gi){if(r.get_i(u)<this.lowerBound.get_i(u)||this.upperBound.get_i(u)<r.get_i(u))return!1}else{var a=1/e.get_i(u),f=(this.lowerBound.get_i(u)-r.get_i(u))*a,l=(this.upperBound.get_i(u)-r.get_i(u))*a,v=-1;if(f>l){var d=l;l=f,f=d,v=1}if(f>s&&(o.x=o.y=0,o.set_i(u,v),s=f),n=rs(n,l),s>n)return!1}return!(s<0||i.maxFraction<s||(t.fraction=s,t.normal.x=o.x,t.normal.y=o.y,0))}},at._localTangent=new h,at._local_incidentEdges=[new st,new st],lt.e_unknown=0,lt.e_edgeA=1,lt.e_edgeB=2,pt._temp_edge=new h,pt._temp_edge0=new h,pt._temp_edge2=new h,pt.prototype={Collide:function(t,i,s,n,h){this.m_xf.Assign(E(s,h)),this.m_centroidB.x=this.m_xf.q.c*n.m_centroid.x-this.m_xf.q.s*n.m_centroid.y+this.m_xf.p.x,this.m_centroidB.y=this.m_xf.q.s*n.m_centroid.x+this.m_xf.q.c*n.m_centroid.y+this.m_xf.p.y,this.m_v0.x=i.m_vertex0.x,this.m_v0.y=i.m_vertex0.y,this.m_v1.x=i.m_vertex1.x,this.m_v1.y=i.m_vertex1.y,this.m_v2.x=i.m_vertex2.x,this.m_v2.y=i.m_vertex2.y,this.m_v3.x=i.m_vertex3.x,this.m_v3.y=i.m_vertex3.y;var r=i.m_hasVertex0,e=i.m_hasVertex3;pt._temp_edge.x=this.m_v2.x-this.m_v1.x,pt._temp_edge.y=this.m_v2.y-this.m_v1.y,pt._temp_edge.Normalize(),this.m_normal1.x=pt._temp_edge.y,this.m_normal1.y=-pt._temp_edge.x;var c=this.m_normal1.x*(this.m_centroidB.x-this.m_v1.x)+this.m_normal1.y*(this.m_centroidB.y-this.m_v1.y),o=0,u=0,a=!1,f=!1;for(r&&(pt._temp_edge0.x=this.m_v1.x-this.m_v0.x,pt._temp_edge0.y=this.m_v1.y-this.m_v0.y,pt._temp_edge0.Normalize(),this.m_normal0.x=pt._temp_edge0.y,this.m_normal0.y=-pt._temp_edge0.x,a=pt._temp_edge0.x*pt._temp_edge.y-pt._temp_edge0.y*pt._temp_edge.x>=0,o=this.m_normal0.x*(this.m_centroidB.x-this.m_v0.x)+this.m_normal0.y*(this.m_centroidB.y-this.m_v0.y)),e&&(pt._temp_edge2.x=this.m_v3.x-this.m_v2.x,pt._temp_edge2.y=this.m_v3.y-this.m_v2.y,pt._temp_edge2.Normalize(),this.m_normal2.x=pt._temp_edge2.y,this.m_normal2.y=-pt._temp_edge2.x,f=pt._temp_edge.x*pt._temp_edge2.y-pt._temp_edge.y*pt._temp_edge2.x>0,u=this.m_normal2.x*(this.m_centroidB.x-this.m_v2.x)+this.m_normal2.y*(this.m_centroidB.y-this.m_v2.y)),r&&e?a&&f?(this.m_front=o>=0||c>=0||u>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):a?(this.m_front=o>=0||c>=0&&u>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):f?(this.m_front=u>=0||o>=0&&c>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):(this.m_front=o>=0&&c>=0&&u>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):r?a?(this.m_front=o>=0||c>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):(this.m_front=o>=0&&c>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):e?f?(this.m_front=c>=0||u>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)):(this.m_front=c>=0&&u>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)):(this.m_front=c>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)),this.m_polygonB.count=n.m_count,_=0;_<n.m_count;++_)this.m_polygonB.vertices[_]=M(this.m_xf,n.m_vertices[_]),this.m_polygonB.normals[_]=S(this.m_xf.q,n.m_normals[_]);this.m_radius=2*Hi,t.pointCount=0;var l=this.ComputeEdgeSeparation();if(l.type!=lt.e_unknown&&!(l.separation>this.m_radius)){var v=this.ComputePolygonSeparation();if(!(v.type!=lt.e_unknown&&v.separation>this.m_radius)){var d=new lt;d=v.type==lt.e_unknown?l:v.separation>.98*l.separation+.001?v:l;var p=new Array(2),g=new dt;if(d.type==lt.e_edgeA){t.type=tt.e_faceA;for(var m=0,w=this.m_normal.x*this.m_polygonB.normals[0].x+this.m_normal.y*this.m_polygonB.normals[0].y,_=1;_<this.m_polygonB.count;++_){var C=this.m_normal.x*this.m_polygonB.normals[_].x+this.m_normal.y*this.m_polygonB.normals[_].y;C<w&&(w=C,m=_)}var b=m,y=b+1<this.m_polygonB.count?b+1:0;p[0]=new st,p[0].v.x=this.m_polygonB.vertices[b].x,p[0].v.y=this.m_polygonB.vertices[b].y,p[0].id.indexA=0,p[0].id.indexB=b,p[0].id.typeA=K.e_face,p[0].id.typeB=K.e_vertex,p[1]=new st,p[1].v.x=this.m_polygonB.vertices[y].x,p[1].v.y=this.m_polygonB.vertices[y].y,p[1].id.indexA=0,p[1].id.indexB=y,p[1].id.typeA=K.e_face,p[1].id.typeB=K.e_vertex,this.m_front?(g.i1=0,g.i2=1,g.v1.x=this.m_v1.x,g.v1.y=this.m_v1.y,g.v2.x=this.m_v2.x,g.v2.y=this.m_v2.y,g.normal.x=this.m_normal1.x,g.normal.y=this.m_normal1.y):(g.i1=1,g.i2=0,g.v1.x=this.m_v2.x,g.v1.y=this.m_v2.y,g.v2.x=this.m_v1.x,g.v2.y=this.m_v1.y,g.normal.x=-this.m_normal1.x,g.normal.y=-this.m_normal1.y)}else t.type=tt.e_faceB,p[0]=new st,p[0].v=this.m_v1,p[0].id.indexA=0,p[0].id.indexB=d.index,p[0].id.typeA=K.e_vertex,p[0].id.typeB=K.e_face,p[1]=new st,p[1].v=this.m_v2,p[1].id.indexA=0,p[1].id.indexB=d.index,p[1].id.typeA=K.e_vertex,p[1].id.typeB=K.e_face,g.i1=d.index,g.i2=g.i1+1<this.m_polygonB.count?g.i1+1:0,g.v1.x=this.m_polygonB.vertices[g.i1].x,g.v1.y=this.m_polygonB.vertices[g.i1].y,g.v2.x=this.m_polygonB.vertices[g.i2].x,g.v2.y=this.m_polygonB.vertices[g.i2].y,g.normal.x=this.m_polygonB.normals[g.i1].x,g.normal.y=this.m_polygonB.normals[g.i1].y;g.sideNormal1.x=g.normal.y,g.sideNormal1.y=-g.normal.x,g.sideNormal2.x=-g.sideNormal1.x,g.sideNormal2.y=-g.sideNormal1.y,g.sideOffset1=g.sideNormal1.x*g.v1.x+g.sideNormal1.y*g.v1.y,g.sideOffset2=g.sideNormal2.x*g.v2.x+g.sideNormal2.y*g.v2.y;var T=new Array(2),A=new Array(2);if(!(mt(T,p,g.sideNormal1.x,g.sideNormal1.y,g.sideOffset1,g.i1)<ji||mt(A,T,g.sideNormal2.x,g.sideNormal2.y,g.sideOffset2,g.i2)<ji)){d.type==lt.e_edgeA?(t.localNormal.x=g.normal.x,t.localNormal.y=g.normal.y,t.localPoint.x=g.v1.x,t.localPoint.y=g.v1.y):(t.localNormal.x=n.m_normals[g.i1].x,t.localNormal.y=n.m_normals[g.i1].y,t.localPoint.x=n.m_vertices[g.i1].x,t.localPoint.y=n.m_vertices[g.i1].y);var O=0;for(_=0;_<ji;++_)if(g.normal.x*(A[_].v.x-g.v1.x)+g.normal.y*(A[_].v.y-g.v1.y)<=this.m_radius){var P=t.points[O]=new $;d.type==lt.e_edgeA?(P.localPoint.Assign(x(this.m_xf,A[_].v)),P.id.Assign(A[_].id)):(P.localPoint.x=A[_].v.x,P.localPoint.y=A[_].v.y,P.id.typeA=A[_].id.typeB,P.id.typeB=A[_].id.typeA,P.id.indexA=A[_].id.indexB,P.id.indexB=A[_].id.indexA),++O}t.pointCount=O}}}},ComputeEdgeSeparation:function(){var t=new lt;t.type=lt.e_edgeA,t.index=this.m_front?0:1,t.separation=Number.MAX_VALUE;for(var i=0;i<this.m_polygonB.count;++i){var s=this.m_normal.x*(this.m_polygonB.vertices[i].x-this.m_v1.x)+this.m_normal.y*(this.m_polygonB.vertices[i].y-this.m_v1.y);s<t.separation&&(t.separation=s)}return t},ComputePolygonSeparation:function(){var t=new lt;t.type=lt.e_unknown,t.index=-1,t.separation=-Number.MAX_VALUE;for(var i=-this.m_normal.y,s=this.m_normal.x,n=0;n<this.m_polygonB.count;++n){var h=-this.m_polygonB.normals[n].x,r=-this.m_polygonB.normals[n].y,e=h*(this.m_polygonB.vertices[n].x-this.m_v1.x)+r*(this.m_polygonB.vertices[n].y-this.m_v1.y),c=h*(this.m_polygonB.vertices[n].x-this.m_v2.x)+r*(this.m_polygonB.vertices[n].y-this.m_v2.y),o=rs(e,c);if(o>this.m_radius)return t.type=lt.e_edgeB,t.index=n,t.separation=o,t;if(h*i+r*s>=0){if((h-this.m_upperLimit.x)*this.m_normal.x+(r-this.m_upperLimit.y)*this.m_normal.y<-Wi)continue}else if((h-this.m_lowerLimit.x)*this.m_normal.x+(r-this.m_lowerLimit.y)*this.m_normal.y<-Wi)continue;o>t.separation&&(t.type=lt.e_edgeB,t.index=n,t.separation=o)}return t}},pt.e_isolated=0,pt.e_concave=1,pt.e_convex=2,gt.collider=new pt,wt.input=new J,wt.cache=new X,wt.output=new Y;var as=-1;Ct.prototype={IsLeaf:function(){return this.child1==as}},bt.aabbExtensionFattener=new h(.1,.1),bt.prototype={CreateProxy:function(t,i){var s=this.AllocateNode();return this.m_nodes[s].aabb.lowerBound.Assign(h.Subtract(t.lowerBound,bt.aabbExtensionFattener)),this.m_nodes[s].aabb.upperBound.Assign(h.Add(t.upperBound,bt.aabbExtensionFattener)),this.m_nodes[s].userData=i,this.m_nodes[s].height=0,this.InsertLeaf(s),s},DestroyProxy:function(i){t(0<=i&&i<this.m_nodeCapacity),t(this.m_nodes[i].IsLeaf()),this.RemoveLeaf(i),this.FreeNode(i)},MoveProxy:function(i,s,n){if(t(0<=i&&i<this.m_nodeCapacity),t(this.m_nodes[i].IsLeaf()),this.m_nodes[i].aabb.Contains(s))return!1;this.RemoveLeaf(i),this.m_nodes[i].aabb.Assign(s),this.m_nodes[i].aabb.lowerBound.Subtract(bt.aabbExtensionFattener),this.m_nodes[i].aabb.upperBound.Add(bt.aabbExtensionFattener);var r=h.Multiply(2,n);return r.x<0?this.m_nodes[i].aabb.lowerBound.x+=r.x:this.m_nodes[i].aabb.upperBound.x+=r.x,r.y<0?this.m_nodes[i].aabb.lowerBound.y+=r.y:this.m_nodes[i].aabb.upperBound.y+=r.y,this.InsertLeaf(i),!0},GetUserData:function(i){return t(0<=i&&i<this.m_nodeCapacity),this.m_nodes[i].userData},GetFatAABB:function(i){return t(0<=i&&i<this.m_nodeCapacity),this.m_nodes[i].aabb},Query:function(t,i){var s=[];for(s.push(this.m_root);s.length>0;){var n=s.pop();if(n!=as){var h=this.m_nodes[n];if(_t(h.aabb,i))if(h.IsLeaf()){if(0==t.QueryCallback(n))return}else s.push(h.child1),s.push(h.child2)}}},RayCast:function(i,s){var n=s.p1,r=s.p2,e=h.Subtract(r,n);t(e.LengthSquared()>0),e.Normalize();var c=d(1,e),o=O(c),u=s.maxFraction,a=new rt,l=h.Add(n,h.Multiply(u,h.Subtract(r,n)));a.lowerBound.Assign(P(n,l)),a.upperBound.Assign(R(n,l));var v=[];for(v.push(this.m_root);v.length>0;){var p=v.pop();if(p!=as){var g=this.m_nodes[p];if(0!=_t(g.aabb,a)){var m=g.aabb.GetCenter(),w=g.aabb.GetExtents();if(!(hs(f(c,h.Subtract(n,m)))-f(o,w)>0))if(g.IsLeaf()){var _=new nt;_.p1.Assign(s.p1),_.p2.Assign(s.p2),_.maxFraction=u;var C=i.RayCastCallback(_,p);if(0==C)return;C>0&&(l=h.Add(n,h.Multiply(u=C,h.Subtract(r,n))),a.lowerBound.Assign(P(n,l)),a.upperBound.Assign(R(n,l)))}else v.push(g.child1),v.push(g.child2)}}}},Validate:function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var i=0,s=this.m_freeList;s!=as;)t(0<=s&&s<this.m_nodeCapacity),s=this.m_nodes[s].parent,++i;t(this.GetHeight()==this.ComputeHeight()),t(this.m_nodeCount+i==this.m_nodeCapacity)},GetHeight:function(){return this.m_root==as?0:this.m_nodes[this.m_root].height},GetMaxBalance:function(){for(var i=0,s=0;s<this.m_nodeCapacity;++s){var n=this.m_nodes[s];if(!(n.height<=1)){t(0==n.IsLeaf());var h=n.child1,r=n.child2,e=hs(this.m_nodes[r].height-this.m_nodes[h].height);i=es(i,e)}}return i},GetAreaRatio:function(){if(this.m_root==as)return 0;for(var t=this.m_nodes[this.m_root].aabb.GetPerimeter(),i=0,s=0;s<this.m_nodeCapacity;++s){var n=this.m_nodes[s];n.height<0||(i+=n.aabb.GetPerimeter())}return i/t},RebuildBottomUp:function(){for(var t=new Array(this.m_nodeCount),i=0,s=0;s<this.m_nodeCapacity;++s)this.m_nodes[s].height<0||(this.m_nodes[s].IsLeaf()?(this.m_nodes[s].parent=as,t[i]=s,++i):this.FreeNode(s));for(;i>1;){var n=Bi,h=-1,r=-1;for(s=0;s<i;++s)for(var e=this.m_nodes[t[s]].aabb,c=s+1;c<i;++c){var o=this.m_nodes[t[c]].aabb,u=new rt;u.Combine(e,o);var a=u.GetPerimeter();a<n&&(h=s,r=c,n=a)}var f=t[h],l=t[r],v=this.m_nodes[f],d=this.m_nodes[l],p=this.AllocateNode(),g=this.m_nodes[p];g.child1=f,g.child2=l,g.height=1+es(v.height,d.height),g.aabb.Combine(v.aabb,d.aabb),g.parent=as,v.parent=p,d.parent=p,t[r]=t[i-1],t[h]=p,--i}this.m_root=t[0],this.Validate()},ShiftOrigin:function(t){for(var i=0;i<this.m_nodeCapacity;++i)this.m_nodes[i].aabb.lowerBound.Subtract(t),this.m_nodes[i].aabb.upperBound.Subtract(t)},AllocateNode:function(){if(this.m_freeList==as){t(this.m_nodeCount==this.m_nodeCapacity);var i=this.m_nodes;this.m_nodeCapacity*=2,this.m_nodes=i.concat(new Array(this.m_nodeCapacity-this.m_nodeCount));for(var s=this.m_nodeCount;s<this.m_nodeCapacity-1;++s)this.m_nodes[s]=new Ct,this.m_nodes[s].parent=s+1,this.m_nodes[s].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new Ct,this.m_nodes[this.m_nodeCapacity-1].parent=as,this.m_nodes[this.m_nodeCapacity-1].height=-1,this.m_freeList=this.m_nodeCount}var n=this.m_freeList;return this.m_freeList=this.m_nodes[n].parent,this.m_nodes[n].parent=as,this.m_nodes[n].child1=as,this.m_nodes[n].child2=as,this.m_nodes[n].height=0,this.m_nodes[n].userData=null,++this.m_nodeCount,n},FreeNode:function(i){t(0<=i&&i<this.m_nodeCapacity),t(0<this.m_nodeCount),this.m_nodes[i].parent=this.m_freeList,this.m_nodes[i].height=-1,this.m_freeList=i,--this.m_nodeCount},InsertLeaf:function(i){if(++this.m_insertionCount,this.m_root==as)return this.m_root=i,void(this.m_nodes[this.m_root].parent=as);for(var s=this.m_nodes[i].aabb,n=this.m_root;0==this.m_nodes[n].IsLeaf();){var h=this.m_nodes[n].child1,r=this.m_nodes[n].child2,e=this.m_nodes[n].aabb.GetPerimeter(),c=new rt;c.Combine(this.m_nodes[n].aabb,s);var o,u,a=c.GetPerimeter(),f=2*a,l=2*(a-e);this.m_nodes[h].IsLeaf()?((u=new rt).Combine(s,this.m_nodes[h].aabb),o=u.GetPerimeter()+l):((u=new rt).Combine(s,this.m_nodes[h].aabb),d=this.m_nodes[h].aabb.GetPerimeter(),o=(p=u.GetPerimeter())-d+l);var v;if(this.m_nodes[r].IsLeaf())(u=new rt).Combine(s,this.m_nodes[r].aabb),v=u.GetPerimeter()+l;else{(u=new rt).Combine(s,this.m_nodes[r].aabb);var d=this.m_nodes[r].aabb.GetPerimeter(),p=u.GetPerimeter();v=p-d+l}if(f<o&&f<v)break;n=o<v?h:r}var g=n,m=this.m_nodes[g].parent,w=this.AllocateNode();for(this.m_nodes[w].parent=m,this.m_nodes[w].userData=null,this.m_nodes[w].aabb.Combine(s,this.m_nodes[g].aabb),this.m_nodes[w].height=this.m_nodes[g].height+1,m!=as?(this.m_nodes[m].child1==g?this.m_nodes[m].child1=w:this.m_nodes[m].child2=w,this.m_nodes[w].child1=g,this.m_nodes[w].child2=i,this.m_nodes[g].parent=w,this.m_nodes[i].parent=w):(this.m_nodes[w].child1=g,this.m_nodes[w].child2=i,this.m_nodes[g].parent=w,this.m_nodes[i].parent=w,this.m_root=w),n=this.m_nodes[i].parent;n!=as;)n=this.Balance(n),h=this.m_nodes[n].child1,r=this.m_nodes[n].child2,t(h!=as),t(r!=as),this.m_nodes[n].height=1+es(this.m_nodes[h].height,this.m_nodes[r].height),this.m_nodes[n].aabb.Combine(this.m_nodes[h].aabb,this.m_nodes[r].aabb),n=this.m_nodes[n].parent},RemoveLeaf:function(t){if(t!=this.m_root){var i,s=this.m_nodes[t].parent,n=this.m_nodes[s].parent;if(i=this.m_nodes[s].child1==t?this.m_nodes[s].child2:this.m_nodes[s].child1,n!=as){this.m_nodes[n].child1==s?this.m_nodes[n].child1=i:this.m_nodes[n].child2=i,this.m_nodes[i].parent=n,this.FreeNode(s);for(var h=n;h!=as;){h=this.Balance(h);var r=this.m_nodes[h].child1,e=this.m_nodes[h].child2;this.m_nodes[h].aabb.Combine(this.m_nodes[r].aabb,this.m_nodes[e].aabb),this.m_nodes[h].height=1+es(this.m_nodes[r].height,this.m_nodes[e].height),h=this.m_nodes[h].parent}}else this.m_root=i,this.m_nodes[i].parent=as,this.FreeNode(s)}else this.m_root=as},Balance:function(i){t(i!=as);var s=this.m_nodes[i];if(s.IsLeaf()||s.height<2)return i;var n=s.child1,h=s.child2;t(0<=n&&n<this.m_nodeCapacity),t(0<=h&&h<this.m_nodeCapacity);var r=this.m_nodes[n],e=this.m_nodes[h],c=e.height-r.height;if(c>1){var o=e.child1,u=e.child2,a=this.m_nodes[o],f=this.m_nodes[u];return t(0<=o&&o<this.m_nodeCapacity),t(0<=u&&u<this.m_nodeCapacity),e.child1=i,e.parent=s.parent,s.parent=h,e.parent!=as?this.m_nodes[e.parent].child1==i?this.m_nodes[e.parent].child1=h:(t(this.m_nodes[e.parent].child2==i),this.m_nodes[e.parent].child2=h):this.m_root=h,a.height>f.height?(e.child2=o,s.child2=u,f.parent=i,s.aabb.Combine(r.aabb,f.aabb),e.aabb.Combine(s.aabb,a.aabb),s.height=1+es(r.height,f.height),e.height=1+es(s.height,a.height)):(e.child2=u,s.child2=o,a.parent=i,s.aabb.Combine(r.aabb,a.aabb),e.aabb.Combine(s.aabb,f.aabb),s.height=1+es(r.height,a.height),e.height=1+es(s.height,f.height)),h}if(c<-1){var l=r.child1,v=r.child2,d=this.m_nodes[l],p=this.m_nodes[v];return t(0<=l&&l<this.m_nodeCapacity),t(0<=v&&v<this.m_nodeCapacity),r.child1=i,r.parent=s.parent,s.parent=n,r.parent!=as?this.m_nodes[r.parent].child1==i?this.m_nodes[r.parent].child1=n:(t(this.m_nodes[r.parent].child2==i),this.m_nodes[r.parent].child2=n):this.m_root=n,d.height>p.height?(r.child2=l,s.child1=v,p.parent=i,s.aabb.Combine(e.aabb,p.aabb),r.aabb.Combine(s.aabb,d.aabb),s.height=1+es(e.height,p.height),r.height=1+es(s.height,d.height)):(r.child2=v,s.child1=l,d.parent=i,s.aabb.Combine(e.aabb,d.aabb),r.aabb.Combine(s.aabb,p.aabb),s.height=1+es(e.height,d.height),r.height=1+es(s.height,p.height)),n}return i},ComputeHeight:function(i){void 0===i&&(i=this.m_root),t(0<=i&&i<this.m_nodeCapacity);var s=this.m_nodes[i];if(s.IsLeaf())return 0;var n=this.ComputeHeight(s.child1),h=this.ComputeHeight(s.child2);return 1+es(n,h)},ValidateStructure:function(i){if(i!=as){i==this.m_root&&t(this.m_nodes[i].parent==as);var s=this.m_nodes[i],n=s.child1,h=s.child2;if(s.IsLeaf())return t(n==as),t(h==as),void t(0==s.height);t(0<=n&&n<this.m_nodeCapacity),t(0<=h&&h<this.m_nodeCapacity),t(this.m_nodes[n].parent==i),t(this.m_nodes[h].parent==i),this.ValidateStructure(n),this.ValidateStructure(h)}},ValidateMetrics:function(i){if(i!=as){var s=this.m_nodes[i],n=s.child1,r=s.child2;if(s.IsLeaf())return t(n==as),t(r==as),void t(0==s.height);t(0<=n&&n<this.m_nodeCapacity),t(0<=r&&r<this.m_nodeCapacity);var e,c=this.m_nodes[n].height,o=this.m_nodes[r].height;e=1+es(c,o),t(s.height==e);var u=new rt;u.Combine(this.m_nodes[n].aabb,this.m_nodes[r].aabb),t(h.Equals(u.lowerBound,s.aabb.lowerBound)),t(h.Equals(u.upperBound,s.aabb.upperBound)),this.ValidateMetrics(n),this.ValidateMetrics(r)}}},Tt.e_unknown=0,Tt.e_failed=1,Tt.e_overlapped=2,Tt.e_touching=3,Tt.e_separated=4;var fs=new u,ls=new u;St.prototype={Initialize:function(i,s,n,h,r,e){this.m_proxyA=s,this.m_proxyB=h;var c=i.count;if(t(0<c&&c<3),this.m_sweepA=n,this.m_sweepB=r,this.m_sweepA.GetTransform(fs,e),this.m_sweepB.GetTransform(ls,e),1==c){this.m_type=St.e_points;var o=this.m_proxyA.GetVertex(i.indexA[0]),u=this.m_proxyB.GetVertex(i.indexB[0]),a=fs.q.c*o.x-fs.q.s*o.y+fs.p.x,f=fs.q.s*o.x+fs.q.c*o.y+fs.p.y,l=ls.q.c*u.x-ls.q.s*u.y+ls.p.x,v=ls.q.s*u.x+ls.q.c*u.y+ls.p.y;return this.m_axis.x=l-a,this.m_axis.y=v-f,C=this.m_axis.Normalize()}if(i.indexA[0]==i.indexA[1]){this.m_type=St.e_faceB;var d=h.GetVertex(i.indexB[0]),p=h.GetVertex(i.indexB[1]);this.m_axis.x=1*(p.y-d.y),this.m_axis.y=-1*(p.x-d.x),this.m_axis.Normalize();var g=ls.q.c*this.m_axis.x-ls.q.s*this.m_axis.y,m=ls.q.s*this.m_axis.x+ls.q.c*this.m_axis.y;return this.m_localPoint.x=.5*(d.x+p.x),this.m_localPoint.y=.5*(d.y+p.y),l=ls.q.c*this.m_localPoint.x-ls.q.s*this.m_localPoint.y+ls.p.x,v=ls.q.s*this.m_localPoint.x+ls.q.c*this.m_localPoint.y+ls.p.y,o=s.GetVertex(i.indexA[0]),(C=((a=fs.q.c*o.x-fs.q.s*o.y+fs.p.x)-l)*g+((f=fs.q.s*o.x+fs.q.c*o.y+fs.p.y)-v)*m)<0&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,C=-C),C}this.m_type=St.e_faceA;var w=this.m_proxyA.GetVertex(i.indexA[0]),_=this.m_proxyA.GetVertex(i.indexA[1]);this.m_axis.x=1*(_.y-w.y),this.m_axis.y=-1*(_.x-w.x),this.m_axis.Normalize(),g=fs.q.c*this.m_axis.x-fs.q.s*this.m_axis.y,m=fs.q.s*this.m_axis.x+fs.q.c*this.m_axis.y,this.m_localPoint.x=.5*(w.x+_.x),this.m_localPoint.y=.5*(w.y+_.y),a=fs.q.c*this.m_localPoint.x-fs.q.s*this.m_localPoint.y+fs.p.x,f=fs.q.s*this.m_localPoint.x+fs.q.c*this.m_localPoint.y+fs.p.y,u=this.m_proxyB.GetVertex(i.indexB[0]);var C=((l=ls.q.c*u.x-ls.q.s*u.y+ls.p.x)-a)*g+((v=ls.q.s*u.x+ls.q.c*u.y+ls.p.y)-f)*m;return C<0&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,C=-C),C},FindMinSeparation:function(i,s){switch(this.m_sweepA.GetTransform(fs,s),this.m_sweepB.GetTransform(ls,s),this.m_type){case St.e_points:var n=fs.q.c*this.m_axis.x+fs.q.s*this.m_axis.y,h=-fs.q.s*this.m_axis.x+fs.q.c*this.m_axis.y,r=ls.q.c*-this.m_axis.x+ls.q.s*-this.m_axis.y,e=-ls.q.s*-this.m_axis.x+ls.q.c*-this.m_axis.y;i[0]=this.m_proxyA.GetSupport(n,h),i[1]=this.m_proxyB.GetSupport(r,e);var c=this.m_proxyA.GetVertex(i[0]),o=this.m_proxyB.GetVertex(i[1]),u=fs.q.c*c.x-fs.q.s*c.y+fs.p.x,a=fs.q.s*c.x+fs.q.c*c.y+fs.p.y,f=ls.q.c*o.x-ls.q.s*o.y+ls.p.x,l=ls.q.s*o.x+ls.q.c*o.y+ls.p.y;return(f-u)*this.m_axis.x+(l-a)*this.m_axis.y;case St.e_faceA:var v=fs.q.c*this.m_axis.x-fs.q.s*this.m_axis.y,d=fs.q.s*this.m_axis.x+fs.q.c*this.m_axis.y;return u=fs.q.c*this.m_localPoint.x-fs.q.s*this.m_localPoint.y+fs.p.x,a=fs.q.s*this.m_localPoint.x+fs.q.c*this.m_localPoint.y+fs.p.y,r=ls.q.c*-v+ls.q.s*-d,e=-ls.q.s*-v+ls.q.c*-d,i[0]=-1,i[1]=this.m_proxyB.GetSupport(r,e),o=this.m_proxyB.GetVertex(i[1]),((f=ls.q.c*o.x-ls.q.s*o.y+ls.p.x)-u)*v+((l=ls.q.s*o.x+ls.q.c*o.y+ls.p.y)-a)*d;case St.e_faceB:return v=ls.q.c*this.m_axis.x-ls.q.s*this.m_axis.y,d=ls.q.s*this.m_axis.x+ls.q.c*this.m_axis.y,f=ls.q.c*this.m_localPoint.x-ls.q.s*this.m_localPoint.y+ls.p.x,l=ls.q.s*this.m_localPoint.x+ls.q.c*this.m_localPoint.y+ls.p.y,n=fs.q.c*-v+fs.q.s*-d,e=-fs.q.s*-v+fs.q.c*-d,i[1]=-1,i[0]=this.m_proxyA.GetSupport(n,e),c=this.m_proxyA.GetVertex(i[0]),((u=fs.q.c*c.x-fs.q.s*c.y+fs.p.x)-f)*v+((a=fs.q.s*c.x+fs.q.c*c.y+fs.p.y)-l)*d;default:return t(!1),i[0]=-1,i[1]=-1,0}},Evaluate:function(i,s,n){switch(this.m_sweepA.GetTransform(fs,n),this.m_sweepB.GetTransform(ls,n),this.m_type){case St.e_points:var h=this.m_proxyA.GetVertex(i),r=this.m_proxyB.GetVertex(s),e=fs.q.c*h.x-fs.q.s*h.y+fs.p.x,c=fs.q.s*h.x+fs.q.c*h.y+fs.p.y,o=ls.q.c*r.x-ls.q.s*r.y+ls.p.x,u=ls.q.s*r.x+ls.q.c*r.y+ls.p.y;return l=(o-e)*this.m_axis.x+(u-c)*this.m_axis.y;case St.e_faceA:var a=fs.q.c*this.m_axis.x-fs.q.s*this.m_axis.y,f=fs.q.s*this.m_axis.x+fs.q.c*this.m_axis.y;return e=fs.q.c*this.m_localPoint.x-fs.q.s*this.m_localPoint.y+fs.p.x,c=fs.q.s*this.m_localPoint.x+fs.q.c*this.m_localPoint.y+fs.p.y,r=this.m_proxyB.GetVertex(s),l=((o=ls.q.c*r.x-ls.q.s*r.y+ls.p.x)-e)*a+((u=ls.q.s*r.x+ls.q.c*r.y+ls.p.y)-c)*f;case St.e_faceB:a=ls.q.c*this.m_axis.x-ls.q.s*this.m_axis.y,f=ls.q.s*this.m_axis.x+ls.q.c*this.m_axis.y,o=ls.q.c*this.m_localPoint.x-ls.q.s*this.m_localPoint.y+ls.p.x,u=ls.q.s*this.m_localPoint.x+ls.q.c*this.m_localPoint.y+ls.p.y,h=this.m_proxyA.GetVertex(i);var l=((e=fs.q.c*h.x-fs.q.s*h.y+fs.p.x)-o)*a+((c=fs.q.s*h.x+fs.q.c*h.y+fs.p.y)-u)*f;return l;default:return t(!1),0}}},St.e_points=0,St.e_faceA=1,St.e_faceB=2;var vs=ki.create("toi","solveTOI");At._temp_sweepA=new a,At._temp_sweepB=new a,At.b2_toiTime=0,At.b2_toiMaxTime=0,At.b2_toiCalls=0,At.b2_toiIters=0,At.b2_toiMaxIters=0,At.b2_toiRootIters=0,At.b2_toiMaxRootIters=0,Mt.prototype={_deserialize:function(t){this.type=t.type,this.position._deserialize(t.position),this.angle=t.angle,this.linearVelocity._deserialize(t.linearVelocity),this.angularVelocity=t.angularVelocity,this.linearDamping=t.linearDamping,this.angularDamping=t.angularDamping,this.allowSleep=t.allowSleep,this.awake=t.awake,this.fixedRotation=t.fixedRotation,this.bullet=t.bullet,this.active=t.active,this.gravityScale=t.gravityScale}},xt.b2_staticBody=0,xt.b2_kinematicBody=1,xt.b2_dynamicBody=2,xt.e_islandFlag=1,xt.e_awakeFlag=2,xt.e_autoSleepFlag=4,xt.e_bulletFlag=8,xt.e_fixedRotationFlag=16,xt.e_activeFlag=32,xt.e_toiFlag=64,xt.m_local_oldCenter=new h,xt.m_local_xf1=new u,xt.prototype={CreateFixture:function(i,s){if(void 0!==s){var n=new Ot;return n.shape=i,n.density=s,this.CreateFixture(n)}if(t(0==this.m_world.IsLocked()),1==this.m_world.IsLocked())return null;var h=new Rt;if(h.Create(this,i),this.m_flags&xt.e_activeFlag){var r=this.m_world.m_contactManager.m_broadPhase;h.CreateProxies(r,this.m_xf)}return h.m_next=this.m_fixtureList,this.m_fixtureList=h,++this.m_fixtureCount,h.m_body=this,h.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=Vt.e_newFixture,h},DestroyFixture:function(i){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){t(i.m_body==this),t(this.m_fixtureCount>0);for(var s=this.m_fixtureList,n=!1;null!=s;){if(s==i){this.m_fixtureList=s=i.m_next,n=!0;break}s=s.m_next}t(n);for(var h=this.m_contactList;h;){var r=h.contact;h=h.next;var e=r.GetFixtureA(),c=r.GetFixtureB();i!=e&&i!=c||this.m_world.m_contactManager.Destroy(r)}if(this.m_flags&xt.e_activeFlag){var o=this.m_world.m_contactManager.m_broadPhase;i.DestroyProxies(o)}i.Destroy(),i.m_body=null,i.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},SetTransform:function(i,s){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){this.m_xf.q.Set(s),this.m_xf.p.Assign(i),this.m_sweep.c.Assign(M(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.a=s,this.m_sweep.c0.Assign(this.m_sweep.c),this.m_sweep.a0=s;for(var n=this.m_world.m_contactManager.m_broadPhase,h=this.m_fixtureList;h;h=h.m_next)h.Synchronize(n,this.m_xf,this.m_xf)}},GetTransform:function(){return this.m_xf},GetPosition:function(){return this.m_xf.p},GetAngle:function(){return this.m_sweep.a},GetWorldCenter:function(){return this.m_sweep.c},GetLocalCenter:function(){return this.m_sweep.localCenter},SetLinearVelocity:function(t){this.m_type!=xt.b2_staticBody&&(f(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity=t)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(t){this.m_type!=xt.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(t,i,s){this.m_type==xt.b2_dynamicBody&&(s&&0==(this.m_flags&xt.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&xt.e_awakeFlag&&(this.m_force.Add(t),this.m_torque+=l(h.Subtract(i,this.m_sweep.c),t)))},ApplyForceToCenter:function(t,i){this.m_type==xt.b2_dynamicBody&&(i&&0==(this.m_flags&xt.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&xt.e_awakeFlag&&this.m_force.Add(t))},ApplyTorque:function(t,i){this.m_type==xt.b2_dynamicBody&&(i&&0==(this.m_flags&xt.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&xt.e_awakeFlag&&(this.m_torque+=t))},ApplyLinearImpulse:function(t,i,s){this.m_type==xt.b2_dynamicBody&&(s&&0==(this.m_flags&xt.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&xt.e_awakeFlag&&(this.m_linearVelocity.Add(h.Multiply(this.m_invMass,t)),this.m_angularVelocity+=this.m_invI*l(h.Subtract(i,this.m_sweep.c),t)))},ApplyAngularImpulse:function(t,i){this.m_type==xt.b2_dynamicBody&&(i&&0==(this.m_flags&xt.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&xt.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I+this.m_mass*f(this.m_sweep.localCenter,this.m_sweep.localCenter)},GetMassData:function(t){t.mass=this.m_mass,t.I=this.m_I+this.m_mass*f(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center=this.m_sweep.localCenter},SetMassData:function(i){t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==xt.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&0==(this.m_flags&xt.e_fixedRotationFlag)&&(this.m_I=i.I-this.m_mass*f(i.center,i.center),t(this.m_I>0),this.m_invI=1/this.m_I),xt.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(i.center),this.m_sweep.c0.Assign(M(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(d(this.m_angularVelocity,h.Subtract(this.m_sweep.c,xt.m_local_oldCenter))))},ResetMassData:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type==xt.b2_staticBody||this.m_type==xt.b2_kinematicBody)return this.m_sweep.c0.Assign(this.m_xf.p),this.m_sweep.c.Assign(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);t(this.m_type==xt.b2_dynamicBody);for(var i=new h(0,0),s=this.m_fixtureList;s;s=s.m_next)if(0!=s.m_density){var n=new N;s.GetMassData(n),this.m_mass+=n.mass,i.Add(h.Multiply(n.mass,n.center)),this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.Multiply(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&xt.e_fixedRotationFlag)?(this.m_I-=this.m_mass*f(i,i),t(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),xt.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(i),this.m_sweep.c0.Assign(M(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(d(this.m_angularVelocity,h.Subtract(this.m_sweep.c,xt.m_local_oldCenter)))},GetWorldPoint:function(t){return M(this.m_xf,t)},GetWorldVector:function(t){return S(this.m_xf.q,t)},GetLocalPoint:function(t){return x(this.m_xf,t)},GetLocalVector:function(t){return A(this.m_xf.q,t)},GetLinearVelocityFromWorldPoint:function(t){return h.Add(this.m_linearVelocity,d(this.m_angularVelocity,h.Subtract(t,this.m_sweep.c)))},GetLinearVelocityFromLocalPoint:function(t){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t))},GetLinearDamping:function(){return this.m_linearDamping},SetLinearDamping:function(t){this.m_linearDamping=t},GetAngularDamping:function(){return this.m_angularDamping},SetAngularDamping:function(t){this.m_angularDamping=t},GetGravityScale:function(){return this.m_gravityScale},SetGravityScale:function(t){this.m_gravityScale=t},SetType:function(i){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type!=i){this.m_type=i,this.ResetMassData(),this.m_type==xt.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Assign(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var s=this.m_contactList;s;){var n=s;s=s.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null;for(var h=this.m_world.m_contactManager.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)for(var e=r.m_proxyCount,c=0;c<e;++c)h.TouchProxy(r.m_proxies[c].proxyId)}},GetType:function(){return this.m_type},SetBullet:function(t){t?this.m_flags|=xt.e_bulletFlag:this.m_flags&=~xt.e_bulletFlag},IsBullet:function(){return(this.m_flags&xt.e_bulletFlag)==xt.e_bulletFlag},SetSleepingAllowed:function(t){t?this.m_flags|=xt.e_autoSleepFlag:(this.m_flags&=~xt.e_autoSleepFlag,this.SetAwake(!0))},IsSleepingAllowed:function(){return(this.m_flags&xt.e_autoSleepFlag)==xt.e_autoSleepFlag},SetAwake:function(t){t?0==(this.m_flags&xt.e_awakeFlag)&&(this.m_flags|=xt.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~xt.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},IsAwake:function(){return(this.m_flags&xt.e_awakeFlag)==xt.e_awakeFlag},SetActive:function(i){if(t(0==this.m_world.IsLocked()),i!=this.IsActive())if(i){this.m_flags|=xt.e_activeFlag;for(var s=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.CreateProxies(s,this.m_xf)}else{for(this.m_flags&=~xt.e_activeFlag,s=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxies(s);for(var h=this.m_contactList;h;){var r=h;h=h.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}},IsActive:function(){return(this.m_flags&xt.e_activeFlag)==xt.e_activeFlag},SetFixedRotation:function(t){(this.m_flags&xt.e_fixedRotationFlag)==xt.e_fixedRotationFlag!=t&&(t?this.m_flags|=xt.e_fixedRotationFlag:this.m_flags&=~xt.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},IsFixedRotation:function(){return(this.m_flags&xt.e_fixedRotationFlag)==xt.e_fixedRotationFlag},GetFixtureList:function(){return this.m_fixtureList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},GetWorld:function(){return this.m_world},SynchronizeFixtures:function(){xt.m_local_xf1.q.Set(this.m_sweep.a0),xt.m_local_xf1.p.Assign(h.Subtract(this.m_sweep.c0,S(xt.m_local_xf1.q,this.m_sweep.localCenter)));for(var t=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(t,xt.m_local_xf1,this.m_xf)},SynchronizeTransform:function(){this.m_xf.q.Set(this.m_sweep.a),this.m_xf.p.Assign(h.Subtract(this.m_sweep.c,S(this.m_xf.q,this.m_sweep.localCenter)))},ShouldCollide:function(t){if(this.m_type!=xt.b2_dynamicBody&&t.m_type!=xt.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0},Advance:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),this.m_xf.p.Assign(h.Subtract(this.m_sweep.c,S(this.m_xf.q,this.m_sweep.localCenter)))},_serialize:function(t){var i=t||{};return i.fixtures=null,i.type=this.m_type,i.position=this.GetPosition()._serialize(),i.angle=this.GetAngle(),i.linearVelocity=this.GetLinearVelocity()._serialize(),i.angularVelocity=this.GetAngularVelocity(),i.linearDamping=this.GetLinearDamping(),i.angularDamping=this.GetAngularDamping(),i.allowSleep=this.IsSleepingAllowed(),i.awake=this.IsAwake(),i.fixedRotation=this.IsFixedRotation(),i.bullet=this.IsBullet(),i.active=this.IsActive(),i.gravityScale=this.GetGravityScale(),i}},Et.prototype={Clone:function(){var t=new Et;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},Assign:function(t){this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex},_serialize:function(t){var i=t||{};return i.categoryBits=this.categoryBits,i.maskBits=this.maskBits,i.groupIndex=this.groupIndex,i},_deserialize:function(t){this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex}},Ot.prototype={_deserialize:function(t){this.friction=t.friction,this.restitution=t.restitution,this.density=t.density,this.isSensor=t.isSensor,this.filter._deserialize(t.filter)}},Rt.prototype={GetType:function(){return this.m_shape.GetType()},GetShape:function(){return this.m_shape},SetSensor:function(t){t!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},IsSensor:function(){return this.m_isSensor},SetFilterData:function(t){this.m_filter=t,this.Refilter()},GetFilterData:function(){return this.m_filter},Refilter:function(){if(null!=this.m_body){for(var t=this.m_body.GetContactList();t;){var i=t.contact,s=i.GetFixtureA(),n=i.GetFixtureB();s!=this&&n!=this||i.FlagForFiltering(),t=t.next}var h=this.m_body.GetWorld();if(null!=h)for(var r=h.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e)r.TouchProxy(this.m_proxies[e].proxyId)}},GetBody:function(){return this.m_body},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},TestPoint:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},RayCast:function(t,i,s){return this.m_shape.RayCast(t,i,this.m_body.GetTransform(),s)},GetMassData:function(t){this.m_shape.ComputeMass(t,this.m_density)},SetDensity:function(i){t(n(i)&&i>=0),this.m_density=i},GetDensity:function(){return this.m_density},GetFriction:function(){return this.m_friction},SetFriction:function(t){this.m_friction=t},GetRestitution:function(){return this.m_restitution},SetRestitution:function(t){this.m_restitution=t},GetAABB:function(i){return t(0<=i&&i<this.m_proxyCount),this.m_proxies[i].aabb},Create:function(t,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter.Assign(i.filter),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Clone();var s=this.m_shape.GetChildCount();this.m_proxies=new Array(s);for(var n=0;n<s;++n)this.m_proxies[n]=new Pt,this.m_proxies[n].fixture=null,this.m_proxies[n].proxyId=W.e_nullProxy;this.m_proxyCount=0,this.m_density=i.density},Destroy:function(){t(0==this.m_proxyCount),this.m_proxies=null,this.m_shape=null},CreateProxies:function(i,s){t(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var n=0;n<this.m_proxyCount;++n){var h=this.m_proxies[n];this.m_shape.ComputeAABB(h.aabb,s,n),h.proxyId=i.CreateProxy(h.aabb,h),h.fixture=this,h.childIndex=n}},DestroyProxies:function(t){for(var i=0;i<this.m_proxyCount;++i){var s=this.m_proxies[i];t.DestroyProxy(s.proxyId),s.proxyId=W.e_nullProxy}this.m_proxyCount=0},Synchronize:function(t,i,s){if(0!=this.m_proxyCount)for(var n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n],e=new rt,c=new rt;this.m_shape.ComputeAABB(e,i,r.childIndex),this.m_shape.ComputeAABB(c,s,r.childIndex),r.aabb.Combine(e,c);var o=h.Subtract(s.p,i.p);t.MoveProxy(r.proxyId,r.aabb,o)}},_serialize:function(t){var i=t||{};return i.shape=null,i.friction=this.m_friction,i.restitution=this.m_restitution,i.density=this.m_density,i.isSensor=this.m_isSensor,i.filter=this.m_filter._serialize(),i}},It.prototype={SayGoodbyeJoint:function(t){},SayGoodbyeFixture:function(t){}},Lt.prototype={ShouldCollide:function(t,i){var s=t.GetFilterData(),n=i.GetFilterData();return s.groupIndex==n.groupIndex&&0!=s.groupIndex?s.groupIndex>0:0!=(s.maskBits&n.categoryBits)&&0!=(s.categoryBits&n.maskBits)}},Ft.prototype={BeginContact:function(t){},EndContact:function(t){},PreSolve:function(t,i){},PostSolve:function(t,i){}},Nt.prototype={ReportFixture:function(t){return!1}},kt.prototype={ReportFixture:function(t,i,s,n){}};var ds=ki.create("step"),ps=ki.create("collide","step"),gs=ki.create("solve","step"),ms=ki.create("solveTOI","step"),ws=ki.create("broadphase","step");Ut.prototype={QueryCallback:function(t){var i=this.broadPhase.GetUserData(t);return this.callback.ReportFixture(i.fixture)}},Wt.prototype={RayCastCallback:function(t,i){var s=this.broadPhase.GetUserData(i),n=s.fixture,r=s.childIndex,e=new ht;if(n.RayCast(e,t,r)){var c=e.fraction,o=h.Add(h.Multiply(1-c,t.p1),h.Multiply(c,t.p2));return this.callback.ReportFixture(n,o,e.normal,c)}return t.maxFraction}},Vt.m_local_sweep_backupA=new a,Vt.m_local_sweep_backupB=new a,Vt.m_local_sweep_backupC=new a,Vt.prototype={Destroy:function(){for(var t=this.m_bodyList;t;){for(var i=t.m_next,s=t.m_fixtureList;s;){var n=s.m_next;s.m_proxyCount=0,s.Destroy(),s=n}t=i}},SetDestructionListener:function(t){this.m_destructionListener=t},SetContactFilter:function(t){this.m_contactManager.m_contactFilter=t},SetContactListener:function(t){this.m_contactManager.m_contactListener=t},SetDebugDraw:function(t){this.g_debugDraw=t},CreateBody:function(i){if(t(0==this.IsLocked()),this.IsLocked())return null;var s=new xt(i,this);return s.m_prev=null,s.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=s),this.m_bodyList=s,++this.m_bodyCount,s},DestroyBody:function(i){if(t(this.m_bodyCount>0),t(0==this.IsLocked()),!this.IsLocked()){for(var s=i.m_jointList;s;){var n=s;s=s.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint),i.m_jointList=s}i.m_jointList=null;for(var h=i.m_contactList;h;){var r=h;h=h.next,this.m_contactManager.Destroy(r.contact)}i.m_contactList=null;for(var e=i.m_fixtureList;e;){var c=e;e=e.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(this.m_contactManager.m_broadPhase),c.Destroy(),i.m_fixtureList=e,i.m_fixtureCount-=1}i.m_fixtureList=null,i.m_fixtureCount=0,i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i==this.m_bodyList&&(this.m_bodyList=i.m_next),i.m_destroyed=!0,--this.m_bodyCount}},CreateJoint:function(i){if(t(0==this.IsLocked()),this.IsLocked())return null;var s=vi.Create(i);s.m_prev=null,s.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=s),this.m_jointList=s,++this.m_jointCount,s.m_edgeA.joint=s,s.m_edgeA.other=s.m_bodyB,s.m_edgeA.prev=null,s.m_edgeA.next=s.m_bodyA.m_jointList,s.m_bodyA.m_jointList&&(s.m_bodyA.m_jointList.prev=s.m_edgeA),s.m_bodyA.m_jointList=s.m_edgeA,s.m_edgeB.joint=s,s.m_edgeB.other=s.m_bodyA,s.m_edgeB.prev=null,s.m_edgeB.next=s.m_bodyB.m_jointList,s.m_bodyB.m_jointList&&(s.m_bodyB.m_jointList.prev=s.m_edgeB),s.m_bodyB.m_jointList=s.m_edgeB;var n=i.bodyA,h=i.bodyB;if(0==i.collideConnected)for(var r=h.GetContactList();r;)r.other==n&&r.contact.FlagForFiltering(),r=r.next;return s},DestroyJoint:function(i){if(t(0==this.IsLocked()),!this.IsLocked()){var s=i.m_collideConnected;i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i==this.m_jointList&&(this.m_jointList=i.m_next);var n=i.m_bodyA,h=i.m_bodyB;if(n.SetAwake(!0),h.SetAwake(!0),i.m_edgeA.prev&&(i.m_edgeA.prev.next=i.m_edgeA.next),i.m_edgeA.next&&(i.m_edgeA.next.prev=i.m_edgeA.prev),i.m_edgeA==n.m_jointList&&(n.m_jointList=i.m_edgeA.next),i.m_edgeA.prev=null,i.m_edgeA.next=null,i.m_edgeB.prev&&(i.m_edgeB.prev.next=i.m_edgeB.next),i.m_edgeB.next&&(i.m_edgeB.next.prev=i.m_edgeB.prev),i.m_edgeB==h.m_jointList&&(h.m_jointList=i.m_edgeB.next),i.m_edgeB.prev=null,i.m_edgeB.next=null,vi.Destroy(i),t(this.m_jointCount>0),--this.m_jointCount,0==s)for(var r=h.GetContactList();r;)r.other==n&&r.contact.FlagForFiltering(),r=r.next}},Step:function(t,i,s){ds.start(),this.m_flags&Vt.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~Vt.e_newFixture),this.m_flags|=Vt.e_locked,this.p_step.dt=t,this.p_step.velocityIterations=i,this.p_step.positionIterations=s,this.p_step.inv_dt=t>0?1/t:0,this.p_step.dtRatio=this.m_inv_dt0*t,this.p_step.warmStarting=this.m_warmStarting,ps.start(),this.m_contactManager.Collide(),ps.stop(),this.m_stepComplete&&this.p_step.dt>0&&(gs.start(),this.Solve(this.p_step),gs.stop()),this.m_continuousPhysics&&this.p_step.dt>0&&(ms.start(),this.SolveTOI(this.p_step),ms.stop()),this.p_step.dt>0&&(this.m_inv_dt0=this.p_step.inv_dt),this.m_flags&Vt.e_clearForces&&this.ClearForces(),this.m_flags&=~Vt.e_locked,ds.stop()},ClearForces:function(){for(var t=this.m_bodyList;t;t=t.GetNext())t.m_force.x=t.m_force.y=0,t.m_torque=0},DrawDebugData:function(){if(null!=this.g_debugDraw){this.g_debugDraw.ClearDraw();var t=this.g_debugDraw.GetFlags();if(t&D.e_shapeBit)for(v=this.m_bodyList;v;v=v.GetNext())for(var i=v.GetTransform(),s=v.GetFixtureList();s;s=s.GetNext())0==v.IsActive()?this.DrawShape(s,i,new L(.5,.5,.3)):v.GetType()==xt.b2_staticBody?this.DrawShape(s,i,new L(.5,.9,.5)):v.GetType()==xt.b2_kinematicBody?this.DrawShape(s,i,new L(.5,.5,.9)):0==v.IsAwake()?this.DrawShape(s,i,new L(.6,.6,.6)):this.DrawShape(s,i,new L(.9,.7,.7));if(t&D.e_jointBit)for(var n=this.m_jointList;n;n=n.GetNext())this.DrawJoint(n);if(t&D.e_pairBit)for(var r=new L(.3,.9,.9),e=this.m_contactManager.m_contactList;e;e=e.GetNext()){var c=e.GetFixtureA(),o=e.GetFixtureB(),u=c.GetAABB(e.GetChildIndexA()).GetCenter(),a=o.GetAABB(e.GetChildIndexB()).GetCenter();this.g_debugDraw.DrawSegment(u,a,r)}if(t&D.e_aabbBit){r=new L(.9,.3,.9);for(var f=new L(.3,.3,.9),l=this.m_contactManager.m_broadPhase,v=this.m_bodyList;v;v=v.GetNext())if(0!=v.IsActive())for(s=v.GetFixtureList();s;s=s.GetNext())for(var d=0;d<s.m_proxyCount;++d){var p=s.m_proxies[d],g=l.GetFatAABB(p.proxyId),m=[];m[0]=new h(g.lowerBound.x,g.lowerBound.y),m[1]=new h(g.upperBound.x,g.lowerBound.y),m[2]=new h(g.upperBound.x,g.upperBound.y),m[3]=new h(g.lowerBound.x,g.upperBound.y),this.g_debugDraw.DrawPolygon(m,4,r);var w=new rt;s.GetShape().ComputeAABB(w,v.GetTransform(),0),(m=[])[0]=new h(w.lowerBound.x,w.lowerBound.y),m[1]=new h(w.upperBound.x,w.lowerBound.y),m[2]=new h(w.upperBound.x,w.upperBound.y),m[3]=new h(w.lowerBound.x,w.upperBound.y),this.g_debugDraw.DrawPolygon(m,4,f)}}if(t&D.e_centerOfMassBit)for(v=this.m_bodyList;v;v=v.GetNext())(i=v.GetTransform().Clone()).p=v.GetWorldCenter(),this.g_debugDraw.DrawTransform(i)}},QueryAABB:function(t,i){var s=new Ut;s.broadPhase=this.m_contactManager.m_broadPhase,s.callback=t,this.m_contactManager.m_broadPhase.Query(s,i)},RayCast:function(t,i,s){var n=new Wt;n.broadPhase=this.m_contactManager.m_broadPhase,n.callback=t;var h=new nt;h.maxFraction=1,h.p1=i,h.p2=s,this.m_contactManager.m_broadPhase.RayCast(n,h)},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactManager.m_contactList},SetAllowSleeping:function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},GetAllowSleeping:function(){return this.m_allowSleep},SetWarmStarting:function(t){this.m_warmStarting=t},GetWarmStarting:function(){return this.m_warmStarting},SetContinuousPhysics:function(t){this.m_continuousPhysics=t},GetContinuousPhysics:function(){return this.m_continuousPhysics},SetSubStepping:function(t){this.m_subStepping=t},GetSubStepping:function(){return this.m_subStepping},GetProxyCount:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},GetBodyCount:function(){return this.m_bodyCount},GetJointCount:function(){return this.m_jointCount},GetContactCount:function(){return this.m_contactManager.m_contactCount},GetTreeHeight:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},GetTreeBalance:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},GetTreeQuality:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},SetGravity:function(t){this.m_gravity=t},GetGravity:function(){return this.m_gravity},IsLocked:function(){return(this.m_flags&Vt.e_locked)==Vt.e_locked},SetAutoClearForces:function(t){t?this.m_flags|=Vt.e_clearForces:this.m_flags&=~Vt.e_clearForces},GetAutoClearForces:function(){return(this.m_flags&Vt.e_clearForces)==Vt.e_clearForces},ShiftOrigin:function(i){if(t(0==(this.m_flags&Vt.e_locked)),(this.m_flags&Vt.e_locked)!=Vt.e_locked){for(var s=this.m_bodyList;s;s=s.m_next)s.m_xf.p.Subtract(i),s.m_sweep.c0.Subtract(i),s.m_sweep.c.Subtract(i);for(var n=this.m_jointList;n;n=n.m_next)n.ShiftOrigin(i);this.m_contactManager.m_broadPhase.ShiftOrigin(i)}},GetContactManager:function(){return this.m_contactManager},Solve:function(i){for(this.p_island.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener),p=this.m_bodyList;p;p=p.m_next)p.m_flags&=~xt.e_islandFlag;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_flags&=~qt.e_islandFlag;for(var n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var h=this.m_bodyCount,r=new Array(h),e=this.m_bodyList;e;e=e.m_next)if(!(e.m_flags&xt.e_islandFlag)&&0!=e.IsAwake()&&0!=e.IsActive()&&e.GetType()!=xt.b2_staticBody){this.p_island.Clear();var c=0;for(r[c++]=e,e.m_flags|=xt.e_islandFlag;c>0;)if(t(1==(p=r[--c]).IsActive()),this.p_island.AddBody(p),p.SetAwake(!0),p.GetType()!=xt.b2_staticBody){for(var o=p.m_contactList;o;o=o.next){var u=o.contact;if(!(u.m_flags&qt.e_islandFlag)&&0!=u.IsEnabled()&&0!=u.IsTouching()){var a=u.m_fixtureA.m_isSensor,f=u.m_fixtureB.m_isSensor;a||f||(this.p_island.AddContact(u),u.m_flags|=qt.e_islandFlag,(v=o.other).m_flags&xt.e_islandFlag||(t(c<h),r[c++]=v,v.m_flags|=xt.e_islandFlag))}}for(var l=p.m_jointList;l;l=l.next)if(1!=l.joint.m_islandFlag){var v=l.other;0!=v.IsActive()&&(this.p_island.AddJoint(l.joint),l.joint.m_islandFlag=!0,v.m_flags&xt.e_islandFlag||(t(c<h),r[c++]=v,v.m_flags|=xt.e_islandFlag))}}this.p_island.Solve(i,this.m_gravity,this.m_allowSleep);for(var d=0;d<this.p_island.m_bodyCount;++d)(p=this.p_island.m_bodies[d]).GetType()==xt.b2_staticBody&&(p.m_flags&=~xt.e_islandFlag)}ws.start();for(var p=this.m_bodyList;p;p=p.GetNext())0!=(p.m_flags&xt.e_islandFlag)&&p.GetType()!=xt.b2_staticBody&&p.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),ws.stop()},SolveTOI:function(i){if(this.p_island.Initialize(64,32,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var s=this.m_bodyList;s;s=s.m_next)s.m_flags&=~xt.e_islandFlag,s.m_sweep.alpha0=0;for(r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_flags&=~(qt.e_toiFlag|qt.e_islandFlag),r.m_toiCount=0,r.m_toi=1}for(;;){for(var n=null,h=1,r=this.m_contactManager.m_contactList;r;r=r.m_next)if(0!=r.IsEnabled()&&!(r.m_toiCount>8)){var e=1;if(r.m_flags&qt.e_toiFlag)e=r.m_toi;else{var c=r.GetFixtureA(),o=r.GetFixtureB();if(c.IsSensor()||o.IsSensor())continue;var u=c.GetBody(),a=o.GetBody(),f=u.m_type,l=a.m_type;t(f==xt.b2_dynamicBody||l==xt.b2_dynamicBody);var v=u.IsAwake()&&f!=xt.b2_staticBody,d=a.IsAwake()&&l!=xt.b2_staticBody;if(0==v&&0==d)continue;var p=u.IsBullet()||f!=xt.b2_dynamicBody,g=a.IsBullet()||l!=xt.b2_dynamicBody;if(0==p&&0==g)continue;var m=u.m_sweep.alpha0;u.m_sweep.alpha0<a.m_sweep.alpha0?(m=a.m_sweep.alpha0,u.m_sweep.Advance(m)):a.m_sweep.alpha0<u.m_sweep.alpha0&&(m=u.m_sweep.alpha0,a.m_sweep.Advance(m)),t(m<1);var w=r.GetChildIndexA(),_=r.GetChildIndexB(),C=new yt;C.proxyA.Set(c.GetShape(),w),C.proxyB.Set(o.GetShape(),_),C.sweepA.Assign(u.m_sweep),C.sweepB.Assign(a.m_sweep),C.tMax=1;var b=new Tt;At(b,C);var y=b.t;e=b.state==Tt.e_touching?rs(m+(1-m)*y,1):1,r.m_toi=e,r.m_flags|=qt.e_toiFlag}e<h&&(n=r,h=e)}if(null==n||1-10*Gi<h){this.m_stepComplete=!0;break}if(c=n.GetFixtureA(),o=n.GetFixtureB(),u=c.GetBody(),a=o.GetBody(),Vt.m_local_sweep_backupA.Assign(u.m_sweep),Vt.m_local_sweep_backupB.Assign(a.m_sweep),u.Advance(h),a.Advance(h),n.Update(this.m_contactManager.m_contactListener),n.m_flags&=~qt.e_toiFlag,++n.m_toiCount,0!=n.IsEnabled()&&0!=n.IsTouching()){u.SetAwake(!0),a.SetAwake(!0),this.p_island.Clear(),this.p_island.AddBody(u),this.p_island.AddBody(a),this.p_island.AddContact(n),u.m_flags|=xt.e_islandFlag,a.m_flags|=xt.e_islandFlag,n.m_flags|=qt.e_islandFlag;for(var T=[u,a],S=0;S<2;++S)if((P=T[S]).m_type==xt.b2_dynamicBody)for(R=P.m_contactList;R&&this.p_island.m_bodyCount!=this.p_island.m_bodyCapacity&&this.p_island.m_contactCount!=this.p_island.m_contactCapacity;R=R.next){var A=R.contact;if(!(A.m_flags&qt.e_islandFlag)){var M=R.other;if(M.m_type!=xt.b2_dynamicBody||0!=P.IsBullet()||0!=M.IsBullet()){var x=A.m_fixtureA.m_isSensor,E=A.m_fixtureB.m_isSensor;x||E||(Vt.m_local_sweep_backupC.Assign(M.m_sweep),0==(M.m_flags&xt.e_islandFlag)&&M.Advance(h),A.Update(this.m_contactManager.m_contactListener),0!=A.IsEnabled()&&0!=A.IsTouching()?(A.m_flags|=qt.e_islandFlag,this.p_island.AddContact(A),M.m_flags&xt.e_islandFlag||(M.m_flags|=xt.e_islandFlag,M.m_type!=xt.b2_staticBody&&M.SetAwake(!0),this.p_island.AddBody(M))):(M.m_sweep.Assign(Vt.m_local_sweep_backupC),M.SynchronizeTransform()))}}}var O=new Bt;for(O.dt=(1-h)*i.dt,O.inv_dt=1/O.dt,O.dtRatio=1,O.positionIterations=20,O.velocityIterations=i.velocityIterations,O.warmStarting=!1,this.p_island.SolveTOI(O,u.m_islandIndex,a.m_islandIndex),S=0;S<this.p_island.m_bodyCount;++S){var P=this.p_island.m_bodies[S];if(P.m_flags&=~xt.e_islandFlag,P.m_type==xt.b2_dynamicBody){P.SynchronizeFixtures();for(var R=P.m_contactList;R;R=R.next)R.contact.m_flags&=~(qt.e_toiFlag|qt.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else n.SetEnabled(!1),u.m_sweep.Assign(Vt.m_local_sweep_backupA),a.m_sweep.Assign(Vt.m_local_sweep_backupB),u.SynchronizeTransform(),a.SynchronizeTransform()}},DrawJoint:function(t){var i=t.GetBodyA(),s=t.GetBodyB(),n=i.GetTransform(),h=s.GetTransform(),r=n.p,e=h.p,c=t.GetAnchorA(),o=t.GetAnchorB(),u=new L(.5,.8,.8);switch(t.GetType()){case vi.e_distanceJoint:this.g_debugDraw.DrawSegment(c,o,u);break;case vi.e_pulleyJoint:var a=t,f=a.GetGroundAnchorA(),l=a.GetGroundAnchorB();this.g_debugDraw.DrawSegment(f,c,u),this.g_debugDraw.DrawSegment(l,o,u),this.g_debugDraw.DrawSegment(f,l,u);break;case vi.e_mouseJoint:break;case vi.e_motorJoint:this.g_debugDraw.DrawPoint(t.GetLinearOffset(),5,u);default:this.g_debugDraw.DrawSegment(r,c,u),this.g_debugDraw.DrawSegment(c,o,u),this.g_debugDraw.DrawSegment(e,o,u)}},DrawShape:function(i,s,n){switch(i.GetType()){case k.e_circle:var r=i.GetShape(),e=M(s,r.m_p),c=r.m_radius,o=S(s.q,new h(1,0));this.g_debugDraw.DrawSolidCircle(e,c,o,n);break;case k.e_edge:var u=i.GetShape(),a=M(s,u.m_vertex1),f=M(s,u.m_vertex2);this.g_debugDraw.DrawSegment(a,f,n);break;case k.e_chain:for(var l=i.GetShape(),v=l.m_count,d=(a=M(s,(m=l.m_vertices)[0]),1);d<v;++d)f=M(s,m[d]),this.g_debugDraw.DrawSegment(a,f,n),a=f;break;case k.e_polygon:var p=i.GetShape(),g=p.m_count;t(g<=Vi);var m=new Array(Vi);for(d=0;d<g;++d)m[d]=M(s,p.m_vertices[d]);this.g_debugDraw.DrawSolidPolygon(m,g,n)}}},Vt.e_newFixture=1,Vt.e_locked=2,Vt.e_clearForces=4,Yt.prototype={Clear:function(){this.other=this.prev=this.next=null}},qt.m_local_tempManifold=new tt,qt.prototype={Create:function(t,i,s,n){this.m_toi=0,this.m_flags=qt.e_enabledFlag,this.m_fixtureA=t||null,this.m_fixtureB=s||null,this.m_indexA=i||0,this.m_indexB=n||0,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,t?(this.m_friction=Ht(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Xt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)):(this.m_friction=0,this.m_restitution=0),this.m_tangentSpeed=0},GetManifold:function(){return this.m_manifold},GetWorldManifold:function(t){var i=this.m_fixtureA.GetBody(),s=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,i.GetTransform(),n.m_radius,s.GetTransform(),h.m_radius)},IsTouching:function(){return(this.m_flags&qt.e_touchingFlag)==qt.e_touchingFlag},SetEnabled:function(t){t?this.m_flags|=qt.e_enabledFlag:this.m_flags&=~qt.e_enabledFlag},IsEnabled:function(){return(this.m_flags&qt.e_enabledFlag)==qt.e_enabledFlag},GetNext:function(){return this.m_next},GetFixtureA:function(){return this.m_fixtureA},GetChildIndexA:function(){return this.m_indexA},GetFixtureB:function(){return this.m_fixtureB},GetChildIndexB:function(){return this.m_indexB},SetFriction:function(t){this.m_friction=t},GetFriction:function(){return this.m_friction},ResetFriction:function(){this.m_friction=Ht(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},SetRestitution:function(t){this.m_restitution=t},GetRestitution:function(){return this.m_restitution},ResetRestitution:function(){this.m_restitution=Xt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},SetTangentSpeed:function(t){this.m_tangentSpeed=t},GetTangentSpeed:function(){return this.m_tangentSpeed},Evaluate:function(t,i,s){},FlagForFiltering:function(){this.m_flags|=qt.e_filterFlag},m_oldManifold:null,Update:function(t){qt.m_local_tempManifold.Assign(this.m_manifold),this.m_flags|=qt.e_enabledFlag;var i=!1,s=(this.m_flags&qt.e_touchingFlag)==qt.e_touchingFlag,n=this.m_fixtureA.IsSensor(),h=this.m_fixtureB.IsSensor(),r=n||h,e=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),o=e.GetTransform(),u=c.GetTransform();if(r){var a=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape();i=wt(a,this.m_indexA,f,this.m_indexB,o,u),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,o,u),i=this.m_manifold.pointCount>0;for(var l=0;l<this.m_manifold.pointCount;++l){var v=this.m_manifold.points[l];v.normalImpulse=0,v.tangentImpulse=0;for(var d=v.id,p=0;p<qt.m_local_tempManifold.pointCount;++p){var g=qt.m_local_tempManifold.points[p];if(g.id.Get()==d.Get()){v.normalImpulse=g.normalImpulse,v.tangentImpulse=g.tangentImpulse;break}}}i!=s&&(e.SetAwake(!0),c.SetAwake(!0))}i?this.m_flags|=qt.e_touchingFlag:this.m_flags&=~qt.e_touchingFlag,0==s&&1==i&&t&&t.BeginContact(this),1==s&&0==i&&t&&t.EndContact(this),0==r&&i&&t&&t.PreSolve(this,qt.m_local_tempManifold)}},qt.e_islandFlag=1,qt.e_touchingFlag=2,qt.e_enabledFlag=4,qt.e_filterFlag=8,qt.e_bulletHitFlag=16,qt.e_toiFlag=32,Zt.prototype={Evaluate:function(t,i,s){et(t,this.m_fixtureA.GetShape(),i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,0,n,0),t(this.m_fixtureA.GetType()==k.e_circle),t(this.m_fixtureB.GetType()==k.e_circle)}},Zt._extend(qt);var _s=new G;Qt.prototype={Evaluate:function(t,i,s){this.m_fixtureA.GetShape().GetChildEdge(_s,this.m_indexA),ft(t,_s,i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,s,n,h),t(this.m_fixtureA.GetType()==k.e_chain),t(this.m_fixtureB.GetType()==k.e_circle)}},Qt._extend(qt),Kt.prototype={Evaluate:function(t,i,s){this.m_fixtureA.GetShape().GetChildEdge(_s,this.m_indexA),gt(t,_s,i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,s,n,h),t(this.m_fixtureA.GetType()==k.e_chain),t(this.m_fixtureB.GetType()==k.e_polygon)}},Kt.Create=function(t,i,s,n){return new Kt(t,i,s,n)},Kt._extend(qt),$t.prototype={Evaluate:function(t,i,s){ft(t,this.m_fixtureA.GetShape(),i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,0,n,0),t(this.m_fixtureA.GetType()==k.e_edge),t(this.m_fixtureB.GetType()==k.e_circle)}},$t.Create=function(t,i,s,n){return new $t(t,s)},$t._extend(qt),ti.prototype={Evaluate:function(t,i,s){gt(t,this.m_fixtureA.GetShape(),i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,0,n,0),t(this.m_fixtureA.GetType()==k.e_edge),t(this.m_fixtureB.GetType()==k.e_polygon)}},ti.Create=function(t,i,s,n){return new ti(t,s)},ti._extend(qt),ii.prototype={Evaluate:function(t,i,s){ct(t,this.m_fixtureA.GetShape(),i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,0,n,0),t(this.m_fixtureA.GetType()==k.e_polygon),t(this.m_fixtureB.GetType()==k.e_circle)}},ii.Create=function(t,i,s,n){return new ii(t,s)},ii._extend(qt),si.prototype={Evaluate:function(t,i,s){at(t,this.m_fixtureA.GetShape(),i,this.m_fixtureB.GetShape(),s)},Create:function(i,s,n,h){this.parent.prototype.Create.call(this,i,0,n,0),t(this.m_fixtureA.GetType()==k.e_polygon),t(this.m_fixtureB.GetType()==k.e_polygon)}},si.Create=function(t,i,s,n){return new si(t,s)},si._extend(qt),qt.AddType=function(i,s,n){t(0<=s&&s<k.e_typeCount),t(0<=n&&n<k.e_typeCount),qt.s_registers[s]||(qt.s_registers[s]=[]),qt.s_registers[s][n]=new Jt,qt.s_registers[s][n].fcn=i,qt.s_registers[s][n].primary=!0,s!=n&&(qt.s_registers[n]||(qt.s_registers[n]=[]),qt.s_registers[n][s]=new Jt,qt.s_registers[n][s].fcn=i,qt.s_registers[n][s].primary=!1),i.garbage=[],i.alloc=2},qt.InitializeRegisters=function(){qt.AddType(Zt,k.e_circle,k.e_circle),qt.AddType(ii,k.e_polygon,k.e_circle),qt.AddType(si,k.e_polygon,k.e_polygon),qt.AddType($t,k.e_edge,k.e_circle),qt.AddType(ti,k.e_edge,k.e_polygon),qt.AddType(Qt,k.e_chain,k.e_circle),qt.AddType(Kt,k.e_chain,k.e_polygon)},qt.RetrieveGarbage=function(t){var i;if(i=t.garbage.pop())return i;for(var s=0;s<t.alloc-1;++s)t.garbage.push(new t);return t.alloc+=32,new t},qt.Create=function(i,s,n,h){0==qt.s_initialized&&(qt.InitializeRegisters(),qt.s_initialized=!0);var r=i.GetType(),e=n.GetType();t(0<=r&&r<k.e_typeCount),t(0<=e&&e<k.e_typeCount);var c=qt.s_registers[r]&&qt.s_registers[r][e]?qt.s_registers[r][e].fcn:null;if(c){var o=qt.RetrieveGarbage(c);return qt.s_registers[r][e].primary?o.Create(i,s,n,h):o.Create(n,h,i,s),o}return null},qt.Destroy=function(i){t(1==qt.s_initialized);var s=i.m_fixtureA,n=i.m_fixtureB;i.m_manifold.pointCount>0&&0==s.IsSensor()&&0==n.IsSensor()&&(s.GetBody().SetAwake(!0),n.GetBody().SetAwake(!0));var h=s.GetType(),r=n.GetType();t(0<=h&&r<k.e_typeCount),t(0<=h&&r<k.e_typeCount),i.m_nodeA.Clear(),i.m_nodeB.Clear(),qt.s_registers[h][r].fcn.garbage.push(i)},qt.s_registers=[],qt.s_initialized=!1;var Cs=new Lt,bs=new Ft;ni.prototype={AddPair:function(t,i){var s=t,n=i,h=s.fixture,r=n.fixture,e=s.childIndex,c=n.childIndex,o=h.GetBody(),u=r.GetBody();if(o!=u){for(var a=u.GetContactList();a;){if(a.other==o){var f=a.contact.GetFixtureA(),l=a.contact.GetFixtureB(),v=a.contact.GetChildIndexA(),d=a.contact.GetChildIndexB();if(f==h&&l==r&&v==e&&d==c)return;if(f==r&&l==h&&v==c&&d==e)return}a=a.next}if(0!=u.ShouldCollide(o)&&(!this.m_contactFilter||0!=this.m_contactFilter.ShouldCollide(h,r))){var p=qt.Create(h,e,r,c);null!=p&&(h=p.GetFixtureA(),r=p.GetFixtureB(),e=p.GetChildIndexA(),c=p.GetChildIndexB(),o=h.GetBody(),u=r.GetBody(),p.m_prev=null,p.m_next=this.m_contactList,null!=this.m_contactList&&(this.m_contactList.m_prev=p),this.m_contactList=p,p.m_nodeA.contact=p,p.m_nodeA.other=u,p.m_nodeA.prev=null,p.m_nodeA.next=o.m_contactList,null!=o.m_contactList&&(o.m_contactList.prev=p.m_nodeA),o.m_contactList=p.m_nodeA,p.m_nodeB.contact=p,p.m_nodeB.other=o,p.m_nodeB.prev=null,p.m_nodeB.next=u.m_contactList,null!=u.m_contactList&&(u.m_contactList.prev=p.m_nodeB),u.m_contactList=p.m_nodeB,0==h.IsSensor()&&0==r.IsSensor()&&(o.SetAwake(!0),u.SetAwake(!0)),++this.m_contactCount)}}},FindNewContacts:function(){this.m_broadPhase.UpdatePairs(this)},Destroy:function(t){var i=t.GetFixtureA(),s=t.GetFixtureB(),n=i.GetBody(),h=s.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==h.m_contactList&&(h.m_contactList=t.m_nodeB.next),qt.Destroy(t),--this.m_contactCount},Collide:function(){for(var t=this.m_contactList;t;){var i=t.GetFixtureA(),s=t.GetFixtureB(),n=t.GetChildIndexA(),h=t.GetChildIndexB(),r=i.GetBody(),e=s.GetBody();if(t.m_flags&qt.e_filterFlag){if(0==e.ShouldCollide(r)){t=(f=t).GetNext(),this.Destroy(f);continue}if(this.m_contactFilter&&0==this.m_contactFilter.ShouldCollide(i,s)){t=(f=t).GetNext(),this.Destroy(f);continue}t.m_flags&=~qt.e_filterFlag}var c=r.IsAwake()&&r.m_type!=xt.b2_staticBody,o=e.IsAwake()&&e.m_type!=xt.b2_staticBody;if(0!=c||0!=o){var u=i.m_proxies[n].proxyId,a=s.m_proxies[h].proxyId;if(0!=this.m_broadPhase.TestOverlap(u,a))t.Update(this.m_contactListener),t=t.GetNext();else{var f=t;t=f.GetNext(),this.Destroy(f)}}else t=t.GetNext()}}},ci.prototype={Initialize:function(i,s,n,h){switch(t(i.pointCount>0),i.type){case tt.e_circles:var r=s.q.c*i.localPoint.x-s.q.s*i.localPoint.y+s.p.x,e=s.q.s*i.localPoint.x+s.q.c*i.localPoint.y+s.p.y,c=n.q.c*i.localPoints[0].x-n.q.s*i.localPoints[0].y+n.p.x,o=n.q.s*i.localPoints[0].x+n.q.c*i.localPoints[0].y+n.p.y;this.point.x=.5*(r+c),this.point.y=.5*(e+o),this.normal.x=c-r,this.normal.y=o-e;var u=this.normal.x,a=this.normal.y;this.normal.Normalize(),this.separation=u*this.normal.x+a*this.normal.y-i.radiusA-i.radiusB;break;case tt.e_faceA:this.normal.x=s.q.c*i.localNormal.x-s.q.s*i.localNormal.y,this.normal.y=s.q.s*i.localNormal.x+s.q.c*i.localNormal.y;var f=s.q.c*i.localPoint.x-s.q.s*i.localPoint.y+s.p.x,l=s.q.s*i.localPoint.x+s.q.c*i.localPoint.y+s.p.y,v=n.q.c*i.localPoints[h].x-n.q.s*i.localPoints[h].y+n.p.x,d=n.q.s*i.localPoints[h].x+n.q.c*i.localPoints[h].y+n.p.y;this.separation=(v-f)*this.normal.x+(d-l)*this.normal.y-i.radiusA-i.radiusB,this.point.x=v,this.point.y=d;break;case tt.e_faceB:this.normal.x=n.q.c*i.localNormal.x-n.q.s*i.localNormal.y,this.normal.y=n.q.s*i.localNormal.x+n.q.c*i.localNormal.y,f=n.q.c*i.localPoint.x-n.q.s*i.localPoint.y+n.p.x,l=n.q.s*i.localPoint.x+n.q.c*i.localPoint.y+n.p.y,v=s.q.c*i.localPoints[h].x-s.q.s*i.localPoints[h].y+s.p.x,d=s.q.s*i.localPoints[h].x+s.q.c*i.localPoints[h].y+s.p.y,this.separation=(v-f)*this.normal.x+(d-l)*this.normal.y-i.radiusA-i.radiusB,this.point.x=v,this.point.y=d,this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}},ui.cs_xfA=new u,ui.cs_xfB=new u,ui.temp_solver_manifold=new ci,ui.prototype={Init:function(i){this.m_step=i.step,this.m_count=i.count,this.m_positionConstraints.length=this.m_count,this.m_velocityConstraints.length=this.m_count,this.m_positions=i.positions,this.m_velocities=i.velocities,this.m_contacts=i.contacts;for(var s=0;s<this.m_count;++s){var n=this.m_contacts[s],h=n.m_fixtureA,r=n.m_fixtureB,e=h.GetShape(),c=r.GetShape(),o=e.m_radius,u=c.m_radius,a=h.GetBody(),f=r.GetBody(),l=n.GetManifold(),v=l.pointCount;t(v>0);var d=this.m_velocityConstraints[s]||new ei;d.friction=n.m_friction,d.restitution=n.m_restitution,d.tangentSpeed=n.m_tangentSpeed,d.indexA=a.m_islandIndex,d.indexB=f.m_islandIndex,d.invMassA=a.m_invMass,d.invMassB=f.m_invMass,d.invIA=a.m_invI,d.invIB=f.m_invI,d.contactIndex=s,d.pointCount=v,d.K.SetZero(),d.normalMass.SetZero(),this.m_velocityConstraints[s]=d;var p=this.m_positionConstraints[s]||new ri;p.indexA=a.m_islandIndex,p.indexB=f.m_islandIndex,p.invMassA=a.m_invMass,p.invMassB=f.m_invMass,p.localCenterA.x=a.m_sweep.localCenter.x,p.localCenterA.y=a.m_sweep.localCenter.y,p.localCenterB.x=f.m_sweep.localCenter.x,p.localCenterB.y=f.m_sweep.localCenter.y,p.invIA=a.m_invI,p.invIB=f.m_invI,p.localNormal.x=l.localNormal.x,p.localNormal.y=l.localNormal.y,p.localPoint.x=l.localPoint.x,p.localPoint.y=l.localPoint.y,p.pointCount=v,p.radiusA=o,p.radiusB=u,p.type=l.type,this.m_positionConstraints[s]=p;for(var g=0;g<v;++g){var m=l.points[g],w=d.points[g];this.m_step.warmStarting?(w.normalImpulse=this.m_step.dtRatio*m.normalImpulse,w.tangentImpulse=this.m_step.dtRatio*m.tangentImpulse):(w.normalImpulse=0,w.tangentImpulse=0),w.rA.SetZero(),w.rB.SetZero(),w.normalMass=0,w.tangentMass=0,w.velocityBias=0,p.localPoints[g]=m.localPoint}}},InitializeVelocityConstraints:function(){for(var i=0;i<this.m_count;++i){var s=this.m_velocityConstraints[i],n=this.m_positionConstraints[i],h=n.radiusA,r=n.radiusB,e=this.m_contacts[s.contactIndex].GetManifold(),c=s.indexA,o=s.indexB,u=s.invMassA,a=s.invMassB,f=s.invIA,l=s.invIB,v=n.localCenterA,d=n.localCenterB,p=this.m_positions[c].c,g=this.m_positions[c].a,m=this.m_velocities[c].v,w=this.m_velocities[c].w,_=this.m_positions[o].c,C=this.m_positions[o].a,b=this.m_velocities[o].v,y=this.m_velocities[o].w;t(e.pointCount>0),ui.cs_xfA.q.Set(g),ui.cs_xfB.q.Set(C),ui.cs_xfA.p.x=p.x-(ui.cs_xfA.q.c*v.x-ui.cs_xfA.q.s*v.y),ui.cs_xfA.p.y=p.y-(ui.cs_xfA.q.s*v.x+ui.cs_xfA.q.c*v.y),ui.cs_xfB.p.x=_.x-(ui.cs_xfB.q.c*d.x-ui.cs_xfB.q.s*d.y),ui.cs_xfB.p.y=_.y-(ui.cs_xfB.q.s*d.x+ui.cs_xfB.q.c*d.y);var T=new it;T.Initialize(e,ui.cs_xfA,h,ui.cs_xfB,r),s.normal.x=T.normal.x,s.normal.y=T.normal.y;for(var S=s.pointCount,A=0;A<S;++A){var M=s.points[A];M.rA.x=T.points[A].x-p.x,M.rA.y=T.points[A].y-p.y,M.rB.x=T.points[A].x-_.x,M.rB.y=T.points[A].y-_.y;var x=M.rA.x*s.normal.y-M.rA.y*s.normal.x,E=M.rB.x*s.normal.y-M.rB.y*s.normal.x,O=u+a+f*x*x+l*E*E;M.normalMass=O>0?1/O:0;var P=1*s.normal.y,R=-1*s.normal.x,I=M.rA.x*R-M.rA.y*P,L=M.rB.x*R-M.rB.y*P,D=u+a+f*I*I+l*L*L;M.tangentMass=D>0?1/D:0,M.velocityBias=0;var F=s.normal.x*(b.x+-y*M.rB.y-m.x- -w*M.rA.y)+s.normal.y*(b.y+y*M.rB.x-m.y-w*M.rA.x);F<-1&&(M.velocityBias=-s.restitution*F)}if(2==s.pointCount){var N=s.points[0],k=s.points[1],B=N.rA.x*s.normal.y-N.rA.y*s.normal.x,G=N.rB.x*s.normal.y-N.rB.y*s.normal.x,z=k.rA.x*s.normal.y-k.rA.y*s.normal.x,j=k.rB.x*s.normal.y-k.rB.y*s.normal.x,V=u+a+f*B*B+l*G*G,U=u+a+f*z*z+l*j*j,W=u+a+f*B*z+l*G*j;V*V<1e3*(V*U-W*W)?(s.K.ex.x=V,s.K.ex.y=W,s.K.ey.x=W,s.K.ey.y=U,s.normalMass.Assign(s.K.GetInverse())):s.pointCount=1}}},WarmStart:function(){for(var t=0;t<this.m_count;++t){for(var i=this.m_velocityConstraints[t],s=i.indexA,n=i.indexB,h=i.invMassA,r=i.invIA,e=i.invMassB,c=i.invIB,o=i.pointCount,u=this.m_velocities[s].v,a=this.m_velocities[s].w,f=this.m_velocities[n].v,l=this.m_velocities[n].w,v=i.normal,d=1*v.y,p=-1*v.x,g=0;g<o;++g){var m=i.points[g],w=m.normalImpulse*v.x+m.tangentImpulse*d,_=m.normalImpulse*v.y+m.tangentImpulse*p;a-=r*(m.rA.x*_-m.rA.y*w),u.x-=h*w,u.y-=h*_,l+=c*(m.rB.x*_-m.rB.y*w),f.x+=e*w,f.y+=e*_}this.m_velocities[s].w=a,this.m_velocities[n].w=l}},SolveVelocityConstraints:function(){for(var i=0;i<this.m_count;++i){var s=this.m_velocityConstraints[i],n=s.indexA,h=s.indexB,r=s.invMassA,e=s.invIA,c=s.invMassB,o=s.invIB,u=s.pointCount,a=this.m_velocities[n].v,f=this.m_velocities[n].w,l=this.m_velocities[h].v,v=this.m_velocities[h].w,d=s.normal,p=1*d.y,g=-1*d.x,m=s.friction;t(1==u||2==u);for(var w=0;w<u;++w){var _=s.points[w],C=l.x+-v*_.rB.y-a.x- -f*_.rA.y,b=l.y+v*_.rB.x-a.y-f*_.rA.x,y=C*p+b*g-s.tangentSpeed,T=_.tangentMass*-y,S=m*_.normalImpulse;T=(E=I(_.tangentImpulse+T,-S,S))-_.tangentImpulse,_.tangentImpulse=E;var A=T*p,M=T*g;a.x-=r*A,a.y-=r*M,f-=e*(_.rA.x*M-_.rA.y*A),l.x+=c*A,l.y+=c*M,v+=o*(_.rB.x*M-_.rB.y*A)}if(1==s.pointCount){_=s.points[0],C=l.x+-v*_.rB.y-a.x- -f*_.rA.y,b=l.y+v*_.rB.x-a.y-f*_.rA.x;var x=C*d.x+b*d.y,E=(T=-_.normalMass*(x-_.velocityBias),es(_.normalImpulse+T,0));T=E-_.normalImpulse,_.normalImpulse=E,A=T*d.x,M=T*d.y,a.x-=r*A,a.y-=r*M,f-=e*(_.rA.x*M-_.rA.y*A),l.x+=c*A,l.y+=c*M,v+=o*(_.rB.x*M-_.rB.y*A)}else{var O=s.points[0],P=s.points[1],R=O.normalImpulse,L=P.normalImpulse;t(R>=0&&L>=0);var D=l.x+-v*O.rB.y-a.x- -f*O.rA.y,F=l.y+v*O.rB.x-a.y-f*O.rA.x,N=l.x+-v*P.rB.y-a.x- -f*P.rA.y,k=l.y+v*P.rB.x-a.y-f*P.rA.x,B=D*d.x+F*d.y,G=N*d.x+k*d.y,z=B-O.velocityBias,j=G-P.velocityBias;for(z-=s.K.ex.x*R+s.K.ey.x*L,j-=s.K.ex.y*R+s.K.ey.y*L;;){var V=-(s.normalMass.ex.x*z+s.normalMass.ey.x*j),U=-(s.normalMass.ex.y*z+s.normalMass.ey.y*j);if(V>=0&&U>=0){var W=V-R,H=U-L,X=W*d.x,J=W*d.y,Y=H*d.x,q=H*d.y;a.x-=r*(X+Y),a.y-=r*(J+q),f-=e*(O.rA.x*J-O.rA.y*X+(P.rA.x*q-P.rA.y*Y)),l.x+=c*(X+Y),l.y+=c*(J+q),v+=o*(O.rB.x*J-O.rB.y*X+(P.rB.x*q-P.rB.y*Y)),O.normalImpulse=V,P.normalImpulse=U;break}if(V=-O.normalMass*z,U=0,B=0,G=s.K.ex.y*V+j,V>=0&&G>=0){H=U-L,X=(W=V-R)*d.x,J=W*d.y,Y=H*d.x,q=H*d.y,a.x-=r*(X+Y),a.y-=r*(J+q),f-=e*(O.rA.x*J-O.rA.y*X+(P.rA.x*q-P.rA.y*Y)),l.x+=c*(X+Y),l.y+=c*(J+q),v+=o*(O.rB.x*J-O.rB.y*X+(P.rB.x*q-P.rB.y*Y)),O.normalImpulse=V,P.normalImpulse=U;break}if(V=0,U=-P.normalMass*j,B=s.K.ey.x*U+z,G=0,U>=0&&B>=0){H=U-L,X=(W=V-R)*d.x,J=W*d.y,Y=H*d.x,q=H*d.y,a.x-=r*(X+Y),a.y-=r*(J+q),f-=e*(O.rA.x*J-O.rA.y*X+(P.rA.x*q-P.rA.y*Y)),l.x+=c*(X+Y),l.y+=c*(J+q),v+=o*(O.rB.x*J-O.rB.y*X+(P.rB.x*q-P.rB.y*Y)),O.normalImpulse=V,P.normalImpulse=U;break}if(V=0,U=0,B=z,G=j,B>=0&&G>=0){H=U-L,X=(W=V-R)*d.x,J=W*d.y,Y=H*d.x,q=H*d.y,a.x-=r*(X+Y),a.y-=r*(J+q),f-=e*(O.rA.x*J-O.rA.y*X+(P.rA.x*q-P.rA.y*Y)),l.x+=c*(X+Y),l.y+=c*(J+q),v+=o*(O.rB.x*J-O.rB.y*X+(P.rB.x*q-P.rB.y*Y)),O.normalImpulse=V,P.normalImpulse=U;break}break}}this.m_velocities[n].w=f,this.m_velocities[h].w=v}},StoreImpulses:function(){for(var t=0;t<this.m_count;++t)for(var i=this.m_velocityConstraints[t],s=this.m_contacts[i.contactIndex].GetManifold(),n=0;n<i.pointCount;++n)s.points[n].normalImpulse=i.points[n].normalImpulse,s.points[n].tangentImpulse=i.points[n].tangentImpulse},SolvePositionConstraints:function(){for(var t=0,i=0;i<this.m_count;++i){for(var s=this.m_positionConstraints[i],n=s.indexA,h=s.indexB,r=s.localCenterA,e=s.invMassA,c=s.invIA,o=s.localCenterB,u=s.invMassB,a=s.invIB,f=s.pointCount,l=this.m_positions[n].c,v=this.m_positions[n].a,d=this.m_positions[h].c,p=this.m_positions[h].a,g=0;g<f;++g){ui.cs_xfA.q.Set(v),ui.cs_xfB.q.Set(p),ui.cs_xfA.p.x=l.x-(ui.cs_xfA.q.c*r.x-ui.cs_xfA.q.s*r.y),ui.cs_xfA.p.y=l.y-(ui.cs_xfA.q.s*r.x+ui.cs_xfA.q.c*r.y),ui.cs_xfB.p.x=d.x-(ui.cs_xfB.q.c*o.x-ui.cs_xfB.q.s*o.y),ui.cs_xfB.p.y=d.y-(ui.cs_xfB.q.s*o.x+ui.cs_xfB.q.c*o.y),ui.temp_solver_manifold.Initialize(s,ui.cs_xfA,ui.cs_xfB,g);var m=ui.temp_solver_manifold.normal,w=ui.temp_solver_manifold.point,_=ui.temp_solver_manifold.separation,C=w.x-l.x,b=w.y-l.y,y=w.x-d.x,T=w.y-d.y;t=rs(t,_);var S=I(.2*(_+Ui),-.2,0),A=C*m.y-b*m.x,M=y*m.y-T*m.x,x=e+u+c*A*A+a*M*M,E=x>0?-S/x:0,O=E*m.x,P=E*m.y;l.x-=e*O,l.y-=e*P,v-=c*(C*P-b*O),d.x+=u*O,d.y+=u*P,p+=a*(y*P-T*O)}this.m_positions[n].a=v,this.m_positions[h].a=p}return t>=-3*Ui},SolveTOIPositionConstraints:function(t,i){for(var s=0,n=0;n<this.m_count;++n){var r=this.m_positionConstraints[n],e=r.indexA,c=r.indexB,o=r.localCenterA,u=r.localCenterB,a=r.pointCount,f=0,v=0;e!=t&&e!=i||(f=r.invMassA,v=r.invIA);var d=0,p=0;c!=t&&c!=i||(d=r.invMassB,p=r.invIB);for(var g=this.m_positions[e].c,m=this.m_positions[e].a,w=this.m_positions[c].c,_=this.m_positions[c].a,C=0;C<a;++C){ui.cs_xfA.q.Set(m),ui.cs_xfB.q.Set(_),ui.cs_xfA.p.Assign(h.Subtract(g,S(ui.cs_xfA.q,o))),ui.cs_xfB.p.Assign(h.Subtract(w,S(ui.cs_xfB.q,u))),ui.temp_solver_manifold.Initialize(r,ui.cs_xfA,ui.cs_xfB,C);var b=ui.temp_solver_manifold.normal,y=ui.temp_solver_manifold.point,T=ui.temp_solver_manifold.separation,A=h.Subtract(y,g),M=h.Subtract(y,w);s=rs(s,T);var x=I(.75*(T+Ui),-.2,0),E=l(A,b),O=l(M,b),P=f+d+v*E*E+p*O*O,R=h.Multiply(P>0?-x/P:0,b);g.Subtract(h.Multiply(f,R)),m-=v*l(A,R),w.Add(h.Multiply(d,R)),_+=p*l(M,R)}this.m_positions[e].a=m,this.m_positions[c].a=_}return s>=-1.5*Ui}};var ys=ki.create("solve initialization","solve"),Ts=ki.create("warm starting","solve initialization"),Ss=ki.create("solve velocities","solve"),As=ki.create("solve positions","solve");ai._solverData=new jt,ai._solverDef=new oi,ai._solver=new ui,ai.prototype={Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Initialize:function(t,i,s,n){this.m_listener=n,this.m_bodyCapacity=t,this.m_contactCapacity=i,this.m_jointCapacity=s,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodies.length=t,this.m_contacts.length=i,this.m_joints.length=s,this.m_velocities.length=t,this.m_positions.length=t},Solve:function(t,i,s){ys.start();for(var n=t.dt,h=0;h<this.m_bodyCount;++h){var r=this.m_bodies[h];this.m_positions[h].c.Assign(r.m_sweep.c),c=r.m_sweep.a,this.m_velocities[h].v.Assign(r.m_linearVelocity),u=r.m_angularVelocity,r.m_sweep.c0.Assign(r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.m_type==xt.b2_dynamicBody&&(this.m_velocities[h].v.x+=n*(r.m_gravityScale*i.x+r.m_invMass*r.m_force.x),this.m_velocities[h].v.y+=n*(r.m_gravityScale*i.y+r.m_invMass*r.m_force.y),u+=n*r.m_invI*r.m_torque,this.m_velocities[h].v.x*=1/(1+n*r.m_linearDamping),this.m_velocities[h].v.y*=1/(1+n*r.m_linearDamping),u*=1/(1+n*r.m_angularDamping)),this.m_positions[h].a=c,this.m_velocities[h].w=u}for(ai._solverData.step=t,ai._solverData.positions=this.m_positions,ai._solverData.velocities=this.m_velocities,ai._solverDef.step=t,ai._solverDef.contacts=this.m_contacts,ai._solverDef.count=this.m_contactCount,ai._solverDef.positions=this.m_positions,ai._solverDef.velocities=this.m_velocities,ai._solverDef.allocator=this.m_allocator,ai._solver.Init(ai._solverDef),ai._solver.InitializeVelocityConstraints(),t.warmStarting&&(Ts.start(),ai._solver.WarmStart(),Ts.stop()),h=0;h<this.m_jointCount;++h)this.m_joints[h].InitVelocityConstraints(ai._solverData);for(ys.stop(),Ss.start(),h=0;h<t.velocityIterations;++h){for(_=0;_<this.m_jointCount;++_)this.m_joints[_].SolveVelocityConstraints(ai._solverData);ai._solver.SolveVelocityConstraints()}for(ai._solver.StoreImpulses(),Ss.stop(),As.start(),h=0;h<this.m_bodyCount;++h){var e=this.m_positions[h].c,c=this.m_positions[h].a,o=this.m_velocities[h].v,u=this.m_velocities[h].w,a=n*o.x,l=n*o.y,v=a*a+l*l;if(v>4){var d=2/ss(v);o.x*=d,o.y*=d}var p=n*u;p*p>Yi&&(u*=d=Ji/hs(p)),e.x+=n*o.x,e.y+=n*o.y,c+=n*u,this.m_positions[h].a=c,this.m_velocities[h].w=u}var g=!1;for(h=0;h<t.positionIterations;++h){for(var m=ai._solver.SolvePositionConstraints(),w=!0,_=0;_<this.m_jointCount;++_){var C=this.m_joints[_].SolvePositionConstraints(ai._solverData);w=w&&C}if(m&&w){g=!0;break}}for(h=0;h<this.m_bodyCount;++h){var b=this.m_bodies[h];b.m_sweep.c.Assign(this.m_positions[h].c),b.m_sweep.a=this.m_positions[h].a,b.m_linearVelocity.Assign(this.m_velocities[h].v),b.m_angularVelocity=this.m_velocities[h].w,b.SynchronizeTransform()}if(As.stop(),this.Report(ai._solver.m_velocityConstraints),s){var y=Bi,T=qi*qi;for(h=0;h<this.m_bodyCount;++h)(r=this.m_bodies[h]).GetType()!=xt.b2_staticBody&&(0==(r.m_flags&xt.e_autoSleepFlag)||r.m_angularVelocity*r.m_angularVelocity>T||f(r.m_linearVelocity,r.m_linearVelocity)>1e-4?(r.m_sleepTime=0,y=0):(r.m_sleepTime+=n,y=rs(y,r.m_sleepTime)));if(y>=.5&&g)for(h=0;h<this.m_bodyCount;++h)(r=this.m_bodies[h]).SetAwake(!1)}},SolveTOI:function(i,s,n){for(t(s<this.m_bodyCount),t(n<this.m_bodyCount),c=0;c<this.m_bodyCount;++c){var r=this.m_bodies[c];this.m_positions[c].c.Assign(r.m_sweep.c),this.m_positions[c].a=r.m_sweep.a,this.m_velocities[c].v.Assign(r.m_linearVelocity),this.m_velocities[c].w=r.m_angularVelocity}for(ai._solverDef.contacts=this.m_contacts,ai._solverDef.count=this.m_contactCount,ai._solverDef.step=i,ai._solverDef.positions=this.m_positions,ai._solverDef.velocities=this.m_velocities,ai._solver.Init(ai._solverDef),c=0;c<i.positionIterations&&!ai._solver.SolveTOIPositionConstraints(s,n);++c);for(this.m_bodies[s].m_sweep.c0.Assign(this.m_positions[s].c),this.m_bodies[s].m_sweep.a0=this.m_positions[s].a,this.m_bodies[n].m_sweep.c0.Assign(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,ai._solver.InitializeVelocityConstraints(),c=0;c<i.velocityIterations;++c)ai._solver.SolveVelocityConstraints();for(var e=i.dt,c=0;c<this.m_bodyCount;++c){var o=this.m_positions[c].c,u=this.m_positions[c].a,a=this.m_velocities[c].v,l=this.m_velocities[c].w,v=h.Multiply(e,a);if(f(v,v)>4){var d=2/v.Length();a.Multiply(d)}var p=e*l;p*p>Yi&&(l*=d=Ji/hs(p)),o.Add(h.Multiply(e,a)),u+=e*l,this.m_positions[c].a=u,this.m_velocities[c].w=l;var g=this.m_bodies[c];g.m_sweep.c.Assign(o),g.m_sweep.a=u,g.m_linearVelocity.Assign(a),g.m_angularVelocity=l,g.SynchronizeTransform()}this.Report(ai._solver.m_velocityConstraints)},AddBody:function(i){t(this.m_bodyCount<this.m_bodyCapacity),i.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=i,this.m_positions[this.m_bodyCount]||(this.m_positions[this.m_bodyCount]=new Gt,this.m_velocities[this.m_bodyCount]=new zt),++this.m_bodyCount},AddContact:function(i){t(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=i},AddJoint:function(i){t(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=i},Report:function(t){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){var s=this.m_contacts[i],n=t[i],h=new Dt;h.count=n.pointCount;for(var r=0;r<n.pointCount;++r)h.normalImpulses[r]=n.points[r].normalImpulse,h.tangentImpulses[r]=n.points[r].tangentImpulse;this.m_listener.PostSolve(s,h)}}},li.prototype={_deserialize:function(t,i,s){this.bodyA=i[t.bodyA],this.bodyB=i[t.bodyB],this.collideConnected=t.collideConnected}},vi.prototype={GetType:function(){return this.m_type},GetBodyA:function(){return this.m_bodyA},GetBodyB:function(){return this.m_bodyB},GetAnchorA:function(){},GetAnchorB:function(){},GetReactionForce:function(t){},GetReactionTorque:function(t){},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},IsActive:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},GetCollideConnected:function(){return this.m_collideConnected},ShiftOrigin:function(t){},InitVelocityConstraints:function(t){},SolveVelocityConstraints:function(t){},SolvePositionConstraints:function(t){},_serialize:function(t){var i=t||{};return i.bodyA=null,i.bodyB=null,i.type=this.m_type,i.collideConnected=this.m_collideConnected,i}},vi.e_inactiveLimit=0,vi.e_atLowerLimit=1,vi.e_atUpperLimit=2,vi.e_equalLimits=3,vi.e_unknownJoint=0,vi.e_revoluteJoint=1,vi.e_prismaticJoint=2,vi.e_distanceJoint=3,vi.e_pulleyJoint=4,vi.e_mouseJoint=5,vi.e_gearJoint=6,vi.e_wheelJoint=7,vi.e_weldJoint=8,vi.e_frictionJoint=9,vi.e_ropeJoint=10,vi.e_motorJoint=11,vi.Create=function(i){var s=null;switch(i.type){case vi.e_distanceJoint:s=new _i(i);break;case vi.e_mouseJoint:s=new mi(i);break;case vi.e_prismaticJoint:s=new bi(i);break;case vi.e_revoluteJoint:s=new pi(i);break;case vi.e_pulleyJoint:s=new Li(i);break;case vi.e_gearJoint:s=new Oi(i);break;case vi.e_wheelJoint:s=new xi(i);break;case vi.e_weldJoint:s=new Ai(i);break;case vi.e_frictionJoint:s=new Ti(i);break;case vi.e_ropeJoint:s=new Fi(i);break;case vi.e_motorJoint:s=new Ri(i);break;default:t(!1)}return s},vi.Destroy=function(t){},di.prototype={Initialize:function(t,i,s){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(s),this.localAnchorB=this.bodyB.GetLocalPoint(s),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.referenceAngle=t.referenceAngle,this.lowerAngle=t.lowerAngle,this.upperAngle=t.upperAngle,this.maxMotorTorque=t.maxMotorTorque,this.motorSpeed=t.motorSpeed,this.enableLimit=t.enableLimit,this.enableMotor=t.enableMotor}},di._extend(li),pi.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointAngle:function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},GetJointSpeed:function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerAngle},GetUpperLimit:function(){return this.m_upperAngle},SetLimits:function(i,s){t(i<=s),i==this.m_lowerAngle&&s==this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=i,this.m_upperAngle=s)},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetReactionForce:function(t){var i=new h(this.m_impulse.x,this.m_impulse.y);return h.Multiply(t,i)},GetReactionTorque:function(t){return t*this.m_impulse.z},GetMotorTorque:function(t){return t*this.m_motorImpulse},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,e=t.velocities[this.m_indexB].v.Clone(),c=t.velocities[this.m_indexB].w,u=new o(i),a=new o(r);this.m_rA=S(u,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=S(a,h.Subtract(this.m_localAnchorB,this.m_localCenterB));var f=this.m_invMassA,v=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,g=d+p==0;if(this.m_mass.ex.x=f+v+this.m_rA.y*this.m_rA.y*d+this.m_rB.y*this.m_rB.y*p,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*d-this.m_rB.y*this.m_rB.x*p,this.m_mass.ez.x=-this.m_rA.y*d-this.m_rB.y*p,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=f+v+this.m_rA.x*this.m_rA.x*d+this.m_rB.x*this.m_rB.x*p,this.m_mass.ez.y=this.m_rA.x*d+this.m_rB.x*p,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=d+p,this.m_motorMass=d+p,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||g)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==g){var m=r-i-this.m_referenceAngle;hs(this.m_upperAngle-this.m_lowerAngle)<2*Wi?this.m_limitState=vi.e_equalLimits:m<=this.m_lowerAngle?(this.m_limitState!=vi.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=vi.e_atLowerLimit):m>=this.m_upperAngle?(this.m_limitState!=vi.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=vi.e_atUpperLimit):(this.m_limitState=vi.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=vi.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var w=new h(this.m_impulse.x,this.m_impulse.y);s.Subtract(h.Multiply(f,w)),n-=d*(l(this.m_rA,w)+this.m_motorImpulse+this.m_impulse.z),e.Add(h.Multiply(v,w)),c+=p*(l(this.m_rB,w)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(s),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(e),t.velocities[this.m_indexB].w=c},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),e=t.velocities[this.m_indexB].w,c=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,f=u+a==0;if(this.m_enableMotor&&this.m_limitState!=vi.e_equalLimits&&0==f){var v=e-s-this.m_motorSpeed,p=-this.m_motorMass*v,g=this.m_motorImpulse,m=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=I(this.m_motorImpulse+p,-m,m),s-=u*(p=this.m_motorImpulse-g),e+=a*p}if(this.m_enableLimit&&this.m_limitState!=vi.e_inactiveLimit&&0==f){var w=h.Subtract(h.Subtract(h.Add(n,d(e,this.m_rB)),i),d(s,this.m_rA)),_=e-s;if(v=new r(w.x,w.y,_),p=this.m_mass.Solve33(v).Negate(),this.m_limitState==vi.e_equalLimits)this.m_impulse.Add(p);else if(this.m_limitState==vi.e_atLowerLimit)if((y=this.m_impulse.z+p.z)<0){var C=h.Add(w.Negate(),h.Multiply(this.m_impulse.z,new h(this.m_mass.ez.x,this.m_mass.ez.y))),b=this.m_mass.Solve22(C);p.x=b.x,p.y=b.y,p.z=-this.m_impulse.z,this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,this.m_impulse.z=0}else this.m_impulse.Add(p);else if(this.m_limitState==vi.e_atUpperLimit){var y=this.m_impulse.z+p.z;y>0?(C=h.Add(w.Negate(),h.Multiply(this.m_impulse.z,new h(this.m_mass.ez.x,this.m_mass.ez.y))),b=this.m_mass.Solve22(C),p.x=b.x,p.y=b.y,p.z=-this.m_impulse.z,this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,this.m_impulse.z=0):this.m_impulse.Add(p)}var T=new h(p.x,p.y);i.Subtract(h.Multiply(c,T)),s-=u*(l(this.m_rA,T)+p.z),n.Add(h.Multiply(o,T)),e+=a*(l(this.m_rB,T)+p.z)}else v=h.Subtract(h.Subtract(h.Add(n,d(e,this.m_rB)),i),d(s,this.m_rA)),p=this.m_mass.Solve22(v.Negate()),this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,i.Subtract(h.Multiply(c,p)),s-=u*l(this.m_rA,p),n.Add(h.Multiply(o,p)),e+=a*l(this.m_rB,p);t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(t){var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),r=t.positions[this.m_indexB].a,c=new o(s),u=new o(r),a=0,f=0,v=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=vi.e_inactiveLimit&&0==v){var d=r-s-this.m_referenceAngle,p=0;if(this.m_limitState==vi.e_equalLimits){var g=I(d-this.m_lowerAngle,-Xi,Xi);p=-this.m_motorMass*g,a=hs(g)}else this.m_limitState==vi.e_atLowerLimit?(a=-(g=d-this.m_lowerAngle),g=I(g+Wi,-Xi,0),p=-this.m_motorMass*g):this.m_limitState==vi.e_atUpperLimit&&(a=g=d-this.m_upperAngle,g=I(g-Wi,0,Xi),p=-this.m_motorMass*g);s-=this.m_invIA*p,r+=this.m_invIB*p}c.Set(s),u.Set(r);var m=S(c,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),w=S(u,h.Subtract(this.m_localAnchorB,this.m_localCenterB));f=(g=h.Subtract(h.Subtract(h.Add(n,w),i),m)).Length();var _=this.m_invMassA,C=this.m_invMassB,b=this.m_invIA,y=this.m_invIB,T=new e;T.ex.x=_+C+b*m.y*m.y+y*w.y*w.y,T.ex.y=-b*m.x*m.y-y*w.x*w.y,T.ey.x=T.ex.y,T.ey.y=_+C+b*m.x*m.x+y*w.x*w.x;var A=T.Solve(g).Negate();return i.Subtract(h.Multiply(_,A)),s-=b*l(m,A),n.Add(h.Multiply(C,A)),r+=y*l(w,A),t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=r,f<=Ui&&a<=Wi},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.referenceAngle=this.m_referenceAngle,i.lowerAngle=this.m_lowerAngle,i.upperAngle=this.m_upperAngle,i.maxMotorTorque=this.m_maxMotorTorque,i.motorSpeed=this.m_motorSpeed,i.enableLimit=this.m_enableLimit,i.enableMotor=this.m_enableMotor,i}},pi._extend(vi),gi._extend(li),mi.prototype={GetAnchorA:function(){return this.m_targetA},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t,this.m_impulse)},GetReactionTorque:function(t){return 0*t},SetTarget:function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Assign(t)},GetTarget:function(){return this.m_targetA},SetMaxForce:function(t){this.m_maxForce=t},GetMaxForce:function(){return this.m_maxForce},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},ShiftOrigin:function(t){this.m_targetA.Subtract(t)},InitVelocityConstraints:function(i){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var s=i.positions[this.m_indexB].c.Clone(),n=i.positions[this.m_indexB].a,r=i.velocities[this.m_indexB].v.Clone(),c=i.velocities[this.m_indexB].w,u=new o(n),a=this.m_bodyB.GetMass(),f=2*zi*this.m_frequencyHz,v=2*a*this.m_dampingRatio*f,d=a*(f*f),p=i.step.dt;t(v+p*d>Gi),this.m_gamma=p*(v+p*d),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=p*d*this.m_gamma,this.m_rB.Assign(S(u,h.Subtract(this.m_localAnchorB,this.m_localCenterB)));var g=new e;g.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,g.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,g.ey.x=g.ex.y,g.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass.Assign(g.GetInverse()),this.m_C.Assign(h.Subtract(h.Add(s,this.m_rB),this.m_targetA)),this.m_C.Multiply(this.m_beta),c*=.98,i.step.warmStarting?(this.m_impulse.Multiply(i.step.dtRatio),r.Add(h.Multiply(this.m_invMassB,this.m_impulse)),c+=this.m_invIB*l(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),i.velocities[this.m_indexB].v.Assign(r),i.velocities[this.m_indexB].w=c},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,n=h.Add(i,d(s,this.m_rB)),r=p(this.m_mass,h.Add(h.Add(n,this.m_C),h.Multiply(this.m_gamma,this.m_impulse)).Negate()),e=this.m_impulse.Clone();this.m_impulse.Add(r);var c=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>c*c&&this.m_impulse.Multiply(c/this.m_impulse.Length()),r.Assign(h.Subtract(this.m_impulse,e)),i.Add(h.Multiply(this.m_invMassB,r)),s+=this.m_invIB*l(this.m_rB,r),t.velocities[this.m_indexB].v.Assign(i),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){return!0}},mi._extend(vi),wi.prototype={Initialize:function(t,i,s,n){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(s),this.localAnchorB=this.bodyB.GetLocalPoint(n);var r=h.Subtract(n,s);this.length=r.Length()},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.length=t.length,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},wi._extend(li),_i.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t*this.m_impulse,this.m_u)},GetReactionTorque:function(t){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetLength:function(t){this.m_length=t},GetLength:function(){return this.m_length},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),r=t.velocities[this.m_indexA].w,e=t.positions[this.m_indexB].c.Clone(),c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,f=new o(s),v=new o(c);this.m_rA=S(f,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=S(v,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),this.m_u=h.Subtract(h.Subtract(h.Add(e,this.m_rB),i),this.m_rA);var d=this.m_u.Length();d>Ui?this.m_u.Multiply(1/d):this.m_u.Set(0,0);var p=l(this.m_rA,this.m_u),g=l(this.m_rB,this.m_u),m=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=0!=m?1/m:0,this.m_frequencyHz>0){var w=d-this.m_length,_=2*zi*this.m_frequencyHz,C=2*this.m_mass*this.m_dampingRatio*_,b=this.m_mass*_*_,y=t.step.dt;this.m_gamma=y*(C+y*b),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=w*y*b*this.m_gamma,m+=this.m_gamma,this.m_mass=0!=m?1/m:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var T=h.Multiply(this.m_impulse,this.m_u);n.Subtract(h.Multiply(this.m_invMassA,T)),r-=this.m_invIA*l(this.m_rA,T),u.Add(h.Multiply(this.m_invMassB,T)),a+=this.m_invIB*l(this.m_rB,T)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].v.Assign(u),t.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=h.Add(i,d(s,this.m_rA)),c=h.Add(n,d(r,this.m_rB)),o=f(this.m_u,h.Subtract(c,e)),u=-this.m_mass*(o+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var a=h.Multiply(u,this.m_u);i.Subtract(h.Multiply(this.m_invMassA,a)),s-=this.m_invIA*l(this.m_rA,a),n.Add(h.Multiply(this.m_invMassB,a)),r+=this.m_invIB*l(this.m_rB,a),t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r},SolvePositionConstraints:function(t){if(this.m_frequencyHz>0)return!0;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),r=t.positions[this.m_indexB].a,e=new o(s),c=new o(r),u=S(e,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),a=S(c,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),f=h.Subtract(h.Subtract(h.Add(n,a),i),u),v=f.Normalize()-this.m_length;v=I(v,-.2,.2);var d=-this.m_mass*v,p=h.Multiply(d,f);return i.Subtract(h.Multiply(this.m_invMassA,p)),s-=this.m_invIA*l(u,p),n.Add(h.Multiply(this.m_invMassB,p)),r+=this.m_invIB*l(a,p),t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=r,hs(v)<Ui},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.length=this.m_length,i.frequencyHz=this.m_frequencyHz,i.dampingRatio=this.m_dampingRatio,i}},_i._extend(vi),Ci.prototype={Initialize:function(t,i,s,n){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(s),this.localAnchorB=this.bodyB.GetLocalPoint(s),this.localAxisA=this.bodyA.GetLocalVector(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.localAxisA._deserialize(t.localAxisA),this.referenceAngle=t.referenceAngle,this.enableLimit=t.enableLimit,this.lowerTranslation=t.lowerTranslation,this.upperTranslation=t.upperTranslation,this.enableMotor=t.enableMotor,this.maxMotorForce=t.maxMotorForce,this.motorSpeed=t.motorSpeed}},Ci._extend(li),bi.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t,h.Add(h.Multiply(this.m_impulse.x,this.m_perp),h.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)))},GetReactionTorque:function(t){return t*this.m_impulse.y},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointTranslation:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB);return f(h.Subtract(i,t),this.m_bodyA.GetWorldVector(this.m_localXAxisA))},GetJointSpeed:function(){var t=this.m_bodyA,i=this.m_bodyB,s=S(t.m_xf.q,h.Subtract(this.m_localAnchorA,t.m_sweep.localCenter)),n=S(i.m_xf.q,h.Subtract(this.m_localAnchorB,i.m_sweep.localCenter)),r=h.Add(t.m_sweep.c,s),e=h.Add(i.m_sweep.c,n),c=h.Subtract(e,r),o=S(t.m_xf.q,this.m_localXAxisA),u=t.m_linearVelocity,a=i.m_linearVelocity,l=t.m_angularVelocity,v=i.m_angularVelocity;return f(c,d(l,o))+f(o,h.Subtract(h.Subtract(h.Add(a,d(v,n)),u),d(l,s)))},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerTranslation},GetUpperLimit:function(){return this.m_upperTranslation},SetLimits:function(i,s){t(i<=s),i==this.m_lowerTranslation&&s==this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=i,this.m_upperTranslation=s,this.m_impulse.z=0)},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorForce:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},GetMaxMotorForce:function(){return this.m_maxMotorForce},GetMotorForce:function(t){return t*this.m_motorImpulse},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),r=t.velocities[this.m_indexA].w,e=t.positions[this.m_indexB].c.Clone(),c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,v=new o(s),d=new o(c),p=S(v,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),g=S(d,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),m=h.Add(h.Subtract(e,i),h.Subtract(g,p)),w=this.m_invMassA,_=this.m_invMassB,C=this.m_invIA,b=this.m_invIB;this.m_axis=S(v,this.m_localXAxisA),this.m_a1=l(h.Add(m,p),this.m_axis),this.m_a2=l(g,this.m_axis),this.m_motorMass=w+_+C*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=S(v,this.m_localYAxisA),this.m_s1=l(h.Add(m,p),this.m_perp),this.m_s2=l(g,this.m_perp);var y=w+_+C*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,T=C*this.m_s1+b*this.m_s2,A=C*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,M=C+b;0==M&&(M=1);var x=C*this.m_a1+b*this.m_a2,E=w+_+C*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_K.ex.Set(y,T,A),this.m_K.ey.Set(T,M,x),this.m_K.ez.Set(A,x,E),this.m_enableLimit){var O=f(this.m_axis,m);hs(this.m_upperTranslation-this.m_lowerTranslation)<2*Ui?this.m_limitState=vi.e_equalLimits:O<=this.m_lowerTranslation?this.m_limitState!=vi.e_atLowerLimit&&(this.m_limitState=vi.e_atLowerLimit,this.m_impulse.z=0):O>=this.m_upperTranslation?this.m_limitState!=vi.e_atUpperLimit&&(this.m_limitState=vi.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=vi.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=vi.e_inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var P=h.Add(h.Multiply(this.m_impulse.x,this.m_perp),h.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)),R=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,I=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.Subtract(h.Multiply(w,P)),r-=C*R,u.Add(h.Multiply(_,P)),a+=b*I}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].v.Assign(u),t.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),e=t.velocities[this.m_indexB].w,c=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=vi.e_equalLimits){var l=f(this.m_axis,h.Subtract(n,i))+this.m_a2*e-this.m_a1*s,v=this.m_motorMass*(this.m_motorSpeed-l),d=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=I(this.m_motorImpulse+v,-p,p),v=this.m_motorImpulse-d;var g=h.Multiply(v,this.m_axis),m=v*this.m_a1,w=v*this.m_a2;i.Subtract(h.Multiply(c,g)),s-=u*m,n.Add(h.Multiply(o,g)),e+=a*w}var _=new h;if(_.x=f(this.m_perp,h.Subtract(n,i))+this.m_s2*e-this.m_s1*s,_.y=e-s,this.m_enableLimit&&this.m_limitState!=vi.e_inactiveLimit){var C;C=f(this.m_axis,h.Subtract(n,i))+this.m_a2*e-this.m_a1*s,l=new r(_.x,_.y,C);var b=this.m_impulse.Clone(),y=this.m_K.Solve33(l.Negate());this.m_impulse.Add(y),this.m_limitState==vi.e_atLowerLimit?this.m_impulse.z=es(this.m_impulse.z,0):this.m_limitState==vi.e_atUpperLimit&&(this.m_impulse.z=rs(this.m_impulse.z,0));var T=h.Subtract(_.Negate(),h.Multiply(this.m_impulse.z-b.z,new h(this.m_K.ez.x,this.m_K.ez.y))),S=h.Add(this.m_K.Solve22(T),new h(b.x,b.y));this.m_impulse.x=S.x,this.m_impulse.y=S.y,y=r.Subtract(this.m_impulse,b),g=h.Add(h.Multiply(y.x,this.m_perp),h.Multiply(y.z,this.m_axis)),m=y.x*this.m_s1+y.y+y.z*this.m_a1,w=y.x*this.m_s2+y.y+y.z*this.m_a2,i.Subtract(h.Multiply(c,g)),s-=u*m,n.Add(h.Multiply(o,g)),e+=a*w}else y=this.m_K.Solve22(_.Negate()),this.m_impulse.x+=y.x,this.m_impulse.y+=y.y,g=h.Multiply(y.x,this.m_perp),m=y.x*this.m_s1+y.y,w=y.x*this.m_s2+y.y,i.Subtract(h.Multiply(c,g)),s-=u*m,n.Add(h.Multiply(o,g)),e+=a*w;t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(t){var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),u=t.positions[this.m_indexB].a,a=new o(s),v=new o(u),d=this.m_invMassA,p=this.m_invMassB,g=this.m_invIA,m=this.m_invIB,w=S(a,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),_=S(v,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),C=h.Subtract(h.Subtract(h.Add(n,_),i),w),b=S(a,this.m_localXAxisA),y=l(h.Add(C,w),b),T=l(_,b),A=S(a,this.m_localYAxisA),M=l(h.Add(C,w),A),x=l(_,A),E=new r,O=new h;O.x=f(A,C),O.y=u-s-this.m_referenceAngle;var P=hs(O.x),R=hs(O.y),L=!1,D=0;if(this.m_enableLimit){var F=f(b,C);hs(this.m_upperTranslation-this.m_lowerTranslation)<2*Ui?(D=I(F,-.2,.2),P=es(P,hs(F)),L=!0):F<=this.m_lowerTranslation?(D=I(F-this.m_lowerTranslation+Ui,-.2,0),P=es(P,this.m_lowerTranslation-F),L=!0):F>=this.m_upperTranslation&&(D=I(F-this.m_upperTranslation-Ui,0,.2),P=es(P,F-this.m_upperTranslation),L=!0)}if(L){var N=d+p+g*M*M+m*x*x,k=g*M+m*x,B=g*M*y+m*x*T;0==(V=g+m)&&(V=1);var G=g*y+m*T,z=d+p+g*y*y+m*T*T;(U=new c).ex.Set(N,k,B),U.ey.Set(k,V,G),U.ez.Set(B,G,z);var j=new r;j.x=O.x,j.y=O.y,j.z=D,E=U.Solve33(j.Negate())}else{N=d+p+g*M*M+m*x*x,k=g*M+m*x;var V=g+m;0==V&&(V=1);var U=new e;U.ex.Set(N,k),U.ey.Set(k,V);var W=U.Solve(O.Negate());E.x=W.x,E.y=W.y,E.z=0}var H=h.Add(h.Multiply(E.x,A),h.Multiply(E.z,b)),X=E.x*M+E.y+E.z*y,J=E.x*x+E.y+E.z*T;return i.Subtract(h.Multiply(d,H)),s-=g*X,n.Add(h.Multiply(p,H)),u+=m*J,t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=u,P<=Ui&&R<=Wi},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.localAxisA=this.m_localXAxisA._serialize(),i.referenceAngle=this.m_referenceAngle,i.enableLimit=this.m_enableLimit,i.lowerTranslation=this.m_lowerTranslation,i.upperTranslation=this.m_upperTranslation,i.enableMotor=this.m_enableMotor,i.maxMotorForce=this.m_maxMotorForce,i.motorSpeed=this.m_motorSpeed,i}},bi._extend(vi),yi.prototype={Initialize:function(t,i,s){this.bodyA=t,this.bodyB=i,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(s)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(s))},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.maxForce=t.maxForce,this.maxTorque=t.maxTorque}},yi._extend(li),Ti.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t,this.m_linearImpulse)},GetReactionTorque:function(t){return t*this.m_angularImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxForce:function(i){t(n(i)&&i>=0),this.m_maxForce=i},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(i){t(n(i)&&i>=0),this.m_maxTorque=i},GetMaxTorque:function(){return this.m_maxTorque},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v.Clone(),u=t.velocities[this.m_indexB].w,a=new o(i),f=new o(r);this.m_rA=S(a,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=S(f,h.Subtract(this.m_localAnchorB,this.m_localCenterB));var v=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,g=this.m_invIB,m=new e;if(m.ex.x=v+d+p*this.m_rA.y*this.m_rA.y+g*this.m_rB.y*this.m_rB.y,m.ex.y=-p*this.m_rA.x*this.m_rA.y-g*this.m_rB.x*this.m_rB.y,m.ey.x=m.ex.y,m.ey.y=v+d+p*this.m_rA.x*this.m_rA.x+g*this.m_rB.x*this.m_rB.x,this.m_linearMass=m.GetInverse(),this.m_angularMass=p+g,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.Multiply(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var w=new h(this.m_linearImpulse.x,this.m_linearImpulse.y);s.Subtract(h.Multiply(v,w)),n-=p*(l(this.m_rA,w)+this.m_angularImpulse),c.Add(h.Multiply(d,w)),u+=g*(l(this.m_rB,w)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].v.Assign(s),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(c),t.velocities[this.m_indexB].w=u},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=this.m_invMassA,c=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,a=t.step.dt,f=r-s,v=-this.m_angularMass*f,g=this.m_angularImpulse,m=a*this.m_maxTorque;this.m_angularImpulse=I(this.m_angularImpulse+v,-m,m),s-=o*(v=this.m_angularImpulse-g),f=h.Add(n,h.Subtract(d(r+=u*v,this.m_rB),h.Subtract(i,d(s,this.m_rA)))),v=p(this.m_linearMass,f).Negate(),g=this.m_linearImpulse.Clone(),this.m_linearImpulse.Add(v),m=a*this.m_maxForce,this.m_linearImpulse.LengthSquared()>m*m&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(m)),v=h.Subtract(this.m_linearImpulse,g),i.Subtract(h.Multiply(e,v)),s-=o*l(this.m_rA,v),n.Add(h.Multiply(c,v)),r+=u*l(this.m_rB,v),t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r},SolvePositionConstraints:function(t){return!0},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.maxForce=this.m_maxForce,i.maxTorque=this.m_maxTorque,i}},Ti._extend(vi),Si.prototype={Initialize:function(t,i,s){this.bodyA=t,this.bodyB=i,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(s)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(s)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.referenceAngle=t.referenceAngle,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},Si._extend(li),Ai.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var i=new h(this.m_impulse.x,this.m_impulse.y);return h.Multiply(t,i)},GetReactionTorque:function(t){return t*this.m_impulse.z},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,e=t.velocities[this.m_indexB].v.Clone(),u=t.velocities[this.m_indexB].w,a=new o(i),f=new o(r);this.m_rA.Assign(S(a,h.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(S(f,h.Subtract(this.m_localAnchorB,this.m_localCenterB)));var v=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,g=this.m_invIB,m=new c;if(m.ex.x=v+d+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*g,m.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*g,m.ez.x=-this.m_rA.y*p-this.m_rB.y*g,m.ex.y=m.ey.x,m.ey.y=v+d+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*g,m.ez.y=this.m_rA.x*p+this.m_rB.x*g,m.ex.z=m.ez.x,m.ey.z=m.ez.y,m.ez.z=p+g,this.m_frequencyHz>0){m.GetInverse22(this.m_mass);var w=p+g,_=w>0?1/w:0,C=r-i-this.m_referenceAngle,b=2*zi*this.m_frequencyHz,y=2*_*this.m_dampingRatio*b,T=_*b*b,A=t.step.dt;this.m_gamma=A*(y+A*T),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=C*A*T*this.m_gamma,w+=this.m_gamma,this.m_mass.ez.z=0!=w?1/w:0}else 0==m.ez.z?(m.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(m.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio);var M=new h(this.m_impulse.x,this.m_impulse.y);s.Subtract(h.Multiply(v,M)),n-=p*(l(this.m_rA,M)+this.m_impulse.z),e.Add(h.Multiply(d,M)),u+=g*(l(this.m_rB,M)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].v.Assign(s),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(e),t.velocities[this.m_indexB].w=u},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),e=t.velocities[this.m_indexB].w,c=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB;if(this.m_frequencyHz>0){var f=e-s,v=-this.m_mass.ez.z*(f+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=v,s-=u*v;var p=h.Subtract(h.Subtract(h.Add(n,d(e+=a*v,this.m_rB)),i),d(s,this.m_rA)),g=b(this.m_mass,p).Negate();this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,_=g.Clone(),i.Subtract(h.Multiply(c,_)),s-=u*l(this.m_rA,_),n.Add(h.Multiply(o,_)),e+=a*l(this.m_rB,_)}else{f=e-s;var m=new r((p=h.Subtract(h.Subtract(h.Add(n,d(e,this.m_rB)),i),d(s,this.m_rA))).x,p.y,f),w=C(this.m_mass,m).Negate();this.m_impulse.Add(w);var _=new h(w.x,w.y);i.Subtract(h.Multiply(c,_)),s-=u*(l(this.m_rA,_)+w.z),n.Add(h.Multiply(o,_)),e+=a*(l(this.m_rB,_)+w.z)}t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(t){var i,s,n=t.positions[this.m_indexA].c.Clone(),e=t.positions[this.m_indexA].a,u=t.positions[this.m_indexB].c.Clone(),a=t.positions[this.m_indexB].a,f=new o(e),v=new o(a),d=this.m_invMassA,p=this.m_invMassB,g=this.m_invIA,m=this.m_invIB,w=S(f,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),_=S(v,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),C=new c;if(C.ex.x=d+p+w.y*w.y*g+_.y*_.y*m,C.ey.x=-w.y*w.x*g-_.y*_.x*m,C.ez.x=-w.y*g-_.y*m,C.ex.y=C.ey.x,C.ey.y=d+p+w.x*w.x*g+_.x*_.x*m,C.ez.y=w.x*g+_.x*m,C.ex.z=C.ez.x,C.ey.z=C.ez.y,C.ez.z=g+m,this.m_frequencyHz>0)i=(b=h.Subtract(h.Subtract(h.Add(u,_),n),w)).Length(),s=0,x=C.Solve22(b).Negate(),n.Subtract(h.Multiply(d,x)),e-=g*l(w,x),u.Add(h.Multiply(p,x)),a+=m*l(_,x);else{var b=h.Subtract(h.Subtract(h.Add(u,_),n),w),y=a-e-this.m_referenceAngle;i=b.Length(),s=hs(y);var T,A=new r(b.x,b.y,y);if(C.ez.z>0)T=C.Solve33(A).Invert();else{var M=C.Solve22(b).Invert();T=new r(M.x,M.y,0)}var x=new h(T.x,T.y);n.Subtract(h.Multiply(d,x)),e-=g*(l(w,x)+T.z),u.Add(h.Multiply(p,x)),a+=m*(l(_,x)+T.z)}return t.positions[this.m_indexA].c.Assign(n),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].c.Assign(u),t.positions[this.m_indexB].a=a,i<=Ui&&s<=Wi},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.referenceAngle=this.m_referenceAngle,i.frequencyHz=this.m_frequencyHz,i.dampingRatio=this.m_dampingRatio,i}},Ai._extend(vi),Mi.prototype={Initialize:function(t,i,s,n){this.bodyA=t,this.bodyB=i,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(s)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(s)),this.localAxisA.Assign(this.bodyA.GetLocalVector(n))},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.localAxisA._deserialize(t.localAxisA),this.enableMotor=t.enableMotor,this.maxMotorTorque=t.maxMotorTorque,this.motorSpeed=t.motorSpeed,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},Mi._extend(li),xi.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t,h.Add(h.Multiply(this.m_impulse,this.m_ay),h.Multiply(this.m_springImpulse,this.m_ax)))},GetReactionTorque:function(t){return t*this.m_motorImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetJointTranslation:function(){var t=this.m_bodyA,i=this.m_bodyB,s=t.GetWorldPoint(this.m_localAnchorA),n=i.GetWorldPoint(this.m_localAnchorB);return f(h.Subtract(n,s),t.GetWorldVector(this.m_localXAxisA))},GetJointSpeed:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetMotorTorque:function(t){return t*this.m_motorImpulse},SetSpringFrequencyHz:function(t){this.m_frequencyHz=t},GetSpringFrequencyHz:function(){return this.m_frequencyHz},SetSpringDampingRatio:function(t){this.m_dampingRatio=t},GetSpringDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,e=t.positions[this.m_indexA].c.Clone(),c=t.positions[this.m_indexA].a,u=t.velocities[this.m_indexA].v.Clone(),a=t.velocities[this.m_indexA].w,v=t.positions[this.m_indexB].c.Clone(),d=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v.Clone(),g=t.velocities[this.m_indexB].w,m=new o(c),w=new o(d),_=S(m,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),C=S(w,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),b=h.Subtract(h.Subtract(h.Add(v,C),e),_);if(this.m_ay.Assign(S(m,this.m_localYAxisA)),this.m_sAy=l(h.Add(b,_),this.m_ay),this.m_sBy=l(C,this.m_ay),this.m_mass=i+s+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax.Assign(S(m,this.m_localXAxisA)),this.m_sAx=l(h.Add(b,_),this.m_ax),this.m_sBx=l(C,this.m_ax);var y=i+s+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(y>0){this.m_springMass=1/y;var T=f(b,this.m_ax),A=2*zi*this.m_frequencyHz,M=(b=2*this.m_springMass*this.m_dampingRatio*A,this.m_springMass*A*A),x=t.step.dt;this.m_gamma=x*(b+x*M),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=T*x*M*this.m_gamma,this.m_springMass=y+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var E=h.Add(h.Multiply(this.m_impulse,this.m_ay),h.Multiply(this.m_springImpulse,this.m_ax)),O=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,P=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;u.Subtract(h.Multiply(this.m_invMassA,E)),a-=this.m_invIA*O,p.Add(h.Multiply(this.m_invMassB,E)),g+=this.m_invIB*P}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(u),t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].v.Assign(p),t.velocities[this.m_indexB].w=g},SolveVelocityConstraints:function(t){var i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,e=t.velocities[this.m_indexA].v.Clone(),c=t.velocities[this.m_indexA].w,o=t.velocities[this.m_indexB].v.Clone(),u=t.velocities[this.m_indexB].w,a=f(this.m_ax,h.Subtract(o,e))+this.m_sBx*u-this.m_sAx*c,l=-this.m_springMass*(a+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var v=h.Multiply(l,this.m_ax),d=l*this.m_sAx,p=l*this.m_sBx;e.Subtract(h.Multiply(i,v)),c-=n*d,o.Add(h.Multiply(s,v)),a=(u+=r*p)-c-this.m_motorSpeed,l=-this.m_motorMass*a;var g=this.m_motorImpulse,m=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=I(this.m_motorImpulse+l,-m,m),c-=n*(l=this.m_motorImpulse-g),u+=r*l,a=f(this.m_ay,h.Subtract(o,e))+this.m_sBy*u-this.m_sAy*c,l=-this.m_mass*a,this.m_impulse+=l,v=h.Multiply(l,this.m_ay),d=l*this.m_sAy,p=l*this.m_sBy,e.Subtract(h.Multiply(i,v)),c-=n*d,o.Add(h.Multiply(s,v)),u+=r*p,t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].v.Assign(o),t.velocities[this.m_indexB].w=u},SolvePositionConstraints:function(t){var i,s=t.positions[this.m_indexA].c.Clone(),n=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c.Clone(),e=t.positions[this.m_indexB].a,c=new o(n),u=new o(e),a=S(c,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),v=S(u,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),d=h.Add(h.Subtract(r,s),h.Subtract(v,a)),p=S(c,this.m_localYAxisA),g=l(h.Add(d,a),p),m=l(v,p),w=f(d,p),_=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,C=h.Multiply(i=0!=_?-w/_:0,p),b=i*g,y=i*m;return s.Subtract(h.Multiply(this.m_invMassA,C)),n-=this.m_invIA*b,r.Add(h.Multiply(this.m_invMassB,C)),e+=this.m_invIB*y,t.positions[this.m_indexA].c.Assign(s),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].c.Assign(r),t.positions[this.m_indexB].a=e,hs(w)<=Ui},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.localAxisA=this.m_localAxisA._serialize(),i.enableMotor=this.m_enableMotor,i.maxMotorTorque=this.m_maxMotorTorque,i.motorSpeed=this.m_motorSpeed,i.frequencyHz=this.m_frequencyHz,i.dampingRatio=this.m_dampingRatio,i}},xi._extend(vi),Ei.prototype={_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.joint1=t.joint1,this.joint2=t.joint2,this.ratio=t.ratio}},Ei._extend(li),Oi.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var i=h.Multiply(this.m_impulse,this.m_JvAC);return h.Multiply(t,i)},GetReactionTorque:function(t){return t*(this.m_impulse*this.m_JwA)},GetJoint1:function(){return this.m_joint1},GetJoint2:function(){return this.m_joint2},SetRatio:function(i){t(n(i)),this.m_ratio=i},GetRatio:function(){return this.m_ratio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Assign(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Assign(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,e=t.velocities[this.m_indexB].v.Clone(),c=t.velocities[this.m_indexB].w,u=t.positions[this.m_indexC].a,a=t.velocities[this.m_indexC].v.Clone(),f=t.velocities[this.m_indexC].w,v=t.positions[this.m_indexD].a,d=t.velocities[this.m_indexD].v.Clone(),p=t.velocities[this.m_indexD].w,g=new o(i),m=new o(r),w=new o(u),_=new o(v);if(this.m_mass=0,this.m_typeA==vi.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var C=S(w,this.m_localAxisC),b=S(w,h.Subtract(this.m_localAnchorC,this.m_lcC)),y=S(g,h.Subtract(this.m_localAnchorA,this.m_lcA));this.m_JvAC.Assign(C),this.m_JwC=l(b,C),this.m_JwA=l(y,C),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==vi.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{C=S(_,this.m_localAxisD);var T=S(_,h.Subtract(this.m_localAnchorD,this.m_lcD)),A=S(m,h.Subtract(this.m_localAnchorB,this.m_lcB));this.m_JvBD.Assign(h.Multiply(this.m_ratio,C)),this.m_JwD=this.m_ratio*l(T,C),this.m_JwB=this.m_ratio*l(A,C),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(s.Add(h.Multiply(this.m_mA*this.m_impulse,this.m_JvAC)),n+=this.m_iA*this.m_impulse*this.m_JwA,e.Add(h.Multiply(this.m_mB*this.m_impulse,this.m_JvBD)),c+=this.m_iB*this.m_impulse*this.m_JwB,a.Subtract(h.Multiply(this.m_mC*this.m_impulse,this.m_JvAC)),f-=this.m_iC*this.m_impulse*this.m_JwC,d.Subtract(h.Multiply(this.m_mD*this.m_impulse,this.m_JvBD)),p-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].v.Assign(s),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(e),t.velocities[this.m_indexB].w=c,t.velocities[this.m_indexC].v.Assign(a),t.velocities[this.m_indexC].w=f,t.velocities[this.m_indexD].v.Assign(d),t.velocities[this.m_indexD].w=p},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=t.velocities[this.m_indexC].v.Clone(),c=t.velocities[this.m_indexC].w,o=t.velocities[this.m_indexD].v.Clone(),u=t.velocities[this.m_indexD].w,a=f(this.m_JvAC,h.Subtract(i,e))+f(this.m_JvBD,h.Subtract(n,o));a+=this.m_JwA*s-this.m_JwC*c+(this.m_JwB*r-this.m_JwD*u);var l=-this.m_mass*a;this.m_impulse+=l,i.Add(h.Multiply(this.m_mA*l,this.m_JvAC)),s+=this.m_iA*l*this.m_JwA,n.Add(h.Multiply(this.m_mB*l,this.m_JvBD)),r+=this.m_iB*l*this.m_JwB,e.Subtract(h.Multiply(this.m_mC*l,this.m_JvAC)),c-=this.m_iC*l*this.m_JwC,o.Subtract(h.Multiply(this.m_mD*l,this.m_JvBD)),u-=this.m_iD*l*this.m_JwD,t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].v.Assign(e),t.velocities[this.m_indexC].w=c,t.velocities[this.m_indexD].v.Assign(o),t.velocities[this.m_indexD].w=u},SolvePositionConstraints:function(t){var i,s,n,r,e,c,u=t.positions[this.m_indexA].c.Clone(),a=t.positions[this.m_indexA].a,v=t.positions[this.m_indexB].c.Clone(),d=t.positions[this.m_indexB].a,p=t.positions[this.m_indexC].c.Clone(),g=t.positions[this.m_indexC].a,m=t.positions[this.m_indexD].c.Clone(),w=t.positions[this.m_indexD].a,_=new o(a),C=new o(d),b=new o(g),y=new o(w),T=new h,M=new h,x=0;if(this.m_typeA==vi.e_revoluteJoint)T.SetZero(),n=1,e=1,x+=this.m_iA+this.m_iC,i=a-g-this.m_referenceAngleA;else{var E=S(b,this.m_localAxisC),O=S(b,h.Subtract(this.m_localAnchorC,this.m_lcC)),P=S(_,h.Subtract(this.m_localAnchorA,this.m_lcA));T.Assign(E),e=l(O,E),n=l(P,E),x+=this.m_mC+this.m_mA+this.m_iC*e*e+this.m_iA*n*n;var R=h.Subtract(this.m_localAnchorC,this.m_lcC),I=A(b,h.Add(P,h.Subtract(u,p)));i=f(h.Subtract(I,R),this.m_localAxisC)}if(this.m_typeB==vi.e_revoluteJoint)M.SetZero(),r=this.m_ratio,c=this.m_ratio,x+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),s=d-w-this.m_referenceAngleB;else{E=S(y,this.m_localAxisD);var L=S(y,h.Subtract(this.m_localAnchorD,this.m_lcD)),D=S(C,h.Subtract(this.m_localAnchorB,this.m_lcB));M.Assign(h.Multiply(this.m_ratio,E)),c=this.m_ratio*l(L,E),r=this.m_ratio*l(D,E),x+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*c*c+this.m_iB*r*r;var F=h.Subtract(this.m_localAnchorD,this.m_lcD),N=A(y,h.Add(D,h.Subtract(v,m)));s=f(h.Subtract(N,F),this.m_localAxisD)}var k=i+this.m_ratio*s-this.m_constant,B=0;return x>0&&(B=-k/x),u.Add(h.Multiply(this.m_mA,h.Multiply(B,T))),a+=this.m_iA*B*n,v.Add(h.Multiply(this.m_mB,h.Multiply(B,M))),d+=this.m_iB*B*r,p.Subtract(h.Multiply(this.m_mC,h.Multiply(B,T))),g-=this.m_iC*B*e,m.Subtract(h.Multiply(this.m_mD,h.Multiply(B,M))),w-=this.m_iD*B*c,t.positions[this.m_indexA].c.Assign(u),t.positions[this.m_indexA].a=a,t.positions[this.m_indexB].c.Assign(v),t.positions[this.m_indexB].a=d,t.positions[this.m_indexC].c.Assign(p),t.positions[this.m_indexC].a=g,t.positions[this.m_indexD].c.Assign(m),t.positions[this.m_indexD].a=w,0<Ui},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.joint1=this.m_joint1.__temp_joint_id,i.joint2=this.m_joint2.__temp_joint_id,i.ratio=this.m_ratio,i}},Oi._extend(vi),Pi.prototype={Initialize:function(t,i){this.bodyA=t,this.bodyB=i;var s=this.bodyB.GetPosition();this.linearOffset.Assign(this.bodyA.GetLocalPoint(s));var n=this.bodyA.GetAngle(),h=this.bodyB.GetAngle();this.angularOffset=h-n},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.linearOffset._deserialize(t.linearOffset),this.angularOffset=t.angularOffset,this.maxForce=t.maxForce,this.maxTorque=t.maxTorque,this.correctionFactor=t.correctionFactor}},Pi._extend(li),Ri.prototype={GetAnchorA:function(){return this.m_bodyA.GetPosition()},GetAnchorB:function(){return this.m_bodyB.GetPosition()},GetReactionForce:function(t){return h.Multiply(t,this.m_linearImpulse)},GetReactionTorque:function(t){return t*this.m_angularImpulse},SetLinearOffset:function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Assign(t))},GetLinearOffset:function(){return this.m_linearOffset},SetAngularOffset:function(t){t!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},GetAngularOffset:function(){return this.m_angularOffset},SetMaxForce:function(i){t(n(i)&&i>=0),this.m_maxForce=i},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(i){t(n(i)&&i>=0),this.m_maxTorque=i},GetMaxTorque:function(){return this.m_maxTorque},SetCorrectionFactor:function(i){t(n(i)&&0<=i&&i<=1),this.m_correctionFactor=i},GetCorrectionFactor:function(){return this.m_correctionFactor},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),r=t.velocities[this.m_indexA].w,c=t.positions[this.m_indexB].c.Clone(),u=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v.Clone(),f=t.velocities[this.m_indexB].w,v=new o(s),d=new o(u);this.m_rA.Assign(S(v,this.m_localCenterA.Negate())),this.m_rB.Assign(S(d,this.m_localCenterB.Negate()));var p=this.m_invMassA,g=this.m_invMassB,m=this.m_invIA,w=this.m_invIB,_=new e;if(_.ex.x=p+g+m*this.m_rA.y*this.m_rA.y+w*this.m_rB.y*this.m_rB.y,_.ex.y=-m*this.m_rA.x*this.m_rA.y-w*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=p+g+m*this.m_rA.x*this.m_rA.x+w*this.m_rB.x*this.m_rB.x,this.m_linearMass.Assign(_.GetInverse()),this.m_angularMass=m+w,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError.x=c.x+this.m_rB.x-i.x-this.m_rA.x-(v.c*this.m_linearOffset.x-v.s*this.m_linearOffset.y),this.m_linearError.y=c.y+this.m_rB.y-i.y-this.m_rA.y-(v.s*this.m_linearOffset.x+v.c*this.m_linearOffset.y),this.m_angularError=u-s-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.Multiply(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var C=new h(this.m_linearImpulse.x,this.m_linearImpulse.y);n.Subtract(h.Multiply(p,C)),r-=m*(l(this.m_rA,C)+this.m_angularImpulse),a.Add(h.Multiply(g,C)),f+=w*(l(this.m_rB,C)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].v.Assign(a),t.velocities[this.m_indexB].w=f},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=this.m_invMassA,c=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,a=t.step.dt,f=t.step.inv_dt,v=r-s+f*this.m_correctionFactor*this.m_angularError,d=-this.m_angularMass*v,g=this.m_angularImpulse,m=a*this.m_maxTorque;this.m_angularImpulse=I(this.m_angularImpulse+d,-m,m),s-=o*(d=this.m_angularImpulse-g),r+=u*d,v=new h(n.x+-r*this.m_rB.x-i.x- -s*this.m_rA.x+f*this.m_correctionFactor*this.m_linearError.x,n.y+r*this.m_rB.y-i.y-s*this.m_rA.y+f*this.m_correctionFactor*this.m_linearError.y),d=p(this.m_linearMass,v).Negate(),g=this.m_linearImpulse.Clone(),this.m_linearImpulse.Add(d),m=a*this.m_maxForce,this.m_linearImpulse.LengthSquared()>m*m&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(m)),d.Assign(h.Subtract(this.m_linearImpulse,g)),i.Subtract(h.Multiply(e,d)),s-=o*l(this.m_rA,d),n.Add(h.Multiply(c,d)),r+=u*l(this.m_rB,d),t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r},SolvePositionConstraints:function(t){return!0},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.linearOffset=this.m_linearOffset._serialize(),i.angularOffset=this.m_angularOffset,i.maxForce=this.m_maxForce,i.maxTorque=this.m_maxTorque,i.correctionFactor=this.m_correctionFactor,i}},Ri._extend(vi),Ii.prototype={Initialize:function(i,s,n,r,e,c,o){this.bodyA=i,this.bodyB=s,this.groundAnchorA.Assign(n),this.groundAnchorB.Assign(r),this.localAnchorA.Assign(this.bodyA.GetLocalPoint(e)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c));var u=h.Subtract(e,n);this.lengthA=u.Length();var a=h.Subtract(c,r);this.lengthB=a.Length(),this.ratio=o,t(this.ratio>Gi)},_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.groundAnchorA._deserialize(t.groundAnchorA),this.groundAnchorB._deserialize(t.groundAnchorB),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.lengthA=t.lengthA,this.lengthB=t.lengthB,this.ratio=t.ratio}},Ii._extend(li),Li.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var i=h.Multiply(this.m_impulse,this.m_uB);return h.Multiply(t,i)},GetReactionTorque:function(t){return 0},GetGroundAnchorA:function(){return this.m_groundAnchorA},GetGroundAnchorB:function(){return this.m_groundAnchorB},GetLengthA:function(){return this.m_lengthA},GetLengthB:function(){return this.m_lengthB},GetRatio:function(){return this.m_ratio},GetCurrentLengthA:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),i=this.m_groundAnchorA;return h.Subtract(t,i).Length()},GetCurrentLengthB:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB),i=this.m_groundAnchorB;return h.Subtract(t,i).Length()},ShiftOrigin:function(t){this.m_groundAnchorA.Subtract(t),this.m_groundAnchorB.Subtract(t)},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),r=t.velocities[this.m_indexA].w,e=t.positions[this.m_indexB].c.Clone(),c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,f=new o(s),v=new o(c);this.m_rA.Assign(S(f,h.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(S(v,h.Subtract(this.m_localAnchorB,this.m_localCenterB))),this.m_uA.Assign(h.Add(i,h.Subtract(this.m_rA,this.m_groundAnchorA))),this.m_uB.Assign(h.Add(e,h.Subtract(this.m_rB,this.m_groundAnchorB)));var d=this.m_uA.Length(),p=this.m_uB.Length();d>10*Ui?this.m_uA.Multiply(1/d):this.m_uA.SetZero(),p>10*Ui?this.m_uB.Multiply(1/p):this.m_uB.SetZero();var g=l(this.m_rA,this.m_uA),m=l(this.m_rB,this.m_uB),w=this.m_invMassA+this.m_invIA*g*g,_=this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=w+this.m_ratio*this.m_ratio*_,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var C=h.Multiply(-this.m_impulse,this.m_uA),b=h.Multiply(-this.m_ratio*this.m_impulse,this.m_uB);n.Add(h.Multiply(this.m_invMassA,C)),r+=this.m_invIA*l(this.m_rA,C),u.Add(h.Multiply(this.m_invMassB,b)),a+=this.m_invIB*l(this.m_rB,b)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].v.Assign(u),t.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=h.Add(i,d(s,this.m_rA)),c=h.Add(n,d(r,this.m_rB)),o=-f(this.m_uA,e)-this.m_ratio*f(this.m_uB,c),u=-this.m_mass*o;this.m_impulse+=u;var a=h.Multiply(-u,this.m_uA),v=h.Multiply(-this.m_ratio,h.Multiply(u,this.m_uB));i.Add(h.Multiply(this.m_invMassA,a)),s+=this.m_invIA*l(this.m_rA,a),n.Add(h.Multiply(this.m_invMassB,v)),r+=this.m_invIB*l(this.m_rB,v),t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r},SolvePositionConstraints:function(t){var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),r=t.positions[this.m_indexB].a,e=new o(s),c=new o(r),u=S(e,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),a=S(c,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),f=h.Add(i,h.Subtract(u,this.m_groundAnchorA)),v=h.Add(n,h.Subtract(a,this.m_groundAnchorB)),d=f.Length(),p=v.Length();d>10*Ui?f.Multiply(1/d):f.SetZero(),p>10*Ui?v.Multiply(1/p):v.SetZero();var g=l(u,f),m=l(a,v),w=this.m_invMassA+this.m_invIA*g*g,_=this.m_invMassB+this.m_invIB*m*m,C=w+this.m_ratio*this.m_ratio*_;C>0&&(C=1/C);var b=this.m_constant-d-this.m_ratio*p,y=hs(b),T=-C*b,A=h.Multiply(-T,f),M=h.Multiply(-this.m_ratio,h.Multiply(T,v));return i.Add(h.Multiply(this.m_invMassA,A)),s+=this.m_invIA*l(u,A),n.Add(h.Multiply(this.m_invMassB,M)),r+=this.m_invIB*l(a,M),t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=r,y<Ui},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.groundAnchorA=this.m_groundAnchorA._serialize(),i.groundAnchorB=this.m_groundAnchorB._serialize(),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.lengthA=this.m_lengthA,i.lengthB=this.m_lengthB,i.ratio=this.m_ratio,i}},Li._extend(vi),Di.prototype={_deserialize:function(t,i,s){this.parent.prototype._deserialize.call(this,t,i,s),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.maxLength=t.maxLength}},Di._extend(li),Fi.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return h.Multiply(t*this.m_impulse,this.m_u)},GetReactionTorque:function(t){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxLength:function(t){this.m_maxLength=t},GetMaxLength:function(){return this.m_maxLength},GetLimitState:function(){return this.m_state},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),r=t.velocities[this.m_indexA].w,e=t.positions[this.m_indexB].c.Clone(),c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,f=new o(s),v=new o(c);this.m_rA.Assign(S(f,h.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(S(v,h.Subtract(this.m_localAnchorB,this.m_localCenterB))),this.m_u.Assign(h.Subtract(h.Subtract(h.Add(e,this.m_rB),i),this.m_rA)),this.m_length=this.m_u.Length();var d=this.m_length-this.m_maxLength;if(this.m_state=d>0?vi.e_atUpperLimit:vi.e_inactiveLimit,!(this.m_length>Ui))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.Multiply(1/this.m_length);var p=l(this.m_rA,this.m_u),g=l(this.m_rB,this.m_u),m=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=0!=m?1/m:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var w=h.Multiply(this.m_impulse,this.m_u);n.Subtract(h.Multiply(this.m_invMassA,w)),r-=this.m_invIA*l(this.m_rA,w),u.Add(h.Multiply(this.m_invMassB,w)),a+=this.m_invIB*l(this.m_rB,w)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].v.Assign(u),t.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var i=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),r=t.velocities[this.m_indexB].w,e=h.Add(i,d(s,this.m_rA)),c=h.Add(n,d(r,this.m_rB)),o=this.m_length-this.m_maxLength,u=f(this.m_u,h.Subtract(c,e));o<0&&(u+=t.step.inv_dt*o);var a=-this.m_mass*u,v=this.m_impulse;this.m_impulse=rs(0,this.m_impulse+a),a=this.m_impulse-v;var p=h.Multiply(a,this.m_u);i.Subtract(h.Multiply(this.m_invMassA,p)),s-=this.m_invIA*l(this.m_rA,p),n.Add(h.Multiply(this.m_invMassB,p)),r+=this.m_invIB*l(this.m_rB,p),t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=r},SolvePositionConstraints:function(t){var i=t.positions[this.m_indexA].c.Clone(),s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),r=t.positions[this.m_indexB].a,e=new o(s),c=new o(r),u=S(e,h.Subtract(this.m_localAnchorA,this.m_localCenterA)),a=S(c,h.Subtract(this.m_localAnchorB,this.m_localCenterB)),f=h.Subtract(h.Subtract(h.Add(n,a),i),u),v=f.Normalize(),d=v-this.m_maxLength;d=I(d,0,.2);var p=-this.m_mass*d,g=h.Multiply(p,f);return i.Subtract(h.Multiply(this.m_invMassA,g)),s-=this.m_invIA*l(u,g),n.Add(h.Multiply(this.m_invMassB,g)),r+=this.m_invIB*l(a,g),t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=r,v-this.m_maxLength<Ui},_serialize:function(t){var i=t||{};return this.parent.prototype._serialize.call(this,i),i.localAnchorA=this.m_localAnchorA._serialize(),i.localAnchorB=this.m_localAnchorB._serialize(),i.maxLength=this.m_maxLength,i}},Fi._extend(vi);var Ms=Math.exp;Ni.prototype={Initialize:function(i){for(t(i.count>=3),this.m_count=i.count,this.m_ps=new Array(this.m_count),this.m_p0s=new Array(this.m_count),this.m_vs=new Array(this.m_count),this.m_ims=new Array(this.m_count),o=0;o<this.m_count;++o){this.m_ps[o]=i.vertices[o].Clone(),this.m_p0s[o]=i.vertices[o].Clone(),this.m_vs[o]=new h;var s=i.masses[o];this.m_ims[o]=s>0?1/s:0}var n=this.m_count-1,r=this.m_count-2;for(this.m_Ls=new Array(n),this.m_as=new Array(r),o=0;o<n;++o){var e=this.m_ps[o],c=this.m_ps[o+1];this.m_Ls[o]=g(e,c)}for(var o=0;o<r;++o){e=this.m_ps[o],c=this.m_ps[o+1];var u=this.m_ps[o+2],a=h.Subtract(c,e),v=h.Subtract(u,c),d=l(a,v),p=f(a,v);this.m_as[o]=ns(d,p)}this.m_gravity=i.gravity.Clone(),this.m_damping=i.damping,this.m_k2=i.k2,this.m_k3=i.k3},Step:function(t,i){if(0!=t){for(var s=Ms(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Assign(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].Add(h.Multiply(t,this.m_gravity)),this.m_vs[n].Multiply(s),this.m_ps[n].Add(h.Multiply(t,this.m_vs[n]));for(n=0;n<i;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();var r=1/t;for(n=0;n<this.m_count;++n)this.m_vs[n]=h.Multiply(r,h.Subtract(this.m_ps[n],this.m_p0s[n]))}},GetVertexCount:function(){return this.m_count},GetVertices:function(){return this.m_ps},Draw:function(t){for(var i=new L(.4,.5,.7),s=0;s<this.m_count-1;++s)t.DrawSegment(this.m_ps[s],this.m_ps[s+1],i)},SetAngle:function(t){for(var i=this.m_count-2,s=0;s<i;++s)this.m_as[s]=t},SolveC2:function(){for(var t=this.m_count-1,i=0;i<t;++i){var s=this.m_ps[i],n=this.m_ps[i+1],r=h.Subtract(n,s),e=r.Normalize(),c=this.m_ims[i],o=this.m_ims[i+1];if(c+o!=0){var u=c/(c+o),a=o/(c+o);s.Subtract(h.Multiply(this.m_k2*u*(this.m_Ls[i]-e),r)),n.Add(h.Multiply(this.m_k2*a*(this.m_Ls[i]-e),r))}}},SolveC3:function(){for(var t=this.m_count-2,i=0;i<t;++i){var s=this.m_ps[i],n=this.m_ps[i+1],r=this.m_ps[i+2],e=this.m_ims[i],c=this.m_ims[i+1],o=this.m_ims[i+2],u=h.Subtract(n,s),a=h.Subtract(r,n),v=u.LengthSquared(),d=a.LengthSquared();if(v*d!=0){var p=l(u,a),g=f(u,a),m=ns(p,g),w=h.Multiply(-1/v,u.Skew()),_=h.Multiply(1/d,a.Skew()),C=h.Negate(w),b=h.Subtract(w,_),y=_,T=e*f(C,C)+c*f(b,b)+o*f(y,y);if(0!=T){T=1/T;for(var S=m-this.m_as[i];S>zi;)S=(m-=2*zi)-this.m_as[i];for(;S<-zi;)S=(m+=2*zi)-this.m_as[i];var A=-this.m_k3*T*S;s.Add(h.Multiply(e*A,C)),n.Add(h.Multiply(c*A,b)),r.Add(h.Multiply(o*A,y))}}}}};var xs={serialize:function(t){var i,s,n,h,r,e=[];for(n=t.GetBodyList();n;n=n.GetNext())for(h=n.GetFixtureList();h;h=h.GetNext())r=h.GetShape(),h.__temp_shape_id=e.length,e.push(r._serialize());var c=[];for(n=t.GetBodyList();n;n=n.GetNext())for(n.__temp_fixture_ids=[],h=n.GetFixtureList();h;h=h.GetNext())(s=h._serialize()).shape=h.__temp_shape_id,delete h.__temp_shape_id,n.__temp_fixture_ids.push(c.length),c.push(s);var o=[];for(n=t.GetBodyList();n;n=n.GetNext()){for((s=n._serialize()).fixtures=[],i=0;i<n.__temp_fixture_ids.length;++i)s.fixtures.push(n.__temp_fixture_ids[i]);delete n.__temp_fixture_ids,n.__temp_body_id=o.length,o.push(s)}var u,a=[];for(u=t.GetJointList(),i=0;u;u=u.GetNext(),++i)u.__temp_joint_id=i;for(u=t.GetJointList();u;u=u.GetNext())u.GetType()!==vi.e_mouseJoint&&((s=u._serialize()).bodyA=u.GetBodyA().__temp_body_id,s.bodyB=u.GetBodyB().__temp_body_id,a.push(s));for(u=t.GetJointList();u;u=u.GetNext())delete u.__temp_joint_id;for(n=t.GetBodyList();n;n=n.GetNext())delete n.__temp_body_id;return{shapes:e,fixtures:c,bodies:o,joints:a}},deserialize:function(t,i,s){var n=JSON.parse(t);if(s){for(var h=i.GetBodyList();h;)e=h.GetNext(),i.DestroyBody(h),h=e;for(var r=i.GetJointList();r;){var e=r.GetNext();i.DestroyJoint(r),r=e}}for(var c=[],o=0;o<n.shapes.length;++o){var u,a=n.shapes[o];switch(a.m_type){case k.e_circle:u=new B;break;case k.e_edge:u=new G;break;case k.e_chain:u=new z;break;case k.e_polygon:u=new j}u._deserialize(a),c.push(u)}var f=[];for(o=0;o<n.fixtures.length;++o){var l=n.fixtures[o],v=new Ot;v._deserialize(l),v.shape=c[l.shape],f.push(v)}var d=[];for(o=0;o<n.bodies.length;++o){var p=n.bodies[o],g=new Mt;g._deserialize(p);for(var m=i.CreateBody(g),w=0;w<p.fixtures.length;++w)m.CreateFixture(f[p.fixtures[w]]);d.push(m)}var _=[],C=[];for(o=0;o<n.joints.length;++o){var b,y=n.joints[o];switch(y.type){case vi.e_revoluteJoint:b=new di;break;case vi.e_prismaticJoint:b=new Ci;break;case vi.e_distanceJoint:b=new wi;break;case vi.e_pulleyJoint:b=new Ii;break;case vi.e_gearJoint:b=new Ei;break;case vi.e_wheelJoint:b=new Mi;break;case vi.e_weldJoint:b=new Si;break;case vi.e_frictionJoint:b=new yi;break;case vi.e_ropeJoint:b=new Di;break;case vi.e_motorJoint:b=new Pi;break;default:throw new Error("unknown joint")}if(b._deserialize(y,d),y.type===vi.e_gearJoint)C.push([b,_.length]),_.push(null);else{var T=i.CreateJoint(b);_.push(T)}}for(o=0;o<C.length;++o)C[o][0].joint1=_[C[o][0].joint1],C[o][0].joint2=_[C[o][0].joint2],T=i.CreateJoint(C[o][0]),_[C[o][1]]=T}},Es=function(){function t(t){return new h(t?t.x||0:0,t?t.y||0:0)}function i(t){for(var i=new Array(t.x.length),s=0;s<i.length;++s)i[s]=new h(t.x[s],t.y[s]);return i}function s(i,s){var n,h=i.name;if(void 0!==i.int)n=i.int;else if(void 0!==i.float)n=i.float;else if(void 0!==i.string)n=i.string;else if(void 0!==i.bool)n=i.bool;else{if(void 0===i.vec2)throw new Error("unknown property type");n=t(i.vec2)}if(s.hasOwnProperty(h))throw new Error("custom property possibly overwriting an existing one");s[h]=n}function n(n,h){var r=new Ot;r.density=n.density||0,r.filter.categoryBits=void 0===n["filter-categoryBits"]?1:n["filter-categoryBits"],r.filter.maskBits=void 0===n["filter-maskBits"]?65535:n["filter-maskBits"],r.filter.groupIndex=void 0===n["filter-groupIndex"]?0:n["filter-groupIndex"],r.friction=n.friction||0,r.restitution=n.restitution||0,r.isSensor=n.sensor||0;var e;if(void 0!==n.circle)(e=new B).m_p=t(n.circle.center),e.m_radius=n.circle.radius||0;else if(void 0!==n.polygon)c=i(n.polygon.vertices),(e=new j).Set(c,c.length);else{if(void 0===n.chain)throw new Error("unknown shape type");var c=i(n.chain.vertices);(e=new z).m_count=c.length,e.m_vertices=c,(e.m_hasNextVertex=n.chain.hasNextVertex)&&(e.m_nextVertex=t(n.chain.nextVertex)),(e.m_hasPrevVertex=n.chain.hasPrevVertex)&&(e.m_prevVertex=t(n.chain.prevVertex))}r.shape=e;var o=h.CreateFixture(r);if(o.name=n.name,n.customProperties)for(var u=0;u<n.customProperties.length;++u)s(n,o)}function r(i,h){var r=new Mt;r.type=i.type||xt.b2_staticBody,r.angle=i.angle||0,r.angularDamping=i.angularDamping||0,r.angularVelocity=i.angularVelocity||0,r.awake=i.awake||!1,r.bullet=i.bullet||!1,r.fixedRotation=i.fixedRotation||!1,r.linearDamping=i.linearDamping||!1,r.linearVelocity=t(i.linearVelocity),r.gravityScale=void 0!==i.gravityScale?i.gravityScale:1;var e=new N;e.mass=i["massData-mass"]||0,e.center=t(i["massData-center"]),e.I=i["massData-I"]||0,r.position=t(i.position);var c=h.CreateBody(r);if(c.name=i.name,c.SetMassData(e),i.fixture)for(var o=0;o<i.fixture.length;++o)n(i.fixture[o],c);if(i.customProperties)for(o=0;o<i.customProperties.length;++o)s(i,c);return c}function e(i,n,h){if(!c[i.type])throw new Error("unknown joint type");var r=new c[i.type];switch(r.type){case vi.e_revoluteJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.enableLimit=i.enableLimit||!1,r.enableMotor=i.enableMotor||!1,r.lowerAngle=i.lowerLimit||0,r.maxMotorTorque=i.maxMotorTorque||0,r.motorSpeed=i.motorSpeed||0,r.referenceAngle=i.refAngle||0,r.upperAngle=i.upperLimit||0;break;case vi.e_distanceJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.dampingRatio=i.dampingRatio||0,r.frequencyHz=i.frequency||0,r.length=i.length||0;break;case vi.e_prismaticJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.enableLimit=i.enableLimit||!1,r.enableMotor=i.enableMotor||!1,r.localAxisA=t(i.localAxisA),r.lowerTranslation=i.lowerLimit||0,r.maxMotorForce=i.maxMotorForce||0,r.motorSpeed=i.motorSpeed||0,r.referenceAngle=i.refAngle||0,r.upperTranslation=i.upperLimit||0;break;case vi.e_wheelJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.enableMotor=i.enableMotor||!1,r.localAxisA=t(i.localAxisA),r.maxMotorTorque=i.maxMotorTorque||0,r.motorSpeed=i.motorSpeed||0,r.dampingRatio=i.springDampingRatio||0,r.frequencyHz=i.springFrequency||0;break;case vi.e_ropeJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.maxLength=i.maxLength||0;break;case vi.e_motorJoint:r.linearOffset=t(i.anchorA),r.angularOffset=i.refAngle||0,r.maxForce=i.maxForce||0,r.maxTorque=i.maxTorque||0,r.correctionFactor=i.correctionFactor||0;break;case vi.e_weldJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.referenceAngle=i.refAngle||0,r.dampingRatio=i.dampingRatio||0,r.frequencyHz=i.frequencyHz||0;break;case vi.e_frictionJoint:r.localAnchorA=t(i.anchorA),r.localAnchorB=t(i.anchorB),r.maxForce=i.maxForce||0,r.maxTorque=i.maxTorque||0;break;default:throw new Error("wat?")}r.bodyA=h[i.bodyA||0],r.bodyB=h[i.bodyB||0],r.collideConnected=i.collideConnected||!1;var e=n.CreateJoint(r);if(e.name=i.name,i.customProperties)for(var o=0;o<i.customProperties.length;++o)s(i,e);return e}var c={revolute:di,distance:wi,prismatic:Ci,wheel:Mi,rope:Di,motor:Pi,weld:Si,friction:yi};return{parseWorld:function(i,s){var n=new function(){this.world=null,this.positionIterations=0,this.velocityIterations=0,this.stepsPerSecond=0,this.fixtures={},this.bodies={},this.joints={},Object.seal(this)};n.world=s=s||new Vt(new h(0,0)),n.positionIterations=i.positionIterations||0,n.velocityIterations=i.velocityIterations||0,n.stepsPerSecond=i.stepsPerSecond||0,i.gravity&&s.SetGravity(t(i.gravity)),s.SetAllowSleeping(i.allowSleep||!1),s.SetAutoClearForces(i.autoClearForces||!1),s.SetWarmStarting(i.warmStarting||!1),s.SetContinuousPhysics(i.continuousPhysics||!1),s.SetSubStepping(i.subStepping||!1);var c=[],o=i.body;if(o)for(var u=0;u<o.length;++u){var a=r(o[u],s);c.push(a);for(var f=a.GetFixtureList();f;f=f.GetNext())n.fixtures[f.name]||(n.fixtures[f.name]=[]),n.fixtures[f.name].push(f);n.bodies[a.name]||(n.bodies[a.name]=[]),n.bodies[a.name].push(a)}var l=[],v=i.joint;if(v)for(u=0;u<v.length;++u){var d=e(v[u],s,c);l.push(d),n.joints[d.name]||(n.joints[d.name]=[]),n.joints[d.name].push(d)}return n}}}(),Os=[{trimmed:"version",name:"b2_version",def:Zi},{trimmed:"Vec2",name:"b2Vec2",def:h},{trimmed:"Vec3",name:"b2Vec3",def:r},{trimmed:"Mat22",name:"b2Mat22",def:e},{trimmed:"Mat33",name:"b2Mat33",def:c},{trimmed:"Rot",name:"b2Rot",def:o},{trimmed:"Transform",name:"b2Transform",def:u},{trimmed:"Sweep",name:"b2Sweep",def:a},{trimmed:"Dot_v2_v2",name:"b2Dot_v2_v2",def:f},{trimmed:"Cross_v2_v2",name:"b2Cross_v2_v2",def:l},{trimmed:"Cross_v2_f",name:"b2Cross_v2_f",def:v},{trimmed:"Cross_f_v2",name:"b2Cross_f_v2",def:d},{trimmed:"Mul_m22_v2",name:"b2Mul_m22_v2",def:p},{trimmed:"MulT_m22_v2",name:"b2MulT_m22_v2",def:function(t,i){return new h(f(i,t.ex),f(i,t.ey))}},{trimmed:"Distance",name:"b2Distance",def:g},{trimmed:"DistanceSquared",name:"b2DistanceSquared",def:m},{trimmed:"Dot_v3_v3",name:"b2Dot_v3_v3",def:w},{trimmed:"Cross_v3_v3",name:"b2Cross_v3_v3",def:_},{trimmed:"Mul_m22_m22",name:"b2Mul_m22_m22",def:function(t,i){return new e(p(t,i.ex),p(t,i.ey))}},{trimmed:"MulT_m22_m22",name:"b2MulT_m22_m22",def:function(t,i){return new e(new h(f(t.ex,i.ex),f(t.ey,i.ex)),new h(f(t.ex,i.ey),f(t.ey,i.ey)))}},{trimmed:"Mul_m33_v3",name:"b2Mul_m33_v3",def:C},{trimmed:"Mul22_m33_v2",name:"b2Mul22_m33_v2",def:b},{trimmed:"Mul_r_r",name:"b2Mul_r_r",def:y},{trimmed:"MulT_r_r",name:"b2MulT_r_r",def:T},{trimmed:"Mul_r_v2",name:"b2Mul_r_v2",def:S},{trimmed:"MulT_r_v2",name:"b2MulT_r_v2",def:A},{trimmed:"Mul_t_v2",name:"b2Mul_t_v2",def:M},{trimmed:"Min_v2",name:"b2Min_v2",def:P},{trimmed:"Max_v2",name:"b2Max_v2",def:R},{trimmed:"Clamp",name:"b2Clamp",def:I},{trimmed:"MulT_t_v2",name:"b2MulT_t_v2",def:x},{trimmed:"Mul_t_t",name:"b2Mul_t_t",def:function(t,i){var s=new u;return s.q=y(t.q,i.q),s.p=h.Add(S(t.q,i.p),t.p),s}},{trimmed:"MulT_t_t",name:"b2MulT_t_t",def:E},{trimmed:"Clamp_v2",name:"b2Clamp_v2",def:function(t,i,s){return R(i,P(t,s))}},{trimmed:"NextPowerOfTwo",name:"b2NextPowerOfTwo",def:function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)}},{trimmed:"Abs_v2",name:"b2Abs_v2",def:O},{trimmed:"Abs_m22",name:"b2Abs_m22",def:function(t){return new e(O(t.ex),O(t.ey))}},{trimmed:"IsPowerOfTwo",name:"b2IsPowerOfTwo",def:function(t){return t>0&&0==(t&t-1)}},{trimmed:"RandomFloat",name:"b2RandomFloat",def:function(t,i){var s=Math.random();return s=void 0!==t?(i-t)*s+t:2*s-1}},{trimmed:"Timer",name:"b2Timer",def:F},{trimmed:"Color",name:"b2Color",def:L},{trimmed:"Draw",name:"b2Draw",def:D},{trimmed:"ContactID",name:"b2ContactID",def:K},{trimmed:"ManifoldPoint",name:"b2ManifoldPoint",def:$},{trimmed:"Manifold",name:"b2Manifold",def:tt},{trimmed:"WorldManifold",name:"b2WorldManifold",def:it},{trimmed:"GetPointStates",name:"b2GetPointStates",def:function(t,i,s,n){for(h=0;h<ji;++h)t[h]=tt.b2_nullState,i[h]=tt.b2_nullState;for(h=0;h<s.pointCount;++h)for(r=s.points[h].id,t[h]=tt.b2_removeState,e=0;e<n.pointCount;++e)if(n.points[e].id.Get()==r.Get()){t[h]=tt.b2_persistState;break}for(var h=0;h<n.pointCount;++h){var r=n.points[h].id;i[h]=tt.b2_addState;for(var e=0;e<s.pointCount;++e)if(s.points[e].id.Get()==r.Get()){i[h]=tt.b2_persistState;break}}}},{trimmed:"ClipVertex",name:"b2ClipVertex",def:st},{trimmed:"RayCastInput",name:"b2RayCastInput",def:nt},{trimmed:"RayCastOutput",name:"b2RayCastOutput",def:ht},{trimmed:"AABB",name:"b2AABB",def:rt},{trimmed:"CollideCircles",name:"b2CollideCircles",def:et},{trimmed:"CollidePolygonAndCircle",name:"b2CollidePolygonAndCircle",def:ct},{trimmed:"FindMaxSeparation",name:"b2FindMaxSeparation",def:ot},{trimmed:"FindIncidentEdge",name:"b2FindIncidentEdge",def:ut},{trimmed:"CollidePolygons",name:"b2CollidePolygons",def:at},{trimmed:"CollideEdgeAndCircle",name:"b2CollideEdgeAndCircle",def:ft},{trimmed:"EPAxis",name:"b2EPAxis",def:lt},{trimmed:"TempPolygon",name:"b2TempPolygon",def:vt},{trimmed:"ReferenceFace",name:"b2ReferenceFace",def:dt},{trimmed:"EPCollider",name:"b2EPCollider",def:pt},{trimmed:"CollideEdgeAndPolygon",name:"b2CollideEdgeAndPolygon",def:gt},{trimmed:"ClipSegmentToLine",name:"b2ClipSegmentToLine",def:mt},{trimmed:"TestShapeOverlap",name:"b2TestShapeOverlap",def:wt},{trimmed:"TestOverlap",name:"b2TestOverlap",def:_t},{trimmed:"Shape",name:"b2Shape",def:k},{trimmed:"CircleShape",name:"b2CircleShape",def:B},{trimmed:"EdgeShape",name:"b2EdgeShape",def:G},{trimmed:"ChainShape",name:"b2ChainShape",def:z},{trimmed:"PolygonShape",name:"b2PolygonShape",def:j},{trimmed:"Pair",name:"b2Pair",def:V},{trimmed:"PairLessThan",name:"b2PairLessThan",def:U},{trimmed:"BroadPhase",name:"b2BroadPhase",def:W},{trimmed:"DistanceProxy",name:"b2DistanceProxy",def:H},{trimmed:"SimplexCache",name:"b2SimplexCache",def:X},{trimmed:"DistanceInput",name:"b2DistanceInput",def:J},{trimmed:"DistanceOutput",name:"b2DistanceOutput",def:Y},{trimmed:"SimplexVertex",name:"b2SimplexVertex",def:q},{trimmed:"Simplex",name:"b2Simplex",def:Z},{trimmed:"DistanceFunc",name:"b2DistanceFunc",def:Q},{trimmed:"TreeNode",name:"b2TreeNode",def:Ct},{trimmed:"DynamicTree",name:"b2DynamicTree",def:bt},{trimmed:"TOIInput",name:"b2TOIInput",def:yt},{trimmed:"TOIOutput",name:"b2TOIOutput",def:Tt},{trimmed:"SeparationFunction",name:"b2SeparationFunction",def:St},{trimmed:"TimeOfImpact",name:"b2TimeOfImpact",def:At},{trimmed:"BodyDef",name:"b2BodyDef",def:Mt},{trimmed:"Body",name:"b2Body",def:xt},{trimmed:"Filter",name:"b2Filter",def:Et},{trimmed:"FixtureDef",name:"b2FixtureDef",def:Ot},{trimmed:"Fixture",name:"b2Fixture",def:Rt},{trimmed:"DestructionListener",name:"b2DestructionListener",def:It},{trimmed:"ContactFilter",name:"b2ContactFilter",def:Lt},{trimmed:"ContactImpulse",name:"b2ContactImpulse",def:Dt},{trimmed:"ContactListener",name:"b2ContactListener",def:Ft},{trimmed:"QueryCallback",name:"b2QueryCallback",def:Nt},{trimmed:"RayCastCallback",name:"b2RayCastCallback",def:kt},{trimmed:"TimeStep",name:"b2TimeStep",def:Bt},{trimmed:"Position",name:"b2Position",def:Gt},{trimmed:"Velocity",name:"b2Velocity",def:zt},{trimmed:"SolverData",name:"b2SolverData",def:jt},{trimmed:"World",name:"b2World",def:Vt},{trimmed:"MixFriction",name:"b2MixFriction",def:Ht},{trimmed:"MixRestitution",name:"b2MixRestitution",def:Xt},{trimmed:"ContactRegister",name:"b2ContactRegister",def:Jt},{trimmed:"ContactEdge",name:"b2ContactEdge",def:Yt},{trimmed:"Contact",name:"b2Contact",def:qt},{trimmed:"CircleContact",name:"b2CircleContact",def:Zt},{trimmed:"PolygonContact",name:"b2PolygonContact",def:si},{trimmed:"ChainAndCircleContact",name:"b2ChainAndCircleContact",def:Qt},{trimmed:"ChainAndPolygonContact",name:"b2ChainAndPolygonContact",def:Kt},{trimmed:"EdgeAndCircleContact",name:"b2EdgeAndCircleContact",def:$t},{trimmed:"EdgeAndPolygonContact",name:"b2EdgeAndPolygonContact",def:ti},{trimmed:"PolygonAndCircleContact",name:"b2PolygonAndCircleContact",def:ii},{trimmed:"defaultFilter",name:"b2_defaultFilter",def:Cs},{trimmed:"defaultListener",name:"b2_defaultListener",def:bs},{trimmed:"ContactManager",name:"b2ContactManager",def:ni},{trimmed:"VelocityConstraintPoint",name:"b2VelocityConstraintPoint",def:hi},{trimmed:"ContactPositionConstraint",name:"b2ContactPositionConstraint",def:ri},{trimmed:"ContactVelocityConstraint",name:"b2ContactVelocityConstraint",def:ei},{trimmed:"PositionSolverManifold",name:"b2PositionSolverManifold",def:ci},{trimmed:"ContactSolverDef",name:"b2ContactSolverDef",def:oi},{trimmed:"ContactSolver",name:"b2ContactSolver",def:ui},{trimmed:"Island",name:"b2Island",def:ai},{trimmed:"Jacobian",name:"b2Jacobian",def:function(){this.linear=new h,this.angularA=0,this.angularB=0}},{trimmed:"JointEdge",name:"b2JointEdge",def:fi},{trimmed:"JointDef",name:"b2JointDef",def:li},{trimmed:"Joint",name:"b2Joint",def:vi},{trimmed:"RevoluteJointDef",name:"b2RevoluteJointDef",def:di},{trimmed:"RevoluteJoint",name:"b2RevoluteJoint",def:pi},{trimmed:"MouseJointDef",name:"b2MouseJointDef",def:gi},{trimmed:"MouseJoint",name:"b2MouseJoint",def:mi},{trimmed:"DistanceJointDef",name:"b2DistanceJointDef",def:wi},{trimmed:"DistanceJoint",name:"b2DistanceJoint",def:_i},{trimmed:"PrismaticJointDef",name:"b2PrismaticJointDef",def:Ci},{trimmed:"PrismaticJoint",name:"b2PrismaticJoint",def:bi},{trimmed:"FrictionJointDef",name:"b2FrictionJointDef",def:yi},{trimmed:"FrictionJoint",name:"b2FrictionJoint",def:Ti},{trimmed:"WeldJointDef",name:"b2WeldJointDef",def:Si},{trimmed:"WeldJoint",name:"b2WeldJoint",def:Ai},{trimmed:"WheelJointDef",name:"b2WheelJointDef",def:Mi},{trimmed:"WheelJoint",name:"b2WheelJoint",def:xi},{trimmed:"GearJointDef",name:"b2GearJointDef",def:Ei},{trimmed:"GearJoint",name:"b2GearJoint",def:Oi},{trimmed:"MotorJointDef",name:"b2MotorJointDef",def:Pi},{trimmed:"MotorJoint",name:"b2MotorJoint",def:Ri},{trimmed:"PulleyJointDef",name:"b2PulleyJointDef",def:Ii},{trimmed:"PulleyJoint",name:"b2PulleyJoint",def:Li},{trimmed:"RopeJointDef",name:"b2RopeJointDef",def:Di},{trimmed:"RopeJoint",name:"b2RopeJoint",def:Fi},{trimmed:"RopeDef",name:"b2RopeDef",def:function(){this.vertices=null,this.count=0,this.masses=null,this.gravity=new h,this.damping=.1,this.k2=.9,this.k3=.1}},{trimmed:"Rope",name:"b2Rope",def:Ni},{trimmed:"maxManifoldPoints",name:"b2_maxManifoldPoints",def:ji},{trimmed:"maxPolygonVertices",name:"b2_maxPolygonVertices",def:Vi},{trimmed:"aabbExtension",name:"b2_aabbExtension",def:.1},{trimmed:"aabbMultiplier",name:"b2_aabbMultiplier",def:2},{trimmed:"linearSlop",name:"b2_linearSlop",def:Ui},{trimmed:"angularSlop",name:"b2_angularSlop",def:Wi},{trimmed:"polygonRadius",name:"b2_polygonRadius",def:Hi},{trimmed:"maxSubSteps",name:"b2_maxSubSteps",def:8},{trimmed:"maxTOIContacts",name:"b2_maxTOIContacts",def:32},{trimmed:"velocityThreshold",name:"b2_velocityThreshold",def:1},{trimmed:"maxLinearCorrection",name:"b2_maxLinearCorrection",def:.2},{trimmed:"maxAngularCorrection",name:"b2_maxAngularCorrection",def:Xi},{trimmed:"maxTranslation",name:"b2_maxTranslation",def:2},{trimmed:"maxTranslationSquared",name:"b2_maxTranslationSquared",def:4},{trimmed:"maxRotation",name:"b2_maxRotation",def:Ji},{trimmed:"maxRotationSquared",name:"b2_maxRotationSquared",def:Yi},{trimmed:"baumgarte",name:"b2_baumgarte",def:.2},{trimmed:"toiBaugarte",name:"b2_toiBaugarte",def:.75},{trimmed:"timeToSleep",name:"b2_timeToSleep",def:.5},{trimmed:"linearSleepTolerance",name:"b2_linearSleepTolerance",def:.01},{trimmed:"angularSleepTolerance",name:"b2_angularSleepTolerance",def:qi},{trimmed:"epsilon",name:"b2_epsilon",def:Gi},{trimmed:"JsonSerializer",name:"b2JsonSerializer",def:xs},{trimmed:"RUBELoader",name:"b2RUBELoader",def:Es},{trimmed:"Profiler",name:"b2Profiler",def:ki}];if("undefined"!=typeof b2_compatibility&&"undefined"!=typeof window)for(Rs=0;Rs<Os.length;++Rs)window[Os[Rs].name]=Os[Rs].def;else{for(var Ps={},Rs=0;Rs<Os.length;++Rs)Ps[Os[Rs].trimmed]=Os[Rs].def;void 0!==i?i.exports=Ps:window.b2=Ps}}()},{}],311:[function(t,i,s){Object.create=Object.create||function(t){function i(){}return i.prototype=t,new i};var n,h,r=function(t,i){if(!t)throw new Error("Assertion failed: "+i)},e=function(t,i){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+i),console.trace&&console.trace())};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(n=Math.min,h=Math.max):(n=function(t,i){return t<i?t:i},h=function(t,i){return t>i?t:i});var c=function(t,i){return t<i?t+" "+i:i+" "+t},o=function(t,i){for(var s=0;s<t.length;s++)if(t[s]===i)return t[s]=t[t.length-1],void t.length--},u=function(t,i,s,n,h,r){var e=s-h,c=n-r,o=p(_(e,c,t-h,i-r)/L(e,c));return new g(h+e*o,r+c*o)};cp.momentForCircle=function(t,i,s,n){return t*(.5*(i*i+s*s)+I(n))},cp.areaForCircle=function(t,i){return Math.PI*Math.abs(t*t-i*i)},cp.momentForSegment=function(t,i,s){var n=A(y(i,s),.5);return t*(G(s,i)/12+I(n))},cp.areaForSegment=function(t,i,s){return s*(Math.PI*s+2*B(t,i))},cp.momentForPoly=function(t,i,s){for(var n=0,h=0,r=i.length,e=0;e<r;e+=2){var c=i[e]+s.x,o=i[e+1]+s.y,u=i[(e+2)%r]+s.x,a=i[(e+3)%r]+s.y,f=x(u,a,c,o);n+=f*(_(c,o,c,o)+_(c,o,u,a)+_(u,a,u,a)),h+=f}return t*n/(6*h)},cp.areaForPoly=function(t){for(var i=0,s=0,n=t.length;s<n;s+=2)i+=M(new g(t[s],t[s+1]),new g(t[(s+2)%n],t[(s+3)%n]));return-i/2},cp.centroidForPoly=function(t){for(var i=0,s=new g(0,0),n=0,h=t.length;n<h;n+=2){var r=new g(t[n],t[n+1]),e=new g(t[(n+2)%h],t[(n+3)%h]),c=M(r,e);i+=c,s=y(s,A(y(r,e),c))}return A(s,1/(3*i))},cp.recenterPoly=function(t){for(var i=cp.centroidForPoly(t),s=0;s<t.length;s+=2)t[s]-=i.x,t[s+1]-=i.y},cp.momentForBox=function(t,i,s){return t*(i*i+s*s)/12},cp.momentForBox2=function(t,i){var s=i.r-i.l,n=i.t-i.b,h=A([i.l+i.r,i.b+i.t],.5);return cp.momentForBox(t,s,n)+t*I(h)};var a=cp.loopIndexes=function(t){var i,s,n,h,r=0,e=0;i=n=t[0],s=h=t[1];for(var c=t.length>>1,o=1;o<c;o++){var u=t[2*o],a=t[2*o+1];u<i||u==i&&a<s?(i=u,s=a,r=o):(u>n||u==n&&a>h)&&(n=u,h=a,e=o)}return[r,e]},f=function(t,i,s){var n=t[2*i];t[2*i]=t[2*s],t[2*s]=n,n=t[2*i+1],t[2*i+1]=t[2*s+1],t[2*s+1]=n},l=function(t,i,s,n,h,r){if(0===s)return 0;for(var e=0,c=i,o=T(h,n),u=r*C(o),a=i,l=i+s-1;a<=l;){var v=new g(t[2*a],t[2*a+1]),d=M(o,T(v,n));d>u?(d>e&&(e=d,c=a),a++):(f(t,a,l),l--)}return c!=i&&f(t,i,c),a-i},v=function(t,i,s,n,h,r,e,c){if(n<0)return 0;if(0==n)return i[2*c]=r.x,i[2*c+1]=r.y,1;var o=l(i,s,n,h,r,t),u=new g(i[2*s],i[2*s+1]),a=v(t,i,s+1,o-1,h,u,r,c),f=c+a++;i[2*f]=r.x,i[2*f+1]=r.y;var d=l(i,s+o,n-o,r,e,t),p=new g(i[2*(s+o)],i[2*(s+o)+1]);return a+v(t,i,s+o+1,d-1,r,p,e,c+a)};cp.convexHull=function(t,i,s){if(i)for(var n=0;n<t.length;n++)i[n]=t[n];else i=t;var h=a(t),r=h[0],c=h[1];if(r==c)return i.length=2,i;f(i,0,r),f(i,1,0==c?r:c);var o=new g(i[0],i[1]),u=new g(i[2],i[3]),l=t.length>>1,d=v(s,i,2,l-2,o,u,o,1)+1;return i.length=2*d,e(K(i),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),i};var d=function(t,i,s){return n(h(t,i),s)},p=function(t){return h(0,n(t,1))},g=cp.Vect=function(t,i){this.x=t,this.y=i};cp.v=function(t,i){return new g(t,i)};var m=cp.vzero=new g(0,0),w=cp.v.dot=function(t,i){return t.x*i.x+t.y*i.y},_=function(t,i,s,n){return t*s+i*n},C=cp.v.len=function(t){return Math.sqrt(w(t,t))},b=cp.v.len2=function(t,i){return Math.sqrt(t*t+i*i)},y=(cp.v.eql=function(t,i){return t.x===i.x&&t.y===i.y},cp.v.add=function(t,i){return new g(t.x+i.x,t.y+i.y)});g.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var T=cp.v.sub=function(t,i){return new g(t.x-i.x,t.y-i.y)};g.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var S=cp.v.neg=function(t){return new g(-t.x,-t.y)};g.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var A=cp.v.mult=function(t,i){return new g(t.x*i,t.y*i)};g.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var M=cp.v.cross=function(t,i){return t.x*i.y-t.y*i.x},x=function(t,i,s,n){return t*n-i*s},E=cp.v.perp=function(t){return new g(-t.y,t.x)},O=(cp.v.pvrperp=function(t){return new g(t.y,-t.x)},cp.v.project=function(t,i){return A(i,w(t,i)/I(i))});g.prototype.project=function(t){return this.mult(w(this,t)/I(t)),this};var P=cp.v.rotate=function(t,i){return new g(t.x*i.x-t.y*i.y,t.x*i.y+t.y*i.x)};g.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var R=cp.v.unrotate=function(t,i){return new g(t.x*i.x+t.y*i.y,t.y*i.x-t.x*i.y)},I=cp.v.lengthsq=function(t){return w(t,t)},L=cp.v.lengthsq2=function(t,i){return t*t+i*i},D=cp.v.lerp=function(t,i,s){return y(A(t,1-s),A(i,s))},F=cp.v.normalize=function(t){return A(t,1/C(t))},N=cp.v.normalize_safe=function(t){return 0===t.x&&0===t.y?m:F(t)},k=cp.v.clamp=function(t,i){return w(t,t)>i*i?A(F(t),i):t},B=(cp.v.lerpconst=function(t,i,s){return y(t,k(T(i,t),s))},cp.v.dist=function(t,i){return C(T(t,i))}),G=cp.v.distsq=function(t,i){return I(T(t,i))},z=(cp.v.near=function(t,i,s){return G(t,i)<s*s},cp.v.slerp=function(t,i,s){var n=Math.acos(w(t,i));if(n){var h=1/Math.sin(n);return y(A(t,Math.sin((1-s)*n)*h),A(i,Math.sin(s*n)*h))}return t}),j=(cp.v.slerpconst=function(t,i,s){var h=Math.acos(w(t,i));return z(t,i,n(s,h)/h)},cp.v.forangle=function(t){return new g(Math.cos(t),Math.sin(t))},cp.v.toangle=function(t){return Math.atan2(t.y,t.x)},cp.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),V=cp.BB=function(t,i,s,n){this.l=t,this.b=i,this.r=s,this.t=n,j++};cp.bb=function(t,i,s,n){return new V(t,i,s,n)};var U=function(t,i){return new V(t.x-i,t.y-i,t.x+i,t.y+i)},W=0,H=(cp.NO_GROUP=0,cp.ALL_LAYERS=-1);cp.resetShapeIdCounter=function(){W=0};var X=cp.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=W++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=m,this.collision_type=0,this.group=0,this.layers=H,this.space=null,this.collisionCode=this.collisionCode};X.prototype.setElasticity=function(t){this.e=t},X.prototype.setFriction=function(t){this.body.activate(),this.u=t},X.prototype.setLayers=function(t){this.body.activate(),this.layers=t},X.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},X.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},X.prototype.getBody=function(){return this.body},X.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},X.prototype.setBody=function(t){r(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},X.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},X.prototype.update=function(t,i){r(!isNaN(i.x),"Rotation is NaN"),r(!isNaN(t.x),"Position is NaN"),this.cacheData(t,i)},X.prototype.pointQuery=function(t){var i=this.nearestPointQuery(t);if(i.d<0)return i},X.prototype.getBB=function(){return new V(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var J=function(t,i,s){this.shape=t,this.p=i,this.d=s},Y=function(t,i,s){this.shape=t,this.t=i,this.n=s};Y.prototype.hitPoint=function(t,i){return D(t,i,this.t)},Y.prototype.hitDist=function(t,i){return B(t,i)*this.t};var q=cp.CircleShape=function(t,i,s){this.c=this.tc=s,this.r=i,this.type="circle",X.call(this,t)};q.prototype=Object.create(X.prototype),q.prototype.cacheData=function(t,i){var s=this.tc=P(this.c,i).add(t),n=this.r;this.bb_l=s.x-n,this.bb_b=s.y-n,this.bb_r=s.x+n,this.bb_t=s.y+n},q.prototype.nearestPointQuery=function(t){var i=t.x-this.tc.x,s=t.y-this.tc.y,n=b(i,s),h=this.r,r=new g(this.tc.x+i*h/n,this.tc.y+s*h/n);return new J(this,r,n-h)};var Z=function(t,i,s,n,h,r){n=T(n,i),h=T(h,i);var e=w(n,n)-2*w(n,h)+w(h,h),c=-2*w(n,n)+2*w(n,h),o=c*c-4*e*(w(n,n)-s*s);if(o>=0){var u=(-c-Math.sqrt(o))/(2*e);if(0<=u&&u<=1)return new Y(t,u,F(D(n,h,u)))}};q.prototype.segmentQuery=function(t,i){return Z(this,this.tc,this.r,t,i)};var Q=cp.SegmentShape=function(t,i,s,n){this.a=i,this.b=s,this.n=E(F(T(s,i))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=m,this.b_tangent=m,this.type="segment",X.call(this,t)};Q.prototype=Object.create(X.prototype),Q.prototype.cacheData=function(t,i){this.ta=y(t,P(this.a,i)),this.tb=y(t,P(this.b,i)),this.tn=P(this.n,i);var s,n,h,r;this.ta.x<this.tb.x?(s=this.ta.x,n=this.tb.x):(s=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(h=this.ta.y,r=this.tb.y):(h=this.tb.y,r=this.ta.y);var e=this.r;this.bb_l=s-e,this.bb_b=h-e,this.bb_r=n+e,this.bb_t=r+e},Q.prototype.nearestPointQuery=function(t){var i=function(t,i,s){var n=T(i,s),h=p(w(n,T(t,s))/I(n));return y(s,A(n,h))}(t,this.ta,this.tb),s=t.x-i.x,n=t.y-i.y,h=b(s,n),r=this.r,e=h?y(i,A(new g(s,n),r/h)):i;return new J(this,e,h-r)},Q.prototype.segmentQuery=function(t,i){var s=this.tn,n=w(T(this.ta,t),s),h=this.r,r=n>0?S(s):s,e=T(A(r,h),t),c=y(this.ta,e),o=y(this.tb,e),u=T(i,t);if(M(u,c)*M(u,o)<=0){var a=n+(n>0?-h:h),f=-a,l=w(u,s)-a;if(f*l<0)return new Y(this,f/(f-l),r)}else if(0!==h){var v=Z(this,this.ta,this.r,t,i),d=Z(this,this.tb,this.r,t,i);return v?d&&d.t<v.t?d:v:d}},Q.prototype.setNeighbors=function(t,i){this.a_tangent=T(t,this.a),this.b_tangent=T(i,this.b)},Q.prototype.setEndpoints=function(t,i){this.a=t,this.b=i,this.n=E(F(T(i,t)))};var K=function(t){for(var i=t.length,s=0;s<i;s+=2){var n=t[s],h=t[s+1],r=t[(s+2)%i],e=t[(s+3)%i],c=t[(s+4)%i],o=t[(s+5)%i];if(x(r-n,e-h,c-r,o-e)>0)return!1}return!0},$=cp.PolyShape=function(t,i,s){this.setVerts(i,s),this.type="poly",X.call(this,t)};$.prototype=Object.create(X.prototype);var tt=function(t,i){this.n=t,this.d=i};tt.prototype.compare=function(t){return w(this.n,t)-this.d},$.prototype.setVerts=function(t,i){r(t.length>=4,"Polygons require some verts"),r("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),r(K(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var s=t.length,n=s>>1;this.verts=new Array(s),this.tVerts=new Array(s),this.planes=new Array(n),this.tPlanes=new Array(n);for(var h=0;h<s;h+=2){var e=t[h]+i.x,c=t[h+1]+i.y,o=t[(h+2)%s]+i.x,u=t[(h+3)%s]+i.y,a=F(E(new g(o-e,u-c)));this.verts[h]=e,this.verts[h+1]=c,this.planes[h>>1]=new tt(a,_(a.x,a.y,e,c)),this.tPlanes[h>>1]=new tt(new g(0,0),0)}},cp.BoxShape=function(t,i,s){var n=i/2,h=s/2;return it(t,new V(-n,-h,n,h))};var it=cp.BoxShape2=function(t,i){var s=[i.l,i.b,i.l,i.t,i.r,i.t,i.r,i.b];return new $(t,s,m)};$.prototype.transformVerts=function(t,i){for(var s=this.verts,r=this.tVerts,e=1/0,c=-1/0,o=1/0,u=-1/0,a=0;a<s.length;a+=2){var f=s[a],l=s[a+1],v=t.x+f*i.x-l*i.y,d=t.y+f*i.y+l*i.x;r[a]=v,r[a+1]=d,e=n(e,v),c=h(c,v),o=n(o,d),u=h(u,d)}this.bb_l=e,this.bb_b=o,this.bb_r=c,this.bb_t=u},$.prototype.transformAxes=function(t,i){for(var s=this.planes,n=this.tPlanes,h=0;h<s.length;h++){var r=P(s[h].n,i);n[h].n=r,n[h].d=w(t,r)+s[h].d}},$.prototype.cacheData=function(t,i){this.transformAxes(t,i),this.transformVerts(t,i)},$.prototype.nearestPointQuery=function(t){for(var i=this.tPlanes,s=this.tVerts,n=s[s.length-2],h=s[s.length-1],r=1/0,e=m,c=!1,o=0;o<i.length;o++){i[o].compare(t)>0&&(c=!0);var a=s[2*o],f=s[2*o+1],l=u(t.x,t.y,n,h,a,f),v=B(t,l);v<r&&(r=v,e=l),n=a,h=f}return new J(this,e,c?r:-r)},$.prototype.segmentQuery=function(t,i){for(var s=this.tPlanes,n=this.tVerts,h=s.length,r=2*h,e=0;e<h;e++){var c=s[e].n,o=w(t,c);if(!(s[e].d>o)){var u=w(i,c),a=(s[e].d-o)/(u-o);if(!(a<0||1<a)){var f=D(t,i,a),l=-M(c,f),v=-x(c.x,c.y,n[2*e],n[2*e+1]),d=-x(c.x,c.y,n[(2*e+2)%r],n[(2*e+3)%r]);if(v<=l&&l<=d)return new Y(this,a,c)}}}},$.prototype.valueOnAxis=function(t,i){for(var s=this.tVerts,h=_(t.x,t.y,s[0],s[1]),r=2;r<s.length;r+=2)h=n(h,_(t.x,t.y,s[r],s[r+1]));return h-i},$.prototype.containsVert=function(t,i){for(var s=this.tPlanes,n=0;n<s.length;n++){var h=s[n].n;if(_(h.x,h.y,t,i)-s[n].d>0)return!1}return!0},$.prototype.containsVertPartial=function(t,i,s){for(var n=this.tPlanes,h=0;h<n.length;h++){var r=n[h].n;if(!(w(r,s)<0)&&_(r.x,r.y,t,i)-n[h].d>0)return!1}return!0},$.prototype.getNumVerts=function(){return this.verts.length/2},$.prototype.getVert=function(t){return new g(this.verts[2*t],this.verts[2*t+1])};var st=cp.Body=function(t,i){this.p=new g(0,0),this.vx=this.vy=0,this.f=new g(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(i),this.rot=new g(0,0),this.setAngle(0)};if(cp.StaticBody=function(){var t=new st(1/0,1/0);return t.nodeIdleTime=1/0,t},"undefined"!=typeof DEBUG&&DEBUG){var nt=function(t,i){(function(t,i){r(t.x==t.x&&t.y==t.y,i)})(t,i),function(t,i){r(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,i)}(t,i)};st.prototype.sanityCheck=function(){r(this.m==this.m&&this.m_inv==this.m_inv,"Body's mass is invalid."),r(this.i==this.i&&this.i_inv==this.i_inv,"Body's moment is invalid."),nt(this.p,"Body's position is invalid."),nt(this.f,"Body's force is invalid."),r(this.vx==this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),r(this.vy==this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),r(this.a==this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),r(this.w==this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),r(this.t==this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),nt(this.rot,"Body's rotation vector is invalid."),r(this.v_limit==this.v_limit,"Body's velocity limit is invalid."),r(this.w_limit==this.w_limit,"Body's angular velocity limit is invalid.")}}else st.prototype.sanityCheck=function(){};st.prototype.getPos=function(){return this.p},st.prototype.getVel=function(){return new g(this.vx,this.vy)},st.prototype.getAngVel=function(){return this.w},st.prototype.isSleeping=function(){return null!==this.nodeRoot},st.prototype.isStatic=function(){return this.nodeIdleTime===1/0},st.prototype.isRogue=function(){return null===this.space},st.prototype.setMass=function(t){r(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},st.prototype.setMoment=function(t){r(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},st.prototype.addShape=function(t){this.shapeList.push(t)},st.prototype.removeShape=function(t){o(this.shapeList,t)};var ht=function(t,i,s){return t===s?t.next(i):(t.a===i?t.next_a=ht(t.next_a,i,s):t.next_b=ht(t.next_b,i,s),t)};st.prototype.removeConstraint=function(t){this.constraintList=ht(this.constraintList,this,t)},st.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===m&&(t=cp.v(0,0)),this.p=t},st.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},st.prototype.setAngVel=function(t){this.activate(),this.w=t},st.prototype.setAngleInternal=function(t){r(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},st.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},st.prototype.velocity_func=function(t,i,s){var n=this.vx*i+(t.x+this.f.x*this.m_inv)*s,h=this.vy*i+(t.y+this.f.y*this.m_inv)*s,r=this.v_limit,e=n*n+h*h,c=e>r*r?r/Math.sqrt(e):1;this.vx=n*c,this.vy=h*c;var o=this.w_limit;this.w=d(this.w*i+this.t*this.i_inv*s,-o,o),this.sanityCheck()},st.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},st.prototype.resetForces=function(){this.activate(),this.f=new g(0,0),this.t=0},st.prototype.applyForce=function(t,i){this.activate(),this.f=y(this.f,t),this.t+=M(i,t)},st.prototype.applyImpulse=function(t,i){this.activate(),Kt(this,t.x,t.y,i)},st.prototype.getVelAtPoint=function(t){return y(new g(this.vx,this.vy),A(E(t),this.w))},st.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(T(t,this.p))},st.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(P(t,this.rot))},st.prototype.eachShape=function(t){for(var i=0,s=this.shapeList.length;i<s;i++)t(this.shapeList[i])},st.prototype.eachConstraint=function(t){for(var i=this.constraintList;i;){var s=i.next(this);t(i),i=s}},st.prototype.eachArbiter=function(t){for(var i=this.arbiterList;i;){var s=i.next(this);i.swappedColl=this===i.body_b,t(i),i=s}},st.prototype.local2World=function(t){return y(this.p,P(t,this.rot))},st.prototype.world2Local=function(t){return R(T(t,this.p),this.rot)},st.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,i=this.w*this.w;return(t?t*this.m:0)+(i?i*this.i:0)};var rt=cp.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};rt.prototype.collideStatic=function(t,i){if(t.count>0){var s=t.query;this.each(function(t){s(t,new V(t.bb_l,t.bb_b,t.bb_r,t.bb_t),i)})}};var et=cp.BBTree=function(t){rt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};et.prototype=Object.create(rt.prototype);var ct=0,ot=function(t,i,s){this.obj=null,this.bb_l=n(i.bb_l,s.bb_l),this.bb_b=n(i.bb_b,s.bb_b),this.bb_r=h(i.bb_r,s.bb_r),this.bb_t=h(i.bb_t,s.bb_t),this.parent=null,this.setA(i),this.setB(s)};et.prototype.makeNode=function(t,i){var s=this.pooledNodes;return s?(this.pooledNodes=s.parent,s.constructor(this,t,i),s):(ct++,new ot(this,t,i))};var ut=0,at=function(t,i){this.obj=i,t.getBB(i,this),this.parent=null,this.stamp=1,this.pairs=null,ut++};et.prototype.getBB=function(t,i){var s=this.velocityFunc;if(s){var r=.1*(t.bb_r-t.bb_l),e=.1*(t.bb_t-t.bb_b),c=A(s(t),.1);i.bb_l=t.bb_l+n(-r,c.x),i.bb_b=t.bb_b+n(-e,c.y),i.bb_r=t.bb_r+h(r,c.x),i.bb_t=t.bb_t+h(e,c.y)}else i.bb_l=t.bb_l,i.bb_b=t.bb_b,i.bb_r=t.bb_r,i.bb_t=t.bb_t},et.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},et.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var ft=0,lt=function(t,i,s,n){this.prevA=null,this.leafA=t,this.nextA=i,this.prevB=null,this.leafB=s,this.nextB=n};et.prototype.makePair=function(t,i,s,n){var h=this.pooledPairs;return h?(this.pooledPairs=h.prevA,h.prevA=null,h.leafA=t,h.nextA=i,h.prevB=null,h.leafB=s,h.nextB=n,h):(ft++,new lt(t,i,s,n))},lt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var vt=function(t,i,s){s&&(s.leafA===i?s.prevA=t:s.prevB=t),t?t.leafA===i?t.nextA=s:t.nextB=s:i.pairs=s};at.prototype.clearPairs=function(t){var i,s=this.pairs;for(this.pairs=null;s;)s.leafA===this?(i=s.nextA,vt(s.prevB,s.leafB,s.nextB)):(i=s.nextB,vt(s.prevA,s.leafA,s.nextA)),s.recycle(t),s=i};var dt=function(t,i,s){var n=t.pairs,h=i.pairs,r=s.makePair(t,n,i,h);t.pairs=i.pairs=r,n&&(n.leafA===t?n.prevA=r:n.prevB=r),h&&(h.leafA===i?h.prevA=r:h.prevB=r)};ot.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},at.prototype.recycle=function(t){},ot.prototype.setA=function(t){this.A=t,t.parent=this},ot.prototype.setB=function(t){this.B=t,t.parent=this},at.prototype.isLeaf=!0,ot.prototype.isLeaf=!1,ot.prototype.otherChild=function(t){return this.A==t?this.B:this.A},ot.prototype.replaceChild=function(t,i,s){e(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(s),this.setA(i)):(this.B.recycle(s),this.setB(i));for(var r=this;r;r=r.parent){var c=r.A,o=r.B;r.bb_l=n(c.bb_l,o.bb_l),r.bb_b=n(c.bb_b,o.bb_b),r.bb_r=h(c.bb_r,o.bb_r),r.bb_t=h(c.bb_t,o.bb_t)}},ot.prototype.bbArea=at.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var pt=function(t,i){return(h(t.bb_r,i.bb_r)-n(t.bb_l,i.bb_l))*(h(t.bb_t,i.bb_t)-n(t.bb_b,i.bb_b))},gt=function(t,i){return Math.abs(t.bb_l+t.bb_r-i.bb_l-i.bb_r)+Math.abs(t.bb_b+t.bb_t-i.bb_b-i.bb_t)},mt=function(t,i,s){if(null==t)return i;if(t.isLeaf)return s.makeNode(i,t);var r=t.B.bbArea()+pt(t.A,i),e=t.A.bbArea()+pt(t.B,i);return r===e&&(r=gt(t.A,i),e=gt(t.B,i)),e<r?t.setB(mt(t.B,i,s)):t.setA(mt(t.A,i,s)),t.bb_l=n(t.bb_l,i.bb_l),t.bb_b=n(t.bb_b,i.bb_b),t.bb_r=h(t.bb_r,i.bb_r),t.bb_t=h(t.bb_t,i.bb_t),t};ot.prototype.intersectsBB=at.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var wt=function(t,i,s){t.intersectsBB(i)&&(t.isLeaf?s(t.obj):(wt(t.A,i,s),wt(t.B,i,s)))},_t=function(t,i,s){var r=1/(s.x-i.x),e=t.bb_l==i.x?-1/0:(t.bb_l-i.x)*r,c=t.bb_r==i.x?1/0:(t.bb_r-i.x)*r,o=n(e,c),u=h(e,c),a=1/(s.y-i.y),f=t.bb_b==i.y?-1/0:(t.bb_b-i.y)*a,l=t.bb_t==i.y?1/0:(t.bb_t-i.y)*a,v=n(f,l),d=h(f,l);if(v<=u&&o<=d){var p=h(o,v);if(0<=n(u,d)&&p<=1)return h(p,0)}return 1/0},Ct=function(t,i,s,h,r){if(t.isLeaf)return r(t.obj);var e=_t(t.A,i,s),c=_t(t.B,i,s);return e<c?(e<h&&(h=n(h,Ct(t.A,i,s,h,r))),c<h&&(h=n(h,Ct(t.B,i,s,h,r)))):(c<h&&(h=n(h,Ct(t.B,i,s,h,r))),e<h&&(h=n(h,Ct(t.A,i,s,h,r)))),h};et.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var bt=function(t,i,s){if(i==t)return null;var n=i.parent;if(n==t){var h=t.otherChild(i);return h.parent=t.parent,t.recycle(s),h}return n.parent.replaceChild(n,n.otherChild(i),s),t},yt=function(t,i){return t.bb_l<=i.bb_r&&i.bb_l<=t.bb_r&&t.bb_b<=i.bb_t&&i.bb_b<=t.bb_t};at.prototype.markLeafQuery=function(t,i,s,n){yt(t,this)&&(i?dt(t,this,s):(this.stamp<t.stamp&&dt(this,t,s),n&&n(t.obj,this.obj)))},ot.prototype.markLeafQuery=function(t,i,s,n){yt(t,this)&&(this.A.markLeafQuery(t,i,s,n),this.B.markLeafQuery(t,i,s,n))},at.prototype.markSubtree=function(t,i,s){if(this.stamp==t.getStamp()){i&&i.markLeafQuery(this,!1,t,s);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,s):n.parent.A.markLeafQuery(this,!1,t,s)}else for(var h=this.pairs;h;)this===h.leafB?(s&&s(h.leafA.obj,this.obj),h=h.nextB):h=h.nextA},ot.prototype.markSubtree=function(t,i,s){this.A.markSubtree(t,i,s),this.B.markSubtree(t,i,s)},at.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},at.prototype.update=function(t){var i=t.root,s=this.obj;return!this.containsObj(s)&&(t.getBB(this.obj,this),i=bt(i,this,t),t.root=mt(i,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},at.prototype.addPairs=function(t){var i=t.dynamicIndex;if(i){var s=i.root;s&&s.markLeafQuery(this,!0,i,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},et.prototype.insert=function(t,i){var s=new at(this,t);this.leaves[i]=s,this.root=mt(this.root,s,this),this.count++,s.stamp=this.getStamp(),s.addPairs(this),this.incrementStamp()},et.prototype.remove=function(t,i){var s=this.leaves[i];delete this.leaves[i],this.root=bt(this.root,s,this),this.count--,s.clearPairs(this),s.recycle(this)},et.prototype.contains=function(t,i){return null!=this.leaves[i]};var Tt=function(t,i){};et.prototype.reindexQuery=function(t){if(this.root){var i,s=this.leaves;for(i in s)s[i].update(this);var n=this.staticIndex,h=n&&n.root;this.root.markSubtree(this,h,t),n&&!h&&this.collideStatic(this,n,t),this.incrementStamp()}},et.prototype.reindex=function(){this.reindexQuery(Tt)},et.prototype.reindexObject=function(t,i){var s=this.leaves[i];s&&(s.update(this)&&s.addPairs(this),this.incrementStamp())},et.prototype.pointQuery=function(t,i){this.query(new V(t.x,t.y,t.x,t.y),i)},et.prototype.segmentQuery=function(t,i,s,n){this.root&&Ct(this.root,t,i,s,n)},et.prototype.query=function(t,i){this.root&&wt(this.root,t,i)},et.prototype.count=function(){return this.count},et.prototype.each=function(t){var i;for(i in this.leaves)t(this.leaves[i].obj)};var St=function(t,i,s,r,e){return(h(t.bb_r,r)-n(t.bb_l,i))*(h(t.bb_t,e)-n(t.bb_b,s))},At=function(t,i,s,r){if(1==r)return i[s];if(2==r)return t.makeNode(i[s],i[s+1]);for(var e=(A=i[s]).bb_l,c=A.bb_b,o=A.bb_r,u=A.bb_t,a=s+r,f=s+1;f<a;f++)A=i[f],e=n(e,A.bb_l),c=n(c,A.bb_b),o=h(o,A.bb_r),u=h(u,A.bb_t);var l=o-e>u-c,v=new Array(2*r);if(l)for(f=s;f<a;f++)v[2*f+0]=i[f].bb_l,v[2*f+1]=i[f].bb_r;else for(f=s;f<a;f++)v[2*f+0]=i[f].bb_b,v[2*f+1]=i[f].bb_t;v.sort(function(t,i){return t-i});var d=.5*(v[r-1]+v[r]),p=e,g=c,m=o,w=u,_=e,C=c,b=o,y=u;l?m=_=d:w=C=d;for(var T=a,S=s;S<T;)A=i[S],St(A,_,C,b,y)<St(A,p,g,m,w)?(T--,i[S]=i[T],i[T]=A):S++;if(T==r){var A=null;for(f=s;f<a;f++)A=mt(A,i[f],t);return A}return NodeNew(t,At(t,i,s,T-s),At(t,i,T,a-T))};et.prototype.optimize=function(){var t=new Array(this.count),i=0;for(var s in this.leaves)t[i++]=this.nodes[s];tree.subtreeRecycle(root),this.root=At(tree,t,t.length)};var Mt=function(t,i){!t.isLeaf&&i<=10&&(Mt(t.A,i+1),Mt(t.B,i+1));for(var s="",n=0;n<i;n++)s+=" ";console.log(s+t.bb_b+" "+t.bb_t)};et.prototype.log=function(){this.root&&Mt(this.root,0)};var xt=cp.CollisionHandler=function(){this.a=this.b=0};xt.prototype.begin=function(t,i){return!0},xt.prototype.preSolve=function(t,i){return!0},xt.prototype.postSolve=function(t,i){},xt.prototype.separate=function(t,i){};var Et=function(t,i){this.e=0,this.u=0,this.surface_vr=m,this.a=t,this.body_a=t.body,this.b=i,this.body_b=i.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Et.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Et.prototype.totalImpulse=function(){for(var t=this.contacts,i=new g(0,0),s=0,n=t.length;s<n;s++){var h=t[s];i.add(A(h.n,h.jnAcc))}return this.swappedColl?i:i.neg()},Et.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,i=new g(0,0),s=0,n=t.length;s<n;s++){var h=t[s];i.add(new g(h.jnAcc,h.jtAcc).rotate(h.n))}return this.swappedColl?i:i.neg()},Et.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),i=0,s=this.contacts,n=0,h=s.length;n<h;n++){var r=s[n],e=r.jnAcc,c=r.jtAcc;i+=t*e*e/r.nMass+c*c/r.tMass}return i},Et.prototype.ignore=function(){this.state="ignore"},Et.prototype.getA=function(){return this.swappedColl?this.b:this.a},Et.prototype.getB=function(){return this.swappedColl?this.a:this.b},Et.prototype.isFirstContact=function(){return"first coll"===this.state};var Ot=function(t,i,s){this.point=t,this.normal=i,this.dist=s};Et.prototype.getContactPointSet=function(){var t,i=new Array(this.contacts.length);for(t=0;t<i.length;t++)i[t]=new Ot(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return i},Et.prototype.getNormal=function(t){var i=this.contacts[t].n;return this.swappedColl?S(i):i},Et.prototype.getPoint=function(t){return this.contacts[t].p},Et.prototype.getDepth=function(t){return this.contacts[t].dist};var Pt=function(t,i,s,n){s?s.body_a===i?s.thread_a_next=n:s.thread_b_next=n:i.arbiterList=n,n&&(n.body_a===i?n.thread_a_prev=s:n.thread_b_prev=s)};Et.prototype.unthread=function(){Pt(0,this.body_a,this.thread_a_prev,this.thread_a_next),Pt(0,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Et.prototype.update=function(t,i,s,n){if(this.contacts)for(var h=0;h<this.contacts.length;h++)for(var r=this.contacts[h],e=0;e<t.length;e++){var c=t[e];c.hash===r.hash&&(c.jnAcc=r.jnAcc,c.jtAcc=r.jtAcc)}this.contacts=t,this.handler=i,this.swappedColl=s.collision_type!==i.a,this.e=s.e*n.e,this.u=s.u*n.u,this.surface_vr=T(s.surface_v,n.surface_v),this.a=s,this.body_a=s.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Et.prototype.preStep=function(t,i,s){for(var h=this.body_a,r=this.body_b,e=0;e<this.contacts.length;e++){var c=this.contacts[e];c.r1=T(c.p,h.p),c.r2=T(c.p,r.p),c.nMass=1/si(h,r,c.r1,c.r2,c.n),c.tMass=1/si(h,r,c.r1,c.r2,E(c.n)),c.bias=-s*n(0,c.dist+i)/t,c.jBias=0,c.bounce=Qt(h,r,c.r1,c.r2,c.n)*this.e}},Et.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var i=this.body_a,s=this.body_b,n=0;n<this.contacts.length;n++){var h=this.contacts[n],r=h.n.x,e=h.n.y,c=r*h.jnAcc-e*h.jtAcc,o=r*h.jtAcc+e*h.jnAcc;$t(i,s,h.r1,h.r2,c*t,o*t)}};var Rt=0,It=0;Et.prototype.applyImpulse=function(){Rt++;for(var t=this.body_a,i=this.body_b,s=this.surface_vr,n=this.u,r=0;r<this.contacts.length;r++){It++;var e=this.contacts[r],c=e.nMass,o=e.n,u=e.r1,a=e.r2,f=i.vx-a.y*i.w-(t.vx-u.y*t.w),l=i.vy+a.x*i.w-(t.vy+u.x*t.w),v=o.x*(i.v_biasx-a.y*i.w_bias-t.v_biasx+u.y*t.w_bias)+o.y*(a.x*i.w_bias+i.v_biasy-u.x*t.w_bias-t.v_biasy),p=_(f,l,o.x,o.y),g=_(f+s.x,l+s.y,-o.y,o.x),m=(e.bias-v)*c,w=e.jBias;e.jBias=h(w+m,0);var C=-(e.bounce+p)*c,b=e.jnAcc;e.jnAcc=h(b+C,0);var y=n*e.jnAcc,T=-g*e.tMass,S=e.jtAcc;e.jtAcc=d(S+T,-y,y);var A=o.x*(e.jBias-w),M=o.y*(e.jBias-w);ti(t,-A,-M,u),ti(i,A,M,a);var x=e.jnAcc-b,E=e.jtAcc-S;$t(t,i,u,a,o.x*x-o.y*E,o.x*E+o.y*x)}},Et.prototype.callSeparate=function(t){t.lookupHandler(this.a.collision_type,this.b.collision_type).separate(this,t)},Et.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Lt=0,Dt=function(t,i,s,n){this.p=t,this.n=i,this.dist=s,this.r1=this.r2=m,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Lt++},Ft=[],Nt=function(t,i,s,n){var h=s+n,r=T(i,t),e=I(r);if(!(e>=h*h)){var c=Math.sqrt(e);return new Dt(y(t,A(r,.5+(s-.5*h)/(c||1/0))),c?A(r,1/c):new g(1,0),c-h,0)}},kt=0,Bt=function(t,i){var s=0,n=t.valueOnAxis(i[0].n,i[0].d);if(n>0)return-1;for(var h=1;h<i.length;h++){var r=t.valueOnAxis(i[h].n,i[h].d);if(r>0)return-1;r>n&&(n=r,s=h)}return kt=n,s},Gt=function(t,i,s,n){for(var h=[],r=t.tVerts,e=0;e<r.length;e+=2){var o=r[e],u=r[e+1];i.containsVert(o,u)&&h.push(new Dt(new g(o,u),s,n,c(t.hashid,e>>1)))}var a=i.tVerts;for(e=0;e<a.length;e+=2)o=a[e],u=a[e+1],t.containsVert(o,u)&&h.push(new Dt(new g(o,u),s,n,c(i.hashid,e>>1)));return h.length?h:function(t,i,s,n){for(var h=[],r=t.tVerts,e=0;e<r.length;e+=2){var o=r[e],u=r[e+1];i.containsVertPartial(o,u,S(s))&&h.push(new Dt(new g(o,u),s,n,c(t.hashid,e)))}var a=i.tVerts;for(e=0;e<a.length;e+=2)o=a[e],u=a[e+1],t.containsVertPartial(o,u,s)&&h.push(new Dt(new g(o,u),s,n,c(i.hashid,e)));return h}(t,i,s,n)},zt=function(t,i,s){var h=w(i,t.ta)-t.r,r=w(i,t.tb)-t.r;return n(h,r)-s},jt=function(t,i,s,n,h){for(var r=M(i.tn,i.ta),e=M(i.tn,i.tb),o=A(i.tn,h),u=s.tVerts,a=0;a<u.length;a+=2){var f=u[a],l=u[a+1];if(_(f,l,o.x,o.y)<w(i.tn,i.ta)*h+i.r){var v=x(i.tn.x,i.tn.y,f,l);r>=v&&v>=e&&t.push(new Dt(new g(f,l),o,n,c(s.hashid,a)))}}};q.prototype.collisionCode=0,Q.prototype.collisionCode=1,$.prototype.collisionCode=2,q.prototype.collisionTable=[function(t,i){var s=Nt(t.tc,i.tc,t.r,i.r);return s?[s]:Ft},function(t,i){var s=i.ta,n=i.tb,h=t.tc,r=T(n,s),e=p(w(r,T(h,s))/I(r)),c=y(s,A(r,e)),o=Nt(h,c,t.r,i.r);if(o){var u=o.n;return 0===e&&w(u,i.a_tangent)<0||1===e&&w(u,i.b_tangent)<0?Ft:[o]}return Ft},function(t,i){for(var s=i.tPlanes,n=0,h=w(s[0].n,t.tc)-s[0].d-t.r,r=0;r<s.length;r++){var e=w(s[r].n,t.tc)-s[r].d-t.r;if(e>0)return Ft;e>h&&(h=e,n=r)}var c=s[n].n,o=i.tVerts,u=o.length,a=n<<1,f=o[a],l=o[a+1],v=o[(a+2)%u],d=o[(a+3)%u],p=x(c.x,c.y,f,l),m=x(c.x,c.y,v,d),_=M(c,t.tc);if(_<m)return(C=Nt(t.tc,new g(v,d),t.r,0))?[C]:Ft;if(_<p)return[new Dt(T(t.tc,A(c,t.r+h/2)),S(c),h,0)];var C=Nt(t.tc,new g(f,l),t.r,0);return C?[C]:Ft}],Q.prototype.collisionTable=[null,function(t,i){return Ft},function(t,i){var s=[],n=i.tPlanes,h=n.length,r=w(t.tn,t.ta),e=i.valueOnAxis(t.tn,r)-t.r,o=i.valueOnAxis(S(t.tn),-r)-t.r;if(o>0||e>0)return Ft;var u=0,a=zt(t,n[0].n,n[0].d);if(a>0)return Ft;for(var f=0;f<h;f++){var l=zt(t,n[f].n,n[f].d);if(l>0)return Ft;l>a&&(a=l,u=f)}var v=S(n[u].n),d=y(t.ta,A(v,t.r)),p=y(t.tb,A(v,t.r));if(i.containsVert(d.x,d.y)&&s.push(new Dt(d,v,a,c(t.hashid,0))),i.containsVert(p.x,p.y)&&s.push(new Dt(p,v,a,c(t.hashid,1))),(e>=a||o>=a)&&(e>o?jt(s,t,i,e,1):jt(s,t,i,o,-1)),0===s.length){var m,_=2*u,C=i.tVerts,b=new g(C[_],C[_+1]);if(m=Nt(t.ta,b,t.r,0))return[m];if(m=Nt(t.tb,b,t.r,0))return[m];var T=2*h,M=new g(C[(_+2)%T],C[(_+3)%T]);if(m=Nt(t.ta,M,t.r,0))return[m];if(m=Nt(t.tb,M,t.r,0))return[m]}return s}],$.prototype.collisionTable=[null,null,function(t,i){var s=Bt(i,t.tPlanes);if(-1==s)return Ft;var n=kt,h=Bt(t,i.tPlanes);if(-1==h)return Ft;var r=kt;return n>r?Gt(t,i,t.tPlanes[s].n,n):Gt(t,i,S(i.tPlanes[h].n),r)}];var Vt=cp.collideShapes=function(t,i){return r(t.collisionCode<=i.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[i.collisionCode](t,i)},Ut=new xt,Wt=cp.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new et(null),this.activeShapes=new et(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=Ut,this.postStepCallbacks=[],this.iterations=10,this.gravity=m,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new st(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};Wt.prototype.getCurrentTimeStep=function(){return this.curr_dt},Wt.prototype.setIterations=function(t){this.iterations=t},Wt.prototype.isLocked=function(){return this.locked};var Ht=function(t){r(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};Wt.prototype.addCollisionHandler=function(t,i,s,n,h,r){Ht(this),this.removeCollisionHandler(t,i);var e=new xt;e.a=t,e.b=i,s&&(e.begin=s),n&&(e.preSolve=n),h&&(e.postSolve=h),r&&(e.separate=r),this.collisionHandlers[c(t,i)]=e},Wt.prototype.removeCollisionHandler=function(t,i){Ht(this),delete this.collisionHandlers[c(t,i)]},Wt.prototype.setDefaultCollisionHandler=function(t,i,s,n){Ht(this);var h=new xt;t&&(h.begin=t),i&&(h.preSolve=i),s&&(h.postSolve=s),n&&(h.separate=n),this.defaultHandler=h},Wt.prototype.lookupHandler=function(t,i){return this.collisionHandlers[c(t,i)]||this.defaultHandler},Wt.prototype.addShape=function(t){var i=t.body;return i.isStatic()?this.addStaticShape(t):(r(!t.space,"This shape is already added to a space and cannot be added to another."),Ht(this),i.activate(),i.addShape(t),t.update(i.p,i.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},Wt.prototype.addStaticShape=function(t){r(!t.space,"This shape is already added to a space and cannot be added to another."),Ht(this);var i=t.body;return i.addShape(t),t.update(i.p,i.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},Wt.prototype.addBody=function(t){return r(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),r(!t.space,"This body is already added to a space and cannot be added to another."),Ht(this),this.bodies.push(t),t.space=this,t},Wt.prototype.addConstraint=function(t){r(!t.space,"This shape is already added to a space and cannot be added to another."),Ht(this);var i=t.a,s=t.b;return i.activate(),s.activate(),this.constraints.push(t),t.next_a=i.constraintList,i.constraintList=t,t.next_b=s.constraintList,s.constraintList=t,t.space=this,t},Wt.prototype.filterArbiters=function(t,i){for(var s in this.cachedArbiters){var n=this.cachedArbiters[s];(t!==n.body_a||i!==n.a&&null!==i)&&(t!==n.body_b||i!==n.b&&null!==i)||(i&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),o(this.arbiters,n),delete this.cachedArbiters[s])}},Wt.prototype.removeShape=function(t){var i=t.body;i.isStatic()?this.removeStaticShape(t):(r(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),Ht(this),i.activate(),i.removeShape(t),this.filterArbiters(i,t),this.activeShapes.remove(t,t.hashid),t.space=null)},Wt.prototype.removeStaticShape=function(t){r(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),Ht(this);var i=t.body;i.isStatic()&&i.activateStatic(t),i.removeShape(t),this.filterArbiters(i,t),this.staticShapes.remove(t,t.hashid),t.space=null},Wt.prototype.removeBody=function(t){r(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),Ht(this),t.activate(),o(this.bodies,t),t.space=null},Wt.prototype.removeConstraint=function(t){r(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),Ht(this),t.a.activate(),t.b.activate(),o(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},Wt.prototype.containsShape=function(t){return t.space===this},Wt.prototype.containsBody=function(t){return t.space==this},Wt.prototype.containsConstraint=function(t){return t.space==this},Wt.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[c(t.a.hashid,t.b.hashid)],o(this.arbiters,t)},Wt.prototype.eachBody=function(t){this.lock();for(var i=this.bodies,s=0;s<i.length;s++)t(i[s]);var n=this.sleepingComponents;for(s=0;s<n.length;s++)for(var h=n[s];h;){var r=h.nodeNext;t(h),h=r}this.unlock(!0)},Wt.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},Wt.prototype.eachConstraint=function(t){this.lock();for(var i=this.constraints,s=0;s<i.length;s++)t(i[s]);this.unlock(!0)},Wt.prototype.reindexStatic=function(){r(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var i=t.body;t.update(i.p,i.rot)}),this.staticShapes.reindex()},Wt.prototype.reindexShape=function(t){r(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var i=t.body;t.update(i.p,i.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},Wt.prototype.reindexShapesForBody=function(t){for(var i=t.shapeList;i;i=i.next)this.reindexShape(i)},Wt.prototype.useSpatialHash=function(t,i){throw new Error("Spatial Hash not implemented.")},Wt.prototype.activateBody=function(t){if(r(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)-1===this.rousedBodies.indexOf(t)&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var i=0;i<t.shapeList.length;i++){var s=t.shapeList[i];this.staticShapes.remove(s,s.hashid),this.activeShapes.insert(s,s.hashid)}for(var n=t.arbiterList;n;n=n.next(t))if(t===(u=n.body_a)||u.isStatic()){var h=n.a,e=n.b;this.cachedArbiters[c(h.hashid,e.hashid)]=n,n.stamp=this.stamp,n.handler=this.lookupHandler(h.collision_type,e.collision_type),this.arbiters.push(n)}for(var o=t.constraintList;o;o=o.nodeNext){var u=o.a;(t===u||u.isStatic())&&this.constraints.push(o)}}},Wt.prototype.deactivateBody=function(t){r(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),o(this.bodies,t);for(var i=0;i<t.shapeList.length;i++){var s=t.shapeList[i];this.activeShapes.remove(s,s.hashid),this.staticShapes.insert(s,s.hashid)}for(var n=t.arbiterList;n;n=n.next(t))(t===(e=n.body_a)||e.isStatic())&&this.uncacheArbiter(n);for(var h=t.constraintList;h;h=h.nodeNext){var e=h.a;(t===e||e.isStatic())&&o(this.constraints,h)}};var Xt=function(t){return t?t.nodeRoot:null};st.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,function(t){if(t&&t.isSleeping(t)){r(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var i=t.space,s=t;s;){var n=s.nodeNext;s.nodeIdleTime=0,s.nodeRoot=null,s.nodeNext=null,i.activateBody(s),s=n}o(i.sleepingComponents,t)}}(Xt(this)))},st.prototype.activateStatic=function(t){r(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var i=this.arbiterList;i;i=i.next(this))t&&t!=i.a&&t!=i.b||(i.body_a==this?i.body_b:i.body_a).activate()},st.prototype.pushArbiter=function(t){e(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),e(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var i=this.arbiterList;e(null===i||null===(i.body_a===this?i.thread_a_prev:i.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=i:t.thread_b_next=i,i&&(i.body_a===this?i.thread_a_prev=t:i.thread_b_prev=t),this.arbiterList=t};var Jt=function(t,i){if(!i.isRogue()){var s=Xt(i);if(null==s){!function(t,i){i.nodeRoot=t,i!==t&&(i.nodeNext=t.nodeNext,t.nodeNext=i)}(t,i);for(var n=i.arbiterList;n;n=n.next(i))Jt(t,i==n.body_a?n.body_b:n.body_a);for(var h=i.constraintList;h;h=h.next(i))Jt(t,i==h.a?h.b:h.a)}else e(s===t,"Internal Error: Inconsistency detected in the contact graph.")}},Yt=function(t,i){for(var s=t;s;s=s.nodeNext)if(s.nodeIdleTime<i)return!0;return!1};Wt.prototype.processComponents=function(t){for(var i=this.sleepTimeThreshold!==1/0,s=this.bodies,n=0;n<s.length;n++)c=s[n],e(null===c.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),e(null===c.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.");if(i){var h=this.idleSpeedThreshold,r=h?h*h:I(this.gravity)*t*t;for(n=0;n<s.length;n++){var c=s[n],o=r?c.m*r:0;c.nodeIdleTime=c.kineticEnergy()>o?0:c.nodeIdleTime+t}}for(var u=this.arbiters,a=(n=0,u.length);n<a;n++){var f=u[n],l=f.body_a,v=f.body_b;i&&((v.isRogue()&&!v.isStatic()||l.isSleeping())&&l.activate(),(l.isRogue()&&!l.isStatic()||v.isSleeping())&&v.activate()),l.pushArbiter(f),v.pushArbiter(f)}if(i){var d=this.constraints;for(n=0;n<d.length;n++){var p=d[n];l=p.a,(v=p.b).isRogue()&&!v.isStatic()&&l.activate(),l.isRogue()&&!l.isStatic()&&v.activate()}for(n=0;n<s.length;)if(c=s[n],null!==Xt(c)||(Jt(c,c),Yt(c,this.sleepTimeThreshold)))n++,c.nodeRoot=null,c.nodeNext=null;else{this.sleepingComponents.push(c);for(var g=c;g;g=g.nodeNext)this.deactivateBody(g)}}},st.prototype.sleep=function(){this.sleepWithGroup(null)},st.prototype.sleepWithGroup=function(t){r(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var i=this.space;if(r(i,"Cannot put a rogue body to sleep."),r(!i.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),r(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())r(Xt(this)===Xt(t),"The body is already sleeping and it's group cannot be reassigned.");else{for(var s=0;s<this.shapeList.length;s++)this.shapeList[s].update(this.p,this.rot);if(i.deactivateBody(this),t){var n=Xt(t);this.nodeRoot=n,this.nodeNext=n.nodeNext,this.nodeIdleTime=0,n.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,i.sleepingComponents.push(this);o(i.bodies,this)}},Wt.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,i){t.body.activate()})},Wt.prototype.pointQuery=function(t,i,s,n){var h=function(h){(!h.group||s!==h.group)&&i&h.layers&&h.pointQuery(t)&&n(h)},r=new V(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(r,h),this.staticShapes.query(r,h),this.unlock(!0)},Wt.prototype.pointQueryFirst=function(t,i,s){var n=null;return this.pointQuery(t,i,s,function(t){t.sensor||(n=t)}),n},Wt.prototype.nearestPointQuery=function(t,i,s,n,h){var r=function(r){if((!r.group||n!==r.group)&&s&r.layers){var e=r.nearestPointQuery(t);e.d<i&&h(r,e.d,e.p)}},e=U(t,i);this.lock(),this.activeShapes.query(e,r),this.staticShapes.query(e,r),this.unlock(!0)},Wt.prototype.nearestPointQueryNearest=function(t,i,s,n){var h,r=function(r){if((!r.group||n!==r.group)&&s&r.layers&&!r.sensor){var e=r.nearestPointQuery(t);e.d<i&&(!h||e.d<h.d)&&(h=e)}},e=U(t,i);return this.activeShapes.query(e,r),this.staticShapes.query(e,r),h},Wt.prototype.segmentQuery=function(t,i,s,n,h){var r=function(r){var e;return(!r.group||n!==r.group)&&s&r.layers&&(e=r.segmentQuery(t,i))&&h(r,e.t,e.n),1};this.lock(),this.staticShapes.segmentQuery(t,i,1,r),this.activeShapes.segmentQuery(t,i,1,r),this.unlock(!0)},Wt.prototype.segmentQueryFirst=function(t,i,s,n){var h=null,r=function(r){var e;return(!r.group||n!==r.group)&&s&r.layers&&!r.sensor&&(e=r.segmentQuery(t,i))&&(null===h||e.t<h.t)&&(h=e),h?h.t:1};return this.staticShapes.segmentQuery(t,i,1,r),this.activeShapes.segmentQuery(t,i,h?h.t:1,r),h},Wt.prototype.bbQuery=function(t,i,s,n){var h=function(h){(!h.group||s!==h.group)&&i&h.layers&&function(t,i,s,n,h){return t.l<=n&&i<=t.r&&t.b<=h&&s<=t.t}(t,h.bb_l,h.bb_b,h.bb_r,h.bb_t)&&n(h)};this.lock(),this.activeShapes.query(t,h),this.staticShapes.query(t,h),this.unlock(!0)},Wt.prototype.shapeQuery=function(t,i){var s=t.body;s&&t.update(s.p,s.rot);var n=new V(t.bb_l,t.bb_b,t.bb_r,t.bb_t),h=!1,r=function(s){var n=t;if((!n.group||n.group!==s.group)&&n.layers&s.layers&&n!==s){var r;if(n.collisionCode<=s.collisionCode)r=Vt(n,s);else for(r=Vt(s,n),c=0;c<r.length;c++)r[c].n=S(r[c].n);if(r.length&&(h=!(n.sensor||s.sensor),i)){for(var e=new Array(r.length),c=0;c<r.length;c++)e[c]=new Ot(r[c].p,r[c].n,r[c].dist);i(s,e)}}};return this.lock(),this.activeShapes.query(n,r),this.staticShapes.query(n,r),this.unlock(!0),h},Wt.prototype.addPostStepCallback=function(t){e(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},Wt.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},Wt.prototype.lock=function(){this.locked++},Wt.prototype.unlock=function(t){if(this.locked--,r(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var i=this.rousedBodies,s=0;s<i.length;s++)this.activateBody(i[s]);i.length=0,this.runPostStepCallbacks()}},Wt.prototype.makeCollideShapes=function(){var t=this;return function(i,s){var n=t;if(i.bb_l<=s.bb_r&&s.bb_l<=i.bb_r&&i.bb_b<=s.bb_t&&s.bb_b<=i.bb_t&&i.body!==s.body&&(!i.group||i.group!==s.group)&&i.layers&s.layers){var h=n.lookupHandler(i.collision_type,s.collision_type),r=i.sensor||s.sensor;if(!r||h!==Ut){if(i.collisionCode>s.collisionCode){var e=i;i=s,s=e}var o=Vt(i,s);if(0!==o.length){var u=c(i.hashid,s.hashid),a=n.cachedArbiters[u];a||(a=n.cachedArbiters[u]=new Et(i,s)),a.update(o,h,i,s),"first coll"!=a.state||h.begin(a,n)||a.ignore(),"ignore"!==a.state&&h.preSolve(a,n)&&!r?n.arbiters.push(a):(a.contacts=null,"ignore"!==a.state&&(a.state="normal")),a.stamp=n.stamp}}}}},Wt.prototype.arbiterSetFilter=function(t){var i=this.stamp-t.stamp,s=t.body_a,n=t.body_b;return!((!s.isStatic()&&!s.isSleeping()||!n.isStatic()&&!n.isSleeping())&&(i>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),i>=this.collisionPersistence&&(t.contacts=null,1)))};var qt=function(t){var i=t.body;t.update(i.p,i.rot)};Wt.prototype.step=function(t){if(0!==t){r(0===m.x&&0===m.y,"vzero is invalid"),this.stamp++;var i=this.curr_dt;this.curr_dt=t;var s,n,h,e=this.bodies,c=this.constraints,o=this.arbiters;for(s=0;s<o.length;s++){var u=o[s];u.state="normal",u.body_a.isSleeping()||u.body_b.isSleeping()||u.unthread()}for(o.length=0,this.lock(),s=0;s<e.length;s++)e[s].position_func(t);this.activeShapes.each(qt),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(h in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[h])||delete this.cachedArbiters[h];var a=this.collisionSlop,f=1-Math.pow(this.collisionBias,t);for(s=0;s<o.length;s++)o[s].preStep(t,a,f);for(s=0;s<c.length;s++){var l=c[s];l.preSolve(this),l.preStep(t)}var v=Math.pow(this.damping,t),d=this.gravity;for(s=0;s<e.length;s++)e[s].velocity_func(d,v,t);var p=0===i?0:t/i;for(s=0;s<o.length;s++)o[s].applyCachedImpulse(p);for(s=0;s<c.length;s++)c[s].applyCachedImpulse(p);for(s=0;s<this.iterations;s++){for(n=0;n<o.length;n++)o[n].applyImpulse();for(n=0;n<c.length;n++)c[n].applyImpulse()}for(s=0;s<c.length;s++)c[s].postSolve(this);for(s=0;s<o.length;s++)o[s].handler.postSolve(o[s],this);this.unlock(!0)}};var Zt=function(t,i,s,n){var h=t.vx+-s.y*t.w,r=t.vy+s.x*t.w,e=i.vx+-n.y*i.w,c=i.vy+n.x*i.w;return new g(e-h,c-r)},Qt=function(t,i,s,n,h){var r=t.vx+-s.y*t.w,e=t.vy+s.x*t.w,c=i.vx+-n.y*i.w,o=i.vy+n.x*i.w;return _(c-r,o-e,h.x,h.y)},Kt=function(t,i,s,n){t.vx+=i*t.m_inv,t.vy+=s*t.m_inv,t.w+=t.i_inv*(n.x*s-n.y*i)},$t=function(t,i,s,n,h,r){Kt(t,-h,-r,s),Kt(i,h,r,n)},ti=function(t,i,s,n){t.v_biasx+=i*t.m_inv,t.v_biasy+=s*t.m_inv,t.w_bias+=t.i_inv*x(n.x,n.y,i,s)},ii=function(t,i,s){var n=M(i,s);return t.m_inv+t.i_inv*n*n},si=function(t,i,s,n,h){var r=ii(t,s,h)+ii(i,n,h);return e(0!==r,"Unsolvable collision or constraint."),r},ni=function(t,i,s,n,h,r){var c,o,u,a,f=t.m_inv+i.m_inv;c=f,o=0,u=0,a=f;var l=t.i_inv,v=s.x*s.x*l,d=s.y*s.y*l,p=-s.x*s.y*l;c+=d,o+=p,u+=p,a+=v;var g=i.i_inv,m=n.x*n.x*g,w=n.y*n.y*g,_=-n.x*n.y*g,C=(c+=w)*(a+=m)-(o+=_)*(u+=_);e(0!==C,"Unsolvable constraint.");var b=1/C;h.x=a*b,h.y=-o*b,r.x=-u*b,r.y=c*b},hi=function(t,i,s){return new g(w(t,i),w(t,s))},ri=function(t,i){return 1-Math.pow(t,i)},ei=cp.Constraint=function(t,i){this.a=t,this.b=i,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};ei.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},ei.prototype.preStep=function(t){},ei.prototype.applyCachedImpulse=function(t){},ei.prototype.applyImpulse=function(){},ei.prototype.getImpulse=function(){return 0},ei.prototype.preSolve=function(t){},ei.prototype.postSolve=function(t){},ei.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var ci=cp.PinJoint=function(t,i,s,n){ei.call(this,t,i),this.anchr1=s,this.anchr2=n;var h=t?y(t.p,P(s,t.rot)):s,r=i?y(i.p,P(n,i.rot)):n;this.dist=C(T(r,h)),e(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};ci.prototype=Object.create(ei.prototype),ci.prototype.preStep=function(t){var i=this.a,s=this.b;this.r1=P(this.anchr1,i.rot),this.r2=P(this.anchr2,s.rot);var n=T(y(s.p,this.r2),y(i.p,this.r1)),h=C(n);this.n=A(n,1/(h||1/0)),this.nMass=1/si(i,s,this.r1,this.r2,this.n);var r=this.maxBias;this.bias=d(-ri(this.errorBias,t)*(h-this.dist)/t,-r,r),this.jnMax=this.maxForce*t},ci.prototype.applyCachedImpulse=function(t){var i=A(this.n,this.jnAcc*t);$t(this.a,this.b,this.r1,this.r2,i.x,i.y)},ci.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=this.n,n=Qt(t,i,this.r1,this.r2,s),h=(this.bias-n)*this.nMass,r=this.jnAcc;this.jnAcc=d(r+h,-this.jnMax,this.jnMax),h=this.jnAcc-r,$t(t,i,this.r1,this.r2,s.x*h,s.y*h)},ci.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var oi=cp.SlideJoint=function(t,i,s,n,h,r){ei.call(this,t,i),this.anchr1=s,this.anchr2=n,this.min=h,this.max=r,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};oi.prototype=Object.create(ei.prototype),oi.prototype.preStep=function(t){var i=this.a,s=this.b;this.r1=P(this.anchr1,i.rot),this.r2=P(this.anchr2,s.rot);var n=T(y(s.p,this.r2),y(i.p,this.r1)),h=C(n),r=0;h>this.max?(r=h-this.max,this.n=N(n)):h<this.min?(r=this.min-h,this.n=S(N(n))):(this.n=m,this.jnAcc=0),this.nMass=1/si(i,s,this.r1,this.r2,this.n);var e=this.maxBias;this.bias=d(-ri(this.errorBias,t)*r/t,-e,e),this.jnMax=this.maxForce*t},oi.prototype.applyCachedImpulse=function(t){var i=this.jnAcc*t;$t(this.a,this.b,this.r1,this.r2,this.n.x*i,this.n.y*i)},oi.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,i=this.b,s=this.n,n=this.r1,h=this.r2,r=Zt(t,i,n,h),e=w(r,s),c=(this.bias-e)*this.nMass,o=this.jnAcc;this.jnAcc=d(o+c,-this.jnMax,0),c=this.jnAcc-o,$t(t,i,this.r1,this.r2,s.x*c,s.y*c)}},oi.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var ui=cp.PivotJoint=function(t,i,s,n){if(ei.call(this,t,i),void 0===n){var h=s;s=t?t.world2Local(h):h,n=i?i.world2Local(h):h}this.anchr1=s,this.anchr2=n,this.r1=this.r2=m,this.k1=new g(0,0),this.k2=new g(0,0),this.jAcc=m,this.jMaxLen=0,this.bias=m};ui.prototype=Object.create(ei.prototype),ui.prototype.preStep=function(t){var i=this.a,s=this.b;this.r1=P(this.anchr1,i.rot),this.r2=P(this.anchr2,s.rot),ni(i,s,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=T(y(s.p,this.r2),y(i.p,this.r1));this.bias=k(A(n,-ri(this.errorBias,t)/t),this.maxBias)},ui.prototype.applyCachedImpulse=function(t){$t(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},ui.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=this.r1,n=this.r2,h=Zt(t,i,s,n),r=hi(T(this.bias,h),this.k1,this.k2),e=this.jAcc;this.jAcc=k(y(this.jAcc,r),this.jMaxLen),$t(t,i,this.r1,this.r2,this.jAcc.x-e.x,this.jAcc.y-e.y)},ui.prototype.getImpulse=function(){return C(this.jAcc)};var ai=cp.GrooveJoint=function(t,i,s,n,h){ei.call(this,t,i),this.grv_a=s,this.grv_b=n,this.grv_n=E(F(T(n,s))),this.anchr2=h,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new g(0,0),this.k2=new g(0,0),this.jAcc=m,this.jMaxLen=0,this.bias=null};ai.prototype=Object.create(ei.prototype),ai.prototype.preStep=function(t){var i=this.a,s=this.b,n=i.local2World(this.grv_a),h=i.local2World(this.grv_b),r=P(this.grv_n,i.rot),e=w(n,r);this.grv_tn=r,this.r2=P(this.anchr2,s.rot);var c=M(y(s.p,this.r2),r);c<=M(n,r)?(this.clamp=1,this.r1=T(n,i.p)):c>=M(h,r)?(this.clamp=-1,this.r1=T(h,i.p)):(this.clamp=0,this.r1=T(y(A(E(r),-c),A(r,e)),i.p)),ni(i,s,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var o=T(y(s.p,this.r2),y(i.p,this.r1));this.bias=k(A(o,-ri(this.errorBias,t)/t),this.maxBias)},ai.prototype.applyCachedImpulse=function(t){$t(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},ai.prototype.grooveConstrain=function(t){var i=this.grv_tn,s=this.clamp*M(t,i)>0?t:O(t,i);return k(s,this.jMaxLen)},ai.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=this.r1,n=this.r2,h=Zt(t,i,s,n),r=hi(T(this.bias,h),this.k1,this.k2),e=this.jAcc;this.jAcc=this.grooveConstrain(y(e,r)),$t(t,i,this.r1,this.r2,this.jAcc.x-e.x,this.jAcc.y-e.y)},ai.prototype.getImpulse=function(){return C(this.jAcc)},ai.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=E(F(T(this.grv_b,t))),this.activateBodies()},ai.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=E(F(T(t,this.grv_a))),this.activateBodies()};var fi=function(t,i){return(t.restLength-i)*t.stiffness},li=cp.DampedSpring=function(t,i,s,n,h,r,e){ei.call(this,t,i),this.anchr1=s,this.anchr2=n,this.restLength=h,this.stiffness=r,this.damping=e,this.springForceFunc=fi,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};li.prototype=Object.create(ei.prototype),li.prototype.preStep=function(t){var i=this.a,s=this.b;this.r1=P(this.anchr1,i.rot),this.r2=P(this.anchr2,s.rot);var n=T(y(s.p,this.r2),y(i.p,this.r1)),h=C(n);this.n=A(n,1/(h||1/0));var r=si(i,s,this.r1,this.r2,this.n);e(0!==r,"Unsolvable this."),this.nMass=1/r,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*r);var c=this.springForceFunc(this,h);$t(i,s,this.r1,this.r2,this.n.x*c*t,this.n.y*c*t)},li.prototype.applyCachedImpulse=function(t){},li.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=this.n,n=this.r1,h=this.r2,r=Qt(t,i,n,h,s),e=(this.target_vrn-r)*this.v_coef;this.target_vrn=r+e,e*=this.nMass,$t(t,i,this.r1,this.r2,this.n.x*e,this.n.y*e)},li.prototype.getImpulse=function(){return 0};var vi=function(t,i){return(i-t.restAngle)*t.stiffness},di=cp.DampedRotarySpring=function(t,i,s,n,h){ei.call(this,t,i),this.restAngle=s,this.stiffness=n,this.damping=h,this.springTorqueFunc=vi,this.target_wrn=0,this.w_coef=0,this.iSum=0};di.prototype=Object.create(ei.prototype),di.prototype.preStep=function(t){var i=this.a,s=this.b,n=i.i_inv+s.i_inv;e(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0;var h=this.springTorqueFunc(this,i.a-s.a)*t;i.w-=h*i.i_inv,s.w+=h*s.i_inv},di.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=t.w-i.w,n=(this.target_wrn-s)*this.w_coef;this.target_wrn=s+n;var h=n*this.iSum;t.w+=h*t.i_inv,i.w-=h*i.i_inv};var pi=cp.RotaryLimitJoint=function(t,i,s,n){ei.call(this,t,i),this.min=s,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};pi.prototype=Object.create(ei.prototype),pi.prototype.preStep=function(t){var i=this.a,s=this.b,n=s.a-i.a,h=0;n>this.max?h=this.max-n:n<this.min&&(h=this.min-n),this.iSum=1/(1/i.i+1/s.i);var r=this.maxBias;this.bias=d(-ri(this.errorBias,t)*h/t,-r,r),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},pi.prototype.applyCachedImpulse=function(t){var i=this.a,s=this.b,n=this.jAcc*t;i.w-=n*i.i_inv,s.w+=n*s.i_inv},pi.prototype.applyImpulse=function(){if(this.bias){var t=this.a,i=this.b,s=i.w-t.w,n=-(this.bias+s)*this.iSum,h=this.jAcc;this.bias<0?this.jAcc=d(h+n,0,this.jMax):this.jAcc=d(h+n,-this.jMax,0),n=this.jAcc-h,t.w-=n*t.i_inv,i.w+=n*i.i_inv}},pi.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var gi=cp.RatchetJoint=function(t,i,s,n){ei.call(this,t,i),this.angle=0,this.phase=s,this.ratchet=n,this.angle=(i?i.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};gi.prototype=Object.create(ei.prototype),gi.prototype.preStep=function(t){var i=this.a,s=this.b,n=this.angle,h=this.phase,r=this.ratchet,e=s.a-i.a,c=n-e,o=0;c*r>0?o=c:this.angle=Math.floor((e-h)/r)*r+h,this.iSum=1/(i.i_inv+s.i_inv);var u=this.maxBias;this.bias=d(-ri(this.errorBias,t)*o/t,-u,u),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},gi.prototype.applyCachedImpulse=function(t){var i=this.a,s=this.b,n=this.jAcc*t;i.w-=n*i.i_inv,s.w+=n*s.i_inv},gi.prototype.applyImpulse=function(){if(this.bias){var t=this.a,i=this.b,s=i.w-t.w,n=this.ratchet,h=-(this.bias+s)*this.iSum,r=this.jAcc;this.jAcc=d((r+h)*n,0,this.jMax*Math.abs(n))/n,h=this.jAcc-r,t.w-=h*t.i_inv,i.w+=h*i.i_inv}},gi.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var mi=cp.GearJoint=function(t,i,s,n){ei.call(this,t,i),this.phase=s,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};mi.prototype=Object.create(ei.prototype),mi.prototype.preStep=function(t){var i=this.a,s=this.b;this.iSum=1/(i.i_inv*this.ratio_inv+this.ratio*s.i_inv);var n=this.maxBias;this.bias=d(-ri(this.errorBias,t)*(s.a*this.ratio-i.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},mi.prototype.applyCachedImpulse=function(t){var i=this.a,s=this.b,n=this.jAcc*t;i.w-=n*i.i_inv*this.ratio_inv,s.w+=n*s.i_inv},mi.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=i.w*this.ratio-t.w,n=(this.bias-s)*this.iSum,h=this.jAcc;this.jAcc=d(h+n,-this.jMax,this.jMax),n=this.jAcc-h,t.w-=n*t.i_inv*this.ratio_inv,i.w+=n*i.i_inv},mi.prototype.getImpulse=function(){return Math.abs(this.jAcc)},mi.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var wi=cp.SimpleMotor=function(t,i,s){ei.call(this,t,i),this.rate=s,this.jAcc=0,this.iSum=this.jMax=0};wi.prototype=Object.create(ei.prototype),wi.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},wi.prototype.applyCachedImpulse=function(t){var i=this.a,s=this.b,n=this.jAcc*t;i.w-=n*i.i_inv,s.w+=n*s.i_inv},wi.prototype.applyImpulse=function(){var t=this.a,i=this.b,s=-(i.w-t.w+this.rate)*this.iSum,n=this.jAcc;this.jAcc=d(n+s,-this.jMax,this.jMax),s=this.jAcc-n,t.w-=s*t.i_inv,i.w+=s*i.i_inv},wi.prototype.getImpulse=function(){return Math.abs(this.jAcc)}},{}],312:[function(t,i,s){i.exports=function(){"use strict";var t=Math.round(window.devicePixelRatio||1),i=function(t,i){this._color=i||"#666",this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};i.prototype._=function(i,s){var n=i*t,h=s*t;this._canvas.width=n,this._canvas.height=h,this._canvas.style.width=i+"px",this._canvas.style.height=s+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,n,h)};var s=Math.round(window.devicePixelRatio||1),n=function(t){function i(i,s){t.call(this,i,s),this._current=0,this._max=0}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.draw=function(t,i){var n=this._canvas.width,h=this._canvas.height;this._current+=.1*(t-this._current),this._max*=.99,this._current>this._max&&(this._max=this._current);var r=Math.round((1-this._current/this._max)*h);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,s,0,n-s,h,0,0,n-s,h),i?(this._ctx.fillStyle="#444",this._ctx.fillRect(n-s,0,s,h),this._ctx.fillStyle="#b70000",this._ctx.fillRect(n-s,r,s,h-r),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(n-s,r,s,s)):(this._ctx.fillStyle="#444",this._ctx.fillRect(n-s,0,s,h),this._ctx.fillStyle=this._color,this._ctx.fillRect(n-s,r,s,h-r),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(n-s,r,s,s))},i}(i),h=Math.round(window.devicePixelRatio||1),r=function(t){function i(i,s){t.call(this,i,s),this._threshold=0,this._canvas2=document.createElement("canvas"),this._ctx2=this._canvas2.getContext("2d")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._=function(i,s){t.prototype._.call(this,i,s);var n=i*h,r=s*h;this._canvas2.width=n,this._canvas2.height=r,this._canvas2.style.width=i+"px",this._canvas2.style.height=s+"px",this._ctx2.globalAlpha=1,this._ctx2.fillStyle="#444",this._ctx2.fillRect(0,0,n,r)},i.prototype.draw=function(t,i){var s=this._canvas.width,n=this._canvas.height;if(this._ctx.globalAlpha=1,this._ctx2.globalAlpha=1,t>this._threshold){var r=n*((t-t%n)/n+1),e=this._threshold;this._threshold=r;var c=e/r;this._ctx2.drawImage(this._canvas,0,0),this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,s,n),this._ctx.drawImage(this._canvas2,h,0,s-h,n,0,Math.round((1-c)*n),s-h,n)}else this._ctx.drawImage(this._canvas,h,0,s-h,n,0,0,s-h,n);var o=Math.round(n*(1-t/this._threshold));i?(this._ctx.fillStyle="#444",this._ctx.fillRect(s-h,0,h,n),this._ctx.fillStyle="#b70000",this._ctx.fillRect(s-h,o,h,n-o),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(s-h,o,h,h)):(this._ctx.fillStyle="#444",this._ctx.fillRect(s-h,0,h,n),this._ctx.fillStyle=this._color,this._ctx.fillRect(s-h,o,h,n-o),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(s-h,o,h,h))},i}(i),e=Math.round(window.devicePixelRatio||1),c=function(t){function i(i,s,n,h){t.call(this,i,s),this._min=n,this._max=h}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.draw=function(t,i){var s=this._canvas.width,n=this._canvas.height,h=(t-this._min)/(this._max-this._min),r=Math.round((1-h)*n);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,e,0,s-e,n,0,0,s-e,n),i?(this._ctx.fillStyle="#444",this._ctx.fillRect(s-e,0,e,n),this._ctx.fillStyle="#b70000",this._ctx.fillRect(s-e,r,e,n-r),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(s-e,r,e,e)):(this._ctx.fillStyle="#444",this._ctx.fillRect(s-e,0,e,n),this._ctx.fillStyle=this._color,this._ctx.fillRect(s-e,r,e,n-r),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(s-e,r,e,e))},i}(i),o=Math.round(window.devicePixelRatio||1),u=function(t,i){this._colors=i,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};u.prototype._=function(t,i,s){var n=t*o,h=i*o;this._canvas.width=n,this._canvas.height=h*s,this._canvas.style.width=t+"px",this._canvas.style.height=i*s+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,n,h*s)},u.prototype.draw=function(t){var i=this._canvas.width,s=this._canvas.height;this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,o,0,i-o,s,0,0,i-o,s);for(var n=0,h=0;h<t.length;++h){var r=t[h]*s;this._ctx.fillStyle=this._colors[h],this._ctx.fillRect(i-o,n,o,r),n+=r}};var a=function(t,i){this._id=t,this._opts=i||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=window.performance.now()},f={value:{}};a.prototype._average=function(t){if(this._opts.average){this._accumValue+=t,++this._accumSamples;var i=performance.now();i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},f.value.get=function(){return this._value},f.value.set=function(t){this._value=t},a.prototype.sample=function(){this._average(this._value)},a.prototype.human=function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},a.prototype.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},Object.defineProperties(a.prototype,f);var l=function(t){function i(i,s){t.call(this,i,s),this._time=window.performance.now()}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.start=function(){this._time=window.performance.now()},i.prototype.end=function(){this._value=window.performance.now()-this._time,this._average(this._value)},i.prototype.tick=function(){this.end(),this.start()},i.prototype.frame=function(){var t=window.performance.now(),i=t-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=t,this._average(this._value))},i}(a),v=Math.log(1024),d=["Bytes","KB","MB","GB","TB"],p=function(t){function i(i,s,n){t.call(this,s,n),this._stats=i,this._start=0,0===n.extension.indexOf("memory.")&&(this._field=n.extension.substring(7))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.snapshot=function(){this._value=this._stats[this._field]},i.prototype.start=function(){this._start=this._stats[this._field]},i.prototype.end=function(){this._value=this._stats[this._field]-this._start},i.prototype.human=function(){return function(t){var i=Math.floor(Math.log(t)/v);return 0===t?"n/a":Math.round(100*t/Math.pow(1024,i))/100+" "+d[i]}(t.prototype.human.call(this))},i}(a),g=function(){0===window.performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome."),this._used=0,this._total=0,this._lastUsed=0},m={alarm:{},used:{},total:{}};g.prototype.tick=function(){this._lastUsed=this._used,this._used=window.performance.memory.usedJSHeapSize,this._total=window.performance.memory.totalJSHeapSize},m.alarm.get=function(){return this._used-this._lastUsed<0},m.used.get=function(){return window.performance.memory.usedJSHeapSize},m.total.get=function(){return this._total},g.prototype.counter=function(t,i){return new p(this,t,i)},Object.defineProperties(g.prototype,m);var w={memory:g},_=document.createElement("style");_.type="text/css",_.textContent="\n  .pstats {\n    position: fixed;\n    z-index: 9999;\n\n    padding: 5px;\n    width: 250px;\n    right: 5px;\n    bottom: 5px;\n\n    font-size: 10px;\n    font-family: 'Roboto Condensed', tahoma, sans-serif;\n    overflow: hidden;\n    user-select: none;\n    cursor: default;\n\n    background: #222;\n    border-radius: 3px;\n  }\n\n  .pstats-container {\n    display: block;\n    position: relative;\n    color: #888;\n    white-space: nowrap;\n  }\n\n  .pstats-item {\n    position: absolute;\n    width: 250px;\n    height: 12px;\n    left: 0px;\n  }\n\n  .pstats-label {\n    position: absolute;\n    width: 150px;\n    height: 12px;\n    text-align: left;\n    transition: background 0.3s;\n  }\n\n  .pstats-label.alarm {\n    color: #ccc;\n    background: #800;\n\n    transition: background 0s;\n  }\n\n  .pstats-counter-id {\n    position: absolute;\n    width: 90px;\n    left: 0px;\n  }\n\n  .pstats-counter-value {\n    position: absolute;\n    width: 60px;\n    left: 90px;\n    text-align: right;\n  }\n\n  .pstats-canvas {\n    display: block;\n    position: absolute;\n    right: 0px;\n    top: 1px;\n  }\n\n  .pstats-fraction {\n    position: absolute;\n    width: 250px;\n    left: 0px;\n  }\n\n  .pstats-legend {\n    position: absolute;\n    width: 150px;\n\n    text-align: right;\n  }\n\n  .pstats-legend > span {\n    position: absolute;\n    right: 0px;\n  }\n",document.head.appendChild(_);var C=function(t,i){if(i=i||{},this._showGraph=void 0===i.showGraph||i._showGraph,this._values=i.values||{},this._fractions=i.fractions||[],this._id2counter={},this._id2item={},this._name2extStats={},i.css){var s=document.createElement("style");s.type="text/css",s.textContent=i.css,document.head.appendChild(s)}if(i.extensions)for(var h=0;h<i.extensions.length;++h){var e=i.extensions[h],o=w[e];o?this._name2extStats[e]=new o:console.warn("Can not find extensions "+e+", please register your extension via pstats.register().")}this._root=document.createElement("div"),this._root.className="pstats";var a=document.createElement("div");a.className="pstats-container",this._root.appendChild(a);var f=0;for(var l in this._values){var v=this._values[l],d=document.createElement("div");d.className="pstats-item";var p=document.createElement("div");p.className="pstats-label";var g=document.createElement("span");g.className="pstats-counter-id",g.textContent=v.desc||l;var m=document.createElement("div");m.className="pstats-counter-value";var _=document.createTextNode("");_.nodeValue="0",p.appendChild(g),p.appendChild(m),m.appendChild(_),d.appendChild(p);var C=void 0;this._showGraph&&(C=void 0!==v.min||void 0!==v.max?new c(d,v.color,v.min||0,v.max||9999):v.threshold?new r(d,v.color):new n(d,v.color))._(95,10),this._id2item[l]={label:p,valueText:_,graph:C},d.style.top=f+"px",a.appendChild(d),f+=12}if(this._showGraph&&i.fractions)for(var b=0;b<i.fractions.length;++b){var y=i.fractions[b],T=y.steps,S=10*T.length+2;y.colors=y.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];var A=document.createElement("div");A.className="pstats-fraction";var M=document.createElement("div");M.className="pstats-legend",M.style.height=S+"px";for(var x=0;x<T.length;++x){var E=document.createElement("span");E.textContent=T[x],E.style.color=y.colors[x],E.style.top=10*x+"px",M.appendChild(E)}A.appendChild(M),A.style.height=S+"px",A.style.top=f+"px";var O=new u(A,y.colors);O._(95,10,T.length),y.graph=O,y.values=new Array(T.length),a.appendChild(A),f+=10*T.length+2}a.style.height=f+"px",this._root.style.height=f+"px",this._showGraph||(this._root.style.width="150px"),t.appendChild(this._root)};return C.prototype.item=function(t){if(!t)return null;var i=this._id2counter[t];if(i)return i;var s=this._values[t];if(!s)return null;if(s.extension){var n=s.extension.indexOf("."),h=s.extension.substring(0,n),r=this._name2extStats[h];if(!r)return console.error("extension "+h+" not found, make sure you have register and enable it."),null;i=r.counter(t,s)}else i=new l(t,s);return this._id2counter[t]=i,i},C.prototype.tick=function(){for(var t in this._name2extStats)this._name2extStats[t].tick();for(var i in this._values){var s=this._id2counter[i];if(s){s.sample();var n=s.alarm(),h=s.human(),r=this._id2item[i];r.label.classList.toggle("alarm",n>0),r.valueText.nodeValue=h,this._showGraph&&r.graph.draw(s.value,n)}}if(this._showGraph)for(var e=0;e<this._fractions.length;++e){var c=this._fractions[e],o=this._id2counter[c.base];if(o){for(var u=c.steps,a=0;a<u.length;++a){var f=u[a],l=this._id2counter[f];l&&(c.values[a]=l.value/o.value)}c.graph.draw(c.values)}}},function(){if(void 0===window.performance&&(window.performance={}),!window.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}window.performance.mark||(window.performance.mark=function(){}),window.performance.measure||(window.performance.measure=function(){}),window.performance.memory||(window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0})}(),{new:function(t,i){var s=new C(t,i);return function(t){return t?s.item(t):s}},register:function(t,i){w[t]=i}}}()},{}],313:[function(t,i,s){function n(t,i){return"if(typeof "+t+'=="undefined")'+t+"="+i+";"}function h(t){return"typeof "+t+'=="object"'}Function(n("CC_TEST",h("tap")+"||"+h("QUnit"))+n("CC_EDITOR",h("Editor")+"&&"+h("process")+'&&"electron" in process.versions')+n("CC_PREVIEW","!CC_EDITOR")+n("CC_DEV",!0)+n("CC_DEBUG",!0)+n("CC_JSB",h("jsb"))+n("CC_BUILD",!1))(),cc={},_ccsg={},t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/typescript"),t("./cocos2d/kazmath"),t("./cocos2d/core/predefine"),ccui={},ccs={},cp={},t("./cocos2d/shaders"),t("./CCBoot"),t("./cocos2d"),t("./extends"),i.exports=cc},{"./CCBoot":1,"./CCDebugger":2,"./DebugInfos":3,"./cocos2d":240,"./cocos2d/core/predefine":198,"./cocos2d/kazmath":244,"./cocos2d/shaders":274,"./extends":289,"./package.json":void 0,"./polyfill/array":314,"./polyfill/misc":315,"./polyfill/string":316,"./polyfill/typescript":317}],314:[function(t,i,s){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)})},{}],315:[function(t,i,s){if(Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&(0|t)===t}),!console.time){var n=window.performance||Date,h=Object.create(null);console.time=function(t){h[t]=n.now()},console.timeEnd=function(t){var i=h[t],s=n.now()-i;console.log(t+": "+s+"ms")}}},{}],316:[function(t,i,s){String.prototype.startsWith||(String.prototype.startsWith=function(t,i){return i=i||0,this.lastIndexOf(t,i)===i}),String.prototype.endsWith||(String.prototype.endsWith=function(t,i){(void 0===i||i>this.length)&&(i=this.length),i-=t.length;var s=this.indexOf(t,i);return-1!==s&&s===i})},{}],317:[function(t,i,s){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])};window.__extends=function(t,i){function s(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)},window.__assign=Object.assign||function(t){for(var i,s=1,n=arguments.length;s<n;s++){i=arguments[s];for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h])}return t},window.__rest=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(n=Object.getOwnPropertySymbols(t);h<n.length;h++)i.indexOf(n[h])<0&&(s[n[h]]=t[n[h]])}return s},window.__decorate=function(t,i,s,n){var h,r=arguments.length,e=r<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)e=Reflect.decorate(t,i,s,n);else for(var c=t.length-1;c>=0;c--)(h=t[c])&&(e=(r<3?h(e):r>3?h(i,s,e):h(i,s))||e);return r>3&&e&&Object.defineProperty(i,s,e),e},window.__param=function(t,i){return function(s,n){i(s,n,t)}},window.__metadata=function(t,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,i)},window.__awaiter=function(t,i,s,n){return new(s||(s=Promise))(function(h,r){function e(t){try{o(n.next(t))}catch(t){r(t)}}function c(t){try{o(n.throw(t))}catch(t){r(t)}}function o(t){t.done?h(t.value):new s(function(i){i(t.value)}).then(e,c)}o((n=n.apply(t,i||[])).next())})},window.__generator=function(t,i){function s(s){return function(e){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,h&&(r=h[2&s[0]?"return":s[0]?"throw":"next"])&&!(r=r.call(h,s[1])).done)return r;switch(h=0,r&&(s=[0,r.value]),s[0]){case 0:case 1:r=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,h=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(r=c.trys,!(r=r.length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){c=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){c.label=s[1];break}if(6===s[0]&&c.label<r[1]){c.label=r[1],r=s;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(s);break}r[2]&&c.ops.pop(),c.trys.pop();continue}s=i.call(t,c)}catch(t){s=[6,t],h=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,e])}}var n,h,r,e,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},window.__exportStar=function(t,i){for(var s in t)i.hasOwnProperty(s)||(i[s]=t[s])},window.__values=function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],s=0;return i?i.call(t):{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}}},window.__read=function(t,i){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var n,h,r=s.call(t),e=[];try{for(;(void 0===i||i-- >0)&&!(n=r.next()).done;)e.push(n.value)}catch(t){h={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(h)throw h.error}}return e},window.__spread=function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,i,s){function n(t){u[t]&&(o[t]=function(i){return new Promise(function(s,n){a.push([t,i,s,n])>1||h(t,i)})})}function h(t,i){try{!function(t){t.value instanceof __await?Promise.resolve(t.value.v).then(r,e):c(a[0][2],t)}(u[t](i))}catch(t){c(a[0][3],t)}}function r(t){h("next",t)}function e(t){h("throw",t)}function c(t,i){t(i),a.shift(),a.length&&h(a[0][0],a[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,u=s.apply(t,i||[]),a=[];return o={},n("next"),n("throw"),n("return"),o[Symbol.asyncIterator]=function(){return this},o},window.__asyncDelegator=function(t){function i(i,h){t[i]&&(s[i]=function(s){return(n=!n)?{value:__await(t[i](s)),done:"return"===i}:h?h(s):s})}var s,n;return s={},i("next"),i("throw",function(t){throw t}),i("return"),s[Symbol.iterator]=function(){return this},s},window.__asyncValues=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t[Symbol.asyncIterator];return i?i.call(t):"function"==typeof __values?__values(t):t[Symbol.iterator]()}},{}]},{},[313]);